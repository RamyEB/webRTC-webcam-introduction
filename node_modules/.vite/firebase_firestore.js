import {
  Component,
  LogLevel,
  Logger,
  __awaiter,
  __extends,
  __generator,
  __name,
  __spreadArray,
  index_esm_default
} from "./chunk-JZRFVQNE.js";

// ../../../node_modules/@firebase/util/dist/index.esm.js
function getUA() {
  if (typeof navigator !== "undefined" && typeof navigator["userAgent"] === "string") {
    return navigator["userAgent"];
  } else {
    return "";
  }
}
__name(getUA, "getUA");
function isMobileCordova() {
  return typeof window !== "undefined" && !!(window["cordova"] || window["phonegap"] || window["PhoneGap"]) && /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA());
}
__name(isMobileCordova, "isMobileCordova");
function isBrowserExtension() {
  var runtime = typeof chrome === "object" ? chrome.runtime : typeof browser === "object" ? browser.runtime : void 0;
  return typeof runtime === "object" && runtime.id !== void 0;
}
__name(isBrowserExtension, "isBrowserExtension");
function isReactNative() {
  return typeof navigator === "object" && navigator["product"] === "ReactNative";
}
__name(isReactNative, "isReactNative");
function isElectron() {
  return getUA().indexOf("Electron/") >= 0;
}
__name(isElectron, "isElectron");
function isIE() {
  var ua3 = getUA();
  return ua3.indexOf("MSIE ") >= 0 || ua3.indexOf("Trident/") >= 0;
}
__name(isIE, "isIE");
function isUWP() {
  return getUA().indexOf("MSAppHost/") >= 0;
}
__name(isUWP, "isUWP");

// ../../../node_modules/@firebase/webchannel-wrapper/dist/index.esm.js
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var extendStatics = /* @__PURE__ */ __name(function(d, b) {
  extendStatics = Object.setPrototypeOf || {__proto__: []} instanceof Array && function(d2, b2) {
    d2.__proto__ = b2;
  } || function(d2, b2) {
    for (var p2 in b2)
      if (Object.prototype.hasOwnProperty.call(b2, p2))
        d2[p2] = b2[p2];
  };
  return extendStatics(d, b);
}, "extendStatics");
function __extends2(d, b) {
  extendStatics(d, b);
  function __() {
    this.constructor = d;
  }
  __name(__, "__");
  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}
__name(__extends2, "__extends");
function __values(o) {
  var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
  if (m)
    return m.call(o);
  if (o && typeof o.length === "number")
    return {
      next: function() {
        if (o && i >= o.length)
          o = void 0;
        return {value: o && o[i++], done: !o};
      }
    };
  throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}
__name(__values, "__values");
var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
var h;
var goog = goog || {};
var k = commonjsGlobal || self;
function aa() {
}
__name(aa, "aa");
function ba(a) {
  var b = typeof a;
  b = b != "object" ? b : a ? Array.isArray(a) ? "array" : b : "null";
  return b == "array" || b == "object" && typeof a.length == "number";
}
__name(ba, "ba");
function n(a) {
  var b = typeof a;
  return b == "object" && a != null || b == "function";
}
__name(n, "n");
function ca(a) {
  return Object.prototype.hasOwnProperty.call(a, da) && a[da] || (a[da] = ++ea);
}
__name(ca, "ca");
var da = "closure_uid_" + (1e9 * Math.random() >>> 0);
var ea = 0;
function fa(a, b, c) {
  return a.call.apply(a.bind, arguments);
}
__name(fa, "fa");
function ha(a, b, c) {
  if (!a)
    throw Error();
  if (2 < arguments.length) {
    var d = Array.prototype.slice.call(arguments, 2);
    return function() {
      var e = Array.prototype.slice.call(arguments);
      Array.prototype.unshift.apply(e, d);
      return a.apply(b, e);
    };
  }
  return function() {
    return a.apply(b, arguments);
  };
}
__name(ha, "ha");
function p(a, b, c) {
  Function.prototype.bind && Function.prototype.bind.toString().indexOf("native code") != -1 ? p = fa : p = ha;
  return p.apply(null, arguments);
}
__name(p, "p");
function ja(a, b) {
  var c = Array.prototype.slice.call(arguments, 1);
  return function() {
    var d = c.slice();
    d.push.apply(d, arguments);
    return a.apply(this, d);
  };
}
__name(ja, "ja");
function q() {
  return Date.now();
}
__name(q, "q");
function r(a, b) {
  function c() {
  }
  __name(c, "c");
  c.prototype = b.prototype;
  a.X = b.prototype;
  a.prototype = new c();
  a.prototype.constructor = a;
  a.Kb = function(d, e, f) {
    for (var g = Array(arguments.length - 2), m = 2; m < arguments.length; m++)
      g[m - 2] = arguments[m];
    return b.prototype[e].apply(d, g);
  };
}
__name(r, "r");
function t() {
  this.j = this.j;
  this.i = this.i;
}
__name(t, "t");
var ka = 0;
t.prototype.j = false;
t.prototype.ja = function() {
  if (!this.j && (this.j = true, this.G(), ka != 0)) {
    var a = ca(this);
  }
};
t.prototype.G = function() {
  if (this.i)
    for (; this.i.length; )
      this.i.shift()();
};
var ma = Array.prototype.indexOf ? function(a, b) {
  return Array.prototype.indexOf.call(a, b, void 0);
} : function(a, b) {
  if (typeof a === "string")
    return typeof b !== "string" || b.length != 1 ? -1 : a.indexOf(b, 0);
  for (var c = 0; c < a.length; c++)
    if (c in a && a[c] === b)
      return c;
  return -1;
};
var na = Array.prototype.forEach ? function(a, b, c) {
  Array.prototype.forEach.call(a, b, c);
} : function(a, b, c) {
  for (var d = a.length, e = typeof a === "string" ? a.split("") : a, f = 0; f < d; f++)
    f in e && b.call(c, e[f], f, a);
};
function oa(a) {
  a: {
    var b = pa;
    for (var c = a.length, d = typeof a === "string" ? a.split("") : a, e = 0; e < c; e++)
      if (e in d && b.call(void 0, d[e], e, a)) {
        b = e;
        break a;
      }
    b = -1;
  }
  return 0 > b ? null : typeof a === "string" ? a.charAt(b) : a[b];
}
__name(oa, "oa");
function qa(a) {
  return Array.prototype.concat.apply([], arguments);
}
__name(qa, "qa");
function ra(a) {
  var b = a.length;
  if (0 < b) {
    for (var c = Array(b), d = 0; d < b; d++)
      c[d] = a[d];
    return c;
  }
  return [];
}
__name(ra, "ra");
function sa(a) {
  return /^[\s\xa0]*$/.test(a);
}
__name(sa, "sa");
var ta = String.prototype.trim ? function(a) {
  return a.trim();
} : function(a) {
  return /^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1];
};
function v(a, b) {
  return a.indexOf(b) != -1;
}
__name(v, "v");
function ua(a, b) {
  return a < b ? -1 : a > b ? 1 : 0;
}
__name(ua, "ua");
var w;
a: {
  va2 = k.navigator;
  if (va2) {
    wa2 = va2.userAgent;
    if (wa2) {
      w = wa2;
      break a;
    }
  }
  w = "";
}
var va2;
var wa2;
function za(a, b, c) {
  for (var d in a)
    b.call(c, a[d], d, a);
}
__name(za, "za");
function Aa(a) {
  var b = {};
  for (var c in a)
    b[c] = a[c];
  return b;
}
__name(Aa, "Aa");
var Ba = "constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function Ca(a, b) {
  var c, d;
  for (var e = 1; e < arguments.length; e++) {
    d = arguments[e];
    for (c in d)
      a[c] = d[c];
    for (var f = 0; f < Ba.length; f++)
      c = Ba[f], Object.prototype.hasOwnProperty.call(d, c) && (a[c] = d[c]);
  }
}
__name(Ca, "Ca");
function Da(a) {
  Da[" "](a);
  return a;
}
__name(Da, "Da");
Da[" "] = aa;
function Ea(a, b) {
  var c = Fa;
  return Object.prototype.hasOwnProperty.call(c, a) ? c[a] : c[a] = b(a);
}
__name(Ea, "Ea");
var Ga = v(w, "Opera");
var x = v(w, "Trident") || v(w, "MSIE");
var Ha = v(w, "Edge");
var Ia = Ha || x;
var Ja = v(w, "Gecko") && !(v(w.toLowerCase(), "webkit") && !v(w, "Edge")) && !(v(w, "Trident") || v(w, "MSIE")) && !v(w, "Edge");
var Ka = v(w.toLowerCase(), "webkit") && !v(w, "Edge");
function La() {
  var a = k.document;
  return a ? a.documentMode : void 0;
}
__name(La, "La");
var Ma;
a: {
  Na2 = "", Oa2 = function() {
    var a = w;
    if (Ja)
      return /rv:([^\);]+)(\)|;)/.exec(a);
    if (Ha)
      return /Edge\/([\d\.]+)/.exec(a);
    if (x)
      return /\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);
    if (Ka)
      return /WebKit\/(\S+)/.exec(a);
    if (Ga)
      return /(?:Version)[ \/]?(\S+)/.exec(a);
  }();
  Oa2 && (Na2 = Oa2 ? Oa2[1] : "");
  if (x) {
    Pa2 = La();
    if (Pa2 != null && Pa2 > parseFloat(Na2)) {
      Ma = String(Pa2);
      break a;
    }
  }
  Ma = Na2;
}
var Na2;
var Oa2;
var Pa2;
var Fa = {};
function Qa(a) {
  return Ea(a, function() {
    {
      var b = 0;
      var e = ta(String(Ma)).split("."), f = ta(String(a)).split("."), g = Math.max(e.length, f.length);
      for (var m = 0; b == 0 && m < g; m++) {
        var c = e[m] || "", d = f[m] || "";
        do {
          c = /(\d*)(\D*)(.*)/.exec(c) || ["", "", "", ""];
          d = /(\d*)(\D*)(.*)/.exec(d) || ["", "", "", ""];
          if (c[0].length == 0 && d[0].length == 0)
            break;
          b = ua(c[1].length == 0 ? 0 : parseInt(c[1], 10), d[1].length == 0 ? 0 : parseInt(d[1], 10)) || ua(c[2].length == 0, d[2].length == 0) || ua(c[2], d[2]);
          c = c[3];
          d = d[3];
        } while (b == 0);
      }
    }
    return 0 <= b;
  });
}
__name(Qa, "Qa");
var Ra;
if (k.document && x) {
  Sa2 = La();
  Ra = Sa2 ? Sa2 : parseInt(Ma, 10) || void 0;
} else
  Ra = void 0;
var Sa2;
var Ta = Ra;
var Ua = !x || 9 <= Number(Ta);
var Va = x && !Qa("9");
var Wa = function() {
  if (!k.addEventListener || !Object.defineProperty)
    return false;
  var a = false, b = Object.defineProperty({}, "passive", {get: function() {
    a = true;
  }});
  try {
    k.addEventListener("test", aa, b), k.removeEventListener("test", aa, b);
  } catch (c) {
  }
  return a;
}();
function y(a, b) {
  this.type = a;
  this.a = this.target = b;
  this.defaultPrevented = false;
}
__name(y, "y");
y.prototype.b = function() {
  this.defaultPrevented = true;
};
function z(a, b) {
  y.call(this, a ? a.type : "");
  this.relatedTarget = this.a = this.target = null;
  this.button = this.screenY = this.screenX = this.clientY = this.clientX = 0;
  this.key = "";
  this.metaKey = this.shiftKey = this.altKey = this.ctrlKey = false;
  this.pointerId = 0;
  this.pointerType = "";
  this.c = null;
  if (a) {
    var c = this.type = a.type, d = a.changedTouches && a.changedTouches.length ? a.changedTouches[0] : null;
    this.target = a.target || a.srcElement;
    this.a = b;
    if (b = a.relatedTarget) {
      if (Ja) {
        a: {
          try {
            Da(b.nodeName);
            var e = true;
            break a;
          } catch (f) {
          }
          e = false;
        }
        e || (b = null);
      }
    } else
      c == "mouseover" ? b = a.fromElement : c == "mouseout" && (b = a.toElement);
    this.relatedTarget = b;
    d ? (this.clientX = d.clientX !== void 0 ? d.clientX : d.pageX, this.clientY = d.clientY !== void 0 ? d.clientY : d.pageY, this.screenX = d.screenX || 0, this.screenY = d.screenY || 0) : (this.clientX = a.clientX !== void 0 ? a.clientX : a.pageX, this.clientY = a.clientY !== void 0 ? a.clientY : a.pageY, this.screenX = a.screenX || 0, this.screenY = a.screenY || 0);
    this.button = a.button;
    this.key = a.key || "";
    this.ctrlKey = a.ctrlKey;
    this.altKey = a.altKey;
    this.shiftKey = a.shiftKey;
    this.metaKey = a.metaKey;
    this.pointerId = a.pointerId || 0;
    this.pointerType = typeof a.pointerType === "string" ? a.pointerType : Xa[a.pointerType] || "";
    this.c = a;
    a.defaultPrevented && this.b();
  }
}
__name(z, "z");
r(z, y);
var Xa = {2: "touch", 3: "pen", 4: "mouse"};
z.prototype.b = function() {
  z.X.b.call(this);
  var a = this.c;
  if (a.preventDefault)
    a.preventDefault();
  else if (a.returnValue = false, Va)
    try {
      if (a.ctrlKey || 112 <= a.keyCode && 123 >= a.keyCode)
        a.keyCode = -1;
    } catch (b) {
    }
};
var A = "closure_listenable_" + (1e6 * Math.random() | 0);
var Ya = 0;
function Za(a, b, c, d, e) {
  this.listener = a;
  this.proxy = null;
  this.src = b;
  this.type = c;
  this.capture = !!d;
  this.ca = e;
  this.key = ++Ya;
  this.Y = this.Z = false;
}
__name(Za, "Za");
function $a(a) {
  a.Y = true;
  a.listener = null;
  a.proxy = null;
  a.src = null;
  a.ca = null;
}
__name($a, "$a");
function ab(a) {
  this.src = a;
  this.a = {};
  this.b = 0;
}
__name(ab, "ab");
ab.prototype.add = function(a, b, c, d, e) {
  var f = a.toString();
  a = this.a[f];
  a || (a = this.a[f] = [], this.b++);
  var g = bb(a, b, d, e);
  -1 < g ? (b = a[g], c || (b.Z = false)) : (b = new Za(b, this.src, f, !!d, e), b.Z = c, a.push(b));
  return b;
};
function cb(a, b) {
  var c = b.type;
  if (c in a.a) {
    var d = a.a[c], e = ma(d, b), f;
    (f = 0 <= e) && Array.prototype.splice.call(d, e, 1);
    f && ($a(b), a.a[c].length == 0 && (delete a.a[c], a.b--));
  }
}
__name(cb, "cb");
function bb(a, b, c, d) {
  for (var e = 0; e < a.length; ++e) {
    var f = a[e];
    if (!f.Y && f.listener == b && f.capture == !!c && f.ca == d)
      return e;
  }
  return -1;
}
__name(bb, "bb");
var db = "closure_lm_" + (1e6 * Math.random() | 0);
var eb = {};
function gb(a, b, c, d, e) {
  if (d && d.once)
    return hb(a, b, c, d, e);
  if (Array.isArray(b)) {
    for (var f = 0; f < b.length; f++)
      gb(a, b[f], c, d, e);
    return null;
  }
  c = ib(c);
  return a && a[A] ? a.va(b, c, n(d) ? !!d.capture : !!d, e) : jb(a, b, c, false, d, e);
}
__name(gb, "gb");
function jb(a, b, c, d, e, f) {
  if (!b)
    throw Error("Invalid event type");
  var g = n(e) ? !!e.capture : !!e;
  if (g && !Ua)
    return null;
  var m = kb(a);
  m || (a[db] = m = new ab(a));
  c = m.add(b, c, d, g, f);
  if (c.proxy)
    return c;
  d = lb();
  c.proxy = d;
  d.src = a;
  d.listener = c;
  if (a.addEventListener)
    Wa || (e = g), e === void 0 && (e = false), a.addEventListener(b.toString(), d, e);
  else if (a.attachEvent)
    a.attachEvent(mb(b.toString()), d);
  else if (a.addListener && a.removeListener)
    a.addListener(d);
  else
    throw Error("addEventListener and attachEvent are unavailable.");
  return c;
}
__name(jb, "jb");
function lb() {
  var a = nb, b = Ua ? function(c) {
    return a.call(b.src, b.listener, c);
  } : function(c) {
    c = a.call(b.src, b.listener, c);
    if (!c)
      return c;
  };
  return b;
}
__name(lb, "lb");
function hb(a, b, c, d, e) {
  if (Array.isArray(b)) {
    for (var f = 0; f < b.length; f++)
      hb(a, b[f], c, d, e);
    return null;
  }
  c = ib(c);
  return a && a[A] ? a.wa(b, c, n(d) ? !!d.capture : !!d, e) : jb(a, b, c, true, d, e);
}
__name(hb, "hb");
function ob(a, b, c, d, e) {
  if (Array.isArray(b))
    for (var f = 0; f < b.length; f++)
      ob(a, b[f], c, d, e);
  else
    (d = n(d) ? !!d.capture : !!d, c = ib(c), a && a[A]) ? (a = a.c, b = String(b).toString(), b in a.a && (f = a.a[b], c = bb(f, c, d, e), -1 < c && ($a(f[c]), Array.prototype.splice.call(f, c, 1), f.length == 0 && (delete a.a[b], a.b--)))) : a && (a = kb(a)) && (b = a.a[b.toString()], a = -1, b && (a = bb(b, c, d, e)), (c = -1 < a ? b[a] : null) && pb(c));
}
__name(ob, "ob");
function pb(a) {
  if (typeof a !== "number" && a && !a.Y) {
    var b = a.src;
    if (b && b[A])
      cb(b.c, a);
    else {
      var c = a.type, d = a.proxy;
      b.removeEventListener ? b.removeEventListener(c, d, a.capture) : b.detachEvent ? b.detachEvent(mb(c), d) : b.addListener && b.removeListener && b.removeListener(d);
      (c = kb(b)) ? (cb(c, a), c.b == 0 && (c.src = null, b[db] = null)) : $a(a);
    }
  }
}
__name(pb, "pb");
function mb(a) {
  return a in eb ? eb[a] : eb[a] = "on" + a;
}
__name(mb, "mb");
function qb(a, b) {
  var c = a.listener, d = a.ca || a.src;
  a.Z && pb(a);
  return c.call(d, b);
}
__name(qb, "qb");
function nb(a, b) {
  if (a.Y)
    return true;
  if (!Ua) {
    if (!b)
      a: {
        b = ["window", "event"];
        for (var c = k, d = 0; d < b.length; d++)
          if (c = c[b[d]], c == null) {
            b = null;
            break a;
          }
        b = c;
      }
    b = new z(b, this);
    return qb(a, b);
  }
  return qb(a, new z(b, this));
}
__name(nb, "nb");
function kb(a) {
  a = a[db];
  return a instanceof ab ? a : null;
}
__name(kb, "kb");
var sb = "__closure_events_fn_" + (1e9 * Math.random() >>> 0);
function ib(a) {
  if (typeof a === "function")
    return a;
  a[sb] || (a[sb] = function(b) {
    return a.handleEvent(b);
  });
  return a[sb];
}
__name(ib, "ib");
function D() {
  t.call(this);
  this.c = new ab(this);
  this.J = this;
  this.C = null;
}
__name(D, "D");
r(D, t);
D.prototype[A] = true;
h = D.prototype;
h.addEventListener = function(a, b, c, d) {
  gb(this, a, b, c, d);
};
h.removeEventListener = function(a, b, c, d) {
  ob(this, a, b, c, d);
};
function E(a, b) {
  var c, d = a.C;
  if (d)
    for (c = []; d; d = d.C)
      c.push(d);
  a = a.J;
  d = b.type || b;
  if (typeof b === "string")
    b = new y(b, a);
  else if (b instanceof y)
    b.target = b.target || a;
  else {
    var e = b;
    b = new y(d, a);
    Ca(b, e);
  }
  e = true;
  if (c)
    for (var f = c.length - 1; 0 <= f; f--) {
      var g = b.a = c[f];
      e = tb(g, d, true, b) && e;
    }
  g = b.a = a;
  e = tb(g, d, true, b) && e;
  e = tb(g, d, false, b) && e;
  if (c)
    for (f = 0; f < c.length; f++)
      g = b.a = c[f], e = tb(g, d, false, b) && e;
}
__name(E, "E");
h.G = function() {
  D.X.G.call(this);
  if (this.c) {
    var a = this.c, c;
    for (c in a.a) {
      for (var d = a.a[c], e = 0; e < d.length; e++)
        $a(d[e]);
      delete a.a[c];
      a.b--;
    }
  }
  this.C = null;
};
h.va = function(a, b, c, d) {
  return this.c.add(String(a), b, false, c, d);
};
h.wa = function(a, b, c, d) {
  return this.c.add(String(a), b, true, c, d);
};
function tb(a, b, c, d) {
  b = a.c.a[String(b)];
  if (!b)
    return true;
  b = b.concat();
  for (var e = true, f = 0; f < b.length; ++f) {
    var g = b[f];
    if (g && !g.Y && g.capture == c) {
      var m = g.listener, l = g.ca || g.src;
      g.Z && cb(a.c, g);
      e = m.call(l, d) !== false && e;
    }
  }
  return e && !d.defaultPrevented;
}
__name(tb, "tb");
var ub = k.JSON.stringify;
function vb() {
  this.b = this.a = null;
}
__name(vb, "vb");
var xb = new (function() {
  function class_1(a, b) {
    this.c = a;
    this.f = b;
    this.b = 0;
    this.a = null;
  }
  __name(class_1, "class_1");
  class_1.prototype.get = function() {
    var a;
    0 < this.b ? (this.b--, a = this.a, this.a = a.next, a.next = null) : a = this.c();
    return a;
  };
  return class_1;
}())(function() {
  return new wb();
}, function(a) {
  a.reset();
});
vb.prototype.add = function(a, b) {
  var c = xb.get();
  c.set(a, b);
  this.b ? this.b.next = c : this.a = c;
  this.b = c;
};
function yb() {
  var a = zb, b = null;
  a.a && (b = a.a, a.a = a.a.next, a.a || (a.b = null), b.next = null);
  return b;
}
__name(yb, "yb");
function wb() {
  this.next = this.b = this.a = null;
}
__name(wb, "wb");
wb.prototype.set = function(a, b) {
  this.a = a;
  this.b = b;
  this.next = null;
};
wb.prototype.reset = function() {
  this.next = this.b = this.a = null;
};
function Ab(a) {
  k.setTimeout(function() {
    throw a;
  }, 0);
}
__name(Ab, "Ab");
function Bb(a, b) {
  Cb || Db();
  Eb || (Cb(), Eb = true);
  zb.add(a, b);
}
__name(Bb, "Bb");
var Cb;
function Db() {
  var a = k.Promise.resolve(void 0);
  Cb = /* @__PURE__ */ __name(function() {
    a.then(Fb);
  }, "Cb");
}
__name(Db, "Db");
var Eb = false;
var zb = new vb();
function Fb() {
  for (var a; a = yb(); ) {
    try {
      a.a.call(a.b);
    } catch (c) {
      Ab(c);
    }
    var b = xb;
    b.f(a);
    100 > b.b && (b.b++, a.next = b.a, b.a = a);
  }
  Eb = false;
}
__name(Fb, "Fb");
function Gb(a, b) {
  D.call(this);
  this.b = a || 1;
  this.a = b || k;
  this.f = p(this.Za, this);
  this.g = q();
}
__name(Gb, "Gb");
r(Gb, D);
h = Gb.prototype;
h.aa = false;
h.M = null;
h.Za = function() {
  if (this.aa) {
    var a = q() - this.g;
    0 < a && a < 0.8 * this.b ? this.M = this.a.setTimeout(this.f, this.b - a) : (this.M && (this.a.clearTimeout(this.M), this.M = null), E(this, "tick"), this.aa && (Hb(this), this.start()));
  }
};
h.start = function() {
  this.aa = true;
  this.M || (this.M = this.a.setTimeout(this.f, this.b), this.g = q());
};
function Hb(a) {
  a.aa = false;
  a.M && (a.a.clearTimeout(a.M), a.M = null);
}
__name(Hb, "Hb");
h.G = function() {
  Gb.X.G.call(this);
  Hb(this);
  delete this.a;
};
function Ib(a, b, c) {
  if (typeof a === "function")
    c && (a = p(a, c));
  else if (a && typeof a.handleEvent == "function")
    a = p(a.handleEvent, a);
  else
    throw Error("Invalid listener argument");
  return 2147483647 < Number(b) ? -1 : k.setTimeout(a, b || 0);
}
__name(Ib, "Ib");
function Jb(a) {
  a.a = Ib(function() {
    a.a = null;
    a.c && (a.c = false, Jb(a));
  }, a.h);
  var b = a.b;
  a.b = null;
  a.g.apply(null, b);
}
__name(Jb, "Jb");
var Kb = function(_super) {
  __extends2(Kb2, _super);
  function Kb2(a, b) {
    var _this = _super.call(this) || this;
    _this.g = a;
    _this.h = b;
    _this.b = null;
    _this.c = false;
    _this.a = null;
    return _this;
  }
  __name(Kb2, "Kb");
  Kb2.prototype.f = function(a) {
    this.b = arguments;
    this.a ? this.c = true : Jb(this);
  };
  Kb2.prototype.G = function() {
    _super.prototype.G.call(this);
    this.a && (k.clearTimeout(this.a), this.a = null, this.c = false, this.b = null);
  };
  return Kb2;
}(t);
function F(a) {
  t.call(this);
  this.b = a;
  this.a = {};
}
__name(F, "F");
r(F, t);
var Lb = [];
function Mb(a, b, c, d) {
  Array.isArray(c) || (c && (Lb[0] = c.toString()), c = Lb);
  for (var e = 0; e < c.length; e++) {
    var f = gb(b, c[e], d || a.handleEvent, false, a.b || a);
    if (!f)
      break;
    a.a[f.key] = f;
  }
}
__name(Mb, "Mb");
function Nb(a) {
  za(a.a, function(b, c) {
    this.a.hasOwnProperty(c) && pb(b);
  }, a);
  a.a = {};
}
__name(Nb, "Nb");
F.prototype.G = function() {
  F.X.G.call(this);
  Nb(this);
};
F.prototype.handleEvent = function() {
  throw Error("EventHandler.handleEvent not implemented");
};
function Ob() {
  this.a = true;
}
__name(Ob, "Ob");
function Pb(a, b, c, d, e, f) {
  a.info(function() {
    if (a.a)
      if (f) {
        var g = "";
        for (var m = f.split("&"), l = 0; l < m.length; l++) {
          var u = m[l].split("=");
          if (1 < u.length) {
            var C2 = u[0];
            u = u[1];
            var B2 = C2.split("_");
            g = 2 <= B2.length && B2[1] == "type" ? g + (C2 + "=" + u + "&") : g + (C2 + "=redacted&");
          }
        }
      } else
        g = null;
    else
      g = f;
    return "XMLHTTP REQ (" + d + ") [attempt " + e + "]: " + b + "\n" + c + "\n" + g;
  });
}
__name(Pb, "Pb");
function Qb(a, b, c, d, e, f, g) {
  a.info(function() {
    return "XMLHTTP RESP (" + d + ") [ attempt " + e + "]: " + b + "\n" + c + "\n" + f + " " + g;
  });
}
__name(Qb, "Qb");
function G(a, b, c, d) {
  a.info(function() {
    return "XMLHTTP TEXT (" + b + "): " + Rb(a, c) + (d ? " " + d : "");
  });
}
__name(G, "G");
function Sb(a, b) {
  a.info(function() {
    return "TIMEOUT: " + b;
  });
}
__name(Sb, "Sb");
Ob.prototype.info = function() {
};
function Rb(a, b) {
  if (!a.a)
    return b;
  if (!b)
    return null;
  try {
    var c = JSON.parse(b);
    if (c) {
      for (a = 0; a < c.length; a++)
        if (Array.isArray(c[a])) {
          var d = c[a];
          if (!(2 > d.length)) {
            var e = d[1];
            if (Array.isArray(e) && !(1 > e.length)) {
              var f = e[0];
              if (f != "noop" && f != "stop" && f != "close")
                for (var g = 1; g < e.length; g++)
                  e[g] = "";
            }
          }
        }
    }
    return ub(c);
  } catch (m) {
    return b;
  }
}
__name(Rb, "Rb");
var H = {};
var Tb = null;
function Ub() {
  return Tb = Tb || new D();
}
__name(Ub, "Ub");
H.Fa = "serverreachability";
function Vb(a) {
  y.call(this, H.Fa, a);
}
__name(Vb, "Vb");
r(Vb, y);
function I(a) {
  var b = Ub();
  E(b, new Vb(b, a));
}
__name(I, "I");
H.STAT_EVENT = "statevent";
function Wb(a, b) {
  y.call(this, H.STAT_EVENT, a);
  this.stat = b;
}
__name(Wb, "Wb");
r(Wb, y);
function J(a) {
  var b = Ub();
  E(b, new Wb(b, a));
}
__name(J, "J");
H.Ga = "timingevent";
function Xb(a) {
  y.call(this, H.Ga, a);
}
__name(Xb, "Xb");
r(Xb, y);
function K(a, b) {
  if (typeof a !== "function")
    throw Error("Fn must not be null and must be a function");
  return k.setTimeout(function() {
    a();
  }, b);
}
__name(K, "K");
var Yb = {NO_ERROR: 0, $a: 1, nb: 2, mb: 3, hb: 4, lb: 5, ob: 6, Da: 7, TIMEOUT: 8, rb: 9};
var Zb = {fb: "complete", Bb: "success", Ea: "error", Da: "abort", tb: "ready", ub: "readystatechange", TIMEOUT: "timeout", pb: "incrementaldata", sb: "progress", ib: "downloadprogress", Jb: "uploadprogress"};
function $b() {
}
__name($b, "$b");
$b.prototype.a = null;
function ac(a) {
  var b;
  (b = a.a) || (b = a.a = {});
  return b;
}
__name(ac, "ac");
function bc() {
}
__name(bc, "bc");
var L = {OPEN: "a", eb: "b", Ea: "c", qb: "d"};
function cc() {
  y.call(this, "d");
}
__name(cc, "cc");
r(cc, y);
function dc() {
  y.call(this, "c");
}
__name(dc, "dc");
r(dc, y);
var ec;
function fc() {
}
__name(fc, "fc");
r(fc, $b);
ec = new fc();
function M(a, b, c, d) {
  this.g = a;
  this.c = b;
  this.f = c;
  this.S = d || 1;
  this.J = new F(this);
  this.P = gc;
  a = Ia ? 125 : void 0;
  this.R = new Gb(a);
  this.B = null;
  this.b = false;
  this.j = this.l = this.i = this.H = this.u = this.T = this.o = null;
  this.s = [];
  this.a = null;
  this.D = 0;
  this.h = this.m = null;
  this.N = -1;
  this.A = false;
  this.O = 0;
  this.F = null;
  this.V = this.C = this.U = this.I = false;
}
__name(M, "M");
var gc = 45e3;
var hc = {};
var ic = {};
h = M.prototype;
h.setTimeout = function(a) {
  this.P = a;
};
function jc(a, b, c) {
  a.H = 1;
  a.i = kc(N(b));
  a.j = c;
  a.I = true;
  lc(a, null);
}
__name(jc, "jc");
function lc(a, b) {
  a.u = q();
  mc(a);
  a.l = N(a.i);
  var c = a.l, d = a.S;
  Array.isArray(d) || (d = [String(d)]);
  nc(c.b, "t", d);
  a.D = 0;
  a.a = oc(a.g, a.g.C ? b : null);
  0 < a.O && (a.F = new Kb(p(a.Ca, a, a.a), a.O));
  Mb(a.J, a.a, "readystatechange", a.Xa);
  b = a.B ? Aa(a.B) : {};
  a.j ? (a.m || (a.m = "POST"), b["Content-Type"] = "application/x-www-form-urlencoded", a.a.ba(a.l, a.m, a.j, b)) : (a.m = "GET", a.a.ba(a.l, a.m, null, b));
  I(1);
  Pb(a.c, a.m, a.l, a.f, a.S, a.j);
}
__name(lc, "lc");
h.Xa = function(a) {
  a = a.target;
  var b = this.F;
  b && O(a) == 3 ? b.f() : this.Ca(a);
};
h.Ca = function(a) {
  try {
    if (a == this.a)
      a: {
        var b = O(this.a), c = this.a.ua(), d = this.a.W();
        if (!(3 > b || b == 3 && !Ia && !this.a.$())) {
          this.A || b != 4 || c == 7 || (c == 8 || 0 >= d ? I(3) : I(2));
          pc(this);
          var e = this.a.W();
          this.N = e;
          var f = this.a.$();
          this.b = e == 200;
          Qb(this.c, this.m, this.l, this.f, this.S, b, e);
          if (this.b) {
            if (this.U && !this.C) {
              b: {
                if (this.a) {
                  var g, m = this.a;
                  if ((g = m.a ? m.a.getResponseHeader("X-HTTP-Initial-Response") : null) && !sa(g)) {
                    var l = g;
                    break b;
                  }
                }
                l = null;
              }
              if (l)
                G(this.c, this.f, l, "Initial handshake response via X-HTTP-Initial-Response"), this.C = true, qc(this, l);
              else {
                this.b = false;
                this.h = 3;
                J(12);
                P(this);
                rc(this);
                break a;
              }
            }
            this.I ? (sc(this, b, f), Ia && this.b && b == 3 && (Mb(this.J, this.R, "tick", this.Wa), this.R.start())) : (G(this.c, this.f, f, null), qc(this, f));
            b == 4 && P(this);
            this.b && !this.A && (b == 4 ? uc(this.g, this) : (this.b = false, mc(this)));
          } else
            e == 400 && 0 < f.indexOf("Unknown SID") ? (this.h = 3, J(12)) : (this.h = 0, J(13)), P(this), rc(this);
        }
      }
  } catch (u) {
  } finally {
  }
};
function sc(a, b, c) {
  for (var d = true; !a.A && a.D < c.length; ) {
    var e = vc(a, c);
    if (e == ic) {
      b == 4 && (a.h = 4, J(14), d = false);
      G(a.c, a.f, null, "[Incomplete Response]");
      break;
    } else if (e == hc) {
      a.h = 4;
      J(15);
      G(a.c, a.f, c, "[Invalid Chunk]");
      d = false;
      break;
    } else
      G(a.c, a.f, e, null), qc(a, e);
  }
  b == 4 && c.length == 0 && (a.h = 1, J(16), d = false);
  a.b = a.b && d;
  d ? 0 < c.length && !a.V && (a.V = true, b = a.g, b.a == a && b.U && !b.F && (b.c.info("Great, no buffering proxy detected. Bytes received: " + c.length), wc(b), b.F = true, J(11))) : (G(a.c, a.f, c, "[Invalid Chunked Response]"), P(a), rc(a));
}
__name(sc, "sc");
h.Wa = function() {
  if (this.a) {
    var a = O(this.a), b = this.a.$();
    this.D < b.length && (pc(this), sc(this, a, b), this.b && a != 4 && mc(this));
  }
};
function vc(a, b) {
  var c = a.D, d = b.indexOf("\n", c);
  if (d == -1)
    return ic;
  c = Number(b.substring(c, d));
  if (isNaN(c))
    return hc;
  d += 1;
  if (d + c > b.length)
    return ic;
  b = b.substr(d, c);
  a.D = d + c;
  return b;
}
__name(vc, "vc");
h.cancel = function() {
  this.A = true;
  P(this);
};
function mc(a) {
  a.T = q() + a.P;
  yc(a, a.P);
}
__name(mc, "mc");
function yc(a, b) {
  if (a.o != null)
    throw Error("WatchDog timer not null");
  a.o = K(p(a.Va, a), b);
}
__name(yc, "yc");
function pc(a) {
  a.o && (k.clearTimeout(a.o), a.o = null);
}
__name(pc, "pc");
h.Va = function() {
  this.o = null;
  var a = q();
  0 <= a - this.T ? (Sb(this.c, this.l), this.H != 2 && (I(3), J(17)), P(this), this.h = 2, rc(this)) : yc(this, this.T - a);
};
function rc(a) {
  a.g.v == 0 || a.A || uc(a.g, a);
}
__name(rc, "rc");
function P(a) {
  pc(a);
  var b = a.F;
  b && typeof b.ja == "function" && b.ja();
  a.F = null;
  Hb(a.R);
  Nb(a.J);
  a.a && (b = a.a, a.a = null, b.abort(), b.ja());
}
__name(P, "P");
function qc(a, b) {
  try {
    var c = a.g;
    if (c.v != 0 && (c.a == a || zc(c.b, a))) {
      if (c.I = a.N, !a.C && zc(c.b, a) && c.v == 3) {
        try {
          var d = c.ka.a.parse(b);
        } catch (tc2) {
          d = null;
        }
        if (Array.isArray(d) && d.length == 3) {
          var e = d;
          if (e[0] == 0)
            a: {
              if (!c.j) {
                if (c.a)
                  if (c.a.u + 3e3 < a.u)
                    Ac(c), Bc(c);
                  else
                    break a;
                Cc(c);
                J(18);
              }
            }
          else
            c.oa = e[1], 0 < c.oa - c.P && 37500 > e[2] && c.H && c.o == 0 && !c.m && (c.m = K(p(c.Sa, c), 6e3));
          if (1 >= Dc(c.b) && c.ea) {
            try {
              c.ea();
            } catch (tc2) {
            }
            c.ea = void 0;
          }
        } else
          Q(c, 11);
      } else if ((a.C || c.a == a) && Ac(c), !sa(b))
        for (b = d = c.ka.a.parse(b), d = 0; d < b.length; d++)
          if (e = b[d], c.P = e[0], e = e[1], c.v == 2)
            if (e[0] == "c") {
              c.J = e[1];
              c.ga = e[2];
              var f = e[3];
              f != null && (c.ha = f, c.c.info("VER=" + c.ha));
              var g = e[4];
              g != null && (c.pa = g, c.c.info("SVER=" + c.pa));
              var m = e[5];
              if (m != null && typeof m === "number" && 0 < m) {
                var l = 1.5 * m;
                c.D = l;
                c.c.info("backChannelRequestTimeoutMs_=" + l);
              }
              l = c;
              var u = a.a;
              if (u) {
                var C2 = u.a ? u.a.getResponseHeader("X-Client-Wire-Protocol") : null;
                if (C2) {
                  var B2 = l.b;
                  !B2.a && (v(C2, "spdy") || v(C2, "quic") || v(C2, "h2")) && (B2.f = B2.g, B2.a = new Set(), B2.b && (Ec(B2, B2.b), B2.b = null));
                }
                if (l.A) {
                  var rb = u.a ? u.a.getResponseHeader("X-HTTP-Session-Id") : null;
                  rb && (l.na = rb, R(l.B, l.A, rb));
                }
              }
              c.v = 3;
              c.f && c.f.ta();
              c.U && (c.N = q() - a.u, c.c.info("Handshake RTT: " + c.N + "ms"));
              l = c;
              var xa2 = a;
              l.la = Fc(l, l.C ? l.ga : null, l.fa);
              if (xa2.C) {
                Gc(l.b, xa2);
                var ya2 = xa2, xc2 = l.D;
                xc2 && ya2.setTimeout(xc2);
                ya2.o && (pc(ya2), mc(ya2));
                l.a = xa2;
              } else
                Hc(l);
              0 < c.g.length && Ic(c);
            } else
              e[0] != "stop" && e[0] != "close" || Q(c, 7);
          else
            c.v == 3 && (e[0] == "stop" || e[0] == "close" ? e[0] == "stop" ? Q(c, 7) : Jc(c) : e[0] != "noop" && c.f && c.f.sa(e), c.o = 0);
    }
    I(4);
  } catch (tc2) {
  }
}
__name(qc, "qc");
function Kc(a) {
  if (a.K && typeof a.K == "function")
    return a.K();
  if (typeof a === "string")
    return a.split("");
  if (ba(a)) {
    for (var b = [], c = a.length, d = 0; d < c; d++)
      b.push(a[d]);
    return b;
  }
  b = [];
  c = 0;
  for (d in a)
    b[c++] = a[d];
  return a = b;
}
__name(Kc, "Kc");
function Lc(a, b) {
  if (a.forEach && typeof a.forEach == "function")
    a.forEach(b, void 0);
  else if (ba(a) || typeof a === "string")
    na(a, b, void 0);
  else {
    if (a.L && typeof a.L == "function")
      var c = a.L();
    else if (a.K && typeof a.K == "function")
      c = void 0;
    else if (ba(a) || typeof a === "string") {
      c = [];
      for (var d = a.length, e = 0; e < d; e++)
        c.push(e);
    } else
      for (e in c = [], d = 0, a)
        c[d++] = e;
    d = Kc(a);
    e = d.length;
    for (var f = 0; f < e; f++)
      b.call(void 0, d[f], c && c[f], a);
  }
}
__name(Lc, "Lc");
function S(a, b) {
  this.b = {};
  this.a = [];
  this.c = 0;
  var c = arguments.length;
  if (1 < c) {
    if (c % 2)
      throw Error("Uneven number of arguments");
    for (var d = 0; d < c; d += 2)
      this.set(arguments[d], arguments[d + 1]);
  } else if (a)
    if (a instanceof S)
      for (c = a.L(), d = 0; d < c.length; d++)
        this.set(c[d], a.get(c[d]));
    else
      for (d in a)
        this.set(d, a[d]);
}
__name(S, "S");
h = S.prototype;
h.K = function() {
  Mc(this);
  for (var a = [], b = 0; b < this.a.length; b++)
    a.push(this.b[this.a[b]]);
  return a;
};
h.L = function() {
  Mc(this);
  return this.a.concat();
};
function Mc(a) {
  if (a.c != a.a.length) {
    for (var b = 0, c = 0; b < a.a.length; ) {
      var d = a.a[b];
      T(a.b, d) && (a.a[c++] = d);
      b++;
    }
    a.a.length = c;
  }
  if (a.c != a.a.length) {
    var e = {};
    for (c = b = 0; b < a.a.length; )
      d = a.a[b], T(e, d) || (a.a[c++] = d, e[d] = 1), b++;
    a.a.length = c;
  }
}
__name(Mc, "Mc");
h.get = function(a, b) {
  return T(this.b, a) ? this.b[a] : b;
};
h.set = function(a, b) {
  T(this.b, a) || (this.c++, this.a.push(a));
  this.b[a] = b;
};
h.forEach = function(a, b) {
  for (var c = this.L(), d = 0; d < c.length; d++) {
    var e = c[d], f = this.get(e);
    a.call(b, f, e, this);
  }
};
function T(a, b) {
  return Object.prototype.hasOwnProperty.call(a, b);
}
__name(T, "T");
var Nc = /^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;
function Oc(a, b) {
  if (a) {
    a = a.split("&");
    for (var c = 0; c < a.length; c++) {
      var d = a[c].indexOf("="), e = null;
      if (0 <= d) {
        var f = a[c].substring(0, d);
        e = a[c].substring(d + 1);
      } else
        f = a[c];
      b(f, e ? decodeURIComponent(e.replace(/\+/g, " ")) : "");
    }
  }
}
__name(Oc, "Oc");
function U(a, b) {
  this.c = this.j = this.f = "";
  this.h = null;
  this.i = this.g = "";
  this.a = false;
  if (a instanceof U) {
    this.a = b !== void 0 ? b : a.a;
    Pc(this, a.f);
    this.j = a.j;
    Qc(this, a.c);
    Rc(this, a.h);
    this.g = a.g;
    b = a.b;
    var c = new Sc();
    c.c = b.c;
    b.a && (c.a = new S(b.a), c.b = b.b);
    Tc(this, c);
    this.i = a.i;
  } else
    a && (c = String(a).match(Nc)) ? (this.a = !!b, Pc(this, c[1] || "", true), this.j = Uc(c[2] || ""), Qc(this, c[3] || "", true), Rc(this, c[4]), this.g = Uc(c[5] || "", true), Tc(this, c[6] || "", true), this.i = Uc(c[7] || "")) : (this.a = !!b, this.b = new Sc(null, this.a));
}
__name(U, "U");
U.prototype.toString = function() {
  var a = [], b = this.f;
  b && a.push(Vc(b, Wc, true), ":");
  var c = this.c;
  if (c || b == "file")
    a.push("//"), (b = this.j) && a.push(Vc(b, Wc, true), "@"), a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g, "%$1")), c = this.h, c != null && a.push(":", String(c));
  if (c = this.g)
    this.c && c.charAt(0) != "/" && a.push("/"), a.push(Vc(c, c.charAt(0) == "/" ? Xc : Yc, true));
  (c = this.b.toString()) && a.push("?", c);
  (c = this.i) && a.push("#", Vc(c, Zc));
  return a.join("");
};
function N(a) {
  return new U(a);
}
__name(N, "N");
function Pc(a, b, c) {
  a.f = c ? Uc(b, true) : b;
  a.f && (a.f = a.f.replace(/:$/, ""));
}
__name(Pc, "Pc");
function Qc(a, b, c) {
  a.c = c ? Uc(b, true) : b;
}
__name(Qc, "Qc");
function Rc(a, b) {
  if (b) {
    b = Number(b);
    if (isNaN(b) || 0 > b)
      throw Error("Bad port number " + b);
    a.h = b;
  } else
    a.h = null;
}
__name(Rc, "Rc");
function Tc(a, b, c) {
  b instanceof Sc ? (a.b = b, $c(a.b, a.a)) : (c || (b = Vc(b, ad)), a.b = new Sc(b, a.a));
}
__name(Tc, "Tc");
function R(a, b, c) {
  a.b.set(b, c);
}
__name(R, "R");
function kc(a) {
  R(a, "zx", Math.floor(2147483648 * Math.random()).toString(36) + Math.abs(Math.floor(2147483648 * Math.random()) ^ q()).toString(36));
  return a;
}
__name(kc, "kc");
function bd(a) {
  return a instanceof U ? N(a) : new U(a, void 0);
}
__name(bd, "bd");
function cd(a, b, c, d) {
  var e = new U(null, void 0);
  a && Pc(e, a);
  b && Qc(e, b);
  c && Rc(e, c);
  d && (e.g = d);
  return e;
}
__name(cd, "cd");
function Uc(a, b) {
  return a ? b ? decodeURI(a.replace(/%25/g, "%2525")) : decodeURIComponent(a) : "";
}
__name(Uc, "Uc");
function Vc(a, b, c) {
  return typeof a === "string" ? (a = encodeURI(a).replace(b, dd), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
}
__name(Vc, "Vc");
function dd(a) {
  a = a.charCodeAt(0);
  return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
}
__name(dd, "dd");
var Wc = /[#\/\?@]/g;
var Yc = /[#\?:]/g;
var Xc = /[#\?]/g;
var ad = /[#\?@]/g;
var Zc = /#/g;
function Sc(a, b) {
  this.b = this.a = null;
  this.c = a || null;
  this.f = !!b;
}
__name(Sc, "Sc");
function V(a) {
  a.a || (a.a = new S(), a.b = 0, a.c && Oc(a.c, function(b, c) {
    a.add(decodeURIComponent(b.replace(/\+/g, " ")), c);
  }));
}
__name(V, "V");
h = Sc.prototype;
h.add = function(a, b) {
  V(this);
  this.c = null;
  a = W(this, a);
  var c = this.a.get(a);
  c || this.a.set(a, c = []);
  c.push(b);
  this.b += 1;
  return this;
};
function ed(a, b) {
  V(a);
  b = W(a, b);
  T(a.a.b, b) && (a.c = null, a.b -= a.a.get(b).length, a = a.a, T(a.b, b) && (delete a.b[b], a.c--, a.a.length > 2 * a.c && Mc(a)));
}
__name(ed, "ed");
function fd(a, b) {
  V(a);
  b = W(a, b);
  return T(a.a.b, b);
}
__name(fd, "fd");
h.forEach = function(a, b) {
  V(this);
  this.a.forEach(function(c, d) {
    na(c, function(e) {
      a.call(b, e, d, this);
    }, this);
  }, this);
};
h.L = function() {
  V(this);
  for (var a = this.a.K(), b = this.a.L(), c = [], d = 0; d < b.length; d++)
    for (var e = a[d], f = 0; f < e.length; f++)
      c.push(b[d]);
  return c;
};
h.K = function(a) {
  V(this);
  var b = [];
  if (typeof a === "string")
    fd(this, a) && (b = qa(b, this.a.get(W(this, a))));
  else {
    a = this.a.K();
    for (var c = 0; c < a.length; c++)
      b = qa(b, a[c]);
  }
  return b;
};
h.set = function(a, b) {
  V(this);
  this.c = null;
  a = W(this, a);
  fd(this, a) && (this.b -= this.a.get(a).length);
  this.a.set(a, [b]);
  this.b += 1;
  return this;
};
h.get = function(a, b) {
  if (!a)
    return b;
  a = this.K(a);
  return 0 < a.length ? String(a[0]) : b;
};
function nc(a, b, c) {
  ed(a, b);
  0 < c.length && (a.c = null, a.a.set(W(a, b), ra(c)), a.b += c.length);
}
__name(nc, "nc");
h.toString = function() {
  if (this.c)
    return this.c;
  if (!this.a)
    return "";
  for (var a = [], b = this.a.L(), c = 0; c < b.length; c++) {
    var d = b[c], e = encodeURIComponent(String(d));
    d = this.K(d);
    for (var f = 0; f < d.length; f++) {
      var g = e;
      d[f] !== "" && (g += "=" + encodeURIComponent(String(d[f])));
      a.push(g);
    }
  }
  return this.c = a.join("&");
};
function W(a, b) {
  b = String(b);
  a.f && (b = b.toLowerCase());
  return b;
}
__name(W, "W");
function $c(a, b) {
  b && !a.f && (V(a), a.c = null, a.a.forEach(function(c, d) {
    var e = d.toLowerCase();
    d != e && (ed(this, d), nc(this, e, c));
  }, a));
  a.f = b;
}
__name($c, "$c");
var gd = function() {
  function gd2(a, b) {
    this.b = a;
    this.a = b;
  }
  __name(gd2, "gd");
  return gd2;
}();
function hd(a) {
  this.g = a || id;
  k.PerformanceNavigationTiming ? (a = k.performance.getEntriesByType("navigation"), a = 0 < a.length && (a[0].nextHopProtocol == "hq" || a[0].nextHopProtocol == "h2")) : a = !!(k.ia && k.ia.ya && k.ia.ya() && k.ia.ya().Lb);
  this.f = a ? this.g : 1;
  this.a = null;
  1 < this.f && (this.a = new Set());
  this.b = null;
  this.c = [];
}
__name(hd, "hd");
var id = 10;
function jd(a) {
  return a.b ? true : a.a ? a.a.size >= a.f : false;
}
__name(jd, "jd");
function Dc(a) {
  return a.b ? 1 : a.a ? a.a.size : 0;
}
__name(Dc, "Dc");
function zc(a, b) {
  return a.b ? a.b == b : a.a ? a.a.has(b) : false;
}
__name(zc, "zc");
function Ec(a, b) {
  a.a ? a.a.add(b) : a.b = b;
}
__name(Ec, "Ec");
function Gc(a, b) {
  a.b && a.b == b ? a.b = null : a.a && a.a.has(b) && a.a.delete(b);
}
__name(Gc, "Gc");
hd.prototype.cancel = function() {
  var e_1, _a2;
  this.c = kd(this);
  if (this.b)
    this.b.cancel(), this.b = null;
  else if (this.a && this.a.size !== 0) {
    try {
      for (var _b = __values(this.a.values()), _c2 = _b.next(); !_c2.done; _c2 = _b.next()) {
        var a = _c2.value;
        a.cancel();
      }
    } catch (e_1_1) {
      e_1 = {error: e_1_1};
    } finally {
      try {
        if (_c2 && !_c2.done && (_a2 = _b.return))
          _a2.call(_b);
      } finally {
        if (e_1)
          throw e_1.error;
      }
    }
    this.a.clear();
  }
};
function kd(a) {
  var e_2, _a2;
  if (a.b != null)
    return a.c.concat(a.b.s);
  if (a.a != null && a.a.size !== 0) {
    var b = a.c;
    try {
      for (var _b = __values(a.a.values()), _c2 = _b.next(); !_c2.done; _c2 = _b.next()) {
        var c = _c2.value;
        b = b.concat(c.s);
      }
    } catch (e_2_1) {
      e_2 = {error: e_2_1};
    } finally {
      try {
        if (_c2 && !_c2.done && (_a2 = _b.return))
          _a2.call(_b);
      } finally {
        if (e_2)
          throw e_2.error;
      }
    }
    return b;
  }
  return ra(a.c);
}
__name(kd, "kd");
function ld() {
}
__name(ld, "ld");
ld.prototype.stringify = function(a) {
  return k.JSON.stringify(a, void 0);
};
ld.prototype.parse = function(a) {
  return k.JSON.parse(a, void 0);
};
function md() {
  this.a = new ld();
}
__name(md, "md");
function nd(a, b, c) {
  var d = c || "";
  try {
    Lc(a, function(e, f) {
      var g = e;
      n(e) && (g = ub(e));
      b.push(d + f + "=" + encodeURIComponent(g));
    });
  } catch (e) {
    throw b.push(d + "type=" + encodeURIComponent("_badmap")), e;
  }
}
__name(nd, "nd");
function od(a, b) {
  var c = new Ob();
  if (k.Image) {
    var d = new Image();
    d.onload = ja(pd, c, d, "TestLoadImage: loaded", true, b);
    d.onerror = ja(pd, c, d, "TestLoadImage: error", false, b);
    d.onabort = ja(pd, c, d, "TestLoadImage: abort", false, b);
    d.ontimeout = ja(pd, c, d, "TestLoadImage: timeout", false, b);
    k.setTimeout(function() {
      if (d.ontimeout)
        d.ontimeout();
    }, 1e4);
    d.src = a;
  } else
    b(false);
}
__name(od, "od");
function pd(a, b, c, d, e) {
  try {
    b.onload = null, b.onerror = null, b.onabort = null, b.ontimeout = null, e(d);
  } catch (f) {
  }
}
__name(pd, "pd");
var qd = k.JSON.parse;
function X(a) {
  D.call(this);
  this.headers = new S();
  this.H = a || null;
  this.b = false;
  this.s = this.a = null;
  this.B = "";
  this.h = 0;
  this.f = "";
  this.g = this.A = this.l = this.u = false;
  this.o = 0;
  this.m = null;
  this.I = rd;
  this.D = this.F = false;
}
__name(X, "X");
r(X, D);
var rd = "";
var sd = /^https?$/i;
var td = ["POST", "PUT"];
h = X.prototype;
h.ba = function(a, b, c, d) {
  if (this.a)
    throw Error("[goog.net.XhrIo] Object is active with another request=" + this.B + "; newUri=" + a);
  b = b ? b.toUpperCase() : "GET";
  this.B = a;
  this.f = "";
  this.h = 0;
  this.u = false;
  this.b = true;
  this.a = new XMLHttpRequest();
  this.s = this.H ? ac(this.H) : ac(ec);
  this.a.onreadystatechange = p(this.za, this);
  try {
    this.A = true, this.a.open(b, String(a), true), this.A = false;
  } catch (f) {
    ud(this, f);
    return;
  }
  a = c || "";
  var e = new S(this.headers);
  d && Lc(d, function(f, g) {
    e.set(g, f);
  });
  d = oa(e.L());
  c = k.FormData && a instanceof k.FormData;
  !(0 <= ma(td, b)) || d || c || e.set("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
  e.forEach(function(f, g) {
    this.a.setRequestHeader(g, f);
  }, this);
  this.I && (this.a.responseType = this.I);
  "withCredentials" in this.a && this.a.withCredentials !== this.F && (this.a.withCredentials = this.F);
  try {
    vd(this), 0 < this.o && ((this.D = wd(this.a)) ? (this.a.timeout = this.o, this.a.ontimeout = p(this.xa, this)) : this.m = Ib(this.xa, this.o, this)), this.l = true, this.a.send(a), this.l = false;
  } catch (f) {
    ud(this, f);
  }
};
function wd(a) {
  return x && Qa(9) && typeof a.timeout === "number" && a.ontimeout !== void 0;
}
__name(wd, "wd");
function pa(a) {
  return a.toLowerCase() == "content-type";
}
__name(pa, "pa");
h.xa = function() {
  typeof goog != "undefined" && this.a && (this.f = "Timed out after " + this.o + "ms, aborting", this.h = 8, E(this, "timeout"), this.abort(8));
};
function ud(a, b) {
  a.b = false;
  a.a && (a.g = true, a.a.abort(), a.g = false);
  a.f = b;
  a.h = 5;
  xd(a);
  yd(a);
}
__name(ud, "ud");
function xd(a) {
  a.u || (a.u = true, E(a, "complete"), E(a, "error"));
}
__name(xd, "xd");
h.abort = function(a) {
  this.a && this.b && (this.b = false, this.g = true, this.a.abort(), this.g = false, this.h = a || 7, E(this, "complete"), E(this, "abort"), yd(this));
};
h.G = function() {
  this.a && (this.b && (this.b = false, this.g = true, this.a.abort(), this.g = false), yd(this, true));
  X.X.G.call(this);
};
h.za = function() {
  this.j || (this.A || this.l || this.g ? zd(this) : this.Ua());
};
h.Ua = function() {
  zd(this);
};
function zd(a) {
  if (a.b && typeof goog != "undefined" && (!a.s[1] || O(a) != 4 || a.W() != 2)) {
    if (a.l && O(a) == 4)
      Ib(a.za, 0, a);
    else if (E(a, "readystatechange"), O(a) == 4) {
      a.b = false;
      try {
        {
          var l = a.W();
          a:
            switch (l) {
              case 200:
              case 201:
              case 202:
              case 204:
              case 206:
              case 304:
              case 1223:
                var b = true;
                break a;
              default:
                b = false;
            }
          var c;
          if (!(c = b)) {
            var d;
            if (d = l === 0) {
              var e = String(a.B).match(Nc)[1] || null;
              if (!e && k.self && k.self.location) {
                var f = k.self.location.protocol;
                e = f.substr(0, f.length - 1);
              }
              d = !sd.test(e ? e.toLowerCase() : "");
            }
            c = d;
          }
          var g = c;
        }
        if (g)
          E(a, "complete"), E(a, "success");
        else {
          a.h = 6;
          try {
            var m = 2 < O(a) ? a.a.statusText : "";
          } catch (l2) {
            m = "";
          }
          a.f = m + " [" + a.W() + "]";
          xd(a);
        }
      } finally {
        yd(a);
      }
    }
  }
}
__name(zd, "zd");
function yd(a, b) {
  if (a.a) {
    vd(a);
    var c = a.a, d = a.s[0] ? aa : null;
    a.a = null;
    a.s = null;
    b || E(a, "ready");
    try {
      c.onreadystatechange = d;
    } catch (e) {
    }
  }
}
__name(yd, "yd");
function vd(a) {
  a.a && a.D && (a.a.ontimeout = null);
  a.m && (k.clearTimeout(a.m), a.m = null);
}
__name(vd, "vd");
function O(a) {
  return a.a ? a.a.readyState : 0;
}
__name(O, "O");
h.W = function() {
  try {
    return 2 < O(this) ? this.a.status : -1;
  } catch (a) {
    return -1;
  }
};
h.$ = function() {
  try {
    return this.a ? this.a.responseText : "";
  } catch (a) {
    return "";
  }
};
h.Pa = function(a) {
  if (this.a) {
    var b = this.a.responseText;
    a && b.indexOf(a) == 0 && (b = b.substring(a.length));
    return qd(b);
  }
};
h.ua = function() {
  return this.h;
};
h.Qa = function() {
  return typeof this.f === "string" ? this.f : String(this.f);
};
function Ad(a) {
  var b = "";
  za(a, function(c, d) {
    b += d;
    b += ":";
    b += c;
    b += "\r\n";
  });
  return b;
}
__name(Ad, "Ad");
function Bd(a, b, c) {
  a: {
    for (d in c) {
      var d = false;
      break a;
    }
    d = true;
  }
  d || (c = Ad(c), typeof a === "string" ? c != null && encodeURIComponent(String(c)) : R(a, b, c));
}
__name(Bd, "Bd");
function Cd(a, b, c) {
  return c && c.internalChannelParams ? c.internalChannelParams[a] || b : b;
}
__name(Cd, "Cd");
function Dd(a) {
  this.pa = 0;
  this.g = [];
  this.c = new Ob();
  this.ga = this.la = this.B = this.fa = this.a = this.na = this.A = this.V = this.i = this.O = this.l = null;
  this.Oa = this.R = 0;
  this.La = Cd("failFast", false, a);
  this.H = this.m = this.j = this.h = this.f = null;
  this.S = true;
  this.I = this.oa = this.P = -1;
  this.T = this.o = this.u = 0;
  this.Ha = Cd("baseRetryDelayMs", 5e3, a);
  this.Ra = Cd("retryDelaySeedMs", 1e4, a);
  this.Ma = Cd("forwardChannelMaxRetries", 2, a);
  this.ma = Cd("forwardChannelRequestTimeoutMs", 2e4, a);
  this.Na = a && a.g || void 0;
  this.D = void 0;
  this.C = a && a.supportsCrossDomainXhr || false;
  this.J = "";
  this.b = new hd(a && a.concurrentRequestLimit);
  this.ka = new md();
  this.da = a && a.fastHandshake || false;
  this.Ia = a && a.b || false;
  a && a.f && (this.c.a = false);
  a && a.forceLongPolling && (this.S = false);
  this.U = !this.da && this.S && a && a.detectBufferingProxy || false;
  this.ea = void 0;
  this.N = 0;
  this.F = false;
  this.s = null;
  (this.Ka = a && a.c || false) && this.c.info("Opt-in to enable Chrome Origin Trials.");
}
__name(Dd, "Dd");
h = Dd.prototype;
h.ha = 8;
h.v = 1;
function Jc(a) {
  Ed(a);
  if (a.v == 3) {
    var b = a.R++, c = N(a.B);
    R(c, "SID", a.J);
    R(c, "RID", b);
    R(c, "TYPE", "terminate");
    Fd(a, c);
    b = new M(a, a.c, b, void 0);
    b.H = 2;
    b.i = kc(N(c));
    c = false;
    k.navigator && k.navigator.sendBeacon && (c = k.navigator.sendBeacon(b.i.toString(), ""));
    !c && k.Image && (new Image().src = b.i, c = true);
    c || (b.a = oc(b.g, null), b.a.ba(b.i));
    b.u = q();
    mc(b);
  }
  Gd(a);
}
__name(Jc, "Jc");
function Bc(a) {
  a.a && (wc(a), a.a.cancel(), a.a = null);
}
__name(Bc, "Bc");
function Ed(a) {
  Bc(a);
  a.j && (k.clearTimeout(a.j), a.j = null);
  Ac(a);
  a.b.cancel();
  a.h && (typeof a.h === "number" && k.clearTimeout(a.h), a.h = null);
}
__name(Ed, "Ed");
function Hd(a, b) {
  a.g.push(new gd(a.Oa++, b));
  a.v == 3 && Ic(a);
}
__name(Hd, "Hd");
function Ic(a) {
  jd(a.b) || a.h || (a.h = true, Bb(a.Ba, a), a.u = 0);
}
__name(Ic, "Ic");
function Id(a, b) {
  if (Dc(a.b) >= a.b.f - (a.h ? 1 : 0))
    return false;
  if (a.h)
    return a.g = b.s.concat(a.g), true;
  if (a.v == 1 || a.v == 2 || a.u >= (a.La ? 0 : a.Ma))
    return false;
  a.h = K(p(a.Ba, a, b), Jd(a, a.u));
  a.u++;
  return true;
}
__name(Id, "Id");
h.Ba = function(a) {
  if (this.h)
    if (this.h = null, this.v == 1) {
      if (!a) {
        this.R = Math.floor(1e5 * Math.random());
        a = this.R++;
        var b = new M(this, this.c, a, void 0), c = this.l;
        this.O && (c ? (c = Aa(c), Ca(c, this.O)) : c = this.O);
        this.i === null && (b.B = c);
        var d;
        if (this.da)
          a: {
            for (var e = d = 0; e < this.g.length; e++) {
              b: {
                var f = this.g[e];
                if ("__data__" in f.a && (f = f.a.__data__, typeof f === "string")) {
                  f = f.length;
                  break b;
                }
                f = void 0;
              }
              if (f === void 0)
                break;
              d += f;
              if (4096 < d) {
                d = e;
                break a;
              }
              if (d === 4096 || e === this.g.length - 1) {
                d = e + 1;
                break a;
              }
            }
            d = 1e3;
          }
        else
          d = 1e3;
        d = Kd(this, b, d);
        e = N(this.B);
        R(e, "RID", a);
        R(e, "CVER", 22);
        this.A && R(e, "X-HTTP-Session-Id", this.A);
        Fd(this, e);
        this.i && c && Bd(e, this.i, c);
        Ec(this.b, b);
        this.Ia && R(e, "TYPE", "init");
        this.da ? (R(e, "$req", d), R(e, "SID", "null"), b.U = true, jc(b, e, null)) : jc(b, e, d);
        this.v = 2;
      }
    } else
      this.v == 3 && (a ? Ld(this, a) : this.g.length == 0 || jd(this.b) || Ld(this));
};
function Ld(a, b) {
  var c;
  b ? c = b.f : c = a.R++;
  var d = N(a.B);
  R(d, "SID", a.J);
  R(d, "RID", c);
  R(d, "AID", a.P);
  Fd(a, d);
  a.i && a.l && Bd(d, a.i, a.l);
  c = new M(a, a.c, c, a.u + 1);
  a.i === null && (c.B = a.l);
  b && (a.g = b.s.concat(a.g));
  b = Kd(a, c, 1e3);
  c.setTimeout(Math.round(0.5 * a.ma) + Math.round(0.5 * a.ma * Math.random()));
  Ec(a.b, c);
  jc(c, d, b);
}
__name(Ld, "Ld");
function Fd(a, b) {
  a.f && Lc({}, function(c, d) {
    R(b, d, c);
  });
}
__name(Fd, "Fd");
function Kd(a, b, c) {
  c = Math.min(a.g.length, c);
  var d = a.f ? p(a.f.Ja, a.f, a) : null;
  a:
    for (var e = a.g, f = -1; ; ) {
      var g = ["count=" + c];
      f == -1 ? 0 < c ? (f = e[0].b, g.push("ofs=" + f)) : f = 0 : g.push("ofs=" + f);
      for (var m = true, l = 0; l < c; l++) {
        var u = e[l].b, C2 = e[l].a;
        u -= f;
        if (0 > u)
          f = Math.max(0, e[l].b - 100), m = false;
        else
          try {
            nd(C2, g, "req" + u + "_");
          } catch (B2) {
            d && d(C2);
          }
      }
      if (m) {
        d = g.join("&");
        break a;
      }
    }
  a = a.g.splice(0, c);
  b.s = a;
  return d;
}
__name(Kd, "Kd");
function Hc(a) {
  a.a || a.j || (a.T = 1, Bb(a.Aa, a), a.o = 0);
}
__name(Hc, "Hc");
function Cc(a) {
  if (a.a || a.j || 3 <= a.o)
    return false;
  a.T++;
  a.j = K(p(a.Aa, a), Jd(a, a.o));
  a.o++;
  return true;
}
__name(Cc, "Cc");
h.Aa = function() {
  this.j = null;
  Md(this);
  if (this.U && !(this.F || this.a == null || 0 >= this.N)) {
    var a = 2 * this.N;
    this.c.info("BP detection timer enabled: " + a);
    this.s = K(p(this.Ta, this), a);
  }
};
h.Ta = function() {
  this.s && (this.s = null, this.c.info("BP detection timeout reached."), this.c.info("Buffering proxy detected and switch to long-polling!"), this.H = false, this.F = true, J(10), Bc(this), Md(this));
};
function wc(a) {
  a.s != null && (k.clearTimeout(a.s), a.s = null);
}
__name(wc, "wc");
function Md(a) {
  a.a = new M(a, a.c, "rpc", a.T);
  a.i === null && (a.a.B = a.l);
  a.a.O = 0;
  var b = N(a.la);
  R(b, "RID", "rpc");
  R(b, "SID", a.J);
  R(b, "CI", a.H ? "0" : "1");
  R(b, "AID", a.P);
  Fd(a, b);
  R(b, "TYPE", "xmlhttp");
  a.i && a.l && Bd(b, a.i, a.l);
  a.D && a.a.setTimeout(a.D);
  var c = a.a;
  a = a.ga;
  c.H = 1;
  c.i = kc(N(b));
  c.j = null;
  c.I = true;
  lc(c, a);
}
__name(Md, "Md");
h.Sa = function() {
  this.m != null && (this.m = null, Bc(this), Cc(this), J(19));
};
function Ac(a) {
  a.m != null && (k.clearTimeout(a.m), a.m = null);
}
__name(Ac, "Ac");
function uc(a, b) {
  var c = null;
  if (a.a == b) {
    Ac(a);
    wc(a);
    a.a = null;
    var d = 2;
  } else if (zc(a.b, b))
    c = b.s, Gc(a.b, b), d = 1;
  else
    return;
  a.I = b.N;
  if (a.v != 0) {
    if (b.b)
      if (d == 1) {
        c = b.j ? b.j.length : 0;
        b = q() - b.u;
        var e = a.u;
        d = Ub();
        E(d, new Xb(d, c, b, e));
        Ic(a);
      } else
        Hc(a);
    else if (e = b.h, e == 3 || e == 0 && 0 < a.I || !(d == 1 && Id(a, b) || d == 2 && Cc(a)))
      switch (c && 0 < c.length && (b = a.b, b.c = b.c.concat(c)), e) {
        case 1:
          Q(a, 5);
          break;
        case 4:
          Q(a, 10);
          break;
        case 3:
          Q(a, 6);
          break;
        default:
          Q(a, 2);
      }
  }
}
__name(uc, "uc");
function Jd(a, b) {
  var c = a.Ha + Math.floor(Math.random() * a.Ra);
  a.f || (c *= 2);
  return c * b;
}
__name(Jd, "Jd");
function Q(a, b) {
  a.c.info("Error code " + b);
  if (b == 2) {
    var c = null;
    a.f && (c = null);
    var d = p(a.Ya, a);
    c || (c = new U("//www.google.com/images/cleardot.gif"), k.location && k.location.protocol == "http" || Pc(c, "https"), kc(c));
    od(c.toString(), d);
  } else
    J(2);
  a.v = 0;
  a.f && a.f.ra(b);
  Gd(a);
  Ed(a);
}
__name(Q, "Q");
h.Ya = function(a) {
  a ? (this.c.info("Successfully pinged google.com"), J(2)) : (this.c.info("Failed to ping google.com"), J(1));
};
function Gd(a) {
  a.v = 0;
  a.I = -1;
  if (a.f) {
    if (kd(a.b).length != 0 || a.g.length != 0)
      a.b.c.length = 0, ra(a.g), a.g.length = 0;
    a.f.qa();
  }
}
__name(Gd, "Gd");
function Fc(a, b, c) {
  var d = bd(c);
  if (d.c != "")
    b && Qc(d, b + "." + d.c), Rc(d, d.h);
  else {
    var e = k.location;
    d = cd(e.protocol, b ? b + "." + e.hostname : e.hostname, +e.port, c);
  }
  a.V && za(a.V, function(f, g) {
    R(d, g, f);
  });
  b = a.A;
  c = a.na;
  b && c && R(d, b, c);
  R(d, "VER", a.ha);
  Fd(a, d);
  return d;
}
__name(Fc, "Fc");
function oc(a, b) {
  if (b && !a.C)
    throw Error("Can't create secondary domain capable XhrIo object.");
  b = new X(a.Na);
  b.F = a.C;
  return b;
}
__name(oc, "oc");
function Nd() {
}
__name(Nd, "Nd");
h = Nd.prototype;
h.ta = function() {
};
h.sa = function() {
};
h.ra = function() {
};
h.qa = function() {
};
h.Ja = function() {
};
function Od() {
  if (x && !(10 <= Number(Ta)))
    throw Error("Environmental error: no available transport.");
}
__name(Od, "Od");
Od.prototype.a = function(a, b) {
  return new Y(a, b);
};
function Y(a, b) {
  D.call(this);
  this.a = new Dd(b);
  this.o = a;
  this.b = b && b.messageUrlParams || null;
  a = b && b.messageHeaders || null;
  b && b.clientProtocolHeaderRequired && (a ? a["X-Client-Protocol"] = "webchannel" : a = {"X-Client-Protocol": "webchannel"});
  this.a.l = a;
  a = b && b.initMessageHeaders || null;
  b && b.messageContentType && (a ? a["X-WebChannel-Content-Type"] = b.messageContentType : a = {"X-WebChannel-Content-Type": b.messageContentType});
  b && b.a && (a ? a["X-WebChannel-Client-Profile"] = b.a : a = {"X-WebChannel-Client-Profile": b.a});
  this.a.O = a;
  (a = b && b.httpHeadersOverwriteParam) && !sa(a) && (this.a.i = a);
  this.m = b && b.supportsCrossDomainXhr || false;
  this.l = b && b.sendRawJson || false;
  (b = b && b.httpSessionIdParam) && !sa(b) && (this.a.A = b, a = this.b, a !== null && b in a && (a = this.b, b in a && delete a[b]));
  this.f = new Z(this);
}
__name(Y, "Y");
r(Y, D);
Y.prototype.g = function() {
  this.a.f = this.f;
  this.m && (this.a.C = true);
  var a = this.a, b = this.o, c = this.b || void 0;
  J(0);
  a.fa = b;
  a.V = c || {};
  a.H = a.S;
  a.B = Fc(a, null, a.fa);
  Ic(a);
};
Y.prototype.close = function() {
  Jc(this.a);
};
Y.prototype.h = function(a) {
  if (typeof a === "string") {
    var b = {};
    b.__data__ = a;
    Hd(this.a, b);
  } else
    this.l ? (b = {}, b.__data__ = ub(a), Hd(this.a, b)) : Hd(this.a, a);
};
Y.prototype.G = function() {
  this.a.f = null;
  delete this.f;
  Jc(this.a);
  delete this.a;
  Y.X.G.call(this);
};
function Pd(a) {
  cc.call(this);
  var b = a.__sm__;
  if (b) {
    a: {
      for (var c in b) {
        a = c;
        break a;
      }
      a = void 0;
    }
    (this.c = a) ? (a = this.c, this.data = b !== null && a in b ? b[a] : void 0) : this.data = b;
  } else
    this.data = a;
}
__name(Pd, "Pd");
r(Pd, cc);
function Qd() {
  dc.call(this);
  this.status = 1;
}
__name(Qd, "Qd");
r(Qd, dc);
function Z(a) {
  this.a = a;
}
__name(Z, "Z");
r(Z, Nd);
Z.prototype.ta = function() {
  E(this.a, "a");
};
Z.prototype.sa = function(a) {
  E(this.a, new Pd(a));
};
Z.prototype.ra = function(a) {
  E(this.a, new Qd(a));
};
Z.prototype.qa = function() {
  E(this.a, "b");
};
Od.prototype.createWebChannel = Od.prototype.a;
Y.prototype.send = Y.prototype.h;
Y.prototype.open = Y.prototype.g;
Y.prototype.close = Y.prototype.close;
Yb.NO_ERROR = 0;
Yb.TIMEOUT = 8;
Yb.HTTP_ERROR = 6;
Zb.COMPLETE = "complete";
bc.EventType = L;
L.OPEN = "a";
L.CLOSE = "b";
L.ERROR = "c";
L.MESSAGE = "d";
D.prototype.listen = D.prototype.va;
X.prototype.listenOnce = X.prototype.wa;
X.prototype.getLastError = X.prototype.Qa;
X.prototype.getLastErrorCode = X.prototype.ua;
X.prototype.getStatus = X.prototype.W;
X.prototype.getResponseJson = X.prototype.Pa;
X.prototype.getResponseText = X.prototype.$;
X.prototype.send = X.prototype.ba;
var createWebChannelTransport = /* @__PURE__ */ __name(function() {
  return new Od();
}, "createWebChannelTransport");
var getStatEventTarget = /* @__PURE__ */ __name(function() {
  return Ub();
}, "getStatEventTarget");
var ErrorCode = Yb;
var EventType = Zb;
var Event = H;
var Stat = {gb: 0, jb: 1, kb: 2, Db: 3, Ib: 4, Fb: 5, Gb: 6, Eb: 7, Cb: 8, Hb: 9, PROXY: 10, NOPROXY: 11, Ab: 12, wb: 13, xb: 14, vb: 15, yb: 16, zb: 17, bb: 18, ab: 19, cb: 20};
var WebChannel = bc;
var XhrIo = X;

// ../../../node_modules/@firebase/firestore/dist/esm5/prebuilt-7525c6cb-cb60b4b9.js
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var I2 = function() {
  function t2(t3, e) {
    var n2 = this;
    this.previousValue = t3, e && (e.sequenceNumberHandler = function(t4) {
      return n2.t(t4);
    }, this.i = function(t4) {
      return e.writeSequenceNumber(t4);
    });
  }
  __name(t2, "t");
  return t2.prototype.t = function(t3) {
    return this.previousValue = Math.max(t3, this.previousValue), this.previousValue;
  }, t2.prototype.next = function() {
    var t3 = ++this.previousValue;
    return this.i && this.i(t3), t3;
  }, t2;
}();
I2.o = -1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var E2 = new Logger("@firebase/firestore");
function T2() {
  return E2.logLevel;
}
__name(T2, "T");
function _(t2) {
  for (var n2 = [], r2 = 1; r2 < arguments.length; r2++)
    n2[r2 - 1] = arguments[r2];
  if (E2.logLevel <= LogLevel.DEBUG) {
    var i = n2.map(N2);
    E2.debug.apply(E2, __spreadArray(["Firestore (8.3.1): " + t2], i));
  }
}
__name(_, "_");
function S2(t2) {
  for (var n2 = [], r2 = 1; r2 < arguments.length; r2++)
    n2[r2 - 1] = arguments[r2];
  if (E2.logLevel <= LogLevel.ERROR) {
    var i = n2.map(N2);
    E2.error.apply(E2, __spreadArray(["Firestore (8.3.1): " + t2], i));
  }
}
__name(S2, "S");
function D2(t2) {
  for (var n2 = [], r2 = 1; r2 < arguments.length; r2++)
    n2[r2 - 1] = arguments[r2];
  if (E2.logLevel <= LogLevel.WARN) {
    var i = n2.map(N2);
    E2.warn.apply(E2, __spreadArray(["Firestore (8.3.1): " + t2], i));
  }
}
__name(D2, "D");
function N2(t2) {
  if (typeof t2 == "string")
    return t2;
  try {
    return e = t2, JSON.stringify(e);
  } catch (e2) {
    return t2;
  }
  /**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
  var e;
}
__name(N2, "N");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function A2(t2) {
  t2 === void 0 && (t2 = "Unexpected state");
  var e = "FIRESTORE (8.3.1) INTERNAL ASSERTION FAILED: " + t2;
  throw S2(e), new Error(e);
}
__name(A2, "A");
function k2(t2, e) {
  t2 || A2();
}
__name(k2, "k");
function C(t2, e) {
  return t2;
}
__name(C, "C");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function x2(t2) {
  var e = typeof self != "undefined" && (self.crypto || self.msCrypto), n2 = new Uint8Array(t2);
  if (e && typeof e.getRandomValues == "function")
    e.getRandomValues(n2);
  else
    for (var r2 = 0; r2 < t2; r2++)
      n2[r2] = Math.floor(256 * Math.random());
  return n2;
}
__name(x2, "x");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var L2 = function() {
  function t2() {
  }
  __name(t2, "t");
  return t2.u = function() {
    for (var t3 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", e = Math.floor(256 / t3.length) * t3.length, n2 = ""; n2.length < 20; )
      for (var r2 = x2(40), i = 0; i < r2.length; ++i)
        n2.length < 20 && r2[i] < e && (n2 += t3.charAt(r2[i] % t3.length));
    return n2;
  }, t2;
}();
function R2(t2, e) {
  return t2 < e ? -1 : t2 > e ? 1 : 0;
}
__name(R2, "R");
function O2(t2, e, n2) {
  return t2.length === e.length && t2.every(function(t3, r2) {
    return n2(t3, e[r2]);
  });
}
__name(O2, "O");
function P2(t2) {
  return t2 + "\0";
}
__name(P2, "P");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function M2(t2) {
  var e = 0;
  for (var n2 in t2)
    Object.prototype.hasOwnProperty.call(t2, n2) && e++;
  return e;
}
__name(M2, "M");
function F2(t2, e) {
  for (var n2 in t2)
    Object.prototype.hasOwnProperty.call(t2, n2) && e(n2, t2[n2]);
}
__name(F2, "F");
function q2(t2) {
  for (var e in t2)
    if (Object.prototype.hasOwnProperty.call(t2, e))
      return false;
  return true;
}
__name(q2, "q");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function V2(t2) {
  return t2 == null;
}
__name(V2, "V");
function U2(t2) {
  return t2 === 0 && 1 / t2 == -1 / 0;
}
__name(U2, "U");
function B(t2) {
  return typeof t2 == "number" && Number.isInteger(t2) && !U2(t2) && t2 <= Number.MAX_SAFE_INTEGER && t2 >= Number.MIN_SAFE_INTEGER;
}
__name(B, "B");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var j = {
  OK: "ok",
  CANCELLED: "cancelled",
  UNKNOWN: "unknown",
  INVALID_ARGUMENT: "invalid-argument",
  DEADLINE_EXCEEDED: "deadline-exceeded",
  NOT_FOUND: "not-found",
  ALREADY_EXISTS: "already-exists",
  PERMISSION_DENIED: "permission-denied",
  UNAUTHENTICATED: "unauthenticated",
  RESOURCE_EXHAUSTED: "resource-exhausted",
  FAILED_PRECONDITION: "failed-precondition",
  ABORTED: "aborted",
  OUT_OF_RANGE: "out-of-range",
  UNIMPLEMENTED: "unimplemented",
  INTERNAL: "internal",
  UNAVAILABLE: "unavailable",
  DATA_LOSS: "data-loss"
};
var G2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).code = e2, r2.message = n2, r2.name = "FirebaseError", r2.toString = function() {
      return r2.name + ": [code=" + r2.code + "]: " + r2.message;
    }, r2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(Error);
var K2 = function() {
  function t2(t3, e, n2) {
    e === void 0 ? e = 0 : e > t3.length && A2(), n2 === void 0 ? n2 = t3.length - e : n2 > t3.length - e && A2(), this.segments = t3, this.offset = e, this.len = n2;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "length", {
    get: function() {
      return this.len;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(e) {
    return t2.comparator(this, e) === 0;
  }, t2.prototype.child = function(e) {
    var n2 = this.segments.slice(this.offset, this.limit());
    return e instanceof t2 ? e.forEach(function(t3) {
      n2.push(t3);
    }) : n2.push(e), this.construct(n2);
  }, t2.prototype.limit = function() {
    return this.offset + this.length;
  }, t2.prototype.popFirst = function(t3) {
    return t3 = t3 === void 0 ? 1 : t3, this.construct(this.segments, this.offset + t3, this.length - t3);
  }, t2.prototype.popLast = function() {
    return this.construct(this.segments, this.offset, this.length - 1);
  }, t2.prototype.firstSegment = function() {
    return this.segments[this.offset];
  }, t2.prototype.lastSegment = function() {
    return this.get(this.length - 1);
  }, t2.prototype.get = function(t3) {
    return this.segments[this.offset + t3];
  }, t2.prototype.isEmpty = function() {
    return this.length === 0;
  }, t2.prototype.isPrefixOf = function(t3) {
    if (t3.length < this.length)
      return false;
    for (var e = 0; e < this.length; e++)
      if (this.get(e) !== t3.get(e))
        return false;
    return true;
  }, t2.prototype.isImmediateParentOf = function(t3) {
    if (this.length + 1 !== t3.length)
      return false;
    for (var e = 0; e < this.length; e++)
      if (this.get(e) !== t3.get(e))
        return false;
    return true;
  }, t2.prototype.forEach = function(t3) {
    for (var e = this.offset, n2 = this.limit(); e < n2; e++)
      t3(this.segments[e]);
  }, t2.prototype.toArray = function() {
    return this.segments.slice(this.offset, this.limit());
  }, t2.comparator = function(t3, e) {
    for (var n2 = Math.min(t3.length, e.length), r2 = 0; r2 < n2; r2++) {
      var i = t3.get(r2), o = e.get(r2);
      if (i < o)
        return -1;
      if (i > o)
        return 1;
    }
    return t3.length < e.length ? -1 : t3.length > e.length ? 1 : 0;
  }, t2;
}();
var z2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.construct = function(t3, n2, r2) {
    return new e(t3, n2, r2);
  }, e.prototype.canonicalString = function() {
    return this.toArray().join("/");
  }, e.prototype.toString = function() {
    return this.canonicalString();
  }, e.fromString = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    for (var r2 = [], i = 0, o = t3; i < o.length; i++) {
      var s = o[i];
      if (s.indexOf("//") >= 0)
        throw new G2(j.INVALID_ARGUMENT, "Invalid segment (" + s + "). Paths must not contain // in them.");
      r2.push.apply(r2, s.split("/").filter(function(t4) {
        return t4.length > 0;
      }));
    }
    return new e(r2);
  }, e.emptyPath = function() {
    return new e([]);
  }, e;
}(K2);
var Q2 = /^[_a-zA-Z][_a-zA-Z0-9]*$/;
var W2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.construct = function(t3, n2, r2) {
    return new e(t3, n2, r2);
  }, e.isValidIdentifier = function(t3) {
    return Q2.test(t3);
  }, e.prototype.canonicalString = function() {
    return this.toArray().map(function(t3) {
      return t3 = t3.replace(/\\/g, "\\\\").replace(/`/g, "\\`"), e.isValidIdentifier(t3) || (t3 = "`" + t3 + "`"), t3;
    }).join(".");
  }, e.prototype.toString = function() {
    return this.canonicalString();
  }, e.prototype.isKeyField = function() {
    return this.length === 1 && this.get(0) === "__name__";
  }, e.keyField = function() {
    return new e(["__name__"]);
  }, e.fromServerFormat = function(t3) {
    for (var n2 = [], r2 = "", i = 0, o = function() {
      if (r2.length === 0)
        throw new G2(j.INVALID_ARGUMENT, "Invalid field path (" + t3 + "). Paths must not be empty, begin with '.', end with '.', or contain '..'");
      n2.push(r2), r2 = "";
    }, s = false; i < t3.length; ) {
      var u = t3[i];
      if (u === "\\") {
        if (i + 1 === t3.length)
          throw new G2(j.INVALID_ARGUMENT, "Path has trailing escape character: " + t3);
        var a = t3[i + 1];
        if (a !== "\\" && a !== "." && a !== "`")
          throw new G2(j.INVALID_ARGUMENT, "Path has invalid escape sequence: " + t3);
        r2 += a, i += 2;
      } else
        u === "`" ? (s = !s, i++) : u !== "." || s ? (r2 += u, i++) : (o(), i++);
    }
    if (o(), s)
      throw new G2(j.INVALID_ARGUMENT, "Unterminated ` in path: " + t3);
    return new e(n2);
  }, e.emptyPath = function() {
    return new e([]);
  }, e;
}(K2);
var H2 = function() {
  function t2(t3) {
    this.path = t3;
  }
  __name(t2, "t");
  return t2.fromPath = function(e) {
    return new t2(z2.fromString(e));
  }, t2.fromName = function(e) {
    return new t2(z2.fromString(e).popFirst(5));
  }, t2.prototype.hasCollectionId = function(t3) {
    return this.path.length >= 2 && this.path.get(this.path.length - 2) === t3;
  }, t2.prototype.isEqual = function(t3) {
    return t3 !== null && z2.comparator(this.path, t3.path) === 0;
  }, t2.prototype.toString = function() {
    return this.path.toString();
  }, t2.comparator = function(t3, e) {
    return z2.comparator(t3.path, e.path);
  }, t2.isDocumentKey = function(t3) {
    return t3.length % 2 == 0;
  }, t2.fromSegments = function(e) {
    return new t2(new z2(e.slice()));
  }, t2;
}();
var Y2 = function() {
  function t2(t3) {
    this.binaryString = t3;
  }
  __name(t2, "t");
  return t2.fromBase64String = function(e) {
    return new t2(atob(e));
  }, t2.fromUint8Array = function(e) {
    return new t2(function(t3) {
      for (var e2 = "", n2 = 0; n2 < t3.length; ++n2)
        e2 += String.fromCharCode(t3[n2]);
      return e2;
    }(e));
  }, t2.prototype.toBase64 = function() {
    return t3 = this.binaryString, btoa(t3);
    var t3;
  }, t2.prototype.toUint8Array = function() {
    return function(t3) {
      for (var e = new Uint8Array(t3.length), n2 = 0; n2 < t3.length; n2++)
        e[n2] = t3.charCodeAt(n2);
      return e;
    }(this.binaryString);
  }, t2.prototype.approximateByteSize = function() {
    return 2 * this.binaryString.length;
  }, t2.prototype.compareTo = function(t3) {
    return R2(this.binaryString, t3.binaryString);
  }, t2.prototype.isEqual = function(t3) {
    return this.binaryString === t3.binaryString;
  }, t2;
}();
Y2.EMPTY_BYTE_STRING = new Y2("");
var J2 = new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
function X2(t2) {
  if (k2(!!t2), typeof t2 == "string") {
    var e = 0, n2 = J2.exec(t2);
    if (k2(!!n2), n2[1]) {
      var r2 = n2[1];
      r2 = (r2 + "000000000").substr(0, 9), e = Number(r2);
    }
    var i = new Date(t2);
    return {
      seconds: Math.floor(i.getTime() / 1e3),
      nanos: e
    };
  }
  return {
    seconds: $(t2.seconds),
    nanos: $(t2.nanos)
  };
}
__name(X2, "X");
function $(t2) {
  return typeof t2 == "number" ? t2 : typeof t2 == "string" ? Number(t2) : 0;
}
__name($, "$");
function Z2(t2) {
  return typeof t2 == "string" ? Y2.fromBase64String(t2) : Y2.fromUint8Array(t2);
}
__name(Z2, "Z");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var tt = function() {
  function t2(t3, e) {
    if (this.seconds = t3, this.nanoseconds = e, e < 0)
      throw new G2(j.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
    if (e >= 1e9)
      throw new G2(j.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + e);
    if (t3 < -62135596800)
      throw new G2(j.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t3);
    if (t3 >= 253402300800)
      throw new G2(j.INVALID_ARGUMENT, "Timestamp seconds out of range: " + t3);
  }
  __name(t2, "t");
  return t2.now = function() {
    return t2.fromMillis(Date.now());
  }, t2.fromDate = function(e) {
    return t2.fromMillis(e.getTime());
  }, t2.fromMillis = function(e) {
    var n2 = Math.floor(e / 1e3);
    return new t2(n2, 1e6 * (e - 1e3 * n2));
  }, t2.prototype.toDate = function() {
    return new Date(this.toMillis());
  }, t2.prototype.toMillis = function() {
    return 1e3 * this.seconds + this.nanoseconds / 1e6;
  }, t2.prototype._compareTo = function(t3) {
    return this.seconds === t3.seconds ? R2(this.nanoseconds, t3.nanoseconds) : R2(this.seconds, t3.seconds);
  }, t2.prototype.isEqual = function(t3) {
    return t3.seconds === this.seconds && t3.nanoseconds === this.nanoseconds;
  }, t2.prototype.toString = function() {
    return "Timestamp(seconds=" + this.seconds + ", nanoseconds=" + this.nanoseconds + ")";
  }, t2.prototype.toJSON = function() {
    return {
      seconds: this.seconds,
      nanoseconds: this.nanoseconds
    };
  }, t2.prototype.valueOf = function() {
    var t3 = this.seconds - -62135596800;
    return String(t3).padStart(12, "0") + "." + String(this.nanoseconds).padStart(9, "0");
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function et(t2) {
  var e, n2;
  return ((n2 = (((e = t2 == null ? void 0 : t2.mapValue) === null || e === void 0 ? void 0 : e.fields) || {}).__type__) === null || n2 === void 0 ? void 0 : n2.stringValue) === "server_timestamp";
}
__name(et, "et");
function nt(t2) {
  var e = t2.mapValue.fields.__previous_value__;
  return et(e) ? nt(e) : e;
}
__name(nt, "nt");
function rt(t2) {
  var e = X2(t2.mapValue.fields.__local_write_time__.timestampValue);
  return new tt(e.seconds, e.nanos);
}
__name(rt, "rt");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function it(t2) {
  return "nullValue" in t2 ? 0 : "booleanValue" in t2 ? 1 : "integerValue" in t2 || "doubleValue" in t2 ? 2 : "timestampValue" in t2 ? 3 : "stringValue" in t2 ? 5 : "bytesValue" in t2 ? 6 : "referenceValue" in t2 ? 7 : "geoPointValue" in t2 ? 8 : "arrayValue" in t2 ? 9 : "mapValue" in t2 ? et(t2) ? 4 : 10 : A2();
}
__name(it, "it");
function ot(t2, e) {
  var n2 = it(t2);
  if (n2 !== it(e))
    return false;
  switch (n2) {
    case 0:
      return true;
    case 1:
      return t2.booleanValue === e.booleanValue;
    case 4:
      return rt(t2).isEqual(rt(e));
    case 3:
      return function(t3, e2) {
        if (typeof t3.timestampValue == "string" && typeof e2.timestampValue == "string" && t3.timestampValue.length === e2.timestampValue.length)
          return t3.timestampValue === e2.timestampValue;
        var n3 = X2(t3.timestampValue), r2 = X2(e2.timestampValue);
        return n3.seconds === r2.seconds && n3.nanos === r2.nanos;
      }(t2, e);
    case 5:
      return t2.stringValue === e.stringValue;
    case 6:
      return function(t3, e2) {
        return Z2(t3.bytesValue).isEqual(Z2(e2.bytesValue));
      }(t2, e);
    case 7:
      return t2.referenceValue === e.referenceValue;
    case 8:
      return function(t3, e2) {
        return $(t3.geoPointValue.latitude) === $(e2.geoPointValue.latitude) && $(t3.geoPointValue.longitude) === $(e2.geoPointValue.longitude);
      }(t2, e);
    case 2:
      return function(t3, e2) {
        if ("integerValue" in t3 && "integerValue" in e2)
          return $(t3.integerValue) === $(e2.integerValue);
        if ("doubleValue" in t3 && "doubleValue" in e2) {
          var n3 = $(t3.doubleValue), r2 = $(e2.doubleValue);
          return n3 === r2 ? U2(n3) === U2(r2) : isNaN(n3) && isNaN(r2);
        }
        return false;
      }(t2, e);
    case 9:
      return O2(t2.arrayValue.values || [], e.arrayValue.values || [], ot);
    case 10:
      return function(t3, e2) {
        var n3 = t3.mapValue.fields || {}, r2 = e2.mapValue.fields || {};
        if (M2(n3) !== M2(r2))
          return false;
        for (var i in n3)
          if (n3.hasOwnProperty(i) && (r2[i] === void 0 || !ot(n3[i], r2[i])))
            return false;
        return true;
      }(t2, e);
    default:
      return A2();
  }
}
__name(ot, "ot");
function st(t2, e) {
  return (t2.values || []).find(function(t3) {
    return ot(t3, e);
  }) !== void 0;
}
__name(st, "st");
function ut(t2, e) {
  var n2 = it(t2), r2 = it(e);
  if (n2 !== r2)
    return R2(n2, r2);
  switch (n2) {
    case 0:
      return 0;
    case 1:
      return R2(t2.booleanValue, e.booleanValue);
    case 2:
      return function(t3, e2) {
        var n3 = $(t3.integerValue || t3.doubleValue), r3 = $(e2.integerValue || e2.doubleValue);
        return n3 < r3 ? -1 : n3 > r3 ? 1 : n3 === r3 ? 0 : isNaN(n3) ? isNaN(r3) ? 0 : -1 : 1;
      }(t2, e);
    case 3:
      return at(t2.timestampValue, e.timestampValue);
    case 4:
      return at(rt(t2), rt(e));
    case 5:
      return R2(t2.stringValue, e.stringValue);
    case 6:
      return function(t3, e2) {
        var n3 = Z2(t3), r3 = Z2(e2);
        return n3.compareTo(r3);
      }(t2.bytesValue, e.bytesValue);
    case 7:
      return function(t3, e2) {
        for (var n3 = t3.split("/"), r3 = e2.split("/"), i = 0; i < n3.length && i < r3.length; i++) {
          var o = R2(n3[i], r3[i]);
          if (o !== 0)
            return o;
        }
        return R2(n3.length, r3.length);
      }(t2.referenceValue, e.referenceValue);
    case 8:
      return function(t3, e2) {
        var n3 = R2($(t3.latitude), $(e2.latitude));
        return n3 !== 0 ? n3 : R2($(t3.longitude), $(e2.longitude));
      }(t2.geoPointValue, e.geoPointValue);
    case 9:
      return function(t3, e2) {
        for (var n3 = t3.values || [], r3 = e2.values || [], i = 0; i < n3.length && i < r3.length; ++i) {
          var o = ut(n3[i], r3[i]);
          if (o)
            return o;
        }
        return R2(n3.length, r3.length);
      }(t2.arrayValue, e.arrayValue);
    case 10:
      return function(t3, e2) {
        var n3 = t3.fields || {}, r3 = Object.keys(n3), i = e2.fields || {}, o = Object.keys(i);
        r3.sort(), o.sort();
        for (var s = 0; s < r3.length && s < o.length; ++s) {
          var u = R2(r3[s], o[s]);
          if (u !== 0)
            return u;
          var a = ut(n3[r3[s]], i[o[s]]);
          if (a !== 0)
            return a;
        }
        return R2(r3.length, o.length);
      }(t2.mapValue, e.mapValue);
    default:
      throw A2();
  }
}
__name(ut, "ut");
function at(t2, e) {
  if (typeof t2 == "string" && typeof e == "string" && t2.length === e.length)
    return R2(t2, e);
  var n2 = X2(t2), r2 = X2(e), i = R2(n2.seconds, r2.seconds);
  return i !== 0 ? i : R2(n2.nanos, r2.nanos);
}
__name(at, "at");
function ct(t2) {
  return ht(t2);
}
__name(ct, "ct");
function ht(t2) {
  return "nullValue" in t2 ? "null" : "booleanValue" in t2 ? "" + t2.booleanValue : "integerValue" in t2 ? "" + t2.integerValue : "doubleValue" in t2 ? "" + t2.doubleValue : "timestampValue" in t2 ? function(t3) {
    var e2 = X2(t3);
    return "time(" + e2.seconds + "," + e2.nanos + ")";
  }(t2.timestampValue) : "stringValue" in t2 ? t2.stringValue : "bytesValue" in t2 ? Z2(t2.bytesValue).toBase64() : "referenceValue" in t2 ? (n2 = t2.referenceValue, H2.fromName(n2).toString()) : "geoPointValue" in t2 ? "geo(" + (e = t2.geoPointValue).latitude + "," + e.longitude + ")" : "arrayValue" in t2 ? function(t3) {
    for (var e2 = "[", n3 = true, r2 = 0, i = t3.values || []; r2 < i.length; r2++) {
      n3 ? n3 = false : e2 += ",", e2 += ht(i[r2]);
    }
    return e2 + "]";
  }(t2.arrayValue) : "mapValue" in t2 ? function(t3) {
    for (var e2 = "{", n3 = true, r2 = 0, i = Object.keys(t3.fields || {}).sort(); r2 < i.length; r2++) {
      var o = i[r2];
      n3 ? n3 = false : e2 += ",", e2 += o + ":" + ht(t3.fields[o]);
    }
    return e2 + "}";
  }(t2.mapValue) : A2();
  var e, n2;
}
__name(ht, "ht");
function ft(t2, e) {
  return {
    referenceValue: "projects/" + t2.projectId + "/databases/" + t2.database + "/documents/" + e.path.canonicalString()
  };
}
__name(ft, "ft");
function lt(t2) {
  return !!t2 && "integerValue" in t2;
}
__name(lt, "lt");
function dt(t2) {
  return !!t2 && "arrayValue" in t2;
}
__name(dt, "dt");
function pt(t2) {
  return !!t2 && "nullValue" in t2;
}
__name(pt, "pt");
function yt(t2) {
  return !!t2 && "doubleValue" in t2 && isNaN(Number(t2.doubleValue));
}
__name(yt, "yt");
function vt(t2) {
  return !!t2 && "mapValue" in t2;
}
__name(vt, "vt");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var mt = /* @__PURE__ */ __name(function(t2, e) {
  this.key = t2, this.version = e;
}, "mt");
var gt = function(t2) {
  function e(e2, n2, r2, i) {
    var o = this;
    return (o = t2.call(this, e2, n2) || this).objectValue = r2, o.hasLocalMutations = !!i.hasLocalMutations, o.hasCommittedMutations = !!i.hasCommittedMutations, o;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.field = function(t3) {
    return this.objectValue.field(t3);
  }, e.prototype.data = function() {
    return this.objectValue;
  }, e.prototype.toProto = function() {
    return this.objectValue.proto;
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof e && this.key.isEqual(t3.key) && this.version.isEqual(t3.version) && this.hasLocalMutations === t3.hasLocalMutations && this.hasCommittedMutations === t3.hasCommittedMutations && this.objectValue.isEqual(t3.objectValue);
  }, e.prototype.toString = function() {
    return "Document(" + this.key + ", " + this.version + ", " + this.objectValue.toString() + ", {hasLocalMutations: " + this.hasLocalMutations + "}), {hasCommittedMutations: " + this.hasCommittedMutations + "})";
  }, Object.defineProperty(e.prototype, "hasPendingWrites", {
    get: function() {
      return this.hasLocalMutations || this.hasCommittedMutations;
    },
    enumerable: false,
    configurable: true
  }), e;
}(mt);
var wt = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, e2, n2) || this).hasCommittedMutations = !(!r2 || !r2.hasCommittedMutations), i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.toString = function() {
    return "NoDocument(" + this.key + ", " + this.version + ")";
  }, Object.defineProperty(e.prototype, "hasPendingWrites", {
    get: function() {
      return this.hasCommittedMutations;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.isEqual = function(t3) {
    return t3 instanceof e && t3.hasCommittedMutations === this.hasCommittedMutations && t3.version.isEqual(this.version) && t3.key.isEqual(this.key);
  }, e;
}(mt);
var bt = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.toString = function() {
    return "UnknownDocument(" + this.key + ", " + this.version + ")";
  }, Object.defineProperty(e.prototype, "hasPendingWrites", {
    get: function() {
      return true;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.isEqual = function(t3) {
    return t3 instanceof e && t3.version.isEqual(this.version) && t3.key.isEqual(this.key);
  }, e;
}(mt);
var It = /* @__PURE__ */ __name(function(t2, e, n2, r2, i, o, s) {
  e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = null), s === void 0 && (s = null), this.path = t2, this.collectionGroup = e, this.orderBy = n2, this.filters = r2, this.limit = i, this.startAt = o, this.endAt = s, this.h = null;
}, "It");
function Et(t2, e, n2, r2, i, o, s) {
  return e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = null), s === void 0 && (s = null), new It(t2, e, n2, r2, i, o, s);
}
__name(Et, "Et");
function Tt(t2) {
  var e = C(t2);
  if (e.h === null) {
    var n2 = e.path.canonicalString();
    e.collectionGroup !== null && (n2 += "|cg:" + e.collectionGroup), n2 += "|f:", n2 += e.filters.map(function(t3) {
      return function(t4) {
        return t4.field.canonicalString() + t4.op.toString() + ct(t4.value);
      }(t3);
    }).join(","), n2 += "|ob:", n2 += e.orderBy.map(function(t3) {
      return function(t4) {
        return t4.field.canonicalString() + t4.dir;
      }(t3);
    }).join(","), V2(e.limit) || (n2 += "|l:", n2 += e.limit), e.startAt && (n2 += "|lb:", n2 += Mt(e.startAt)), e.endAt && (n2 += "|ub:", n2 += Mt(e.endAt)), e.h = n2;
  }
  return e.h;
}
__name(Tt, "Tt");
function _t(t2, e) {
  if (t2.limit !== e.limit)
    return false;
  if (t2.orderBy.length !== e.orderBy.length)
    return false;
  for (var n2 = 0; n2 < t2.orderBy.length; n2++)
    if (!qt(t2.orderBy[n2], e.orderBy[n2]))
      return false;
  if (t2.filters.length !== e.filters.length)
    return false;
  for (var r2 = 0; r2 < t2.filters.length; r2++)
    if (i = t2.filters[r2], o = e.filters[r2], i.op !== o.op || !i.field.isEqual(o.field) || !ot(i.value, o.value))
      return false;
  var i, o;
  return t2.collectionGroup === e.collectionGroup && !!t2.path.isEqual(e.path) && !!Ut(t2.startAt, e.startAt) && Ut(t2.endAt, e.endAt);
}
__name(_t, "_t");
function St(t2) {
  return H2.isDocumentKey(t2.path) && t2.collectionGroup === null && t2.filters.length === 0;
}
__name(St, "St");
var Dt = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).field = e2, i.op = n2, i.value = r2, i;
  }
  __name(e, "e");
  return __extends(e, t2), e.create = function(t3, n2, r2) {
    return t3.isKeyField() ? n2 === "in" || n2 === "not-in" ? this.l(t3, n2, r2) : new Nt(t3, n2, r2) : n2 === "array-contains" ? new xt(t3, r2) : n2 === "in" ? new Lt(t3, r2) : n2 === "not-in" ? new Rt(t3, r2) : n2 === "array-contains-any" ? new Ot(t3, r2) : new e(t3, n2, r2);
  }, e.l = function(t3, e2, n2) {
    return e2 === "in" ? new At(t3, n2) : new kt(t3, n2);
  }, e.prototype.matches = function(t3) {
    var e2 = t3.field(this.field);
    return this.op === "!=" ? e2 !== null && this.m(ut(e2, this.value)) : e2 !== null && it(this.value) === it(e2) && this.m(ut(e2, this.value));
  }, e.prototype.m = function(t3) {
    switch (this.op) {
      case "<":
        return t3 < 0;
      case "<=":
        return t3 <= 0;
      case "==":
        return t3 === 0;
      case "!=":
        return t3 !== 0;
      case ">":
        return t3 > 0;
      case ">=":
        return t3 >= 0;
      default:
        return A2();
    }
  }, e.prototype.g = function() {
    return ["<", "<=", ">", ">=", "!=", "not-in"].indexOf(this.op) >= 0;
  }, e;
}(function() {
});
var Nt = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, e2, n2, r2) || this).key = H2.fromName(r2.referenceValue), i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = H2.comparator(t3.key, this.key);
    return this.m(e2);
  }, e;
}(Dt);
var At = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, "in", n2) || this).keys = Ct("in", n2), r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.matches = function(t3) {
    return this.keys.some(function(e2) {
      return e2.isEqual(t3.key);
    });
  }, e;
}(Dt);
var kt = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, "not-in", n2) || this).keys = Ct("not-in", n2), r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.matches = function(t3) {
    return !this.keys.some(function(e2) {
      return e2.isEqual(t3.key);
    });
  }, e;
}(Dt);
function Ct(t2, e) {
  var n2;
  return (((n2 = e.arrayValue) === null || n2 === void 0 ? void 0 : n2.values) || []).map(function(t3) {
    return H2.fromName(t3.referenceValue);
  });
}
__name(Ct, "Ct");
var xt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "array-contains", n2) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = t3.field(this.field);
    return dt(e2) && st(e2.arrayValue, this.value);
  }, e;
}(Dt);
var Lt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "in", n2) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = t3.field(this.field);
    return e2 !== null && st(this.value.arrayValue, e2);
  }, e;
}(Dt);
var Rt = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "not-in", n2) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.matches = function(t3) {
    if (st(this.value.arrayValue, {
      nullValue: "NULL_VALUE"
    }))
      return false;
    var e2 = t3.field(this.field);
    return e2 !== null && !st(this.value.arrayValue, e2);
  }, e;
}(Dt);
var Ot = function(t2) {
  function e(e2, n2) {
    return t2.call(this, e2, "array-contains-any", n2) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.matches = function(t3) {
    var e2 = this, n2 = t3.field(this.field);
    return !(!dt(n2) || !n2.arrayValue.values) && n2.arrayValue.values.some(function(t4) {
      return st(e2.value.arrayValue, t4);
    });
  }, e;
}(Dt);
var Pt = /* @__PURE__ */ __name(function(t2, e) {
  this.position = t2, this.before = e;
}, "Pt");
function Mt(t2) {
  return (t2.before ? "b" : "a") + ":" + t2.position.map(function(t3) {
    return ct(t3);
  }).join(",");
}
__name(Mt, "Mt");
var Ft = /* @__PURE__ */ __name(function(t2, e) {
  e === void 0 && (e = "asc"), this.field = t2, this.dir = e;
}, "Ft");
function qt(t2, e) {
  return t2.dir === e.dir && t2.field.isEqual(e.field);
}
__name(qt, "qt");
function Vt(t2, e, n2) {
  for (var r2 = 0, i = 0; i < t2.position.length; i++) {
    var o = e[i], s = t2.position[i];
    if (r2 = o.field.isKeyField() ? H2.comparator(H2.fromName(s.referenceValue), n2.key) : ut(s, n2.field(o.field)), o.dir === "desc" && (r2 *= -1), r2 !== 0)
      break;
  }
  return t2.before ? r2 <= 0 : r2 < 0;
}
__name(Vt, "Vt");
function Ut(t2, e) {
  if (t2 === null)
    return e === null;
  if (e === null)
    return false;
  if (t2.before !== e.before || t2.position.length !== e.position.length)
    return false;
  for (var n2 = 0; n2 < t2.position.length; n2++)
    if (!ot(t2.position[n2], e.position[n2]))
      return false;
  return true;
}
__name(Ut, "Ut");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Bt = /* @__PURE__ */ __name(function(t2, e, n2, r2, i, o, s, u) {
  e === void 0 && (e = null), n2 === void 0 && (n2 = []), r2 === void 0 && (r2 = []), i === void 0 && (i = null), o === void 0 && (o = "F"), s === void 0 && (s = null), u === void 0 && (u = null), this.path = t2, this.collectionGroup = e, this.explicitOrderBy = n2, this.filters = r2, this.limit = i, this.limitType = o, this.startAt = s, this.endAt = u, this.p = null, this.T = null, this.startAt, this.endAt;
}, "Bt");
function jt(t2, e, n2, r2, i, o, s, u) {
  return new Bt(t2, e, n2, r2, i, o, s, u);
}
__name(jt, "jt");
function Gt(t2) {
  return new Bt(t2);
}
__name(Gt, "Gt");
function Kt(t2) {
  return !V2(t2.limit) && t2.limitType === "F";
}
__name(Kt, "Kt");
function zt(t2) {
  return !V2(t2.limit) && t2.limitType === "L";
}
__name(zt, "zt");
function Qt(t2) {
  return t2.explicitOrderBy.length > 0 ? t2.explicitOrderBy[0].field : null;
}
__name(Qt, "Qt");
function Wt(t2) {
  for (var e = 0, n2 = t2.filters; e < n2.length; e++) {
    var r2 = n2[e];
    if (r2.g())
      return r2.field;
  }
  return null;
}
__name(Wt, "Wt");
function Ht(t2) {
  return t2.collectionGroup !== null;
}
__name(Ht, "Ht");
function Yt(t2) {
  var e = C(t2);
  if (e.p === null) {
    e.p = [];
    var n2 = Wt(e), r2 = Qt(e);
    if (n2 !== null && r2 === null)
      n2.isKeyField() || e.p.push(new Ft(n2)), e.p.push(new Ft(W2.keyField(), "asc"));
    else {
      for (var i = false, o = 0, s = e.explicitOrderBy; o < s.length; o++) {
        var u = s[o];
        e.p.push(u), u.field.isKeyField() && (i = true);
      }
      if (!i) {
        var a = e.explicitOrderBy.length > 0 ? e.explicitOrderBy[e.explicitOrderBy.length - 1].dir : "asc";
        e.p.push(new Ft(W2.keyField(), a));
      }
    }
  }
  return e.p;
}
__name(Yt, "Yt");
function Jt(t2) {
  var e = C(t2);
  if (!e.T)
    if (e.limitType === "F")
      e.T = Et(e.path, e.collectionGroup, Yt(e), e.filters, e.limit, e.startAt, e.endAt);
    else {
      for (var n2 = [], r2 = 0, i = Yt(e); r2 < i.length; r2++) {
        var o = i[r2], s = o.dir === "desc" ? "asc" : "desc";
        n2.push(new Ft(o.field, s));
      }
      var u = e.endAt ? new Pt(e.endAt.position, !e.endAt.before) : null, a = e.startAt ? new Pt(e.startAt.position, !e.startAt.before) : null;
      e.T = Et(e.path, e.collectionGroup, n2, e.filters, e.limit, u, a);
    }
  return e.T;
}
__name(Jt, "Jt");
function Xt(t2, e, n2) {
  return new Bt(t2.path, t2.collectionGroup, t2.explicitOrderBy.slice(), t2.filters.slice(), e, n2, t2.startAt, t2.endAt);
}
__name(Xt, "Xt");
function $t(t2, e) {
  return _t(Jt(t2), Jt(e)) && t2.limitType === e.limitType;
}
__name($t, "$t");
function Zt(t2) {
  return Tt(Jt(t2)) + "|lt:" + t2.limitType;
}
__name(Zt, "Zt");
function te(t2) {
  return "Query(target=" + function(t3) {
    var e = t3.path.canonicalString();
    return t3.collectionGroup !== null && (e += " collectionGroup=" + t3.collectionGroup), t3.filters.length > 0 && (e += ", filters: [" + t3.filters.map(function(t4) {
      return (e2 = t4).field.canonicalString() + " " + e2.op + " " + ct(e2.value);
      var e2;
    }).join(", ") + "]"), V2(t3.limit) || (e += ", limit: " + t3.limit), t3.orderBy.length > 0 && (e += ", orderBy: [" + t3.orderBy.map(function(t4) {
      return function(t5) {
        return t5.field.canonicalString() + " (" + t5.dir + ")";
      }(t4);
    }).join(", ") + "]"), t3.startAt && (e += ", startAt: " + Mt(t3.startAt)), t3.endAt && (e += ", endAt: " + Mt(t3.endAt)), "Target(" + e + ")";
  }(Jt(t2)) + "; limitType=" + t2.limitType + ")";
}
__name(te, "te");
function ee(t2, e) {
  return function(t3, e2) {
    var n2 = e2.key.path;
    return t3.collectionGroup !== null ? e2.key.hasCollectionId(t3.collectionGroup) && t3.path.isPrefixOf(n2) : H2.isDocumentKey(t3.path) ? t3.path.isEqual(n2) : t3.path.isImmediateParentOf(n2);
  }(t2, e) && function(t3, e2) {
    for (var n2 = 0, r2 = t3.explicitOrderBy; n2 < r2.length; n2++) {
      var i = r2[n2];
      if (!i.field.isKeyField() && e2.field(i.field) === null)
        return false;
    }
    return true;
  }(t2, e) && function(t3, e2) {
    for (var n2 = 0, r2 = t3.filters; n2 < r2.length; n2++) {
      if (!r2[n2].matches(e2))
        return false;
    }
    return true;
  }(t2, e) && function(t3, e2) {
    return !(t3.startAt && !Vt(t3.startAt, Yt(t3), e2)) && (!t3.endAt || !Vt(t3.endAt, Yt(t3), e2));
  }(t2, e);
}
__name(ee, "ee");
function ne(t2) {
  return function(e, n2) {
    for (var r2 = false, i = 0, o = Yt(t2); i < o.length; i++) {
      var s = o[i], u = re(s, e, n2);
      if (u !== 0)
        return u;
      r2 = r2 || s.field.isKeyField();
    }
    return 0;
  };
}
__name(ne, "ne");
function re(t2, e, n2) {
  var r2 = t2.field.isKeyField() ? H2.comparator(e.key, n2.key) : function(t3, e2, n3) {
    var r3 = e2.field(t3), i = n3.field(t3);
    return r3 !== null && i !== null ? ut(r3, i) : A2();
  }(t2.field, e, n2);
  switch (t2.dir) {
    case "asc":
      return r2;
    case "desc":
      return -1 * r2;
    default:
      return A2();
  }
}
__name(re, "re");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ie = function() {
  function t2(t3) {
    this.timestamp = t3;
  }
  __name(t2, "t");
  return t2.fromTimestamp = function(e) {
    return new t2(e);
  }, t2.min = function() {
    return new t2(new tt(0, 0));
  }, t2.prototype.compareTo = function(t3) {
    return this.timestamp._compareTo(t3.timestamp);
  }, t2.prototype.isEqual = function(t3) {
    return this.timestamp.isEqual(t3.timestamp);
  }, t2.prototype.toMicroseconds = function() {
    return 1e6 * this.timestamp.seconds + this.timestamp.nanoseconds / 1e3;
  }, t2.prototype.toString = function() {
    return "SnapshotVersion(" + this.timestamp.toString() + ")";
  }, t2.prototype.toTimestamp = function() {
    return this.timestamp;
  }, t2;
}();
var oe = function() {
  function t2(t3) {
    this.fields = t3, t3.sort(W2.comparator);
  }
  __name(t2, "t");
  return t2.prototype.covers = function(t3) {
    for (var e = 0, n2 = this.fields; e < n2.length; e++) {
      if (n2[e].isPrefixOf(t3))
        return true;
    }
    return false;
  }, t2.prototype.isEqual = function(t3) {
    return O2(this.fields, t3.fields, function(t4, e) {
      return t4.isEqual(e);
    });
  }, t2;
}();
var se = function() {
  function t2(t3) {
    this.proto = t3;
  }
  __name(t2, "t");
  return t2.empty = function() {
    return new t2({
      mapValue: {}
    });
  }, t2.prototype.field = function(t3) {
    if (t3.isEmpty())
      return this.proto;
    for (var e = this.proto, n2 = 0; n2 < t3.length - 1; ++n2) {
      if (!e.mapValue.fields)
        return null;
      if (!vt(e = e.mapValue.fields[t3.get(n2)]))
        return null;
    }
    return (e = (e.mapValue.fields || {})[t3.lastSegment()]) || null;
  }, t2.prototype.isEqual = function(t3) {
    return ot(this.proto, t3.proto);
  }, t2;
}();
var ue = function() {
  function t2(t3) {
    t3 === void 0 && (t3 = se.empty()), this.I = t3, this.A = new Map();
  }
  __name(t2, "t");
  return t2.prototype.set = function(t3, e) {
    return this.R(t3, e), this;
  }, t2.prototype.delete = function(t3) {
    return this.R(t3, null), this;
  }, t2.prototype.R = function(t3, e) {
    for (var n2 = this.A, r2 = 0; r2 < t3.length - 1; ++r2) {
      var i = t3.get(r2), o = n2.get(i);
      o instanceof Map ? n2 = o : o && it(o) === 10 ? (o = new Map(Object.entries(o.mapValue.fields || {})), n2.set(i, o), n2 = o) : (o = new Map(), n2.set(i, o), n2 = o);
    }
    n2.set(t3.lastSegment(), e);
  }, t2.prototype.v = function() {
    var t3 = this.P(W2.emptyPath(), this.A);
    return t3 != null ? new se(t3) : this.I;
  }, t2.prototype.P = function(t3, e) {
    var n2 = this, r2 = false, i = this.I.field(t3), o = vt(i) ? Object.assign({}, i.mapValue.fields) : {};
    return e.forEach(function(e2, i2) {
      if (e2 instanceof Map) {
        var s = n2.P(t3.child(i2), e2);
        s != null && (o[i2] = s, r2 = true);
      } else
        e2 !== null ? (o[i2] = e2, r2 = true) : o.hasOwnProperty(i2) && (delete o[i2], r2 = true);
    }), r2 ? {
      mapValue: {
        fields: o
      }
    } : null;
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ae(t2) {
  var e = [];
  return F2(t2.fields || {}, function(t3, n2) {
    var r2 = new W2([t3]);
    if (vt(n2)) {
      var i = ae(n2.mapValue).fields;
      if (i.length === 0)
        e.push(r2);
      else
        for (var o = 0, s = i; o < s.length; o++) {
          var u = s[o];
          e.push(r2.child(u));
        }
    } else
      e.push(r2);
  }), new oe(e);
}
__name(ae, "ae");
function ce(t2, e) {
  if (t2.V) {
    if (isNaN(e))
      return {
        doubleValue: "NaN"
      };
    if (e === 1 / 0)
      return {
        doubleValue: "Infinity"
      };
    if (e === -1 / 0)
      return {
        doubleValue: "-Infinity"
      };
  }
  return {
    doubleValue: U2(e) ? "-0" : e
  };
}
__name(ce, "ce");
function he(t2) {
  return {
    integerValue: "" + t2
  };
}
__name(he, "he");
function fe(t2, e) {
  return B(e) ? he(e) : ce(t2, e);
}
__name(fe, "fe");
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var le = /* @__PURE__ */ __name(function() {
  this._ = void 0;
}, "le");
function de(t2, e, n2) {
  return t2 instanceof ve ? function(t3, e2) {
    var n3 = {
      fields: {
        __type__: {
          stringValue: "server_timestamp"
        },
        __local_write_time__: {
          timestampValue: {
            seconds: t3.seconds,
            nanos: t3.nanoseconds
          }
        }
      }
    };
    return e2 && (n3.fields.__previous_value__ = e2), {
      mapValue: n3
    };
  }(n2, e) : t2 instanceof me ? ge(t2, e) : t2 instanceof we ? be(t2, e) : function(t3, e2) {
    var n3 = ye(t3, e2), r2 = Ee(n3) + Ee(t3.S);
    return lt(n3) && lt(t3.S) ? he(r2) : ce(t3.D, r2);
  }(t2, e);
}
__name(de, "de");
function pe(t2, e, n2) {
  return t2 instanceof me ? ge(t2, e) : t2 instanceof we ? be(t2, e) : n2;
}
__name(pe, "pe");
function ye(t2, e) {
  return t2 instanceof Ie ? lt(n2 = e) || function(t3) {
    return !!t3 && "doubleValue" in t3;
  }(n2) ? e : {
    integerValue: 0
  } : null;
  var n2;
}
__name(ye, "ye");
var ve = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(le);
var me = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).elements = e2, n2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(le);
function ge(t2, e) {
  for (var n2 = Te(e), r2 = function(t3) {
    n2.some(function(e2) {
      return ot(e2, t3);
    }) || n2.push(t3);
  }, i = 0, o = t2.elements; i < o.length; i++) {
    r2(o[i]);
  }
  return {
    arrayValue: {
      values: n2
    }
  };
}
__name(ge, "ge");
var we = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).elements = e2, n2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(le);
function be(t2, e) {
  for (var n2 = Te(e), r2 = function(t3) {
    n2 = n2.filter(function(e2) {
      return !ot(e2, t3);
    });
  }, i = 0, o = t2.elements; i < o.length; i++) {
    r2(o[i]);
  }
  return {
    arrayValue: {
      values: n2
    }
  };
}
__name(be, "be");
var Ie = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).D = e2, r2.S = n2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(le);
function Ee(t2) {
  return $(t2.integerValue || t2.doubleValue);
}
__name(Ee, "Ee");
function Te(t2) {
  return dt(t2) && t2.arrayValue.values ? t2.arrayValue.values.slice() : [];
}
__name(Te, "Te");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _e = /* @__PURE__ */ __name(function(t2, e) {
  this.field = t2, this.transform = e;
}, "_e");
var Se = /* @__PURE__ */ __name(function(t2, e) {
  this.version = t2, this.transformResults = e;
}, "Se");
var De = function() {
  function t2(t3, e) {
    this.updateTime = t3, this.exists = e;
  }
  __name(t2, "t");
  return t2.none = function() {
    return new t2();
  }, t2.exists = function(e) {
    return new t2(void 0, e);
  }, t2.updateTime = function(e) {
    return new t2(e);
  }, Object.defineProperty(t2.prototype, "isNone", {
    get: function() {
      return this.updateTime === void 0 && this.exists === void 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    return this.exists === t3.exists && (this.updateTime ? !!t3.updateTime && this.updateTime.isEqual(t3.updateTime) : !t3.updateTime);
  }, t2;
}();
function Ne(t2, e) {
  return t2.updateTime !== void 0 ? e instanceof gt && e.version.isEqual(t2.updateTime) : t2.exists === void 0 || t2.exists === e instanceof gt;
}
__name(Ne, "Ne");
var Ae = /* @__PURE__ */ __name(function() {
}, "Ae");
function ke(t2, e, n2) {
  return t2 instanceof Oe ? function(t3, e2, n3) {
    var r2 = t3.value, i = Fe(t3.fieldTransforms, e2, n3.transformResults);
    return r2 = Ve(t3.fieldTransforms, r2, i), new gt(t3.key, n3.version, r2, {
      hasCommittedMutations: true
    });
  }(t2, e, n2) : t2 instanceof Pe ? function(t3, e2, n3) {
    if (!Ne(t3.precondition, e2))
      return new bt(t3.key, n3.version);
    var r2 = Me(t3, e2, Fe(t3.fieldTransforms, e2, n3.transformResults));
    return new gt(t3.key, n3.version, r2, {
      hasCommittedMutations: true
    });
  }(t2, e, n2) : function(t3, e2, n3) {
    return new wt(t3.key, n3.version, {
      hasCommittedMutations: true
    });
  }(t2, 0, n2);
}
__name(ke, "ke");
function Ce(t2, e, n2) {
  return t2 instanceof Oe ? function(t3, e2, n3) {
    if (!Ne(t3.precondition, e2))
      return e2;
    var r2 = t3.value, i = qe(t3.fieldTransforms, n3, e2);
    r2 = Ve(t3.fieldTransforms, r2, i);
    var o = Re(e2);
    return new gt(t3.key, o, r2, {
      hasLocalMutations: true
    });
  }(t2, e, n2) : t2 instanceof Pe ? function(t3, e2, n3) {
    if (!Ne(t3.precondition, e2))
      return e2;
    var r2 = Re(e2), i = Me(t3, e2, qe(t3.fieldTransforms, n3, e2));
    return new gt(t3.key, r2, i, {
      hasLocalMutations: true
    });
  }(t2, e, n2) : function(t3, e2) {
    return Ne(t3.precondition, e2) ? new wt(t3.key, ie.min()) : e2;
  }(t2, e);
}
__name(Ce, "Ce");
function xe(t2, e) {
  return function(t3, e2) {
    for (var n2 = null, r2 = 0, i = t3; r2 < i.length; r2++) {
      var o = i[r2], s = e2 instanceof gt ? e2.field(o.field) : void 0, u = ye(o.transform, s || null);
      u != null && (n2 = n2 == null ? new ue().set(o.field, u) : n2.set(o.field, u));
    }
    return n2 ? n2.v() : null;
  }(t2.fieldTransforms, e);
}
__name(xe, "xe");
function Le(t2, e) {
  return t2.type === e.type && !!t2.key.isEqual(e.key) && !!t2.precondition.isEqual(e.precondition) && !!function(t3, e2) {
    return t3 === void 0 && e2 === void 0 || !(!t3 || !e2) && O2(t3, e2, function(t4, e3) {
      return function(t5, e4) {
        return t5.field.isEqual(e4.field) && function(t6, e5) {
          return t6 instanceof me && e5 instanceof me || t6 instanceof we && e5 instanceof we ? O2(t6.elements, e5.elements, ot) : t6 instanceof Ie && e5 instanceof Ie ? ot(t6.S, e5.S) : t6 instanceof ve && e5 instanceof ve;
        }(t5.transform, e4.transform);
      }(t4, e3);
    });
  }(t2.fieldTransforms, e.fieldTransforms) && (t2.type === 0 ? t2.value.isEqual(e.value) : t2.type !== 1 || t2.data.isEqual(e.data) && t2.fieldMask.isEqual(e.fieldMask));
}
__name(Le, "Le");
function Re(t2) {
  return t2 instanceof gt ? t2.version : ie.min();
}
__name(Re, "Re");
var Oe = function(t2) {
  function e(e2, n2, r2, i) {
    i === void 0 && (i = []);
    var o = this;
    return (o = t2.call(this) || this).key = e2, o.value = n2, o.precondition = r2, o.fieldTransforms = i, o.type = 0, o;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(Ae);
var Pe = function(t2) {
  function e(e2, n2, r2, i, o) {
    o === void 0 && (o = []);
    var s = this;
    return (s = t2.call(this) || this).key = e2, s.data = n2, s.fieldMask = r2, s.precondition = i, s.fieldTransforms = o, s.type = 1, s;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(Ae);
function Me(t2, e, n2) {
  var r2;
  return r2 = function(t3, e2) {
    var n3 = new ue(e2);
    return t3.fieldMask.fields.forEach(function(e3) {
      if (!e3.isEmpty()) {
        var r3 = t3.data.field(e3);
        r3 !== null ? n3.set(e3, r3) : n3.delete(e3);
      }
    }), n3.v();
  }(t2, r2 = e instanceof gt ? e.data() : se.empty()), r2 = Ve(t2.fieldTransforms, r2, n2);
}
__name(Me, "Me");
function Fe(t2, e, n2) {
  var r2 = [];
  k2(t2.length === n2.length);
  for (var i = 0; i < n2.length; i++) {
    var o = t2[i], s = o.transform, u = null;
    e instanceof gt && (u = e.field(o.field)), r2.push(pe(s, u, n2[i]));
  }
  return r2;
}
__name(Fe, "Fe");
function qe(t2, e, n2) {
  for (var r2 = [], i = 0, o = t2; i < o.length; i++) {
    var s = o[i], u = s.transform, a = null;
    n2 instanceof gt && (a = n2.field(s.field)), r2.push(de(u, a, e));
  }
  return r2;
}
__name(qe, "qe");
function Ve(t2, e, n2) {
  for (var r2 = new ue(e), i = 0; i < t2.length; i++) {
    var o = t2[i];
    r2.set(o.field, n2[i]);
  }
  return r2.v();
}
__name(Ve, "Ve");
var Ue;
var Be;
var je = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).key = e2, r2.precondition = n2, r2.type = 2, r2.fieldTransforms = [], r2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(Ae);
var Ge = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).key = e2, r2.precondition = n2, r2.type = 3, r2.fieldTransforms = [], r2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(Ae);
var Ke = /* @__PURE__ */ __name(function(t2) {
  this.count = t2;
}, "Ke");
function ze(t2) {
  switch (t2) {
    case j.OK:
      return A2();
    case j.CANCELLED:
    case j.UNKNOWN:
    case j.DEADLINE_EXCEEDED:
    case j.RESOURCE_EXHAUSTED:
    case j.INTERNAL:
    case j.UNAVAILABLE:
    case j.UNAUTHENTICATED:
      return false;
    case j.INVALID_ARGUMENT:
    case j.NOT_FOUND:
    case j.ALREADY_EXISTS:
    case j.PERMISSION_DENIED:
    case j.FAILED_PRECONDITION:
    case j.ABORTED:
    case j.OUT_OF_RANGE:
    case j.UNIMPLEMENTED:
    case j.DATA_LOSS:
      return true;
    default:
      return A2();
  }
}
__name(ze, "ze");
function Qe(t2) {
  if (t2 === void 0)
    return S2("GRPC error has no .code"), j.UNKNOWN;
  switch (t2) {
    case Ue.OK:
      return j.OK;
    case Ue.CANCELLED:
      return j.CANCELLED;
    case Ue.UNKNOWN:
      return j.UNKNOWN;
    case Ue.DEADLINE_EXCEEDED:
      return j.DEADLINE_EXCEEDED;
    case Ue.RESOURCE_EXHAUSTED:
      return j.RESOURCE_EXHAUSTED;
    case Ue.INTERNAL:
      return j.INTERNAL;
    case Ue.UNAVAILABLE:
      return j.UNAVAILABLE;
    case Ue.UNAUTHENTICATED:
      return j.UNAUTHENTICATED;
    case Ue.INVALID_ARGUMENT:
      return j.INVALID_ARGUMENT;
    case Ue.NOT_FOUND:
      return j.NOT_FOUND;
    case Ue.ALREADY_EXISTS:
      return j.ALREADY_EXISTS;
    case Ue.PERMISSION_DENIED:
      return j.PERMISSION_DENIED;
    case Ue.FAILED_PRECONDITION:
      return j.FAILED_PRECONDITION;
    case Ue.ABORTED:
      return j.ABORTED;
    case Ue.OUT_OF_RANGE:
      return j.OUT_OF_RANGE;
    case Ue.UNIMPLEMENTED:
      return j.UNIMPLEMENTED;
    case Ue.DATA_LOSS:
      return j.DATA_LOSS;
    default:
      return A2();
  }
}
__name(Qe, "Qe");
(Be = Ue || (Ue = {}))[Be.OK = 0] = "OK", Be[Be.CANCELLED = 1] = "CANCELLED", Be[Be.UNKNOWN = 2] = "UNKNOWN", Be[Be.INVALID_ARGUMENT = 3] = "INVALID_ARGUMENT", Be[Be.DEADLINE_EXCEEDED = 4] = "DEADLINE_EXCEEDED", Be[Be.NOT_FOUND = 5] = "NOT_FOUND", Be[Be.ALREADY_EXISTS = 6] = "ALREADY_EXISTS", Be[Be.PERMISSION_DENIED = 7] = "PERMISSION_DENIED", Be[Be.UNAUTHENTICATED = 16] = "UNAUTHENTICATED", Be[Be.RESOURCE_EXHAUSTED = 8] = "RESOURCE_EXHAUSTED", Be[Be.FAILED_PRECONDITION = 9] = "FAILED_PRECONDITION", Be[Be.ABORTED = 10] = "ABORTED", Be[Be.OUT_OF_RANGE = 11] = "OUT_OF_RANGE", Be[Be.UNIMPLEMENTED = 12] = "UNIMPLEMENTED", Be[Be.INTERNAL = 13] = "INTERNAL", Be[Be.UNAVAILABLE = 14] = "UNAVAILABLE", Be[Be.DATA_LOSS = 15] = "DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var We = function() {
  function t2(t3, e) {
    this.comparator = t3, this.root = e || Ye.EMPTY;
  }
  __name(t2, "t");
  return t2.prototype.insert = function(e, n2) {
    return new t2(this.comparator, this.root.insert(e, n2, this.comparator).copy(null, null, Ye.BLACK, null, null));
  }, t2.prototype.remove = function(e) {
    return new t2(this.comparator, this.root.remove(e, this.comparator).copy(null, null, Ye.BLACK, null, null));
  }, t2.prototype.get = function(t3) {
    for (var e = this.root; !e.isEmpty(); ) {
      var n2 = this.comparator(t3, e.key);
      if (n2 === 0)
        return e.value;
      n2 < 0 ? e = e.left : n2 > 0 && (e = e.right);
    }
    return null;
  }, t2.prototype.indexOf = function(t3) {
    for (var e = 0, n2 = this.root; !n2.isEmpty(); ) {
      var r2 = this.comparator(t3, n2.key);
      if (r2 === 0)
        return e + n2.left.size;
      r2 < 0 ? n2 = n2.left : (e += n2.left.size + 1, n2 = n2.right);
    }
    return -1;
  }, t2.prototype.isEmpty = function() {
    return this.root.isEmpty();
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.root.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.minKey = function() {
    return this.root.minKey();
  }, t2.prototype.maxKey = function() {
    return this.root.maxKey();
  }, t2.prototype.inorderTraversal = function(t3) {
    return this.root.inorderTraversal(t3);
  }, t2.prototype.forEach = function(t3) {
    this.inorderTraversal(function(e, n2) {
      return t3(e, n2), false;
    });
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.inorderTraversal(function(e, n2) {
      return t3.push(e + ":" + n2), false;
    }), "{" + t3.join(", ") + "}";
  }, t2.prototype.reverseTraversal = function(t3) {
    return this.root.reverseTraversal(t3);
  }, t2.prototype.getIterator = function() {
    return new He(this.root, null, this.comparator, false);
  }, t2.prototype.getIteratorFrom = function(t3) {
    return new He(this.root, t3, this.comparator, false);
  }, t2.prototype.getReverseIterator = function() {
    return new He(this.root, null, this.comparator, true);
  }, t2.prototype.getReverseIteratorFrom = function(t3) {
    return new He(this.root, t3, this.comparator, true);
  }, t2;
}();
var He = function() {
  function t2(t3, e, n2, r2) {
    this.isReverse = r2, this.nodeStack = [];
    for (var i = 1; !t3.isEmpty(); )
      if (i = e ? n2(t3.key, e) : 1, r2 && (i *= -1), i < 0)
        t3 = this.isReverse ? t3.left : t3.right;
      else {
        if (i === 0) {
          this.nodeStack.push(t3);
          break;
        }
        this.nodeStack.push(t3), t3 = this.isReverse ? t3.right : t3.left;
      }
  }
  __name(t2, "t");
  return t2.prototype.getNext = function() {
    var t3 = this.nodeStack.pop(), e = {
      key: t3.key,
      value: t3.value
    };
    if (this.isReverse)
      for (t3 = t3.left; !t3.isEmpty(); )
        this.nodeStack.push(t3), t3 = t3.right;
    else
      for (t3 = t3.right; !t3.isEmpty(); )
        this.nodeStack.push(t3), t3 = t3.left;
    return e;
  }, t2.prototype.hasNext = function() {
    return this.nodeStack.length > 0;
  }, t2.prototype.peek = function() {
    if (this.nodeStack.length === 0)
      return null;
    var t3 = this.nodeStack[this.nodeStack.length - 1];
    return {
      key: t3.key,
      value: t3.value
    };
  }, t2;
}();
var Ye = function() {
  function t2(e, n2, r2, i, o) {
    this.key = e, this.value = n2, this.color = r2 != null ? r2 : t2.RED, this.left = i != null ? i : t2.EMPTY, this.right = o != null ? o : t2.EMPTY, this.size = this.left.size + 1 + this.right.size;
  }
  __name(t2, "t");
  return t2.prototype.copy = function(e, n2, r2, i, o) {
    return new t2(e != null ? e : this.key, n2 != null ? n2 : this.value, r2 != null ? r2 : this.color, i != null ? i : this.left, o != null ? o : this.right);
  }, t2.prototype.isEmpty = function() {
    return false;
  }, t2.prototype.inorderTraversal = function(t3) {
    return this.left.inorderTraversal(t3) || t3(this.key, this.value) || this.right.inorderTraversal(t3);
  }, t2.prototype.reverseTraversal = function(t3) {
    return this.right.reverseTraversal(t3) || t3(this.key, this.value) || this.left.reverseTraversal(t3);
  }, t2.prototype.min = function() {
    return this.left.isEmpty() ? this : this.left.min();
  }, t2.prototype.minKey = function() {
    return this.min().key;
  }, t2.prototype.maxKey = function() {
    return this.right.isEmpty() ? this.key : this.right.maxKey();
  }, t2.prototype.insert = function(t3, e, n2) {
    var r2 = this, i = n2(t3, r2.key);
    return (r2 = i < 0 ? r2.copy(null, null, null, r2.left.insert(t3, e, n2), null) : i === 0 ? r2.copy(null, e, null, null, null) : r2.copy(null, null, null, null, r2.right.insert(t3, e, n2))).fixUp();
  }, t2.prototype.removeMin = function() {
    if (this.left.isEmpty())
      return t2.EMPTY;
    var e = this;
    return e.left.isRed() || e.left.left.isRed() || (e = e.moveRedLeft()), (e = e.copy(null, null, null, e.left.removeMin(), null)).fixUp();
  }, t2.prototype.remove = function(e, n2) {
    var r2, i = this;
    if (n2(e, i.key) < 0)
      i.left.isEmpty() || i.left.isRed() || i.left.left.isRed() || (i = i.moveRedLeft()), i = i.copy(null, null, null, i.left.remove(e, n2), null);
    else {
      if (i.left.isRed() && (i = i.rotateRight()), i.right.isEmpty() || i.right.isRed() || i.right.left.isRed() || (i = i.moveRedRight()), n2(e, i.key) === 0) {
        if (i.right.isEmpty())
          return t2.EMPTY;
        r2 = i.right.min(), i = i.copy(r2.key, r2.value, null, null, i.right.removeMin());
      }
      i = i.copy(null, null, null, null, i.right.remove(e, n2));
    }
    return i.fixUp();
  }, t2.prototype.isRed = function() {
    return this.color;
  }, t2.prototype.fixUp = function() {
    var t3 = this;
    return t3.right.isRed() && !t3.left.isRed() && (t3 = t3.rotateLeft()), t3.left.isRed() && t3.left.left.isRed() && (t3 = t3.rotateRight()), t3.left.isRed() && t3.right.isRed() && (t3 = t3.colorFlip()), t3;
  }, t2.prototype.moveRedLeft = function() {
    var t3 = this.colorFlip();
    return t3.right.left.isRed() && (t3 = (t3 = (t3 = t3.copy(null, null, null, null, t3.right.rotateRight())).rotateLeft()).colorFlip()), t3;
  }, t2.prototype.moveRedRight = function() {
    var t3 = this.colorFlip();
    return t3.left.left.isRed() && (t3 = (t3 = t3.rotateRight()).colorFlip()), t3;
  }, t2.prototype.rotateLeft = function() {
    var e = this.copy(null, null, t2.RED, null, this.right.left);
    return this.right.copy(null, null, this.color, e, null);
  }, t2.prototype.rotateRight = function() {
    var e = this.copy(null, null, t2.RED, this.left.right, null);
    return this.left.copy(null, null, this.color, null, e);
  }, t2.prototype.colorFlip = function() {
    var t3 = this.left.copy(null, null, !this.left.color, null, null), e = this.right.copy(null, null, !this.right.color, null, null);
    return this.copy(null, null, !this.color, t3, e);
  }, t2.prototype.checkMaxDepth = function() {
    var t3 = this.check();
    return Math.pow(2, t3) <= this.size + 1;
  }, t2.prototype.check = function() {
    if (this.isRed() && this.left.isRed())
      throw A2();
    if (this.right.isRed())
      throw A2();
    var t3 = this.left.check();
    if (t3 !== this.right.check())
      throw A2();
    return t3 + (this.isRed() ? 0 : 1);
  }, t2;
}();
Ye.EMPTY = null, Ye.RED = true, Ye.BLACK = false, Ye.EMPTY = new (function() {
  function t2() {
    this.size = 0;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "key", {
    get: function() {
      throw A2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "value", {
    get: function() {
      throw A2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "color", {
    get: function() {
      throw A2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "left", {
    get: function() {
      throw A2();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "right", {
    get: function() {
      throw A2();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.copy = function(t3, e, n2, r2, i) {
    return this;
  }, t2.prototype.insert = function(t3, e, n2) {
    return new Ye(t3, e);
  }, t2.prototype.remove = function(t3, e) {
    return this;
  }, t2.prototype.isEmpty = function() {
    return true;
  }, t2.prototype.inorderTraversal = function(t3) {
    return false;
  }, t2.prototype.reverseTraversal = function(t3) {
    return false;
  }, t2.prototype.minKey = function() {
    return null;
  }, t2.prototype.maxKey = function() {
    return null;
  }, t2.prototype.isRed = function() {
    return false;
  }, t2.prototype.checkMaxDepth = function() {
    return true;
  }, t2.prototype.check = function() {
    return 0;
  }, t2;
}())();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Je = function() {
  function t2(t3) {
    this.comparator = t3, this.data = new We(this.comparator);
  }
  __name(t2, "t");
  return t2.prototype.has = function(t3) {
    return this.data.get(t3) !== null;
  }, t2.prototype.first = function() {
    return this.data.minKey();
  }, t2.prototype.last = function() {
    return this.data.maxKey();
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.data.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.indexOf = function(t3) {
    return this.data.indexOf(t3);
  }, t2.prototype.forEach = function(t3) {
    this.data.inorderTraversal(function(e, n2) {
      return t3(e), false;
    });
  }, t2.prototype.forEachInRange = function(t3, e) {
    for (var n2 = this.data.getIteratorFrom(t3[0]); n2.hasNext(); ) {
      var r2 = n2.getNext();
      if (this.comparator(r2.key, t3[1]) >= 0)
        return;
      e(r2.key);
    }
  }, t2.prototype.forEachWhile = function(t3, e) {
    var n2;
    for (n2 = e !== void 0 ? this.data.getIteratorFrom(e) : this.data.getIterator(); n2.hasNext(); )
      if (!t3(n2.getNext().key))
        return;
  }, t2.prototype.firstAfterOrEqual = function(t3) {
    var e = this.data.getIteratorFrom(t3);
    return e.hasNext() ? e.getNext().key : null;
  }, t2.prototype.getIterator = function() {
    return new Xe(this.data.getIterator());
  }, t2.prototype.getIteratorFrom = function(t3) {
    return new Xe(this.data.getIteratorFrom(t3));
  }, t2.prototype.add = function(t3) {
    return this.copy(this.data.remove(t3).insert(t3, true));
  }, t2.prototype.delete = function(t3) {
    return this.has(t3) ? this.copy(this.data.remove(t3)) : this;
  }, t2.prototype.isEmpty = function() {
    return this.data.isEmpty();
  }, t2.prototype.unionWith = function(t3) {
    var e = this;
    return e.size < t3.size && (e = t3, t3 = this), t3.forEach(function(t4) {
      e = e.add(t4);
    }), e;
  }, t2.prototype.isEqual = function(e) {
    if (!(e instanceof t2))
      return false;
    if (this.size !== e.size)
      return false;
    for (var n2 = this.data.getIterator(), r2 = e.data.getIterator(); n2.hasNext(); ) {
      var i = n2.getNext().key, o = r2.getNext().key;
      if (this.comparator(i, o) !== 0)
        return false;
    }
    return true;
  }, t2.prototype.toArray = function() {
    var t3 = [];
    return this.forEach(function(e) {
      t3.push(e);
    }), t3;
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.forEach(function(e) {
      return t3.push(e);
    }), "SortedSet(" + t3.toString() + ")";
  }, t2.prototype.copy = function(e) {
    var n2 = new t2(this.comparator);
    return n2.data = e, n2;
  }, t2;
}();
var Xe = function() {
  function t2(t3) {
    this.iter = t3;
  }
  __name(t2, "t");
  return t2.prototype.getNext = function() {
    return this.iter.getNext().key;
  }, t2.prototype.hasNext = function() {
    return this.iter.hasNext();
  }, t2;
}();
var $e = new We(H2.comparator);
function Ze() {
  return $e;
}
__name(Ze, "Ze");
function tn() {
  return Ze();
}
__name(tn, "tn");
var en = new We(H2.comparator);
function nn() {
  return en;
}
__name(nn, "nn");
var rn = new We(H2.comparator);
function on() {
  return rn;
}
__name(on, "on");
var sn = new Je(H2.comparator);
function un() {
  for (var t2 = [], e = 0; e < arguments.length; e++)
    t2[e] = arguments[e];
  for (var n2 = sn, r2 = 0, i = t2; r2 < i.length; r2++) {
    var o = i[r2];
    n2 = n2.add(o);
  }
  return n2;
}
__name(un, "un");
var an = new Je(R2);
function cn() {
  return an;
}
__name(cn, "cn");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var hn = function() {
  function t2(t3, e, n2, r2, i) {
    this.snapshotVersion = t3, this.targetChanges = e, this.targetMismatches = n2, this.documentUpdates = r2, this.resolvedLimboDocuments = i;
  }
  __name(t2, "t");
  return t2.createSynthesizedRemoteEventForCurrentChange = function(e, n2) {
    var r2 = new Map();
    return r2.set(e, fn.createSynthesizedTargetChangeForCurrentChange(e, n2)), new t2(ie.min(), r2, cn(), Ze(), un());
  }, t2;
}();
var fn = function() {
  function t2(t3, e, n2, r2, i) {
    this.resumeToken = t3, this.current = e, this.addedDocuments = n2, this.modifiedDocuments = r2, this.removedDocuments = i;
  }
  __name(t2, "t");
  return t2.createSynthesizedTargetChangeForCurrentChange = function(e, n2) {
    return new t2(Y2.EMPTY_BYTE_STRING, n2, un(), un(), un());
  }, t2;
}();
var ln = /* @__PURE__ */ __name(function(t2, e, n2, r2) {
  this.C = t2, this.removedTargetIds = e, this.key = n2, this.N = r2;
}, "ln");
var dn = /* @__PURE__ */ __name(function(t2, e) {
  this.targetId = t2, this.$ = e;
}, "dn");
var pn = /* @__PURE__ */ __name(function(t2, e, n2, r2) {
  n2 === void 0 && (n2 = Y2.EMPTY_BYTE_STRING), r2 === void 0 && (r2 = null), this.state = t2, this.targetIds = e, this.resumeToken = n2, this.cause = r2;
}, "pn");
var yn = function() {
  function t2() {
    this.F = 0, this.O = gn(), this.k = Y2.EMPTY_BYTE_STRING, this.M = false, this.L = true;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "current", {
    get: function() {
      return this.M;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "resumeToken", {
    get: function() {
      return this.k;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "B", {
    get: function() {
      return this.F !== 0;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "q", {
    get: function() {
      return this.L;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.U = function(t3) {
    t3.approximateByteSize() > 0 && (this.L = true, this.k = t3);
  }, t2.prototype.K = function() {
    var t3 = un(), e = un(), n2 = un();
    return this.O.forEach(function(r2, i) {
      switch (i) {
        case 0:
          t3 = t3.add(r2);
          break;
        case 2:
          e = e.add(r2);
          break;
        case 1:
          n2 = n2.add(r2);
          break;
        default:
          A2();
      }
    }), new fn(this.k, this.M, t3, e, n2);
  }, t2.prototype.W = function() {
    this.L = false, this.O = gn();
  }, t2.prototype.j = function(t3, e) {
    this.L = true, this.O = this.O.insert(t3, e);
  }, t2.prototype.G = function(t3) {
    this.L = true, this.O = this.O.remove(t3);
  }, t2.prototype.H = function() {
    this.F += 1;
  }, t2.prototype.J = function() {
    this.F -= 1;
  }, t2.prototype.Y = function() {
    this.L = true, this.M = true;
  }, t2;
}();
var vn = function() {
  function t2(t3) {
    this.X = t3, this.Z = new Map(), this.tt = Ze(), this.et = mn(), this.nt = new Je(R2);
  }
  __name(t2, "t");
  return t2.prototype.st = function(t3) {
    for (var e = 0, n2 = t3.C; e < n2.length; e++) {
      var r2 = n2[e];
      t3.N instanceof gt ? this.it(r2, t3.N) : t3.N instanceof wt && this.rt(r2, t3.key, t3.N);
    }
    for (var i = 0, o = t3.removedTargetIds; i < o.length; i++) {
      r2 = o[i];
      this.rt(r2, t3.key, t3.N);
    }
  }, t2.prototype.ot = function(t3) {
    var e = this;
    this.forEachTarget(t3, function(n2) {
      var r2 = e.ct(n2);
      switch (t3.state) {
        case 0:
          e.at(n2) && r2.U(t3.resumeToken);
          break;
        case 1:
          r2.J(), r2.B || r2.W(), r2.U(t3.resumeToken);
          break;
        case 2:
          r2.J(), r2.B || e.removeTarget(n2);
          break;
        case 3:
          e.at(n2) && (r2.Y(), r2.U(t3.resumeToken));
          break;
        case 4:
          e.at(n2) && (e.ut(n2), r2.U(t3.resumeToken));
          break;
        default:
          A2();
      }
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    var n2 = this;
    t3.targetIds.length > 0 ? t3.targetIds.forEach(e) : this.Z.forEach(function(t4, r2) {
      n2.at(r2) && e(r2);
    });
  }, t2.prototype.ht = function(t3) {
    var e = t3.targetId, n2 = t3.$.count, r2 = this.lt(e);
    if (r2) {
      var i = r2.target;
      if (St(i))
        if (n2 === 0) {
          var o = new H2(i.path);
          this.rt(e, o, new wt(o, ie.min()));
        } else
          k2(n2 === 1);
      else
        this.ft(e) !== n2 && (this.ut(e), this.nt = this.nt.add(e));
    }
  }, t2.prototype.dt = function(t3) {
    var e = this, n2 = new Map();
    this.Z.forEach(function(r3, i2) {
      var o = e.lt(i2);
      if (o) {
        if (r3.current && St(o.target)) {
          var s = new H2(o.target.path);
          e.tt.get(s) !== null || e.wt(i2, s) || e.rt(i2, s, new wt(s, t3));
        }
        r3.q && (n2.set(i2, r3.K()), r3.W());
      }
    });
    var r2 = un();
    this.et.forEach(function(t4, n3) {
      var i2 = true;
      n3.forEachWhile(function(t5) {
        var n4 = e.lt(t5);
        return !n4 || n4.purpose === 2 || (i2 = false, false);
      }), i2 && (r2 = r2.add(t4));
    });
    var i = new hn(t3, n2, this.nt, this.tt, r2);
    return this.tt = Ze(), this.et = mn(), this.nt = new Je(R2), i;
  }, t2.prototype.it = function(t3, e) {
    if (this.at(t3)) {
      var n2 = this.wt(t3, e.key) ? 2 : 0;
      this.ct(t3).j(e.key, n2), this.tt = this.tt.insert(e.key, e), this.et = this.et.insert(e.key, this._t(e.key).add(t3));
    }
  }, t2.prototype.rt = function(t3, e, n2) {
    if (this.at(t3)) {
      var r2 = this.ct(t3);
      this.wt(t3, e) ? r2.j(e, 1) : r2.G(e), this.et = this.et.insert(e, this._t(e).delete(t3)), n2 && (this.tt = this.tt.insert(e, n2));
    }
  }, t2.prototype.removeTarget = function(t3) {
    this.Z.delete(t3);
  }, t2.prototype.ft = function(t3) {
    var e = this.ct(t3).K();
    return this.X.getRemoteKeysForTarget(t3).size + e.addedDocuments.size - e.removedDocuments.size;
  }, t2.prototype.H = function(t3) {
    this.ct(t3).H();
  }, t2.prototype.ct = function(t3) {
    var e = this.Z.get(t3);
    return e || (e = new yn(), this.Z.set(t3, e)), e;
  }, t2.prototype._t = function(t3) {
    var e = this.et.get(t3);
    return e || (e = new Je(R2), this.et = this.et.insert(t3, e)), e;
  }, t2.prototype.at = function(t3) {
    var e = this.lt(t3) !== null;
    return e || _("WatchChangeAggregator", "Detected inactive target", t3), e;
  }, t2.prototype.lt = function(t3) {
    var e = this.Z.get(t3);
    return e && e.B ? null : this.X.yt(t3);
  }, t2.prototype.ut = function(t3) {
    var e = this;
    this.Z.set(t3, new yn()), this.X.getRemoteKeysForTarget(t3).forEach(function(n2) {
      e.rt(t3, n2, null);
    });
  }, t2.prototype.wt = function(t3, e) {
    return this.X.getRemoteKeysForTarget(t3).has(e);
  }, t2;
}();
function mn() {
  return new We(H2.comparator);
}
__name(mn, "mn");
function gn() {
  return new We(H2.comparator);
}
__name(gn, "gn");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var wn = {
  asc: "ASCENDING",
  desc: "DESCENDING"
};
var bn = {
  "<": "LESS_THAN",
  "<=": "LESS_THAN_OR_EQUAL",
  ">": "GREATER_THAN",
  ">=": "GREATER_THAN_OR_EQUAL",
  "==": "EQUAL",
  "!=": "NOT_EQUAL",
  "array-contains": "ARRAY_CONTAINS",
  in: "IN",
  "not-in": "NOT_IN",
  "array-contains-any": "ARRAY_CONTAINS_ANY"
};
var In = /* @__PURE__ */ __name(function(t2, e) {
  this.databaseId = t2, this.V = e;
}, "In");
function En(t2, e) {
  return t2.V ? new Date(1e3 * e.seconds).toISOString().replace(/\.\d*/, "").replace("Z", "") + "." + ("000000000" + e.nanoseconds).slice(-9) + "Z" : {
    seconds: "" + e.seconds,
    nanos: e.nanoseconds
  };
}
__name(En, "En");
function Tn(t2, e) {
  return t2.V ? e.toBase64() : e.toUint8Array();
}
__name(Tn, "Tn");
function _n(t2, e) {
  return En(t2, e.toTimestamp());
}
__name(_n, "_n");
function Sn(t2) {
  return k2(!!t2), ie.fromTimestamp(function(t3) {
    var e = X2(t3);
    return new tt(e.seconds, e.nanos);
  }(t2));
}
__name(Sn, "Sn");
function Dn(t2, e) {
  return function(t3) {
    return new z2(["projects", t3.projectId, "databases", t3.database]);
  }(t2).child("documents").child(e).canonicalString();
}
__name(Dn, "Dn");
function Nn(t2) {
  var e = z2.fromString(t2);
  return k2(Xn(e)), e;
}
__name(Nn, "Nn");
function An(t2, e) {
  return Dn(t2.databaseId, e.path);
}
__name(An, "An");
function kn(t2, e) {
  var n2 = Nn(e);
  if (n2.get(1) !== t2.databaseId.projectId)
    throw new G2(j.INVALID_ARGUMENT, "Tried to deserialize key from different project: " + n2.get(1) + " vs " + t2.databaseId.projectId);
  if (n2.get(3) !== t2.databaseId.database)
    throw new G2(j.INVALID_ARGUMENT, "Tried to deserialize key from different database: " + n2.get(3) + " vs " + t2.databaseId.database);
  return new H2(Rn(n2));
}
__name(kn, "kn");
function Cn(t2, e) {
  return Dn(t2.databaseId, e);
}
__name(Cn, "Cn");
function xn(t2) {
  var e = Nn(t2);
  return e.length === 4 ? z2.emptyPath() : Rn(e);
}
__name(xn, "xn");
function Ln(t2) {
  return new z2(["projects", t2.databaseId.projectId, "databases", t2.databaseId.database]).canonicalString();
}
__name(Ln, "Ln");
function Rn(t2) {
  return k2(t2.length > 4 && t2.get(4) === "documents"), t2.popFirst(5);
}
__name(Rn, "Rn");
function On(t2, e, n2) {
  return {
    name: An(t2, e),
    fields: n2.proto.mapValue.fields
  };
}
__name(On, "On");
function Pn(t2, e, n2) {
  var r2 = kn(t2, e.name), i = Sn(e.updateTime), o = new se({
    mapValue: {
      fields: e.fields
    }
  });
  return new gt(r2, i, o, {
    hasCommittedMutations: !!n2
  });
}
__name(Pn, "Pn");
function Mn(t2, e) {
  var n2;
  if (e instanceof Oe)
    n2 = {
      update: On(t2, e.key, e.value)
    };
  else if (e instanceof je)
    n2 = {
      delete: An(t2, e.key)
    };
  else if (e instanceof Pe)
    n2 = {
      update: On(t2, e.key, e.data),
      updateMask: Jn(e.fieldMask)
    };
  else {
    if (!(e instanceof Ge))
      return A2();
    n2 = {
      verify: An(t2, e.key)
    };
  }
  return e.fieldTransforms.length > 0 && (n2.updateTransforms = e.fieldTransforms.map(function(t3) {
    return function(t4, e2) {
      var n3 = e2.transform;
      if (n3 instanceof ve)
        return {
          fieldPath: e2.field.canonicalString(),
          setToServerValue: "REQUEST_TIME"
        };
      if (n3 instanceof me)
        return {
          fieldPath: e2.field.canonicalString(),
          appendMissingElements: {
            values: n3.elements
          }
        };
      if (n3 instanceof we)
        return {
          fieldPath: e2.field.canonicalString(),
          removeAllFromArray: {
            values: n3.elements
          }
        };
      if (n3 instanceof Ie)
        return {
          fieldPath: e2.field.canonicalString(),
          increment: n3.S
        };
      throw A2();
    }(0, t3);
  })), e.precondition.isNone || (n2.currentDocument = function(t3, e2) {
    return e2.updateTime !== void 0 ? {
      updateTime: _n(t3, e2.updateTime)
    } : e2.exists !== void 0 ? {
      exists: e2.exists
    } : A2();
  }(t2, e.precondition)), n2;
}
__name(Mn, "Mn");
function Fn(t2, e) {
  var n2 = e.currentDocument ? function(t3) {
    return t3.updateTime !== void 0 ? De.updateTime(Sn(t3.updateTime)) : t3.exists !== void 0 ? De.exists(t3.exists) : De.none();
  }(e.currentDocument) : De.none(), r2 = e.updateTransforms ? e.updateTransforms.map(function(e2) {
    return function(t3, e3) {
      var n3 = null;
      if ("setToServerValue" in e3)
        k2(e3.setToServerValue === "REQUEST_TIME"), n3 = new ve();
      else if ("appendMissingElements" in e3) {
        var r3 = e3.appendMissingElements.values || [];
        n3 = new me(r3);
      } else if ("removeAllFromArray" in e3) {
        var i2 = e3.removeAllFromArray.values || [];
        n3 = new we(i2);
      } else
        "increment" in e3 ? n3 = new Ie(t3, e3.increment) : A2();
      var o2 = W2.fromServerFormat(e3.fieldPath);
      return new _e(o2, n3);
    }(t2, e2);
  }) : [];
  if (e.update) {
    e.update.name;
    var i = kn(t2, e.update.name), o = new se({
      mapValue: {
        fields: e.update.fields
      }
    });
    if (e.updateMask) {
      var s = function(t3) {
        var e2 = t3.fieldPaths || [];
        return new oe(e2.map(function(t4) {
          return W2.fromServerFormat(t4);
        }));
      }(e.updateMask);
      return new Pe(i, o, s, n2, r2);
    }
    return new Oe(i, o, n2, r2);
  }
  if (e.delete) {
    var u = kn(t2, e.delete);
    return new je(u, n2);
  }
  if (e.verify) {
    var a = kn(t2, e.verify);
    return new Ge(a, n2);
  }
  return A2();
}
__name(Fn, "Fn");
function qn(t2, e) {
  return {
    documents: [Cn(t2, e.path)]
  };
}
__name(qn, "qn");
function Vn(t2, e) {
  var n2 = {
    structuredQuery: {}
  }, r2 = e.path;
  e.collectionGroup !== null ? (n2.parent = Cn(t2, r2), n2.structuredQuery.from = [{
    collectionId: e.collectionGroup,
    allDescendants: true
  }]) : (n2.parent = Cn(t2, r2.popLast()), n2.structuredQuery.from = [{
    collectionId: r2.lastSegment()
  }]);
  var i = function(t3) {
    if (t3.length !== 0) {
      var e2 = t3.map(function(t4) {
        return function(t5) {
          if (t5.op === "==") {
            if (yt(t5.value))
              return {
                unaryFilter: {
                  field: Qn(t5.field),
                  op: "IS_NAN"
                }
              };
            if (pt(t5.value))
              return {
                unaryFilter: {
                  field: Qn(t5.field),
                  op: "IS_NULL"
                }
              };
          } else if (t5.op === "!=") {
            if (yt(t5.value))
              return {
                unaryFilter: {
                  field: Qn(t5.field),
                  op: "IS_NOT_NAN"
                }
              };
            if (pt(t5.value))
              return {
                unaryFilter: {
                  field: Qn(t5.field),
                  op: "IS_NOT_NULL"
                }
              };
          }
          return {
            fieldFilter: {
              field: Qn(t5.field),
              op: zn(t5.op),
              value: t5.value
            }
          };
        }(t4);
      });
      return e2.length === 1 ? e2[0] : {
        compositeFilter: {
          op: "AND",
          filters: e2
        }
      };
    }
  }(e.filters);
  i && (n2.structuredQuery.where = i);
  var o = function(t3) {
    if (t3.length !== 0)
      return t3.map(function(t4) {
        return function(t5) {
          return {
            field: Qn(t5.field),
            direction: Kn(t5.dir)
          };
        }(t4);
      });
  }(e.orderBy);
  o && (n2.structuredQuery.orderBy = o);
  var s = function(t3, e2) {
    return t3.V || V2(e2) ? e2 : {
      value: e2
    };
  }(t2, e.limit);
  return s !== null && (n2.structuredQuery.limit = s), e.startAt && (n2.structuredQuery.startAt = jn(e.startAt)), e.endAt && (n2.structuredQuery.endAt = jn(e.endAt)), n2;
}
__name(Vn, "Vn");
function Un(t2) {
  var e = xn(t2.parent), n2 = t2.structuredQuery, r2 = n2.from ? n2.from.length : 0, i = null;
  if (r2 > 0) {
    k2(r2 === 1);
    var o = n2.from[0];
    o.allDescendants ? i = o.collectionId : e = e.child(o.collectionId);
  }
  var s = [];
  n2.where && (s = Bn(n2.where));
  var u = [];
  n2.orderBy && (u = n2.orderBy.map(function(t3) {
    return function(t4) {
      return new Ft(Wn(t4.field), function(t5) {
        switch (t5) {
          case "ASCENDING":
            return "asc";
          case "DESCENDING":
            return "desc";
          default:
            return;
        }
      }(t4.direction));
    }(t3);
  }));
  var a = null;
  n2.limit && (a = function(t3) {
    var e2;
    return V2(e2 = typeof t3 == "object" ? t3.value : t3) ? null : e2;
  }(n2.limit));
  var c = null;
  n2.startAt && (c = Gn(n2.startAt));
  var h2 = null;
  return n2.endAt && (h2 = Gn(n2.endAt)), jt(e, i, u, s, a, "F", c, h2);
}
__name(Un, "Un");
function Bn(t2) {
  return t2 ? t2.unaryFilter !== void 0 ? [Yn(t2)] : t2.fieldFilter !== void 0 ? [Hn(t2)] : t2.compositeFilter !== void 0 ? t2.compositeFilter.filters.map(function(t3) {
    return Bn(t3);
  }).reduce(function(t3, e) {
    return t3.concat(e);
  }) : A2() : [];
}
__name(Bn, "Bn");
function jn(t2) {
  return {
    before: t2.before,
    values: t2.position
  };
}
__name(jn, "jn");
function Gn(t2) {
  var e = !!t2.before, n2 = t2.values || [];
  return new Pt(n2, e);
}
__name(Gn, "Gn");
function Kn(t2) {
  return wn[t2];
}
__name(Kn, "Kn");
function zn(t2) {
  return bn[t2];
}
__name(zn, "zn");
function Qn(t2) {
  return {
    fieldPath: t2.canonicalString()
  };
}
__name(Qn, "Qn");
function Wn(t2) {
  return W2.fromServerFormat(t2.fieldPath);
}
__name(Wn, "Wn");
function Hn(t2) {
  return Dt.create(Wn(t2.fieldFilter.field), function(t3) {
    switch (t3) {
      case "EQUAL":
        return "==";
      case "NOT_EQUAL":
        return "!=";
      case "GREATER_THAN":
        return ">";
      case "GREATER_THAN_OR_EQUAL":
        return ">=";
      case "LESS_THAN":
        return "<";
      case "LESS_THAN_OR_EQUAL":
        return "<=";
      case "ARRAY_CONTAINS":
        return "array-contains";
      case "IN":
        return "in";
      case "NOT_IN":
        return "not-in";
      case "ARRAY_CONTAINS_ANY":
        return "array-contains-any";
      case "OPERATOR_UNSPECIFIED":
      default:
        return A2();
    }
  }(t2.fieldFilter.op), t2.fieldFilter.value);
}
__name(Hn, "Hn");
function Yn(t2) {
  switch (t2.unaryFilter.op) {
    case "IS_NAN":
      var e = Wn(t2.unaryFilter.field);
      return Dt.create(e, "==", {
        doubleValue: NaN
      });
    case "IS_NULL":
      var n2 = Wn(t2.unaryFilter.field);
      return Dt.create(n2, "==", {
        nullValue: "NULL_VALUE"
      });
    case "IS_NOT_NAN":
      var r2 = Wn(t2.unaryFilter.field);
      return Dt.create(r2, "!=", {
        doubleValue: NaN
      });
    case "IS_NOT_NULL":
      var i = Wn(t2.unaryFilter.field);
      return Dt.create(i, "!=", {
        nullValue: "NULL_VALUE"
      });
    case "OPERATOR_UNSPECIFIED":
    default:
      return A2();
  }
}
__name(Yn, "Yn");
function Jn(t2) {
  var e = [];
  return t2.fields.forEach(function(t3) {
    return e.push(t3.canonicalString());
  }), {
    fieldPaths: e
  };
}
__name(Jn, "Jn");
function Xn(t2) {
  return t2.length >= 4 && t2.get(0) === "projects" && t2.get(2) === "databases";
}
__name(Xn, "Xn");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function $n(t2) {
  for (var e = "", n2 = 0; n2 < t2.length; n2++)
    e.length > 0 && (e = tr(e)), e = Zn(t2.get(n2), e);
  return tr(e);
}
__name($n, "$n");
function Zn(t2, e) {
  for (var n2 = e, r2 = t2.length, i = 0; i < r2; i++) {
    var o = t2.charAt(i);
    switch (o) {
      case "\0":
        n2 += "";
        break;
      case "":
        n2 += "";
        break;
      default:
        n2 += o;
    }
  }
  return n2;
}
__name(Zn, "Zn");
function tr(t2) {
  return t2 + "";
}
__name(tr, "tr");
function er(t2) {
  var e = t2.length;
  if (k2(e >= 2), e === 2)
    return k2(t2.charAt(0) === "" && t2.charAt(1) === ""), z2.emptyPath();
  for (var n2 = e - 2, r2 = [], i = "", o = 0; o < e; ) {
    var s = t2.indexOf("", o);
    switch ((s < 0 || s > n2) && A2(), t2.charAt(s + 1)) {
      case "":
        var u = t2.substring(o, s), a = void 0;
        i.length === 0 ? a = u : (a = i += u, i = ""), r2.push(a);
        break;
      case "":
        i += t2.substring(o, s), i += "\0";
        break;
      case "":
        i += t2.substring(o, s + 1);
        break;
      default:
        A2();
    }
    o = s + 2;
  }
  return new z2(r2);
}
__name(er, "er");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var nr = /* @__PURE__ */ __name(function(t2, e) {
  this.seconds = t2, this.nanoseconds = e;
}, "nr");
var rr = /* @__PURE__ */ __name(function(t2, e, n2) {
  this.ownerId = t2, this.allowTabSynchronization = e, this.leaseTimestampMs = n2;
}, "rr");
rr.store = "owner", rr.key = "owner";
var ir = /* @__PURE__ */ __name(function(t2, e, n2) {
  this.userId = t2, this.lastAcknowledgedBatchId = e, this.lastStreamToken = n2;
}, "ir");
ir.store = "mutationQueues", ir.keyPath = "userId";
var or = /* @__PURE__ */ __name(function(t2, e, n2, r2, i) {
  this.userId = t2, this.batchId = e, this.localWriteTimeMs = n2, this.baseMutations = r2, this.mutations = i;
}, "or");
or.store = "mutations", or.keyPath = "batchId", or.userMutationsIndex = "userMutationsIndex", or.userMutationsKeyPath = ["userId", "batchId"];
var sr = function() {
  function t2() {
  }
  __name(t2, "t");
  return t2.prefixForUser = function(t3) {
    return [t3];
  }, t2.prefixForPath = function(t3, e) {
    return [t3, $n(e)];
  }, t2.key = function(t3, e, n2) {
    return [t3, $n(e), n2];
  }, t2;
}();
sr.store = "documentMutations", sr.PLACEHOLDER = new sr();
var ur = /* @__PURE__ */ __name(function(t2, e) {
  this.path = t2, this.readTime = e;
}, "ur");
var ar = /* @__PURE__ */ __name(function(t2, e) {
  this.path = t2, this.version = e;
}, "ar");
var cr = /* @__PURE__ */ __name(function(t2, e, n2, r2, i, o) {
  this.unknownDocument = t2, this.noDocument = e, this.document = n2, this.hasCommittedMutations = r2, this.readTime = i, this.parentPath = o;
}, "cr");
cr.store = "remoteDocuments", cr.readTimeIndex = "readTimeIndex", cr.readTimeIndexPath = "readTime", cr.collectionReadTimeIndex = "collectionReadTimeIndex", cr.collectionReadTimeIndexPath = ["parentPath", "readTime"];
var hr = /* @__PURE__ */ __name(function(t2) {
  this.byteSize = t2;
}, "hr");
hr.store = "remoteDocumentGlobal", hr.key = "remoteDocumentGlobalKey";
var fr = /* @__PURE__ */ __name(function(t2, e, n2, r2, i, o, s) {
  this.targetId = t2, this.canonicalId = e, this.readTime = n2, this.resumeToken = r2, this.lastListenSequenceNumber = i, this.lastLimboFreeSnapshotVersion = o, this.query = s;
}, "fr");
fr.store = "targets", fr.keyPath = "targetId", fr.queryTargetsIndexName = "queryTargetsIndex", fr.queryTargetsKeyPath = ["canonicalId", "targetId"];
var lr = /* @__PURE__ */ __name(function(t2, e, n2) {
  this.targetId = t2, this.path = e, this.sequenceNumber = n2;
}, "lr");
lr.store = "targetDocuments", lr.keyPath = ["targetId", "path"], lr.documentTargetsIndex = "documentTargetsIndex", lr.documentTargetsKeyPath = ["path", "targetId"];
var dr = /* @__PURE__ */ __name(function(t2, e, n2, r2) {
  this.highestTargetId = t2, this.highestListenSequenceNumber = e, this.lastRemoteSnapshotVersion = n2, this.targetCount = r2;
}, "dr");
dr.key = "targetGlobalKey", dr.store = "targetGlobal";
var pr = /* @__PURE__ */ __name(function(t2, e) {
  this.collectionId = t2, this.parent = e;
}, "pr");
pr.store = "collectionParents", pr.keyPath = ["collectionId", "parent"];
var yr = /* @__PURE__ */ __name(function(t2, e, n2, r2) {
  this.clientId = t2, this.updateTimeMs = e, this.networkEnabled = n2, this.inForeground = r2;
}, "yr");
yr.store = "clientMetadata", yr.keyPath = "clientId";
var vr = /* @__PURE__ */ __name(function(t2, e, n2) {
  this.bundleId = t2, this.createTime = e, this.version = n2;
}, "vr");
vr.store = "bundles", vr.keyPath = "bundleId";
var mr = /* @__PURE__ */ __name(function(t2, e, n2) {
  this.name = t2, this.readTime = e, this.bundledQuery = n2;
}, "mr");
mr.store = "namedQueries", mr.keyPath = "name";
var gr = __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], __spreadArray(__spreadArray([], [ir.store, or.store, sr.store, cr.store, fr.store, rr.store, dr.store, lr.store]), [yr.store])), [hr.store])), [pr.store])), [vr.store, mr.store]);
var wr = "The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";
var br = function() {
  function t2() {
    this.onCommittedListeners = [];
  }
  __name(t2, "t");
  return t2.prototype.addOnCommittedListener = function(t3) {
    this.onCommittedListeners.push(t3);
  }, t2.prototype.raiseOnCommittedEvent = function() {
    this.onCommittedListeners.forEach(function(t3) {
      return t3();
    });
  }, t2;
}();
var Ir = /* @__PURE__ */ __name(function() {
  var t2 = this;
  this.promise = new Promise(function(e, n2) {
    t2.resolve = e, t2.reject = n2;
  });
}, "Ir");
var Er = function() {
  function t2(t3) {
    var e = this;
    this.nextCallback = null, this.catchCallback = null, this.result = void 0, this.error = void 0, this.isDone = false, this.callbackAttached = false, t3(function(t4) {
      e.isDone = true, e.result = t4, e.nextCallback && e.nextCallback(t4);
    }, function(t4) {
      e.isDone = true, e.error = t4, e.catchCallback && e.catchCallback(t4);
    });
  }
  __name(t2, "t");
  return t2.prototype.catch = function(t3) {
    return this.next(void 0, t3);
  }, t2.prototype.next = function(e, n2) {
    var r2 = this;
    return this.callbackAttached && A2(), this.callbackAttached = true, this.isDone ? this.error ? this.wrapFailure(n2, this.error) : this.wrapSuccess(e, this.result) : new t2(function(t3, i) {
      r2.nextCallback = function(n3) {
        r2.wrapSuccess(e, n3).next(t3, i);
      }, r2.catchCallback = function(e2) {
        r2.wrapFailure(n2, e2).next(t3, i);
      };
    });
  }, t2.prototype.toPromise = function() {
    var t3 = this;
    return new Promise(function(e, n2) {
      t3.next(e, n2);
    });
  }, t2.prototype.wrapUserFunction = function(e) {
    try {
      var n2 = e();
      return n2 instanceof t2 ? n2 : t2.resolve(n2);
    } catch (e2) {
      return t2.reject(e2);
    }
  }, t2.prototype.wrapSuccess = function(e, n2) {
    return e ? this.wrapUserFunction(function() {
      return e(n2);
    }) : t2.resolve(n2);
  }, t2.prototype.wrapFailure = function(e, n2) {
    return e ? this.wrapUserFunction(function() {
      return e(n2);
    }) : t2.reject(n2);
  }, t2.resolve = function(e) {
    return new t2(function(t3, n2) {
      t3(e);
    });
  }, t2.reject = function(e) {
    return new t2(function(t3, n2) {
      n2(e);
    });
  }, t2.waitFor = function(e) {
    return new t2(function(t3, n2) {
      var r2 = 0, i = 0, o = false;
      e.forEach(function(e2) {
        ++r2, e2.next(function() {
          ++i, o && i === r2 && t3();
        }, function(t4) {
          return n2(t4);
        });
      }), o = true, i === r2 && t3();
    });
  }, t2.or = function(e) {
    for (var n2 = t2.resolve(false), r2 = function(e2) {
      n2 = n2.next(function(n3) {
        return n3 ? t2.resolve(n3) : e2();
      });
    }, i = 0, o = e; i < o.length; i++) {
      r2(o[i]);
    }
    return n2;
  }, t2.forEach = function(t3, e) {
    var n2 = this, r2 = [];
    return t3.forEach(function(t4, i) {
      r2.push(e.call(n2, t4, i));
    }), this.waitFor(r2);
  }, t2;
}();
var Tr = function() {
  function t2(t3, e) {
    var n2 = this;
    this.action = t3, this.transaction = e, this.aborted = false, this.gt = new Ir(), this.transaction.oncomplete = function() {
      n2.gt.resolve();
    }, this.transaction.onabort = function() {
      e.error ? n2.gt.reject(new Dr(t3, e.error)) : n2.gt.resolve();
    }, this.transaction.onerror = function(e2) {
      var r2 = xr(e2.target.error);
      n2.gt.reject(new Dr(t3, r2));
    };
  }
  __name(t2, "t");
  return t2.open = function(e, n2, r2, i) {
    try {
      return new t2(n2, e.transaction(i, r2));
    } catch (e2) {
      throw new Dr(n2, e2);
    }
  }, Object.defineProperty(t2.prototype, "Et", {
    get: function() {
      return this.gt.promise;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.abort = function(t3) {
    t3 && this.gt.reject(t3), this.aborted || (_("SimpleDb", "Aborting transaction:", t3 ? t3.message : "Client-initiated abort"), this.aborted = true, this.transaction.abort());
  }, t2.prototype.store = function(t3) {
    var e = this.transaction.objectStore(t3);
    return new Ar(e);
  }, t2;
}();
var _r = function() {
  function t2(e, r2, i) {
    this.name = e, this.version = r2, this.Tt = i, t2.It(getUA()) === 12.2 && S2("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
  }
  __name(t2, "t");
  return t2.delete = function(t3) {
    return _("SimpleDb", "Removing database:", t3), kr(window.indexedDB.deleteDatabase(t3)).toPromise();
  }, t2.At = function() {
    if (typeof indexedDB == "undefined")
      return false;
    if (t2.Rt())
      return true;
    var e = getUA(), r2 = t2.It(e), i = 0 < r2 && r2 < 10, o = t2.bt(e), s = 0 < o && o < 4.5;
    return !(e.indexOf("MSIE ") > 0 || e.indexOf("Trident/") > 0 || e.indexOf("Edge/") > 0 || i || s);
  }, t2.Rt = function() {
    var t3;
    return typeof process != "undefined" && ((t3 = process.env) === null || t3 === void 0 ? void 0 : t3.vt) === "YES";
  }, t2.Pt = function(t3, e) {
    return t3.store(e);
  }, t2.It = function(t3) {
    var e = t3.match(/i(?:phone|pad|pod) os ([\d_]+)/i), n2 = e ? e[1].split("_").slice(0, 2).join(".") : "-1";
    return Number(n2);
  }, t2.bt = function(t3) {
    var e = t3.match(/Android ([\d.]+)/i), n2 = e ? e[1].split(".").slice(0, 2).join(".") : "-1";
    return Number(n2);
  }, t2.prototype.Vt = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e, n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.db ? [3, 2] : (_("SimpleDb", "Opening database:", this.name), e = this, [4, new Promise(function(e2, r3) {
              var i = indexedDB.open(n2.name, n2.version);
              i.onsuccess = function(t4) {
                var n3 = t4.target.result;
                e2(n3);
              }, i.onblocked = function() {
                r3(new Dr(t3, "Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."));
              }, i.onerror = function(e3) {
                var n3 = e3.target.error;
                n3.name === "VersionError" ? r3(new G2(j.FAILED_PRECONDITION, "A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")) : r3(new Dr(t3, n3));
              }, i.onupgradeneeded = function(t4) {
                _("SimpleDb", 'Database "' + n2.name + '" requires upgrade from version:', t4.oldVersion);
                var e3 = t4.target.result;
                n2.Tt.St(e3, i.transaction, t4.oldVersion, n2.version).next(function() {
                  _("SimpleDb", "Database upgrade to version " + n2.version + " complete");
                });
              };
            })]);
          case 1:
            e.db = r2.sent(), r2.label = 2;
          case 2:
            return [2, (this.Dt && (this.db.onversionchange = function(t4) {
              return n2.Dt(t4);
            }), this.db)];
        }
      });
    });
  }, t2.prototype.Ct = function(t3) {
    this.Dt = t3, this.db && (this.db.onversionchange = function(e) {
      return t3(e);
    });
  }, t2.prototype.runTransaction = function(t3, e, n2, r2) {
    return __awaiter(this, void 0, void 0, function() {
      var i, o, s, u, a;
      return __generator(this, function(c) {
        switch (c.label) {
          case 0:
            i = e === "readonly", o = 0, s = /* @__PURE__ */ __name(function() {
              var e2, s2, a2, c2, h2;
              return __generator(this, function(f) {
                switch (f.label) {
                  case 0:
                    ++o, f.label = 1;
                  case 1:
                    return f.trys.push([1, 4, , 5]), [4, u.Vt(t3)];
                  case 2:
                    return u.db = f.sent(), e2 = Tr.open(u.db, t3, i ? "readonly" : "readwrite", n2), s2 = r2(e2).catch(function(t4) {
                      return e2.abort(t4), Er.reject(t4);
                    }).toPromise(), a2 = {}, s2.catch(function() {
                    }), [4, e2.Et];
                  case 3:
                    return [2, (a2.value = (f.sent(), s2), a2)];
                  case 4:
                    return c2 = f.sent(), h2 = c2.name !== "FirebaseError" && o < 3, _("SimpleDb", "Transaction failed with error:", c2.message, "Retrying:", h2), u.close(), h2 ? [3, 5] : [2, {
                      value: Promise.reject(c2)
                    }];
                  case 5:
                    return [2];
                }
              });
            }, "s"), u = this, c.label = 1;
          case 1:
            return [5, s()];
          case 2:
            if (typeof (a = c.sent()) == "object")
              return [2, a.value];
            c.label = 3;
          case 3:
            return [3, 1];
          case 4:
            return [2];
        }
      });
    });
  }, t2.prototype.close = function() {
    this.db && this.db.close(), this.db = void 0;
  }, t2;
}();
var Sr = function() {
  function t2(t3) {
    this.xt = t3, this.Nt = false, this.$t = null;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "isDone", {
    get: function() {
      return this.Nt;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "Ft", {
    get: function() {
      return this.$t;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "cursor", {
    set: function(t3) {
      this.xt = t3;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.done = function() {
    this.Nt = true;
  }, t2.prototype.Ot = function(t3) {
    this.$t = t3;
  }, t2.prototype.delete = function() {
    return kr(this.xt.delete());
  }, t2;
}();
var Dr = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, j.UNAVAILABLE, "IndexedDB transaction '" + e2 + "' failed: " + n2) || this).name = "IndexedDbTransactionError", r2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(G2);
function Nr(t2) {
  return t2.name === "IndexedDbTransactionError";
}
__name(Nr, "Nr");
var Ar = function() {
  function t2(t3) {
    this.store = t3;
  }
  __name(t2, "t");
  return t2.prototype.put = function(t3, e) {
    var n2;
    return e !== void 0 ? (_("SimpleDb", "PUT", this.store.name, t3, e), n2 = this.store.put(e, t3)) : (_("SimpleDb", "PUT", this.store.name, "<auto-key>", t3), n2 = this.store.put(t3)), kr(n2);
  }, t2.prototype.add = function(t3) {
    return _("SimpleDb", "ADD", this.store.name, t3, t3), kr(this.store.add(t3));
  }, t2.prototype.get = function(t3) {
    var e = this;
    return kr(this.store.get(t3)).next(function(n2) {
      return n2 === void 0 && (n2 = null), _("SimpleDb", "GET", e.store.name, t3, n2), n2;
    });
  }, t2.prototype.delete = function(t3) {
    return _("SimpleDb", "DELETE", this.store.name, t3), kr(this.store.delete(t3));
  }, t2.prototype.count = function() {
    return _("SimpleDb", "COUNT", this.store.name), kr(this.store.count());
  }, t2.prototype.kt = function(t3, e) {
    var n2 = this.cursor(this.options(t3, e)), r2 = [];
    return this.Mt(n2, function(t4, e2) {
      r2.push(e2);
    }).next(function() {
      return r2;
    });
  }, t2.prototype.Lt = function(t3, e) {
    _("SimpleDb", "DELETE ALL", this.store.name);
    var n2 = this.options(t3, e);
    n2.Bt = false;
    var r2 = this.cursor(n2);
    return this.Mt(r2, function(t4, e2, n3) {
      return n3.delete();
    });
  }, t2.prototype.qt = function(t3, e) {
    var n2;
    e ? n2 = t3 : (n2 = {}, e = t3);
    var r2 = this.cursor(n2);
    return this.Mt(r2, e);
  }, t2.prototype.Ut = function(t3) {
    var e = this.cursor({});
    return new Er(function(n2, r2) {
      e.onerror = function(t4) {
        var e2 = xr(t4.target.error);
        r2(e2);
      }, e.onsuccess = function(e2) {
        var r3 = e2.target.result;
        r3 ? t3(r3.primaryKey, r3.value).next(function(t4) {
          t4 ? r3.continue() : n2();
        }) : n2();
      };
    });
  }, t2.prototype.Mt = function(t3, e) {
    var n2 = [];
    return new Er(function(r2, i) {
      t3.onerror = function(t4) {
        i(t4.target.error);
      }, t3.onsuccess = function(t4) {
        var i2 = t4.target.result;
        if (i2) {
          var o = new Sr(i2), s = e(i2.primaryKey, i2.value, o);
          if (s instanceof Er) {
            var u = s.catch(function(t5) {
              return o.done(), Er.reject(t5);
            });
            n2.push(u);
          }
          o.isDone ? r2() : o.Ft === null ? i2.continue() : i2.continue(o.Ft);
        } else
          r2();
      };
    }).next(function() {
      return Er.waitFor(n2);
    });
  }, t2.prototype.options = function(t3, e) {
    var n2;
    return t3 !== void 0 && (typeof t3 == "string" ? n2 = t3 : e = t3), {
      index: n2,
      range: e
    };
  }, t2.prototype.cursor = function(t3) {
    var e = "next";
    if (t3.reverse && (e = "prev"), t3.index) {
      var n2 = this.store.index(t3.index);
      return t3.Bt ? n2.openKeyCursor(t3.range, e) : n2.openCursor(t3.range, e);
    }
    return this.store.openCursor(t3.range, e);
  }, t2;
}();
function kr(t2) {
  return new Er(function(e, n2) {
    t2.onsuccess = function(t3) {
      var n3 = t3.target.result;
      e(n3);
    }, t2.onerror = function(t3) {
      var e2 = xr(t3.target.error);
      n2(e2);
    };
  });
}
__name(kr, "kr");
var Cr = false;
function xr(t2) {
  var e = _r.It(getUA());
  if (e >= 12.2 && e < 13) {
    var r2 = "An internal error was encountered in the Indexed Database server";
    if (t2.message.indexOf(r2) >= 0) {
      var i = new G2("internal", "IOS_INDEXEDDB_BUG1: IndexedDb has thrown '" + r2 + "'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");
      return Cr || (Cr = true, setTimeout(function() {
        throw i;
      }, 0)), i;
    }
  }
  return t2;
}
__name(xr, "xr");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Lr = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).Qt = e2, r2.currentSequenceNumber = n2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(br);
function Rr(t2, e) {
  var n2 = C(t2);
  return _r.Pt(n2.Qt, e);
}
__name(Rr, "Rr");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Or = function() {
  function t2(t3, e, n2, r2) {
    this.batchId = t3, this.localWriteTime = e, this.baseMutations = n2, this.mutations = r2;
  }
  __name(t2, "t");
  return t2.prototype.applyToRemoteDocument = function(t3, e, n2) {
    for (var r2 = n2.mutationResults, i = 0; i < this.mutations.length; i++) {
      var o = this.mutations[i];
      o.key.isEqual(t3) && (e = ke(o, e, r2[i]));
    }
    return e;
  }, t2.prototype.applyToLocalView = function(t3, e) {
    for (var n2 = 0, r2 = this.baseMutations; n2 < r2.length; n2++) {
      (s = r2[n2]).key.isEqual(t3) && (e = Ce(s, e, this.localWriteTime));
    }
    for (var i = 0, o = this.mutations; i < o.length; i++) {
      var s;
      (s = o[i]).key.isEqual(t3) && (e = Ce(s, e, this.localWriteTime));
    }
    return e;
  }, t2.prototype.applyToLocalDocumentSet = function(t3) {
    var e = this, n2 = t3;
    return this.mutations.forEach(function(r2) {
      var i = e.applyToLocalView(r2.key, t3.get(r2.key));
      i && (n2 = n2.insert(r2.key, i));
    }), n2;
  }, t2.prototype.keys = function() {
    return this.mutations.reduce(function(t3, e) {
      return t3.add(e.key);
    }, un());
  }, t2.prototype.isEqual = function(t3) {
    return this.batchId === t3.batchId && O2(this.mutations, t3.mutations, function(t4, e) {
      return Le(t4, e);
    }) && O2(this.baseMutations, t3.baseMutations, function(t4, e) {
      return Le(t4, e);
    });
  }, t2;
}();
var Pr = function() {
  function t2(t3, e, n2, r2) {
    this.batch = t3, this.commitVersion = e, this.mutationResults = n2, this.docVersions = r2;
  }
  __name(t2, "t");
  return t2.from = function(e, n2, r2) {
    k2(e.mutations.length === r2.length);
    for (var i = on(), o = e.mutations, s = 0; s < o.length; s++)
      i = i.insert(o[s].key, r2[s].version);
    return new t2(e, n2, r2, i);
  }, t2;
}();
var Mr = function() {
  function t2(t3, e, n2, r2, i, o, s) {
    i === void 0 && (i = ie.min()), o === void 0 && (o = ie.min()), s === void 0 && (s = Y2.EMPTY_BYTE_STRING), this.target = t3, this.targetId = e, this.purpose = n2, this.sequenceNumber = r2, this.snapshotVersion = i, this.lastLimboFreeSnapshotVersion = o, this.resumeToken = s;
  }
  __name(t2, "t");
  return t2.prototype.withSequenceNumber = function(e) {
    return new t2(this.target, this.targetId, this.purpose, e, this.snapshotVersion, this.lastLimboFreeSnapshotVersion, this.resumeToken);
  }, t2.prototype.withResumeToken = function(e, n2) {
    return new t2(this.target, this.targetId, this.purpose, this.sequenceNumber, n2, this.lastLimboFreeSnapshotVersion, e);
  }, t2.prototype.withLastLimboFreeSnapshotVersion = function(e) {
    return new t2(this.target, this.targetId, this.purpose, this.sequenceNumber, this.snapshotVersion, e, this.resumeToken);
  }, t2;
}();
var Fr = /* @__PURE__ */ __name(function(t2) {
  this.Kt = t2;
}, "Fr");
function qr(t2, e) {
  if (e.document)
    return Pn(t2.Kt, e.document, !!e.hasCommittedMutations);
  if (e.noDocument) {
    var n2 = H2.fromSegments(e.noDocument.path), r2 = Gr(e.noDocument.readTime);
    return new wt(n2, r2, {
      hasCommittedMutations: !!e.hasCommittedMutations
    });
  }
  if (e.unknownDocument) {
    var i = H2.fromSegments(e.unknownDocument.path);
    r2 = Gr(e.unknownDocument.version);
    return new bt(i, r2);
  }
  return A2();
}
__name(qr, "qr");
function Vr(t2, e, n2) {
  var r2 = Ur(n2), i = e.key.path.popLast().toArray();
  if (e instanceof gt) {
    var o = function(t3, e2) {
      return {
        name: An(t3, e2.key),
        fields: e2.toProto().mapValue.fields,
        updateTime: En(t3, e2.version.toTimestamp())
      };
    }(t2.Kt, e), s = e.hasCommittedMutations;
    return new cr(null, null, o, s, r2, i);
  }
  if (e instanceof wt) {
    var u = e.key.path.toArray(), a = jr(e.version);
    s = e.hasCommittedMutations;
    return new cr(null, new ur(u, a), null, s, r2, i);
  }
  if (e instanceof bt) {
    var c = e.key.path.toArray(), h2 = jr(e.version);
    return new cr(new ar(c, h2), null, null, true, r2, i);
  }
  return A2();
}
__name(Vr, "Vr");
function Ur(t2) {
  var e = t2.toTimestamp();
  return [e.seconds, e.nanoseconds];
}
__name(Ur, "Ur");
function Br(t2) {
  var e = new tt(t2[0], t2[1]);
  return ie.fromTimestamp(e);
}
__name(Br, "Br");
function jr(t2) {
  var e = t2.toTimestamp();
  return new nr(e.seconds, e.nanoseconds);
}
__name(jr, "jr");
function Gr(t2) {
  var e = new tt(t2.seconds, t2.nanoseconds);
  return ie.fromTimestamp(e);
}
__name(Gr, "Gr");
function Kr(t2, e) {
  for (var n2 = (e.baseMutations || []).map(function(e2) {
    return Fn(t2.Kt, e2);
  }), r2 = 0; r2 < e.mutations.length - 1; ++r2) {
    var i = e.mutations[r2];
    if (r2 + 1 < e.mutations.length && e.mutations[r2 + 1].transform !== void 0) {
      var o = e.mutations[r2 + 1];
      i.updateTransforms = o.transform.fieldTransforms, e.mutations.splice(r2 + 1, 1), ++r2;
    }
  }
  var s = e.mutations.map(function(e2) {
    return Fn(t2.Kt, e2);
  }), u = tt.fromMillis(e.localWriteTimeMs);
  return new Or(e.batchId, u, n2, s);
}
__name(Kr, "Kr");
function zr(t2) {
  var e, n2, r2 = Gr(t2.readTime), i = t2.lastLimboFreeSnapshotVersion !== void 0 ? Gr(t2.lastLimboFreeSnapshotVersion) : ie.min();
  return t2.query.documents !== void 0 ? (k2((n2 = t2.query).documents.length === 1), e = Jt(Gt(xn(n2.documents[0])))) : e = function(t3) {
    return Jt(Un(t3));
  }(t2.query), new Mr(e, t2.targetId, 0, t2.lastListenSequenceNumber, r2, i, Y2.fromBase64String(t2.resumeToken));
}
__name(zr, "zr");
function Qr(t2, e) {
  var n2, r2 = jr(e.snapshotVersion), i = jr(e.lastLimboFreeSnapshotVersion);
  n2 = St(e.target) ? qn(t2.Kt, e.target) : Vn(t2.Kt, e.target);
  var o = e.resumeToken.toBase64();
  return new fr(e.targetId, Tt(e.target), r2, o, e.sequenceNumber, i, n2);
}
__name(Qr, "Qr");
function Wr(t2) {
  var e = Un({
    parent: t2.parent,
    structuredQuery: t2.structuredQuery
  });
  return t2.limitType === "LAST" ? Xt(e, e.limit, "L") : e;
}
__name(Wr, "Wr");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Hr = function() {
  function t2() {
  }
  __name(t2, "t");
  return t2.prototype.getBundleMetadata = function(t3, e) {
    return Yr(t3).get(e).next(function(t4) {
      if (t4)
        return {
          id: (e2 = t4).bundleId,
          createTime: Gr(e2.createTime),
          version: e2.version
        };
      var e2;
    });
  }, t2.prototype.saveBundleMetadata = function(t3, e) {
    return Yr(t3).put({
      bundleId: (n2 = e).id,
      createTime: jr(Sn(n2.createTime)),
      version: n2.version
    });
    var n2;
  }, t2.prototype.getNamedQuery = function(t3, e) {
    return Jr(t3).get(e).next(function(t4) {
      if (t4)
        return {
          name: (e2 = t4).name,
          query: Wr(e2.bundledQuery),
          readTime: Gr(e2.readTime)
        };
      var e2;
    });
  }, t2.prototype.saveNamedQuery = function(t3, e) {
    return Jr(t3).put(function(t4) {
      return {
        name: t4.name,
        readTime: jr(Sn(t4.readTime)),
        bundledQuery: t4.bundledQuery
      };
    }(e));
  }, t2;
}();
function Yr(t2) {
  return Rr(t2, vr.store);
}
__name(Yr, "Yr");
function Jr(t2) {
  return Rr(t2, mr.store);
}
__name(Jr, "Jr");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Xr = function() {
  function t2() {
    this.Wt = new $r();
  }
  __name(t2, "t");
  return t2.prototype.addToCollectionParentIndex = function(t3, e) {
    return this.Wt.add(e), Er.resolve();
  }, t2.prototype.getCollectionParents = function(t3, e) {
    return Er.resolve(this.Wt.getEntries(e));
  }, t2;
}();
var $r = function() {
  function t2() {
    this.index = {};
  }
  __name(t2, "t");
  return t2.prototype.add = function(t3) {
    var e = t3.lastSegment(), n2 = t3.popLast(), r2 = this.index[e] || new Je(z2.comparator), i = !r2.has(n2);
    return this.index[e] = r2.add(n2), i;
  }, t2.prototype.has = function(t3) {
    var e = t3.lastSegment(), n2 = t3.popLast(), r2 = this.index[e];
    return r2 && r2.has(n2);
  }, t2.prototype.getEntries = function(t3) {
    return (this.index[t3] || new Je(z2.comparator)).toArray();
  }, t2;
}();
var Zr = function() {
  function t2() {
    this.jt = new $r();
  }
  __name(t2, "t");
  return t2.prototype.addToCollectionParentIndex = function(t3, e) {
    var n2 = this;
    if (!this.jt.has(e)) {
      var r2 = e.lastSegment(), i = e.popLast();
      t3.addOnCommittedListener(function() {
        n2.jt.add(e);
      });
      var o = {
        collectionId: r2,
        parent: $n(i)
      };
      return ti(t3).put(o);
    }
    return Er.resolve();
  }, t2.prototype.getCollectionParents = function(t3, e) {
    var n2 = [], r2 = IDBKeyRange.bound([e, ""], [P2(e), ""], false, true);
    return ti(t3).kt(r2).next(function(t4) {
      for (var r3 = 0, i = t4; r3 < i.length; r3++) {
        var o = i[r3];
        if (o.collectionId !== e)
          break;
        n2.push(er(o.parent));
      }
      return n2;
    });
  }, t2;
}();
function ti(t2) {
  return Rr(t2, pr.store);
}
__name(ti, "ti");
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ei = {
  didRun: false,
  sequenceNumbersCollected: 0,
  targetsRemoved: 0,
  documentsRemoved: 0
};
var ni = function() {
  function t2(t3, e, n2) {
    this.cacheSizeCollectionThreshold = t3, this.percentileToCollect = e, this.maximumSequenceNumbersToCollect = n2;
  }
  __name(t2, "t");
  return t2.withCacheSize = function(e) {
    return new t2(e, t2.DEFAULT_COLLECTION_PERCENTILE, t2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ri(t2, e, n2) {
  var r2 = t2.store(or.store), i = t2.store(sr.store), o = [], s = IDBKeyRange.only(n2.batchId), u = 0, a = r2.qt({
    range: s
  }, function(t3, e2, n3) {
    return u++, n3.delete();
  });
  o.push(a.next(function() {
    k2(u === 1);
  }));
  for (var c = [], h2 = 0, f = n2.mutations; h2 < f.length; h2++) {
    var l = f[h2], d = sr.key(e, l.key.path, n2.batchId);
    o.push(i.delete(d)), c.push(l.key);
  }
  return Er.waitFor(o).next(function() {
    return c;
  });
}
__name(ri, "ri");
function ii(t2) {
  var e;
  if (t2.document)
    e = t2.document;
  else if (t2.unknownDocument)
    e = t2.unknownDocument;
  else {
    if (!t2.noDocument)
      throw A2();
    e = t2.noDocument;
  }
  return JSON.stringify(e).length;
}
__name(ii, "ii");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
ni.DEFAULT_COLLECTION_PERCENTILE = 10, ni.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT = 1e3, ni.DEFAULT = new ni(41943040, ni.DEFAULT_COLLECTION_PERCENTILE, ni.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT), ni.DISABLED = new ni(-1, 0, 0);
var oi = function() {
  function t2(t3, e, n2, r2) {
    this.userId = t3, this.D = e, this.Gt = n2, this.referenceDelegate = r2, this.zt = {};
  }
  __name(t2, "t");
  return t2.Ht = function(e, n2, r2, i) {
    return k2(e.uid !== ""), new t2(e.isAuthenticated() ? e.uid : "", n2, r2, i);
  }, t2.prototype.checkEmpty = function(t3) {
    var e = true, n2 = IDBKeyRange.bound([this.userId, Number.NEGATIVE_INFINITY], [this.userId, Number.POSITIVE_INFINITY]);
    return ui(t3).qt({
      index: or.userMutationsIndex,
      range: n2
    }, function(t4, n3, r2) {
      e = false, r2.done();
    }).next(function() {
      return e;
    });
  }, t2.prototype.addMutationBatch = function(t3, e, n2, r2) {
    var i = this, o = ai(t3), s = ui(t3);
    return s.add({}).next(function(u) {
      k2(typeof u == "number");
      for (var a = new Or(u, e, n2, r2), c = function(t4, e2, n3) {
        var r3 = n3.baseMutations.map(function(e3) {
          return Mn(t4.Kt, e3);
        }), i2 = n3.mutations.map(function(e3) {
          return Mn(t4.Kt, e3);
        });
        return new or(e2, n3.batchId, n3.localWriteTime.toMillis(), r3, i2);
      }(i.D, i.userId, a), h2 = [], f = new Je(function(t4, e2) {
        return R2(t4.canonicalString(), e2.canonicalString());
      }), l = 0, d = r2; l < d.length; l++) {
        var p2 = d[l], y2 = sr.key(i.userId, p2.key.path, u);
        f = f.add(p2.key.path.popLast()), h2.push(s.put(c)), h2.push(o.put(y2, sr.PLACEHOLDER));
      }
      return f.forEach(function(e2) {
        h2.push(i.Gt.addToCollectionParentIndex(t3, e2));
      }), t3.addOnCommittedListener(function() {
        i.zt[u] = a.keys();
      }), Er.waitFor(h2).next(function() {
        return a;
      });
    });
  }, t2.prototype.lookupMutationBatch = function(t3, e) {
    var n2 = this;
    return ui(t3).get(e).next(function(t4) {
      return t4 ? (k2(t4.userId === n2.userId), Kr(n2.D, t4)) : null;
    });
  }, t2.prototype.Jt = function(t3, e) {
    var n2 = this;
    return this.zt[e] ? Er.resolve(this.zt[e]) : this.lookupMutationBatch(t3, e).next(function(t4) {
      if (t4) {
        var r2 = t4.keys();
        return n2.zt[e] = r2, r2;
      }
      return null;
    });
  }, t2.prototype.getNextMutationBatchAfterBatchId = function(t3, e) {
    var n2 = this, r2 = e + 1, i = IDBKeyRange.lowerBound([this.userId, r2]), o = null;
    return ui(t3).qt({
      index: or.userMutationsIndex,
      range: i
    }, function(t4, e2, i2) {
      e2.userId === n2.userId && (k2(e2.batchId >= r2), o = Kr(n2.D, e2)), i2.done();
    }).next(function() {
      return o;
    });
  }, t2.prototype.getHighestUnacknowledgedBatchId = function(t3) {
    var e = IDBKeyRange.upperBound([this.userId, Number.POSITIVE_INFINITY]), n2 = -1;
    return ui(t3).qt({
      index: or.userMutationsIndex,
      range: e,
      reverse: true
    }, function(t4, e2, r2) {
      n2 = e2.batchId, r2.done();
    }).next(function() {
      return n2;
    });
  }, t2.prototype.getAllMutationBatches = function(t3) {
    var e = this, n2 = IDBKeyRange.bound([this.userId, -1], [this.userId, Number.POSITIVE_INFINITY]);
    return ui(t3).kt(or.userMutationsIndex, n2).next(function(t4) {
      return t4.map(function(t5) {
        return Kr(e.D, t5);
      });
    });
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKey = function(t3, e) {
    var n2 = this, r2 = sr.prefixForPath(this.userId, e.path), i = IDBKeyRange.lowerBound(r2), o = [];
    return ai(t3).qt({
      range: i
    }, function(r3, i2, s) {
      var u = r3[0], a = r3[1], c = r3[2], h2 = er(a);
      if (u === n2.userId && e.path.isEqual(h2))
        return ui(t3).get(c).next(function(t4) {
          if (!t4)
            throw A2();
          k2(t4.userId === n2.userId), o.push(Kr(n2.D, t4));
        });
      s.done();
    }).next(function() {
      return o;
    });
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKeys = function(t3, e) {
    var n2 = this, r2 = new Je(R2), i = [];
    return e.forEach(function(e2) {
      var o = sr.prefixForPath(n2.userId, e2.path), s = IDBKeyRange.lowerBound(o), u = ai(t3).qt({
        range: s
      }, function(t4, i2, o2) {
        var s2 = t4[0], u2 = t4[1], a = t4[2], c = er(u2);
        s2 === n2.userId && e2.path.isEqual(c) ? r2 = r2.add(a) : o2.done();
      });
      i.push(u);
    }), Er.waitFor(i).next(function() {
      return n2.Yt(t3, r2);
    });
  }, t2.prototype.getAllMutationBatchesAffectingQuery = function(t3, e) {
    var n2 = this, r2 = e.path, i = r2.length + 1, o = sr.prefixForPath(this.userId, r2), s = IDBKeyRange.lowerBound(o), u = new Je(R2);
    return ai(t3).qt({
      range: s
    }, function(t4, e2, o2) {
      var s2 = t4[0], a = t4[1], c = t4[2], h2 = er(a);
      s2 === n2.userId && r2.isPrefixOf(h2) ? h2.length === i && (u = u.add(c)) : o2.done();
    }).next(function() {
      return n2.Yt(t3, u);
    });
  }, t2.prototype.Yt = function(t3, e) {
    var n2 = this, r2 = [], i = [];
    return e.forEach(function(e2) {
      i.push(ui(t3).get(e2).next(function(t4) {
        if (t4 === null)
          throw A2();
        k2(t4.userId === n2.userId), r2.push(Kr(n2.D, t4));
      }));
    }), Er.waitFor(i).next(function() {
      return r2;
    });
  }, t2.prototype.removeMutationBatch = function(t3, e) {
    var n2 = this;
    return ri(t3.Qt, this.userId, e).next(function(r2) {
      return t3.addOnCommittedListener(function() {
        n2.Xt(e.batchId);
      }), Er.forEach(r2, function(e2) {
        return n2.referenceDelegate.markPotentiallyOrphaned(t3, e2);
      });
    });
  }, t2.prototype.Xt = function(t3) {
    delete this.zt[t3];
  }, t2.prototype.performConsistencyCheck = function(t3) {
    var e = this;
    return this.checkEmpty(t3).next(function(n2) {
      if (!n2)
        return Er.resolve();
      var r2 = IDBKeyRange.lowerBound(sr.prefixForUser(e.userId)), i = [];
      return ai(t3).qt({
        range: r2
      }, function(t4, n3, r3) {
        if (t4[0] === e.userId) {
          var o = er(t4[1]);
          i.push(o);
        } else
          r3.done();
      }).next(function() {
        k2(i.length === 0);
      });
    });
  }, t2.prototype.containsKey = function(t3, e) {
    return si(t3, this.userId, e);
  }, t2.prototype.Zt = function(t3) {
    var e = this;
    return ci(t3).get(this.userId).next(function(t4) {
      return t4 || new ir(e.userId, -1, "");
    });
  }, t2;
}();
function si(t2, e, n2) {
  var r2 = sr.prefixForPath(e, n2.path), i = r2[1], o = IDBKeyRange.lowerBound(r2), s = false;
  return ai(t2).qt({
    range: o,
    Bt: true
  }, function(t3, n3, r3) {
    var o2 = t3[0], u = t3[1];
    t3[2];
    o2 === e && u === i && (s = true), r3.done();
  }).next(function() {
    return s;
  });
}
__name(si, "si");
function ui(t2) {
  return Rr(t2, or.store);
}
__name(ui, "ui");
function ai(t2) {
  return Rr(t2, sr.store);
}
__name(ai, "ai");
function ci(t2) {
  return Rr(t2, ir.store);
}
__name(ci, "ci");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var hi = function() {
  function t2(t3) {
    this.te = t3;
  }
  __name(t2, "t");
  return t2.prototype.next = function() {
    return this.te += 2, this.te;
  }, t2.ee = function() {
    return new t2(0);
  }, t2.ne = function() {
    return new t2(-1);
  }, t2;
}();
var fi = function() {
  function t2(t3, e) {
    this.referenceDelegate = t3, this.D = e;
  }
  __name(t2, "t");
  return t2.prototype.allocateTargetId = function(t3) {
    var e = this;
    return this.se(t3).next(function(n2) {
      var r2 = new hi(n2.highestTargetId);
      return n2.highestTargetId = r2.next(), e.ie(t3, n2).next(function() {
        return n2.highestTargetId;
      });
    });
  }, t2.prototype.getLastRemoteSnapshotVersion = function(t3) {
    return this.se(t3).next(function(t4) {
      return ie.fromTimestamp(new tt(t4.lastRemoteSnapshotVersion.seconds, t4.lastRemoteSnapshotVersion.nanoseconds));
    });
  }, t2.prototype.getHighestSequenceNumber = function(t3) {
    return this.se(t3).next(function(t4) {
      return t4.highestListenSequenceNumber;
    });
  }, t2.prototype.setTargetsMetadata = function(t3, e, n2) {
    var r2 = this;
    return this.se(t3).next(function(i) {
      return i.highestListenSequenceNumber = e, n2 && (i.lastRemoteSnapshotVersion = n2.toTimestamp()), e > i.highestListenSequenceNumber && (i.highestListenSequenceNumber = e), r2.ie(t3, i);
    });
  }, t2.prototype.addTargetData = function(t3, e) {
    var n2 = this;
    return this.re(t3, e).next(function() {
      return n2.se(t3).next(function(r2) {
        return r2.targetCount += 1, n2.oe(e, r2), n2.ie(t3, r2);
      });
    });
  }, t2.prototype.updateTargetData = function(t3, e) {
    return this.re(t3, e);
  }, t2.prototype.removeTargetData = function(t3, e) {
    var n2 = this;
    return this.removeMatchingKeysForTargetId(t3, e.targetId).next(function() {
      return li(t3).delete(e.targetId);
    }).next(function() {
      return n2.se(t3);
    }).next(function(e2) {
      return k2(e2.targetCount > 0), e2.targetCount -= 1, n2.ie(t3, e2);
    });
  }, t2.prototype.removeTargets = function(t3, e, n2) {
    var r2 = this, i = 0, o = [];
    return li(t3).qt(function(s, u) {
      var a = zr(u);
      a.sequenceNumber <= e && n2.get(a.targetId) === null && (i++, o.push(r2.removeTargetData(t3, a)));
    }).next(function() {
      return Er.waitFor(o);
    }).next(function() {
      return i;
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    return li(t3).qt(function(t4, n2) {
      var r2 = zr(n2);
      e(r2);
    });
  }, t2.prototype.se = function(t3) {
    return di(t3).get(dr.key).next(function(t4) {
      return k2(t4 !== null), t4;
    });
  }, t2.prototype.ie = function(t3, e) {
    return di(t3).put(dr.key, e);
  }, t2.prototype.re = function(t3, e) {
    return li(t3).put(Qr(this.D, e));
  }, t2.prototype.oe = function(t3, e) {
    var n2 = false;
    return t3.targetId > e.highestTargetId && (e.highestTargetId = t3.targetId, n2 = true), t3.sequenceNumber > e.highestListenSequenceNumber && (e.highestListenSequenceNumber = t3.sequenceNumber, n2 = true), n2;
  }, t2.prototype.getTargetCount = function(t3) {
    return this.se(t3).next(function(t4) {
      return t4.targetCount;
    });
  }, t2.prototype.getTargetData = function(t3, e) {
    var n2 = Tt(e), r2 = IDBKeyRange.bound([n2, Number.NEGATIVE_INFINITY], [n2, Number.POSITIVE_INFINITY]), i = null;
    return li(t3).qt({
      range: r2,
      index: fr.queryTargetsIndexName
    }, function(t4, n3, r3) {
      var o = zr(n3);
      _t(e, o.target) && (i = o, r3.done());
    }).next(function() {
      return i;
    });
  }, t2.prototype.addMatchingKeys = function(t3, e, n2) {
    var r2 = this, i = [], o = pi(t3);
    return e.forEach(function(e2) {
      var s = $n(e2.path);
      i.push(o.put(new lr(n2, s))), i.push(r2.referenceDelegate.addReference(t3, n2, e2));
    }), Er.waitFor(i);
  }, t2.prototype.removeMatchingKeys = function(t3, e, n2) {
    var r2 = this, i = pi(t3);
    return Er.forEach(e, function(e2) {
      var o = $n(e2.path);
      return Er.waitFor([i.delete([n2, o]), r2.referenceDelegate.removeReference(t3, n2, e2)]);
    });
  }, t2.prototype.removeMatchingKeysForTargetId = function(t3, e) {
    var n2 = pi(t3), r2 = IDBKeyRange.bound([e], [e + 1], false, true);
    return n2.delete(r2);
  }, t2.prototype.getMatchingKeysForTargetId = function(t3, e) {
    var n2 = IDBKeyRange.bound([e], [e + 1], false, true), r2 = pi(t3), i = un();
    return r2.qt({
      range: n2,
      Bt: true
    }, function(t4, e2, n3) {
      var r3 = er(t4[1]), o = new H2(r3);
      i = i.add(o);
    }).next(function() {
      return i;
    });
  }, t2.prototype.containsKey = function(t3, e) {
    var n2 = $n(e.path), r2 = IDBKeyRange.bound([n2], [P2(n2)], false, true), i = 0;
    return pi(t3).qt({
      index: lr.documentTargetsIndex,
      Bt: true,
      range: r2
    }, function(t4, e2, n3) {
      var r3 = t4[0];
      t4[1];
      r3 !== 0 && (i++, n3.done());
    }).next(function() {
      return i > 0;
    });
  }, t2.prototype.yt = function(t3, e) {
    return li(t3).get(e).next(function(t4) {
      return t4 ? zr(t4) : null;
    });
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function li(t2) {
  return Rr(t2, fr.store);
}
__name(li, "li");
function di(t2) {
  return Rr(t2, dr.store);
}
__name(di, "di");
function pi(t2) {
  return Rr(t2, lr.store);
}
__name(pi, "pi");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function yi(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      if (t2.code !== j.FAILED_PRECONDITION || t2.message !== wr)
        throw t2;
      return _("LocalStore", "Unexpectedly lost primary lease"), [2];
    });
  });
}
__name(yi, "yi");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function vi(t2, e) {
  var n2 = t2[0], r2 = t2[1], i = e[0], o = e[1], s = R2(n2, i);
  return s === 0 ? R2(r2, o) : s;
}
__name(vi, "vi");
var mi = function() {
  function t2(t3) {
    this.ce = t3, this.buffer = new Je(vi), this.ae = 0;
  }
  __name(t2, "t");
  return t2.prototype.ue = function() {
    return ++this.ae;
  }, t2.prototype.he = function(t3) {
    var e = [t3, this.ue()];
    if (this.buffer.size < this.ce)
      this.buffer = this.buffer.add(e);
    else {
      var n2 = this.buffer.last();
      vi(e, n2) < 0 && (this.buffer = this.buffer.delete(n2).add(e));
    }
  }, Object.defineProperty(t2.prototype, "maxValue", {
    get: function() {
      return this.buffer.last()[0];
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var gi = function() {
  function t2(t3, e) {
    this.garbageCollector = t3, this.asyncQueue = e, this.le = false, this.fe = null;
  }
  __name(t2, "t");
  return t2.prototype.start = function(t3) {
    this.garbageCollector.params.cacheSizeCollectionThreshold !== -1 && this.de(t3);
  }, t2.prototype.stop = function() {
    this.fe && (this.fe.cancel(), this.fe = null);
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.fe !== null;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.de = function(t3) {
    var e = this, n2 = this.le ? 3e5 : 6e4;
    _("LruGarbageCollector", "Garbage collection scheduled in " + n2 + "ms"), this.fe = this.asyncQueue.enqueueAfterDelay("lru_garbage_collection", n2, function() {
      return __awaiter(e, void 0, void 0, function() {
        var e2;
        return __generator(this, function(n3) {
          switch (n3.label) {
            case 0:
              this.fe = null, this.le = true, n3.label = 1;
            case 1:
              return n3.trys.push([1, 3, , 7]), [4, t3.collectGarbage(this.garbageCollector)];
            case 2:
              return n3.sent(), [3, 7];
            case 3:
              return Nr(e2 = n3.sent()) ? (_("LruGarbageCollector", "Ignoring IndexedDB error during garbage collection: ", e2), [3, 6]) : [3, 4];
            case 4:
              return [4, yi(e2)];
            case 5:
              n3.sent(), n3.label = 6;
            case 6:
              return [3, 7];
            case 7:
              return [4, this.de(t3)];
            case 8:
              return n3.sent(), [2];
          }
        });
      });
    });
  }, t2;
}();
var wi = function() {
  function t2(t3, e) {
    this.we = t3, this.params = e;
  }
  __name(t2, "t");
  return t2.prototype.calculateTargetCount = function(t3, e) {
    return this.we._e(t3).next(function(t4) {
      return Math.floor(e / 100 * t4);
    });
  }, t2.prototype.nthSequenceNumber = function(t3, e) {
    var n2 = this;
    if (e === 0)
      return Er.resolve(I2.o);
    var r2 = new mi(e);
    return this.we.forEachTarget(t3, function(t4) {
      return r2.he(t4.sequenceNumber);
    }).next(function() {
      return n2.we.me(t3, function(t4) {
        return r2.he(t4);
      });
    }).next(function() {
      return r2.maxValue;
    });
  }, t2.prototype.removeTargets = function(t3, e, n2) {
    return this.we.removeTargets(t3, e, n2);
  }, t2.prototype.removeOrphanedDocuments = function(t3, e) {
    return this.we.removeOrphanedDocuments(t3, e);
  }, t2.prototype.collect = function(t3, e) {
    var n2 = this;
    return this.params.cacheSizeCollectionThreshold === -1 ? (_("LruGarbageCollector", "Garbage collection skipped; disabled"), Er.resolve(ei)) : this.getCacheSize(t3).next(function(r2) {
      return r2 < n2.params.cacheSizeCollectionThreshold ? (_("LruGarbageCollector", "Garbage collection skipped; Cache size " + r2 + " is lower than threshold " + n2.params.cacheSizeCollectionThreshold), ei) : n2.ye(t3, e);
    });
  }, t2.prototype.getCacheSize = function(t3) {
    return this.we.getCacheSize(t3);
  }, t2.prototype.ye = function(t3, n2) {
    var r2, i, o, s, u, a, c, h2 = this, f = Date.now();
    return this.calculateTargetCount(t3, this.params.percentileToCollect).next(function(e) {
      return e > h2.params.maximumSequenceNumbersToCollect ? (_("LruGarbageCollector", "Capping sequence numbers to collect down to the maximum of " + h2.params.maximumSequenceNumbersToCollect + " from " + e), i = h2.params.maximumSequenceNumbersToCollect) : i = e, s = Date.now(), h2.nthSequenceNumber(t3, i);
    }).next(function(e) {
      return r2 = e, u = Date.now(), h2.removeTargets(t3, r2, n2);
    }).next(function(e) {
      return o = e, a = Date.now(), h2.removeOrphanedDocuments(t3, r2);
    }).next(function(t4) {
      return c = Date.now(), T2() <= LogLevel.DEBUG && _("LruGarbageCollector", "LRU Garbage Collection\n	Counted targets in " + (s - f) + "ms\n	Determined least recently used " + i + " in " + (u - s) + "ms\n	Removed " + o + " targets in " + (a - u) + "ms\n	Removed " + t4 + " documents in " + (c - a) + "ms\nTotal Duration: " + (c - f) + "ms"), Er.resolve({
        didRun: true,
        sequenceNumbersCollected: i,
        targetsRemoved: o,
        documentsRemoved: t4
      });
    });
  }, t2;
}();
var bi = function() {
  function t2(t3, e) {
    this.db = t3, this.garbageCollector = function(t4, e2) {
      return new wi(t4, e2);
    }(this, e);
  }
  __name(t2, "t");
  return t2.prototype._e = function(t3) {
    var e = this.ge(t3);
    return this.db.getTargetCache().getTargetCount(t3).next(function(t4) {
      return e.next(function(e2) {
        return t4 + e2;
      });
    });
  }, t2.prototype.ge = function(t3) {
    var e = 0;
    return this.me(t3, function(t4) {
      e++;
    }).next(function() {
      return e;
    });
  }, t2.prototype.forEachTarget = function(t3, e) {
    return this.db.getTargetCache().forEachTarget(t3, e);
  }, t2.prototype.me = function(t3, e) {
    return this.pe(t3, function(t4, n2) {
      return e(n2);
    });
  }, t2.prototype.addReference = function(t3, e, n2) {
    return Ii(t3, n2);
  }, t2.prototype.removeReference = function(t3, e, n2) {
    return Ii(t3, n2);
  }, t2.prototype.removeTargets = function(t3, e, n2) {
    return this.db.getTargetCache().removeTargets(t3, e, n2);
  }, t2.prototype.markPotentiallyOrphaned = function(t3, e) {
    return Ii(t3, e);
  }, t2.prototype.Ee = function(t3, e) {
    return function(t4, e2) {
      var n2 = false;
      return ci(t4).Ut(function(r2) {
        return si(t4, r2, e2).next(function(t5) {
          return t5 && (n2 = true), Er.resolve(!t5);
        });
      }).next(function() {
        return n2;
      });
    }(t3, e);
  }, t2.prototype.removeOrphanedDocuments = function(t3, e) {
    var n2 = this, r2 = this.db.getRemoteDocumentCache().newChangeBuffer(), i = [], o = 0;
    return this.pe(t3, function(s, u) {
      if (u <= e) {
        var a = n2.Ee(t3, s).next(function(e2) {
          if (!e2)
            return o++, r2.getEntry(t3, s).next(function() {
              return r2.removeEntry(s), pi(t3).delete([0, $n(s.path)]);
            });
        });
        i.push(a);
      }
    }).next(function() {
      return Er.waitFor(i);
    }).next(function() {
      return r2.apply(t3);
    }).next(function() {
      return o;
    });
  }, t2.prototype.removeTarget = function(t3, e) {
    var n2 = e.withSequenceNumber(t3.currentSequenceNumber);
    return this.db.getTargetCache().updateTargetData(t3, n2);
  }, t2.prototype.updateLimboDocument = function(t3, e) {
    return Ii(t3, e);
  }, t2.prototype.pe = function(t3, e) {
    var n2, r2 = pi(t3), i = I2.o;
    return r2.qt({
      index: lr.documentTargetsIndex
    }, function(t4, r3) {
      var o = t4[0], s = (t4[1], r3.path), u = r3.sequenceNumber;
      o === 0 ? (i !== I2.o && e(new H2(er(n2)), i), i = u, n2 = s) : i = I2.o;
    }).next(function() {
      i !== I2.o && e(new H2(er(n2)), i);
    });
  }, t2.prototype.getCacheSize = function(t3) {
    return this.db.getRemoteDocumentCache().getSize(t3);
  }, t2;
}();
function Ii(t2, e) {
  return pi(t2).put(function(t3, e2) {
    return new lr(0, $n(t3.path), e2);
  }(e, t2.currentSequenceNumber));
}
__name(Ii, "Ii");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ei = function() {
  function t2(t3, e) {
    this.mapKeyFn = t3, this.equalsFn = e, this.inner = {};
  }
  __name(t2, "t");
  return t2.prototype.get = function(t3) {
    var e = this.mapKeyFn(t3), n2 = this.inner[e];
    if (n2 !== void 0)
      for (var r2 = 0, i = n2; r2 < i.length; r2++) {
        var o = i[r2], s = o[0], u = o[1];
        if (this.equalsFn(s, t3))
          return u;
      }
  }, t2.prototype.has = function(t3) {
    return this.get(t3) !== void 0;
  }, t2.prototype.set = function(t3, e) {
    var n2 = this.mapKeyFn(t3), r2 = this.inner[n2];
    if (r2 !== void 0) {
      for (var i = 0; i < r2.length; i++)
        if (this.equalsFn(r2[i][0], t3))
          return void (r2[i] = [t3, e]);
      r2.push([t3, e]);
    } else
      this.inner[n2] = [[t3, e]];
  }, t2.prototype.delete = function(t3) {
    var e = this.mapKeyFn(t3), n2 = this.inner[e];
    if (n2 === void 0)
      return false;
    for (var r2 = 0; r2 < n2.length; r2++)
      if (this.equalsFn(n2[r2][0], t3))
        return n2.length === 1 ? delete this.inner[e] : n2.splice(r2, 1), true;
    return false;
  }, t2.prototype.forEach = function(t3) {
    F2(this.inner, function(e, n2) {
      for (var r2 = 0, i = n2; r2 < i.length; r2++) {
        var o = i[r2], s = o[0], u = o[1];
        t3(s, u);
      }
    });
  }, t2.prototype.isEmpty = function() {
    return q2(this.inner);
  }, t2;
}();
var Ti = function() {
  function t2() {
    this.changes = new Ei(function(t3) {
      return t3.toString();
    }, function(t3, e) {
      return t3.isEqual(e);
    }), this.changesApplied = false;
  }
  __name(t2, "t");
  return t2.prototype.getReadTime = function(t3) {
    var e = this.changes.get(t3);
    return e ? e.readTime : ie.min();
  }, t2.prototype.addEntry = function(t3, e) {
    this.assertNotApplied(), this.changes.set(t3.key, {
      maybeDocument: t3,
      readTime: e
    });
  }, t2.prototype.removeEntry = function(t3, e) {
    e === void 0 && (e = null), this.assertNotApplied(), this.changes.set(t3, {
      maybeDocument: null,
      readTime: e
    });
  }, t2.prototype.getEntry = function(t3, e) {
    this.assertNotApplied();
    var n2 = this.changes.get(e);
    return n2 !== void 0 ? Er.resolve(n2.maybeDocument) : this.getFromCache(t3, e);
  }, t2.prototype.getEntries = function(t3, e) {
    return this.getAllFromCache(t3, e);
  }, t2.prototype.apply = function(t3) {
    return this.assertNotApplied(), this.changesApplied = true, this.applyChanges(t3);
  }, t2.prototype.assertNotApplied = function() {
  }, t2;
}();
var _i = function() {
  function t2(t3, e) {
    this.D = t3, this.Gt = e;
  }
  __name(t2, "t");
  return t2.prototype.addEntry = function(t3, e, n2) {
    return Ni(t3).put(Ai(e), n2);
  }, t2.prototype.removeEntry = function(t3, e) {
    var n2 = Ni(t3), r2 = Ai(e);
    return n2.delete(r2);
  }, t2.prototype.updateMetadata = function(t3, e) {
    var n2 = this;
    return this.getMetadata(t3).next(function(r2) {
      return r2.byteSize += e, n2.Te(t3, r2);
    });
  }, t2.prototype.getEntry = function(t3, e) {
    var n2 = this;
    return Ni(t3).get(Ai(e)).next(function(t4) {
      return n2.Ie(t4);
    });
  }, t2.prototype.Ae = function(t3, e) {
    var n2 = this;
    return Ni(t3).get(Ai(e)).next(function(t4) {
      var e2 = n2.Ie(t4);
      return e2 ? {
        maybeDocument: e2,
        size: ii(t4)
      } : null;
    });
  }, t2.prototype.getEntries = function(t3, e) {
    var n2 = this, r2 = tn();
    return this.Re(t3, e, function(t4, e2) {
      var i = n2.Ie(e2);
      r2 = r2.insert(t4, i);
    }).next(function() {
      return r2;
    });
  }, t2.prototype.be = function(t3, e) {
    var n2 = this, r2 = tn(), i = new We(H2.comparator);
    return this.Re(t3, e, function(t4, e2) {
      var o = n2.Ie(e2);
      o ? (r2 = r2.insert(t4, o), i = i.insert(t4, ii(e2))) : (r2 = r2.insert(t4, null), i = i.insert(t4, 0));
    }).next(function() {
      return {
        ve: r2,
        Pe: i
      };
    });
  }, t2.prototype.Re = function(t3, e, n2) {
    if (e.isEmpty())
      return Er.resolve();
    var r2 = IDBKeyRange.bound(e.first().path.toArray(), e.last().path.toArray()), i = e.getIterator(), o = i.getNext();
    return Ni(t3).qt({
      range: r2
    }, function(t4, e2, r3) {
      for (var s = H2.fromSegments(t4); o && H2.comparator(o, s) < 0; )
        n2(o, null), o = i.getNext();
      o && o.isEqual(s) && (n2(o, e2), o = i.hasNext() ? i.getNext() : null), o ? r3.Ot(o.path.toArray()) : r3.done();
    }).next(function() {
      for (; o; )
        n2(o, null), o = i.hasNext() ? i.getNext() : null;
    });
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n2) {
    var r2 = this, i = nn(), o = e.path.length + 1, s = {};
    if (n2.isEqual(ie.min())) {
      var u = e.path.toArray();
      s.range = IDBKeyRange.lowerBound(u);
    } else {
      var a = e.path.toArray(), c = Ur(n2);
      s.range = IDBKeyRange.lowerBound([a, c], true), s.index = cr.collectionReadTimeIndex;
    }
    return Ni(t3).qt(s, function(t4, n3, s2) {
      if (t4.length === o) {
        var u2 = qr(r2.D, n3);
        e.path.isPrefixOf(u2.key.path) ? u2 instanceof gt && ee(e, u2) && (i = i.insert(u2.key, u2)) : s2.done();
      }
    }).next(function() {
      return i;
    });
  }, t2.prototype.newChangeBuffer = function(t3) {
    return new Si(this, !!t3 && t3.trackRemovals);
  }, t2.prototype.getSize = function(t3) {
    return this.getMetadata(t3).next(function(t4) {
      return t4.byteSize;
    });
  }, t2.prototype.getMetadata = function(t3) {
    return Di(t3).get(hr.key).next(function(t4) {
      return k2(!!t4), t4;
    });
  }, t2.prototype.Te = function(t3, e) {
    return Di(t3).put(hr.key, e);
  }, t2.prototype.Ie = function(t3) {
    if (t3) {
      var e = qr(this.D, t3);
      return e instanceof wt && e.version.isEqual(ie.min()) ? null : e;
    }
    return null;
  }, t2;
}();
var Si = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).Ve = e2, r2.trackRemovals = n2, r2.Se = new Ei(function(t3) {
      return t3.toString();
    }, function(t3, e3) {
      return t3.isEqual(e3);
    }), r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.applyChanges = function(t3) {
    var e2 = this, n2 = [], r2 = 0, i = new Je(function(t4, e3) {
      return R2(t4.canonicalString(), e3.canonicalString());
    });
    return this.changes.forEach(function(o, s) {
      var u = e2.Se.get(o);
      if (s.maybeDocument) {
        var a = Vr(e2.Ve.D, s.maybeDocument, e2.getReadTime(o));
        i = i.add(o.path.popLast());
        var c = ii(a);
        r2 += c - u, n2.push(e2.Ve.addEntry(t3, o, a));
      } else if (r2 -= u, e2.trackRemovals) {
        var h2 = Vr(e2.Ve.D, new wt(o, ie.min()), e2.getReadTime(o));
        n2.push(e2.Ve.addEntry(t3, o, h2));
      } else
        n2.push(e2.Ve.removeEntry(t3, o));
    }), i.forEach(function(r3) {
      n2.push(e2.Ve.Gt.addToCollectionParentIndex(t3, r3));
    }), n2.push(this.Ve.updateMetadata(t3, r2)), Er.waitFor(n2);
  }, e.prototype.getFromCache = function(t3, e2) {
    var n2 = this;
    return this.Ve.Ae(t3, e2).next(function(t4) {
      return t4 === null ? (n2.Se.set(e2, 0), null) : (n2.Se.set(e2, t4.size), t4.maybeDocument);
    });
  }, e.prototype.getAllFromCache = function(t3, e2) {
    var n2 = this;
    return this.Ve.be(t3, e2).next(function(t4) {
      var e3 = t4.ve;
      return t4.Pe.forEach(function(t5, e4) {
        n2.Se.set(t5, e4);
      }), e3;
    });
  }, e;
}(Ti);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Di(t2) {
  return Rr(t2, hr.store);
}
__name(Di, "Di");
function Ni(t2) {
  return Rr(t2, cr.store);
}
__name(Ni, "Ni");
function Ai(t2) {
  return t2.path.toArray();
}
__name(Ai, "Ai");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ki = function() {
  function t2(t3) {
    this.D = t3;
  }
  __name(t2, "t");
  return t2.prototype.St = function(t3, e, n2, r2) {
    var i = this;
    k2(n2 < r2 && n2 >= 0 && r2 <= 11);
    var o = new Tr("createOrUpgrade", e);
    n2 < 1 && r2 >= 1 && (function(t4) {
      t4.createObjectStore(rr.store);
    }(t3), function(t4) {
      t4.createObjectStore(ir.store, {
        keyPath: ir.keyPath
      }), t4.createObjectStore(or.store, {
        keyPath: or.keyPath,
        autoIncrement: true
      }).createIndex(or.userMutationsIndex, or.userMutationsKeyPath, {
        unique: true
      }), t4.createObjectStore(sr.store);
    }(t3), Ci(t3), function(t4) {
      t4.createObjectStore(cr.store);
    }(t3));
    var s = Er.resolve();
    return n2 < 3 && r2 >= 3 && (n2 !== 0 && (function(t4) {
      t4.deleteObjectStore(lr.store), t4.deleteObjectStore(fr.store), t4.deleteObjectStore(dr.store);
    }(t3), Ci(t3)), s = s.next(function() {
      return function(t4) {
        var e2 = t4.store(dr.store), n3 = new dr(0, 0, ie.min().toTimestamp(), 0);
        return e2.put(dr.key, n3);
      }(o);
    })), n2 < 4 && r2 >= 4 && (n2 !== 0 && (s = s.next(function() {
      return function(t4, e2) {
        return e2.store(or.store).kt().next(function(n3) {
          t4.deleteObjectStore(or.store), t4.createObjectStore(or.store, {
            keyPath: or.keyPath,
            autoIncrement: true
          }).createIndex(or.userMutationsIndex, or.userMutationsKeyPath, {
            unique: true
          });
          var r3 = e2.store(or.store), i2 = n3.map(function(t5) {
            return r3.put(t5);
          });
          return Er.waitFor(i2);
        });
      }(t3, o);
    })), s = s.next(function() {
      !function(t4) {
        t4.createObjectStore(yr.store, {
          keyPath: yr.keyPath
        });
      }(t3);
    })), n2 < 5 && r2 >= 5 && (s = s.next(function() {
      return i.De(o);
    })), n2 < 6 && r2 >= 6 && (s = s.next(function() {
      return function(t4) {
        t4.createObjectStore(hr.store);
      }(t3), i.Ce(o);
    })), n2 < 7 && r2 >= 7 && (s = s.next(function() {
      return i.xe(o);
    })), n2 < 8 && r2 >= 8 && (s = s.next(function() {
      return i.Ne(t3, o);
    })), n2 < 9 && r2 >= 9 && (s = s.next(function() {
      !function(t4) {
        t4.objectStoreNames.contains("remoteDocumentChanges") && t4.deleteObjectStore("remoteDocumentChanges");
      }(t3), function(t4) {
        var e2 = t4.objectStore(cr.store);
        e2.createIndex(cr.readTimeIndex, cr.readTimeIndexPath, {
          unique: false
        }), e2.createIndex(cr.collectionReadTimeIndex, cr.collectionReadTimeIndexPath, {
          unique: false
        });
      }(e);
    })), n2 < 10 && r2 >= 10 && (s = s.next(function() {
      return i.$e(o);
    })), n2 < 11 && r2 >= 11 && (s = s.next(function() {
      !function(t4) {
        t4.createObjectStore(vr.store, {
          keyPath: vr.keyPath
        });
      }(t3), function(t4) {
        t4.createObjectStore(mr.store, {
          keyPath: mr.keyPath
        });
      }(t3);
    })), s;
  }, t2.prototype.Ce = function(t3) {
    var e = 0;
    return t3.store(cr.store).qt(function(t4, n2) {
      e += ii(n2);
    }).next(function() {
      var n2 = new hr(e);
      return t3.store(hr.store).put(hr.key, n2);
    });
  }, t2.prototype.De = function(t3) {
    var e = this, n2 = t3.store(ir.store), r2 = t3.store(or.store);
    return n2.kt().next(function(n3) {
      return Er.forEach(n3, function(n4) {
        var i = IDBKeyRange.bound([n4.userId, -1], [n4.userId, n4.lastAcknowledgedBatchId]);
        return r2.kt(or.userMutationsIndex, i).next(function(r3) {
          return Er.forEach(r3, function(r4) {
            k2(r4.userId === n4.userId);
            var i2 = Kr(e.D, r4);
            return ri(t3, n4.userId, i2).next(function() {
            });
          });
        });
      });
    });
  }, t2.prototype.xe = function(t3) {
    var e = t3.store(lr.store), n2 = t3.store(cr.store);
    return t3.store(dr.store).get(dr.key).next(function(t4) {
      var r2 = [];
      return n2.qt(function(n3, i) {
        var o = new z2(n3), s = function(t5) {
          return [0, $n(t5)];
        }(o);
        r2.push(e.get(s).next(function(n4) {
          return n4 ? Er.resolve() : function(n5) {
            return e.put(new lr(0, $n(n5), t4.highestListenSequenceNumber));
          }(o);
        }));
      }).next(function() {
        return Er.waitFor(r2);
      });
    });
  }, t2.prototype.Ne = function(t3, e) {
    t3.createObjectStore(pr.store, {
      keyPath: pr.keyPath
    });
    var n2 = e.store(pr.store), r2 = new $r(), i = /* @__PURE__ */ __name(function(t4) {
      if (r2.add(t4)) {
        var e2 = t4.lastSegment(), i2 = t4.popLast();
        return n2.put({
          collectionId: e2,
          parent: $n(i2)
        });
      }
    }, "i");
    return e.store(cr.store).qt({
      Bt: true
    }, function(t4, e2) {
      var n3 = new z2(t4);
      return i(n3.popLast());
    }).next(function() {
      return e.store(sr.store).qt({
        Bt: true
      }, function(t4, e2) {
        t4[0];
        var n3 = t4[1], r3 = (t4[2], er(n3));
        return i(r3.popLast());
      });
    });
  }, t2.prototype.$e = function(t3) {
    var e = this, n2 = t3.store(fr.store);
    return n2.qt(function(t4, r2) {
      var i = zr(r2), o = Qr(e.D, i);
      return n2.put(o);
    });
  }, t2;
}();
function Ci(t2) {
  t2.createObjectStore(lr.store, {
    keyPath: lr.keyPath
  }).createIndex(lr.documentTargetsIndex, lr.documentTargetsKeyPath, {
    unique: true
  }), t2.createObjectStore(fr.store, {
    keyPath: fr.keyPath
  }).createIndex(fr.queryTargetsIndexName, fr.queryTargetsKeyPath, {
    unique: true
  }), t2.createObjectStore(dr.store);
}
__name(Ci, "Ci");
var xi = "Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";
var Li = function() {
  function t2(e, n2, r2, i, o, s, u, a, c, h2) {
    if (this.allowTabSynchronization = e, this.persistenceKey = n2, this.clientId = r2, this.Fe = o, this.window = s, this.document = u, this.Oe = c, this.ke = h2, this.Me = null, this.Le = false, this.isPrimary = false, this.networkEnabled = true, this.Be = null, this.inForeground = false, this.qe = null, this.Ue = null, this.Qe = Number.NEGATIVE_INFINITY, this.Ke = function(t3) {
      return Promise.resolve();
    }, !t2.At())
      throw new G2(j.UNIMPLEMENTED, "This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");
    this.referenceDelegate = new bi(this, i), this.We = n2 + "main", this.D = new Fr(a), this.je = new _r(this.We, 11, new ki(this.D)), this.Ge = new fi(this.referenceDelegate, this.D), this.Gt = new Zr(), this.ze = function(t3, e2) {
      return new _i(t3, e2);
    }(this.D, this.Gt), this.He = new Hr(), this.window && this.window.localStorage ? this.Je = this.window.localStorage : (this.Je = null, h2 === false && S2("IndexedDbPersistence", "LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."));
  }
  __name(t2, "t");
  return t2.prototype.start = function() {
    var t3 = this;
    return this.Ye().then(function() {
      if (!t3.isPrimary && !t3.allowTabSynchronization)
        throw new G2(j.FAILED_PRECONDITION, xi);
      return t3.Xe(), t3.Ze(), t3.tn(), t3.runTransaction("getHighestListenSequenceNumber", "readonly", function(e) {
        return t3.Ge.getHighestSequenceNumber(e);
      });
    }).then(function(e) {
      t3.Me = new I2(e, t3.Oe);
    }).then(function() {
      t3.Le = true;
    }).catch(function(e) {
      return t3.je && t3.je.close(), Promise.reject(e);
    });
  }, t2.prototype.en = function(t3) {
    var e = this;
    return this.Ke = function(n2) {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(e2) {
          return this.started ? [2, t3(n2)] : [2];
        });
      });
    }, t3(this.isPrimary);
  }, t2.prototype.setDatabaseDeletedListener = function(t3) {
    var e = this;
    this.je.Ct(function(n2) {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(e2) {
          switch (e2.label) {
            case 0:
              return n2.newVersion === null ? [4, t3()] : [3, 2];
            case 1:
              e2.sent(), e2.label = 2;
            case 2:
              return [2];
          }
        });
      });
    });
  }, t2.prototype.setNetworkEnabled = function(t3) {
    var e = this;
    this.networkEnabled !== t3 && (this.networkEnabled = t3, this.Fe.enqueueAndForget(function() {
      return __awaiter(e, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return this.started ? [4, this.Ye()] : [3, 2];
            case 1:
              t4.sent(), t4.label = 2;
            case 2:
              return [2];
          }
        });
      });
    }));
  }, t2.prototype.Ye = function() {
    var t3 = this;
    return this.runTransaction("updateClientMetadataAndTryBecomePrimary", "readwrite", function(e) {
      return Oi(e).put(new yr(t3.clientId, Date.now(), t3.networkEnabled, t3.inForeground)).next(function() {
        if (t3.isPrimary)
          return t3.nn(e).next(function(e2) {
            e2 || (t3.isPrimary = false, t3.Fe.enqueueRetryable(function() {
              return t3.Ke(false);
            }));
          });
      }).next(function() {
        return t3.sn(e);
      }).next(function(n2) {
        return t3.isPrimary && !n2 ? t3.rn(e).next(function() {
          return false;
        }) : !!n2 && t3.on(e).next(function() {
          return true;
        });
      });
    }).catch(function(e) {
      if (Nr(e))
        return _("IndexedDbPersistence", "Failed to extend owner lease: ", e), t3.isPrimary;
      if (!t3.allowTabSynchronization)
        throw e;
      return _("IndexedDbPersistence", "Releasing owner lease after error during lease refresh", e), false;
    }).then(function(e) {
      t3.isPrimary !== e && t3.Fe.enqueueRetryable(function() {
        return t3.Ke(e);
      }), t3.isPrimary = e;
    });
  }, t2.prototype.nn = function(t3) {
    var e = this;
    return Ri(t3).get(rr.key).next(function(t4) {
      return Er.resolve(e.cn(t4));
    });
  }, t2.prototype.an = function(t3) {
    return Oi(t3).delete(this.clientId);
  }, t2.prototype.un = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i = this;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return !this.isPrimary || this.hn(this.Qe, 18e5) ? [3, 2] : (this.Qe = Date.now(), [4, this.runTransaction("maybeGarbageCollectMultiClientState", "readwrite-primary", function(t4) {
              var e2 = Rr(t4, yr.store);
              return e2.kt().next(function(t5) {
                var n3 = i.ln(t5, 18e5), r3 = t5.filter(function(t6) {
                  return n3.indexOf(t6) === -1;
                });
                return Er.forEach(r3, function(t6) {
                  return e2.delete(t6.clientId);
                }).next(function() {
                  return r3;
                });
              });
            }).catch(function() {
              return [];
            })]);
          case 1:
            if (t3 = o.sent(), this.Je)
              for (e = 0, n2 = t3; e < n2.length; e++)
                r2 = n2[e], this.Je.removeItem(this.fn(r2.clientId));
            o.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.tn = function() {
    var t3 = this;
    this.Ue = this.Fe.enqueueAfterDelay("client_metadata_refresh", 4e3, function() {
      return t3.Ye().then(function() {
        return t3.un();
      }).then(function() {
        return t3.tn();
      });
    });
  }, t2.prototype.cn = function(t3) {
    return !!t3 && t3.ownerId === this.clientId;
  }, t2.prototype.sn = function(t3) {
    var e = this;
    return this.ke ? Er.resolve(true) : Ri(t3).get(rr.key).next(function(n2) {
      if (n2 !== null && e.hn(n2.leaseTimestampMs, 5e3) && !e.dn(n2.ownerId)) {
        if (e.cn(n2) && e.networkEnabled)
          return true;
        if (!e.cn(n2)) {
          if (!n2.allowTabSynchronization)
            throw new G2(j.FAILED_PRECONDITION, xi);
          return false;
        }
      }
      return !(!e.networkEnabled || !e.inForeground) || Oi(t3).kt().next(function(t4) {
        return e.ln(t4, 5e3).find(function(t5) {
          if (e.clientId !== t5.clientId) {
            var n3 = !e.networkEnabled && t5.networkEnabled, r2 = !e.inForeground && t5.inForeground, i = e.networkEnabled === t5.networkEnabled;
            if (n3 || r2 && i)
              return true;
          }
          return false;
        }) === void 0;
      });
    }).next(function(t4) {
      return e.isPrimary !== t4 && _("IndexedDbPersistence", "Client " + (t4 ? "is" : "is not") + " eligible for a primary lease."), t4;
    });
  }, t2.prototype.shutdown = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3 = this;
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return this.Le = false, this.wn(), this.Ue && (this.Ue.cancel(), this.Ue = null), this._n(), this.mn(), [4, this.je.runTransaction("shutdown", "readwrite", [rr.store, yr.store], function(e2) {
              var n2 = new Lr(e2, I2.o);
              return t3.rn(n2).next(function() {
                return t3.an(n2);
              });
            })];
          case 1:
            return e.sent(), this.je.close(), this.yn(), [2];
        }
      });
    });
  }, t2.prototype.ln = function(t3, e) {
    var n2 = this;
    return t3.filter(function(t4) {
      return n2.hn(t4.updateTimeMs, e) && !n2.dn(t4.clientId);
    });
  }, t2.prototype.gn = function() {
    var t3 = this;
    return this.runTransaction("getActiveClients", "readonly", function(e) {
      return Oi(e).kt().next(function(e2) {
        return t3.ln(e2, 18e5).map(function(t4) {
          return t4.clientId;
        });
      });
    });
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.Le;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.getMutationQueue = function(t3) {
    return oi.Ht(t3, this.D, this.Gt, this.referenceDelegate);
  }, t2.prototype.getTargetCache = function() {
    return this.Ge;
  }, t2.prototype.getRemoteDocumentCache = function() {
    return this.ze;
  }, t2.prototype.getIndexManager = function() {
    return this.Gt;
  }, t2.prototype.getBundleCache = function() {
    return this.He;
  }, t2.prototype.runTransaction = function(t3, e, n2) {
    var r2 = this;
    _("IndexedDbPersistence", "Starting transaction:", t3);
    var i, o = e === "readonly" ? "readonly" : "readwrite";
    return this.je.runTransaction(t3, o, gr, function(o2) {
      return i = new Lr(o2, r2.Me ? r2.Me.next() : I2.o), e === "readwrite-primary" ? r2.nn(i).next(function(t4) {
        return !!t4 || r2.sn(i);
      }).next(function(e2) {
        if (!e2)
          throw S2("Failed to obtain primary lease for action '" + t3 + "'."), r2.isPrimary = false, r2.Fe.enqueueRetryable(function() {
            return r2.Ke(false);
          }), new G2(j.FAILED_PRECONDITION, wr);
        return n2(i);
      }).next(function(t4) {
        return r2.on(i).next(function() {
          return t4;
        });
      }) : r2.pn(i).next(function() {
        return n2(i);
      });
    }).then(function(t4) {
      return i.raiseOnCommittedEvent(), t4;
    });
  }, t2.prototype.pn = function(t3) {
    var e = this;
    return Ri(t3).get(rr.key).next(function(t4) {
      if (t4 !== null && e.hn(t4.leaseTimestampMs, 5e3) && !e.dn(t4.ownerId) && !e.cn(t4) && !(e.ke || e.allowTabSynchronization && t4.allowTabSynchronization))
        throw new G2(j.FAILED_PRECONDITION, xi);
    });
  }, t2.prototype.on = function(t3) {
    var e = new rr(this.clientId, this.allowTabSynchronization, Date.now());
    return Ri(t3).put(rr.key, e);
  }, t2.At = function() {
    return _r.At();
  }, t2.prototype.rn = function(t3) {
    var e = this, n2 = Ri(t3);
    return n2.get(rr.key).next(function(t4) {
      return e.cn(t4) ? (_("IndexedDbPersistence", "Releasing primary lease."), n2.delete(rr.key)) : Er.resolve();
    });
  }, t2.prototype.hn = function(t3, e) {
    var n2 = Date.now();
    return !(t3 < n2 - e || t3 > n2 && (S2("Detected an update time that is in the future: " + t3 + " > " + n2), 1));
  }, t2.prototype.Xe = function() {
    var t3 = this;
    this.document !== null && typeof this.document.addEventListener == "function" && (this.qe = function() {
      t3.Fe.enqueueAndForget(function() {
        return t3.inForeground = t3.document.visibilityState === "visible", t3.Ye();
      });
    }, this.document.addEventListener("visibilitychange", this.qe), this.inForeground = this.document.visibilityState === "visible");
  }, t2.prototype._n = function() {
    this.qe && (this.document.removeEventListener("visibilitychange", this.qe), this.qe = null);
  }, t2.prototype.Ze = function() {
    var t3, e = this;
    typeof ((t3 = this.window) === null || t3 === void 0 ? void 0 : t3.addEventListener) == "function" && (this.Be = function() {
      e.wn(), e.Fe.enqueueAndForget(function() {
        return e.shutdown();
      });
    }, this.window.addEventListener("unload", this.Be));
  }, t2.prototype.mn = function() {
    this.Be && (this.window.removeEventListener("unload", this.Be), this.Be = null);
  }, t2.prototype.dn = function(t3) {
    var e;
    try {
      var n2 = ((e = this.Je) === null || e === void 0 ? void 0 : e.getItem(this.fn(t3))) !== null;
      return _("IndexedDbPersistence", "Client '" + t3 + "' " + (n2 ? "is" : "is not") + " zombied in LocalStorage"), n2;
    } catch (t4) {
      return S2("IndexedDbPersistence", "Failed to get zombied client id.", t4), false;
    }
  }, t2.prototype.wn = function() {
    if (this.Je)
      try {
        this.Je.setItem(this.fn(this.clientId), String(Date.now()));
      } catch (t3) {
        S2("Failed to set zombie client id.", t3);
      }
  }, t2.prototype.yn = function() {
    if (this.Je)
      try {
        this.Je.removeItem(this.fn(this.clientId));
      } catch (t3) {
      }
  }, t2.prototype.fn = function(t3) {
    return "firestore_zombie_" + this.persistenceKey + "_" + t3;
  }, t2;
}();
function Ri(t2) {
  return Rr(t2, rr.store);
}
__name(Ri, "Ri");
function Oi(t2) {
  return Rr(t2, yr.store);
}
__name(Oi, "Oi");
function Pi(t2, e) {
  var n2 = t2.projectId;
  return t2.isDefaultDatabase || (n2 += "." + t2.database), "firestore/" + e + "/" + n2 + "/";
}
__name(Pi, "Pi");
var Mi = /* @__PURE__ */ __name(function(t2, e) {
  this.progress = t2, this.En = e;
}, "Mi");
var Fi = function() {
  function t2(t3, e, n2) {
    this.ze = t3, this.Tn = e, this.Gt = n2;
  }
  __name(t2, "t");
  return t2.prototype.In = function(t3, e) {
    var n2 = this;
    return this.Tn.getAllMutationBatchesAffectingDocumentKey(t3, e).next(function(r2) {
      return n2.An(t3, e, r2);
    });
  }, t2.prototype.An = function(t3, e, n2) {
    return this.ze.getEntry(t3, e).next(function(t4) {
      for (var r2 = 0, i = n2; r2 < i.length; r2++) {
        t4 = i[r2].applyToLocalView(e, t4);
      }
      return t4;
    });
  }, t2.prototype.Rn = function(t3, e, n2) {
    var r2 = tn();
    return e.forEach(function(t4, e2) {
      for (var i = 0, o = n2; i < o.length; i++) {
        e2 = o[i].applyToLocalView(t4, e2);
      }
      r2 = r2.insert(t4, e2);
    }), r2;
  }, t2.prototype.bn = function(t3, e) {
    var n2 = this;
    return this.ze.getEntries(t3, e).next(function(e2) {
      return n2.vn(t3, e2);
    });
  }, t2.prototype.vn = function(t3, e) {
    var n2 = this;
    return this.Tn.getAllMutationBatchesAffectingDocumentKeys(t3, e).next(function(r2) {
      var i = n2.Rn(t3, e, r2), o = Ze();
      return i.forEach(function(t4, e2) {
        e2 || (e2 = new wt(t4, ie.min())), o = o.insert(t4, e2);
      }), o;
    });
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n2) {
    return function(t4) {
      return H2.isDocumentKey(t4.path) && t4.collectionGroup === null && t4.filters.length === 0;
    }(e) ? this.Pn(t3, e.path) : Ht(e) ? this.Vn(t3, e, n2) : this.Sn(t3, e, n2);
  }, t2.prototype.Pn = function(t3, e) {
    return this.In(t3, new H2(e)).next(function(t4) {
      var e2 = nn();
      return t4 instanceof gt && (e2 = e2.insert(t4.key, t4)), e2;
    });
  }, t2.prototype.Vn = function(t3, e, n2) {
    var r2 = this, i = e.collectionGroup, o = nn();
    return this.Gt.getCollectionParents(t3, i).next(function(s) {
      return Er.forEach(s, function(s2) {
        var u = function(t4, e2) {
          return new Bt(e2, null, t4.explicitOrderBy.slice(), t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, t4.endAt);
        }(e, s2.child(i));
        return r2.Sn(t3, u, n2).next(function(t4) {
          t4.forEach(function(t5, e2) {
            o = o.insert(t5, e2);
          });
        });
      }).next(function() {
        return o;
      });
    });
  }, t2.prototype.Sn = function(t3, e, n2) {
    var r2, i, o = this;
    return this.ze.getDocumentsMatchingQuery(t3, e, n2).next(function(n3) {
      return r2 = n3, o.Tn.getAllMutationBatchesAffectingQuery(t3, e);
    }).next(function(e2) {
      return i = e2, o.Dn(t3, i, r2).next(function(t4) {
        r2 = t4;
        for (var e3 = 0, n3 = i; e3 < n3.length; e3++)
          for (var o2 = n3[e3], s = 0, u = o2.mutations; s < u.length; s++) {
            var a = u[s], c = a.key, h2 = Ce(a, r2.get(c), o2.localWriteTime);
            r2 = h2 instanceof gt ? r2.insert(c, h2) : r2.remove(c);
          }
      });
    }).next(function() {
      return r2.forEach(function(t4, n3) {
        ee(e, n3) || (r2 = r2.remove(t4));
      }), r2;
    });
  }, t2.prototype.Dn = function(t3, e, n2) {
    for (var r2 = un(), i = 0, o = e; i < o.length; i++)
      for (var s = 0, u = o[i].mutations; s < u.length; s++) {
        var a = u[s];
        a instanceof Pe && n2.get(a.key) === null && (r2 = r2.add(a.key));
      }
    var c = n2;
    return this.ze.getEntries(t3, r2).next(function(t4) {
      return t4.forEach(function(t5, e2) {
        e2 !== null && e2 instanceof gt && (c = c.insert(t5, e2));
      }), c;
    });
  }, t2;
}();
var qi = function() {
  function t2(t3, e, n2, r2) {
    this.targetId = t3, this.fromCache = e, this.Cn = n2, this.xn = r2;
  }
  __name(t2, "t");
  return t2.Nn = function(e, n2) {
    for (var r2 = un(), i = un(), o = 0, s = n2.docChanges; o < s.length; o++) {
      var u = s[o];
      switch (u.type) {
        case 0:
          r2 = r2.add(u.doc.key);
          break;
        case 1:
          i = i.add(u.doc.key);
      }
    }
    return new t2(e, n2.fromCache, r2, i);
  }, t2;
}();
var Vi = function() {
  function t2() {
  }
  __name(t2, "t");
  return t2.prototype.$n = function(t3) {
    this.Fn = t3;
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, n2, r2, i) {
    var o = this;
    return function(t4) {
      return t4.filters.length === 0 && t4.limit === null && t4.startAt == null && t4.endAt == null && (t4.explicitOrderBy.length === 0 || t4.explicitOrderBy.length === 1 && t4.explicitOrderBy[0].field.isKeyField());
    }(n2) || r2.isEqual(ie.min()) ? this.On(t3, n2) : this.Fn.bn(t3, i).next(function(s) {
      var u = o.kn(n2, s);
      return (Kt(n2) || zt(n2)) && o.Mn(n2.limitType, u, i, r2) ? o.On(t3, n2) : (T2() <= LogLevel.DEBUG && _("QueryEngine", "Re-using previous result from %s to execute query: %s", r2.toString(), te(n2)), o.Fn.getDocumentsMatchingQuery(t3, n2, r2).next(function(t4) {
        return u.forEach(function(e) {
          t4 = t4.insert(e.key, e);
        }), t4;
      }));
    });
  }, t2.prototype.kn = function(t3, e) {
    var n2 = new Je(ne(t3));
    return e.forEach(function(e2, r2) {
      r2 instanceof gt && ee(t3, r2) && (n2 = n2.add(r2));
    }), n2;
  }, t2.prototype.Mn = function(t3, e, n2, r2) {
    if (n2.size !== e.size)
      return true;
    var i = t3 === "F" ? e.last() : e.first();
    return !!i && (i.hasPendingWrites || i.version.compareTo(r2) > 0);
  }, t2.prototype.On = function(t3, n2) {
    return T2() <= LogLevel.DEBUG && _("QueryEngine", "Using full collection scan to execute query:", te(n2)), this.Fn.getDocumentsMatchingQuery(t3, n2, ie.min());
  }, t2;
}();
var Ui = function() {
  function t2(t3, e, n2, r2) {
    this.persistence = t3, this.Ln = e, this.D = r2, this.Bn = new We(R2), this.qn = new Ei(function(t4) {
      return Tt(t4);
    }, _t), this.Un = ie.min(), this.Tn = t3.getMutationQueue(n2), this.Qn = t3.getRemoteDocumentCache(), this.Ge = t3.getTargetCache(), this.Kn = new Fi(this.Qn, this.Tn, this.persistence.getIndexManager()), this.He = t3.getBundleCache(), this.Ln.$n(this.Kn);
  }
  __name(t2, "t");
  return t2.prototype.collectGarbage = function(t3) {
    var e = this;
    return this.persistence.runTransaction("Collect garbage", "readwrite-primary", function(n2) {
      return t3.collect(n2, e.Bn);
    });
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Bi(t2, e, n2, r2) {
  return new Ui(t2, e, n2, r2);
}
__name(Bi, "Bi");
function ji(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          return n2 = C(t2), r2 = n2.Tn, i = n2.Kn, [4, n2.persistence.runTransaction("Handle user change", "readonly", function(t3) {
            var o2;
            return n2.Tn.getAllMutationBatches(t3).next(function(s2) {
              return o2 = s2, r2 = n2.persistence.getMutationQueue(e), i = new Fi(n2.Qn, r2, n2.persistence.getIndexManager()), r2.getAllMutationBatches(t3);
            }).next(function(e2) {
              for (var n3 = [], r3 = [], s2 = un(), u = 0, a = o2; u < a.length; u++) {
                var c = a[u];
                n3.push(c.batchId);
                for (var h2 = 0, f = c.mutations; h2 < f.length; h2++) {
                  var l = f[h2];
                  s2 = s2.add(l.key);
                }
              }
              for (var d = 0, p2 = e2; d < p2.length; d++) {
                var y2 = p2[d];
                r3.push(y2.batchId);
                for (var v2 = 0, m = y2.mutations; v2 < m.length; v2++) {
                  var g = m[v2];
                  s2 = s2.add(g.key);
                }
              }
              return i.bn(t3, s2).next(function(t4) {
                return {
                  Wn: t4,
                  removedBatchIds: n3,
                  addedBatchIds: r3
                };
              });
            });
          })];
        case 1:
          return o = s.sent(), [2, (n2.Tn = r2, n2.Kn = i, n2.Ln.$n(n2.Kn), o)];
      }
    });
  });
}
__name(ji, "ji");
function Gi(t2, e) {
  var n2 = C(t2);
  return n2.persistence.runTransaction("Acknowledge batch", "readwrite-primary", function(t3) {
    var r2 = e.batch.keys(), i = n2.Qn.newChangeBuffer({
      trackRemovals: true
    });
    return function(t4, e2, n3, r3) {
      var i2 = n3.batch, o = i2.keys(), s = Er.resolve();
      return o.forEach(function(t5) {
        s = s.next(function() {
          return r3.getEntry(e2, t5);
        }).next(function(e3) {
          var o2 = e3, s2 = n3.docVersions.get(t5);
          k2(s2 !== null), (!o2 || o2.version.compareTo(s2) < 0) && ((o2 = i2.applyToRemoteDocument(t5, o2, n3)) && r3.addEntry(o2, n3.commitVersion));
        });
      }), s.next(function() {
        return t4.Tn.removeMutationBatch(e2, i2);
      });
    }(n2, t3, e, i).next(function() {
      return i.apply(t3);
    }).next(function() {
      return n2.Tn.performConsistencyCheck(t3);
    }).next(function() {
      return n2.Kn.bn(t3, r2);
    });
  });
}
__name(Gi, "Gi");
function Ki(t2) {
  var e = C(t2);
  return e.persistence.runTransaction("Get last remote snapshot version", "readonly", function(t3) {
    return e.Ge.getLastRemoteSnapshotVersion(t3);
  });
}
__name(Ki, "Ki");
function zi(t2, e) {
  var n2 = C(t2), r2 = e.snapshotVersion, i = n2.Bn;
  return n2.persistence.runTransaction("Apply remote event", "readwrite-primary", function(t3) {
    var o = n2.Qn.newChangeBuffer({
      trackRemovals: true
    });
    i = n2.Bn;
    var s = [];
    e.targetChanges.forEach(function(e2, o2) {
      var u2 = i.get(o2);
      if (u2) {
        s.push(n2.Ge.removeMatchingKeys(t3, e2.removedDocuments, o2).next(function() {
          return n2.Ge.addMatchingKeys(t3, e2.addedDocuments, o2);
        }));
        var a2 = e2.resumeToken;
        if (a2.approximateByteSize() > 0) {
          var c = u2.withResumeToken(a2, r2).withSequenceNumber(t3.currentSequenceNumber);
          i = i.insert(o2, c), function(t4, e3, n3) {
            return k2(e3.resumeToken.approximateByteSize() > 0), t4.resumeToken.approximateByteSize() === 0 || (e3.snapshotVersion.toMicroseconds() - t4.snapshotVersion.toMicroseconds() >= 3e8 || n3.addedDocuments.size + n3.modifiedDocuments.size + n3.removedDocuments.size > 0);
          }(u2, c, e2) && s.push(n2.Ge.updateTargetData(t3, c));
        }
      }
    });
    var u = Ze();
    if (e.documentUpdates.forEach(function(r3, i2) {
      e.resolvedLimboDocuments.has(r3) && s.push(n2.persistence.referenceDelegate.updateLimboDocument(t3, r3));
    }), s.push(Qi(t3, o, e.documentUpdates, r2, void 0).next(function(t4) {
      u = t4;
    })), !r2.isEqual(ie.min())) {
      var a = n2.Ge.getLastRemoteSnapshotVersion(t3).next(function(e2) {
        return n2.Ge.setTargetsMetadata(t3, t3.currentSequenceNumber, r2);
      });
      s.push(a);
    }
    return Er.waitFor(s).next(function() {
      return o.apply(t3);
    }).next(function() {
      return n2.Kn.vn(t3, u);
    });
  }).then(function(t3) {
    return n2.Bn = i, t3;
  });
}
__name(zi, "zi");
function Qi(t2, e, n2, r2, i) {
  var o = un();
  return n2.forEach(function(t3) {
    return o = o.add(t3);
  }), e.getEntries(t2, o).next(function(t3) {
    var o2 = Ze();
    return n2.forEach(function(n3, s) {
      var u = t3.get(n3), a = (i == null ? void 0 : i.get(n3)) || r2;
      s instanceof wt && s.version.isEqual(ie.min()) ? (e.removeEntry(n3, a), o2 = o2.insert(n3, s)) : u == null || s.version.compareTo(u.version) > 0 || s.version.compareTo(u.version) === 0 && u.hasPendingWrites ? (e.addEntry(s, a), o2 = o2.insert(n3, s)) : _("LocalStore", "Ignoring outdated watch update for ", n3, ". Current version:", u.version, " Watch version:", s.version);
    }), o2;
  });
}
__name(Qi, "Qi");
function Wi(t2, e) {
  var n2 = C(t2);
  return n2.persistence.runTransaction("Get next mutation batch", "readonly", function(t3) {
    return e === void 0 && (e = -1), n2.Tn.getNextMutationBatchAfterBatchId(t3, e);
  });
}
__name(Wi, "Wi");
function Hi(t2, e) {
  var n2 = C(t2);
  return n2.persistence.runTransaction("Allocate target", "readwrite", function(t3) {
    var r2;
    return n2.Ge.getTargetData(t3, e).next(function(i) {
      return i ? (r2 = i, Er.resolve(r2)) : n2.Ge.allocateTargetId(t3).next(function(i2) {
        return r2 = new Mr(e, i2, 0, t3.currentSequenceNumber), n2.Ge.addTargetData(t3, r2).next(function() {
          return r2;
        });
      });
    });
  }).then(function(t3) {
    var r2 = n2.Bn.get(t3.targetId);
    return (r2 === null || t3.snapshotVersion.compareTo(r2.snapshotVersion) > 0) && (n2.Bn = n2.Bn.insert(t3.targetId, t3), n2.qn.set(e, t3.targetId)), t3;
  });
}
__name(Hi, "Hi");
function Yi(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          r2 = C(t2), i = r2.Bn.get(e), o = n2 ? "readwrite" : "readwrite-primary", u.label = 1;
        case 1:
          return u.trys.push([1, 4, , 5]), n2 ? [3, 3] : [4, r2.persistence.runTransaction("Release target", o, function(t3) {
            return r2.persistence.referenceDelegate.removeTarget(t3, i);
          })];
        case 2:
          u.sent(), u.label = 3;
        case 3:
          return [3, 5];
        case 4:
          if (!Nr(s = u.sent()))
            throw s;
          return _("LocalStore", "Failed to update sequence numbers for target " + e + ": " + s), [3, 5];
        case 5:
          return r2.Bn = r2.Bn.remove(e), r2.qn.delete(i.target), [2];
      }
    });
  });
}
__name(Yi, "Yi");
function Ji(t2, e, n2) {
  var r2 = C(t2), i = ie.min(), o = un();
  return r2.persistence.runTransaction("Execute query", "readonly", function(t3) {
    return function(t4, e2, n3) {
      var r3 = C(t4), i2 = r3.qn.get(n3);
      return i2 !== void 0 ? Er.resolve(r3.Bn.get(i2)) : r3.Ge.getTargetData(e2, n3);
    }(r2, t3, Jt(e)).next(function(e2) {
      if (e2)
        return i = e2.lastLimboFreeSnapshotVersion, r2.Ge.getMatchingKeysForTargetId(t3, e2.targetId).next(function(t4) {
          o = t4;
        });
    }).next(function() {
      return r2.Ln.getDocumentsMatchingQuery(t3, e, n2 ? i : ie.min(), n2 ? o : un());
    }).next(function(t4) {
      return {
        documents: t4,
        jn: o
      };
    });
  });
}
__name(Ji, "Ji");
function Xi(t2, e) {
  var n2 = C(t2), r2 = C(n2.Ge), i = n2.Bn.get(e);
  return i ? Promise.resolve(i.target) : n2.persistence.runTransaction("Get target data", "readonly", function(t3) {
    return r2.yt(t3, e).next(function(t4) {
      return t4 ? t4.target : null;
    });
  });
}
__name(Xi, "Xi");
function $i(t2) {
  var e = C(t2);
  return e.persistence.runTransaction("Get new document changes", "readonly", function(t3) {
    return function(t4, e2, n2) {
      var r2 = C(t4), i = Ze(), o = Ur(n2), s = Ni(e2), u = IDBKeyRange.lowerBound(o, true);
      return s.qt({
        index: cr.readTimeIndex,
        range: u
      }, function(t5, e3) {
        var n3 = qr(r2.D, e3);
        i = i.insert(n3.key, n3), o = e3.readTime;
      }).next(function() {
        return {
          En: i,
          readTime: Br(o)
        };
      });
    }(e.Qn, t3, e.Un);
  }).then(function(t3) {
    var n2 = t3.En, r2 = t3.readTime;
    return e.Un = r2, n2;
  });
}
__name($i, "$i");
function Zi(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e;
    return __generator(this, function(n2) {
      return [2, (e = C(t2)).persistence.runTransaction("Synchronize last document change read time", "readonly", function(t3) {
        return function(t4) {
          var e2 = Ni(t4), n3 = ie.min();
          return e2.qt({
            index: cr.readTimeIndex,
            reverse: true
          }, function(t5, e3, r2) {
            e3.readTime && (n3 = Br(e3.readTime)), r2.done();
          }).next(function() {
            return n3;
          });
        }(t3);
      }).then(function(t3) {
        e.Un = t3;
      })];
    });
  });
}
__name(Zi, "Zi");
function to(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, s, u, a, c, h2, f, l, d;
    return __generator(this, function(p2) {
      switch (p2.label) {
        case 0:
          for (i = C(t2), o = un(), s = Ze(), u = on(), a = 0, c = n2; a < c.length; a++)
            h2 = c[a], f = e.Gn(h2.metadata.name), h2.document && (o = o.add(f)), s = s.insert(f, e.zn(h2)), u = u.insert(f, e.Hn(h2.metadata.readTime));
          return l = i.Qn.newChangeBuffer({
            trackRemovals: true
          }), [4, Hi(i, function(t3) {
            return Jt(Gt(z2.fromString("__bundle__/docs/" + t3)));
          }(r2))];
        case 1:
          return d = p2.sent(), [2, i.persistence.runTransaction("Apply bundle documents", "readwrite", function(t3) {
            return Qi(t3, l, s, ie.min(), u).next(function(e2) {
              return l.apply(t3), e2;
            }).next(function(e2) {
              return i.Ge.removeMatchingKeysForTargetId(t3, d.targetId).next(function() {
                return i.Ge.addMatchingKeys(t3, o, d.targetId);
              }).next(function() {
                return i.Kn.vn(t3, e2);
              });
            });
          })];
      }
    });
  });
}
__name(to, "to");
function eo(t2, e, n2) {
  return n2 === void 0 && (n2 = un()), __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return [4, Hi(t2, Jt(Wr(e.bundledQuery)))];
        case 1:
          return r2 = o.sent(), [2, (i = C(t2)).persistence.runTransaction("Save named query", "readwrite", function(t3) {
            var o2 = Sn(e.readTime);
            if (r2.snapshotVersion.compareTo(o2) >= 0)
              return i.He.saveNamedQuery(t3, e);
            var s = r2.withResumeToken(Y2.EMPTY_BYTE_STRING, o2);
            return i.Bn = i.Bn.insert(s.targetId, s), i.Ge.updateTargetData(t3, s).next(function() {
              return i.Ge.removeMatchingKeysForTargetId(t3, r2.targetId);
            }).next(function() {
              return i.Ge.addMatchingKeys(t3, n2, r2.targetId);
            }).next(function() {
              return i.He.saveNamedQuery(t3, e);
            });
          })];
      }
    });
  });
}
__name(eo, "eo");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var no = function() {
  function t2(t3) {
    this.D = t3, this.Jn = new Map(), this.Yn = new Map();
  }
  __name(t2, "t");
  return t2.prototype.getBundleMetadata = function(t3, e) {
    return Er.resolve(this.Jn.get(e));
  }, t2.prototype.saveBundleMetadata = function(t3, e) {
    var n2;
    return this.Jn.set(e.id, {
      id: (n2 = e).id,
      version: n2.version,
      createTime: Sn(n2.createTime)
    }), Er.resolve();
  }, t2.prototype.getNamedQuery = function(t3, e) {
    return Er.resolve(this.Yn.get(e));
  }, t2.prototype.saveNamedQuery = function(t3, e) {
    return this.Yn.set(e.name, function(t4) {
      return {
        name: t4.name,
        query: Wr(t4.bundledQuery),
        readTime: Sn(t4.readTime)
      };
    }(e)), Er.resolve();
  }, t2;
}();
var ro = function() {
  function t2() {
    this.Xn = new Je(io.Zn), this.ts = new Je(io.es);
  }
  __name(t2, "t");
  return t2.prototype.isEmpty = function() {
    return this.Xn.isEmpty();
  }, t2.prototype.addReference = function(t3, e) {
    var n2 = new io(t3, e);
    this.Xn = this.Xn.add(n2), this.ts = this.ts.add(n2);
  }, t2.prototype.ns = function(t3, e) {
    var n2 = this;
    t3.forEach(function(t4) {
      return n2.addReference(t4, e);
    });
  }, t2.prototype.removeReference = function(t3, e) {
    this.ss(new io(t3, e));
  }, t2.prototype.rs = function(t3, e) {
    var n2 = this;
    t3.forEach(function(t4) {
      return n2.removeReference(t4, e);
    });
  }, t2.prototype.os = function(t3) {
    var e = this, n2 = new H2(new z2([])), r2 = new io(n2, t3), i = new io(n2, t3 + 1), o = [];
    return this.ts.forEachInRange([r2, i], function(t4) {
      e.ss(t4), o.push(t4.key);
    }), o;
  }, t2.prototype.cs = function() {
    var t3 = this;
    this.Xn.forEach(function(e) {
      return t3.ss(e);
    });
  }, t2.prototype.ss = function(t3) {
    this.Xn = this.Xn.delete(t3), this.ts = this.ts.delete(t3);
  }, t2.prototype.us = function(t3) {
    var e = new H2(new z2([])), n2 = new io(e, t3), r2 = new io(e, t3 + 1), i = un();
    return this.ts.forEachInRange([n2, r2], function(t4) {
      i = i.add(t4.key);
    }), i;
  }, t2.prototype.containsKey = function(t3) {
    var e = new io(t3, 0), n2 = this.Xn.firstAfterOrEqual(e);
    return n2 !== null && t3.isEqual(n2.key);
  }, t2;
}();
var io = function() {
  function t2(t3, e) {
    this.key = t3, this.hs = e;
  }
  __name(t2, "t");
  return t2.Zn = function(t3, e) {
    return H2.comparator(t3.key, e.key) || R2(t3.hs, e.hs);
  }, t2.es = function(t3, e) {
    return R2(t3.hs, e.hs) || H2.comparator(t3.key, e.key);
  }, t2;
}();
var oo = function() {
  function t2(t3, e) {
    this.Gt = t3, this.referenceDelegate = e, this.Tn = [], this.ls = 1, this.fs = new Je(io.Zn);
  }
  __name(t2, "t");
  return t2.prototype.checkEmpty = function(t3) {
    return Er.resolve(this.Tn.length === 0);
  }, t2.prototype.addMutationBatch = function(t3, e, n2, r2) {
    var i = this.ls;
    this.ls++, this.Tn.length > 0 && this.Tn[this.Tn.length - 1];
    var o = new Or(i, e, n2, r2);
    this.Tn.push(o);
    for (var s = 0, u = r2; s < u.length; s++) {
      var a = u[s];
      this.fs = this.fs.add(new io(a.key, i)), this.Gt.addToCollectionParentIndex(t3, a.key.path.popLast());
    }
    return Er.resolve(o);
  }, t2.prototype.lookupMutationBatch = function(t3, e) {
    return Er.resolve(this.ds(e));
  }, t2.prototype.getNextMutationBatchAfterBatchId = function(t3, e) {
    var n2 = e + 1, r2 = this.ws(n2), i = r2 < 0 ? 0 : r2;
    return Er.resolve(this.Tn.length > i ? this.Tn[i] : null);
  }, t2.prototype.getHighestUnacknowledgedBatchId = function() {
    return Er.resolve(this.Tn.length === 0 ? -1 : this.ls - 1);
  }, t2.prototype.getAllMutationBatches = function(t3) {
    return Er.resolve(this.Tn.slice());
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKey = function(t3, e) {
    var n2 = this, r2 = new io(e, 0), i = new io(e, Number.POSITIVE_INFINITY), o = [];
    return this.fs.forEachInRange([r2, i], function(t4) {
      var e2 = n2.ds(t4.hs);
      o.push(e2);
    }), Er.resolve(o);
  }, t2.prototype.getAllMutationBatchesAffectingDocumentKeys = function(t3, e) {
    var n2 = this, r2 = new Je(R2);
    return e.forEach(function(t4) {
      var e2 = new io(t4, 0), i = new io(t4, Number.POSITIVE_INFINITY);
      n2.fs.forEachInRange([e2, i], function(t5) {
        r2 = r2.add(t5.hs);
      });
    }), Er.resolve(this._s(r2));
  }, t2.prototype.getAllMutationBatchesAffectingQuery = function(t3, e) {
    var n2 = e.path, r2 = n2.length + 1, i = n2;
    H2.isDocumentKey(i) || (i = i.child(""));
    var o = new io(new H2(i), 0), s = new Je(R2);
    return this.fs.forEachWhile(function(t4) {
      var e2 = t4.key.path;
      return !!n2.isPrefixOf(e2) && (e2.length === r2 && (s = s.add(t4.hs)), true);
    }, o), Er.resolve(this._s(s));
  }, t2.prototype._s = function(t3) {
    var e = this, n2 = [];
    return t3.forEach(function(t4) {
      var r2 = e.ds(t4);
      r2 !== null && n2.push(r2);
    }), n2;
  }, t2.prototype.removeMutationBatch = function(t3, e) {
    var n2 = this;
    k2(this.ys(e.batchId, "removed") === 0), this.Tn.shift();
    var r2 = this.fs;
    return Er.forEach(e.mutations, function(i) {
      var o = new io(i.key, e.batchId);
      return r2 = r2.delete(o), n2.referenceDelegate.markPotentiallyOrphaned(t3, i.key);
    }).next(function() {
      n2.fs = r2;
    });
  }, t2.prototype.Xt = function(t3) {
  }, t2.prototype.containsKey = function(t3, e) {
    var n2 = new io(e, 0), r2 = this.fs.firstAfterOrEqual(n2);
    return Er.resolve(e.isEqual(r2 && r2.key));
  }, t2.prototype.performConsistencyCheck = function(t3) {
    return this.Tn.length, Er.resolve();
  }, t2.prototype.ys = function(t3, e) {
    return this.ws(t3);
  }, t2.prototype.ws = function(t3) {
    return this.Tn.length === 0 ? 0 : t3 - this.Tn[0].batchId;
  }, t2.prototype.ds = function(t3) {
    var e = this.ws(t3);
    return e < 0 || e >= this.Tn.length ? null : this.Tn[e];
  }, t2;
}();
var so = function() {
  function t2(t3, e) {
    this.Gt = t3, this.gs = e, this.docs = new We(H2.comparator), this.size = 0;
  }
  __name(t2, "t");
  return t2.prototype.addEntry = function(t3, e, n2) {
    var r2 = e.key, i = this.docs.get(r2), o = i ? i.size : 0, s = this.gs(e);
    return this.docs = this.docs.insert(r2, {
      maybeDocument: e,
      size: s,
      readTime: n2
    }), this.size += s - o, this.Gt.addToCollectionParentIndex(t3, r2.path.popLast());
  }, t2.prototype.removeEntry = function(t3) {
    var e = this.docs.get(t3);
    e && (this.docs = this.docs.remove(t3), this.size -= e.size);
  }, t2.prototype.getEntry = function(t3, e) {
    var n2 = this.docs.get(e);
    return Er.resolve(n2 ? n2.maybeDocument : null);
  }, t2.prototype.getEntries = function(t3, e) {
    var n2 = this, r2 = tn();
    return e.forEach(function(t4) {
      var e2 = n2.docs.get(t4);
      r2 = r2.insert(t4, e2 ? e2.maybeDocument : null);
    }), Er.resolve(r2);
  }, t2.prototype.getDocumentsMatchingQuery = function(t3, e, n2) {
    for (var r2 = nn(), i = new H2(e.path.child("")), o = this.docs.getIteratorFrom(i); o.hasNext(); ) {
      var s = o.getNext(), u = s.key, a = s.value, c = a.maybeDocument, h2 = a.readTime;
      if (!e.path.isPrefixOf(u.path))
        break;
      h2.compareTo(n2) <= 0 || c instanceof gt && ee(e, c) && (r2 = r2.insert(c.key, c));
    }
    return Er.resolve(r2);
  }, t2.prototype.ps = function(t3, e) {
    return Er.forEach(this.docs, function(t4) {
      return e(t4);
    });
  }, t2.prototype.newChangeBuffer = function(t3) {
    return new uo(this);
  }, t2.prototype.getSize = function(t3) {
    return Er.resolve(this.size);
  }, t2;
}();
var uo = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).Ve = e2, n2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.applyChanges = function(t3) {
    var e2 = this, n2 = [];
    return this.changes.forEach(function(r2, i) {
      i && i.maybeDocument ? n2.push(e2.Ve.addEntry(t3, i.maybeDocument, e2.getReadTime(r2))) : e2.Ve.removeEntry(r2);
    }), Er.waitFor(n2);
  }, e.prototype.getFromCache = function(t3, e2) {
    return this.Ve.getEntry(t3, e2);
  }, e.prototype.getAllFromCache = function(t3, e2) {
    return this.Ve.getEntries(t3, e2);
  }, e;
}(Ti);
var ao = function() {
  function t2(t3) {
    this.persistence = t3, this.Es = new Ei(function(t4) {
      return Tt(t4);
    }, _t), this.lastRemoteSnapshotVersion = ie.min(), this.highestTargetId = 0, this.Ts = 0, this.Is = new ro(), this.targetCount = 0, this.As = hi.ee();
  }
  __name(t2, "t");
  return t2.prototype.forEachTarget = function(t3, e) {
    return this.Es.forEach(function(t4, n2) {
      return e(n2);
    }), Er.resolve();
  }, t2.prototype.getLastRemoteSnapshotVersion = function(t3) {
    return Er.resolve(this.lastRemoteSnapshotVersion);
  }, t2.prototype.getHighestSequenceNumber = function(t3) {
    return Er.resolve(this.Ts);
  }, t2.prototype.allocateTargetId = function(t3) {
    return this.highestTargetId = this.As.next(), Er.resolve(this.highestTargetId);
  }, t2.prototype.setTargetsMetadata = function(t3, e, n2) {
    return n2 && (this.lastRemoteSnapshotVersion = n2), e > this.Ts && (this.Ts = e), Er.resolve();
  }, t2.prototype.re = function(t3) {
    this.Es.set(t3.target, t3);
    var e = t3.targetId;
    e > this.highestTargetId && (this.As = new hi(e), this.highestTargetId = e), t3.sequenceNumber > this.Ts && (this.Ts = t3.sequenceNumber);
  }, t2.prototype.addTargetData = function(t3, e) {
    return this.re(e), this.targetCount += 1, Er.resolve();
  }, t2.prototype.updateTargetData = function(t3, e) {
    return this.re(e), Er.resolve();
  }, t2.prototype.removeTargetData = function(t3, e) {
    return this.Es.delete(e.target), this.Is.os(e.targetId), this.targetCount -= 1, Er.resolve();
  }, t2.prototype.removeTargets = function(t3, e, n2) {
    var r2 = this, i = 0, o = [];
    return this.Es.forEach(function(s, u) {
      u.sequenceNumber <= e && n2.get(u.targetId) === null && (r2.Es.delete(s), o.push(r2.removeMatchingKeysForTargetId(t3, u.targetId)), i++);
    }), Er.waitFor(o).next(function() {
      return i;
    });
  }, t2.prototype.getTargetCount = function(t3) {
    return Er.resolve(this.targetCount);
  }, t2.prototype.getTargetData = function(t3, e) {
    var n2 = this.Es.get(e) || null;
    return Er.resolve(n2);
  }, t2.prototype.addMatchingKeys = function(t3, e, n2) {
    return this.Is.ns(e, n2), Er.resolve();
  }, t2.prototype.removeMatchingKeys = function(t3, e, n2) {
    this.Is.rs(e, n2);
    var r2 = this.persistence.referenceDelegate, i = [];
    return r2 && e.forEach(function(e2) {
      i.push(r2.markPotentiallyOrphaned(t3, e2));
    }), Er.waitFor(i);
  }, t2.prototype.removeMatchingKeysForTargetId = function(t3, e) {
    return this.Is.os(e), Er.resolve();
  }, t2.prototype.getMatchingKeysForTargetId = function(t3, e) {
    var n2 = this.Is.us(e);
    return Er.resolve(n2);
  }, t2.prototype.containsKey = function(t3, e) {
    return Er.resolve(this.Is.containsKey(e));
  }, t2;
}();
var co = function() {
  function t2(t3, e) {
    var n2 = this;
    this.Rs = {}, this.Me = new I2(0), this.Le = false, this.Le = true, this.referenceDelegate = t3(this), this.Ge = new ao(this), this.Gt = new Xr(), this.ze = function(t4, e2) {
      return new so(t4, function(t5) {
        return n2.referenceDelegate.bs(t5);
      });
    }(this.Gt), this.D = new Fr(e), this.He = new no(this.D);
  }
  __name(t2, "t");
  return t2.prototype.start = function() {
    return Promise.resolve();
  }, t2.prototype.shutdown = function() {
    return this.Le = false, Promise.resolve();
  }, Object.defineProperty(t2.prototype, "started", {
    get: function() {
      return this.Le;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.setDatabaseDeletedListener = function() {
  }, t2.prototype.setNetworkEnabled = function() {
  }, t2.prototype.getIndexManager = function() {
    return this.Gt;
  }, t2.prototype.getMutationQueue = function(t3) {
    var e = this.Rs[t3.toKey()];
    return e || (e = new oo(this.Gt, this.referenceDelegate), this.Rs[t3.toKey()] = e), e;
  }, t2.prototype.getTargetCache = function() {
    return this.Ge;
  }, t2.prototype.getRemoteDocumentCache = function() {
    return this.ze;
  }, t2.prototype.getBundleCache = function() {
    return this.He;
  }, t2.prototype.runTransaction = function(t3, e, n2) {
    var r2 = this;
    _("MemoryPersistence", "Starting transaction:", t3);
    var i = new ho(this.Me.next());
    return this.referenceDelegate.vs(), n2(i).next(function(t4) {
      return r2.referenceDelegate.Ps(i).next(function() {
        return t4;
      });
    }).toPromise().then(function(t4) {
      return i.raiseOnCommittedEvent(), t4;
    });
  }, t2.prototype.Vs = function(t3, e) {
    return Er.or(Object.values(this.Rs).map(function(n2) {
      return function() {
        return n2.containsKey(t3, e);
      };
    }));
  }, t2;
}();
var ho = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).currentSequenceNumber = e2, n2;
  }
  __name(e, "e");
  return __extends(e, t2), e;
}(br);
var fo = function() {
  function t2(t3) {
    this.persistence = t3, this.Ss = new ro(), this.Ds = null;
  }
  __name(t2, "t");
  return t2.Cs = function(e) {
    return new t2(e);
  }, Object.defineProperty(t2.prototype, "xs", {
    get: function() {
      if (this.Ds)
        return this.Ds;
      throw A2();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.addReference = function(t3, e, n2) {
    return this.Ss.addReference(n2, e), this.xs.delete(n2.toString()), Er.resolve();
  }, t2.prototype.removeReference = function(t3, e, n2) {
    return this.Ss.removeReference(n2, e), this.xs.add(n2.toString()), Er.resolve();
  }, t2.prototype.markPotentiallyOrphaned = function(t3, e) {
    return this.xs.add(e.toString()), Er.resolve();
  }, t2.prototype.removeTarget = function(t3, e) {
    var n2 = this;
    this.Ss.os(e.targetId).forEach(function(t4) {
      return n2.xs.add(t4.toString());
    });
    var r2 = this.persistence.getTargetCache();
    return r2.getMatchingKeysForTargetId(t3, e.targetId).next(function(t4) {
      t4.forEach(function(t5) {
        return n2.xs.add(t5.toString());
      });
    }).next(function() {
      return r2.removeTargetData(t3, e);
    });
  }, t2.prototype.vs = function() {
    this.Ds = new Set();
  }, t2.prototype.Ps = function(t3) {
    var e = this, n2 = this.persistence.getRemoteDocumentCache().newChangeBuffer();
    return Er.forEach(this.xs, function(r2) {
      var i = H2.fromPath(r2);
      return e.Ns(t3, i).next(function(t4) {
        t4 || n2.removeEntry(i);
      });
    }).next(function() {
      return e.Ds = null, n2.apply(t3);
    });
  }, t2.prototype.updateLimboDocument = function(t3, e) {
    var n2 = this;
    return this.Ns(t3, e).next(function(t4) {
      t4 ? n2.xs.delete(e.toString()) : n2.xs.add(e.toString());
    });
  }, t2.prototype.bs = function(t3) {
    return 0;
  }, t2.prototype.Ns = function(t3, e) {
    var n2 = this;
    return Er.or([function() {
      return Er.resolve(n2.Ss.containsKey(e));
    }, function() {
      return n2.persistence.getTargetCache().containsKey(t3, e);
    }, function() {
      return n2.persistence.Vs(t3, e);
    }]);
  }, t2;
}();
var lo = function() {
  function t2(t3) {
    this.uid = t3;
  }
  __name(t2, "t");
  return t2.prototype.isAuthenticated = function() {
    return this.uid != null;
  }, t2.prototype.toKey = function() {
    return this.isAuthenticated() ? "uid:" + this.uid : "anonymous-user";
  }, t2.prototype.isEqual = function(t3) {
    return t3.uid === this.uid;
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function po(t2, e) {
  return "firestore_clients_" + t2 + "_" + e;
}
__name(po, "po");
function yo(t2, e, n2) {
  var r2 = "firestore_mutations_" + t2 + "_" + n2;
  return e.isAuthenticated() && (r2 += "_" + e.uid), r2;
}
__name(yo, "yo");
function vo(t2, e) {
  return "firestore_targets_" + t2 + "_" + e;
}
__name(vo, "vo");
lo.UNAUTHENTICATED = new lo(null), lo.GOOGLE_CREDENTIALS = new lo("google-credentials-uid"), lo.FIRST_PARTY = new lo("first-party-uid");
var mo = function() {
  function t2(t3, e, n2, r2) {
    this.user = t3, this.batchId = e, this.state = n2, this.error = r2;
  }
  __name(t2, "t");
  return t2.$s = function(e, n2, r2) {
    var i, o = JSON.parse(r2), s = typeof o == "object" && ["pending", "acknowledged", "rejected"].indexOf(o.state) !== -1 && (o.error === void 0 || typeof o.error == "object");
    return s && o.error && ((s = typeof o.error.message == "string" && typeof o.error.code == "string") && (i = new G2(o.error.code, o.error.message))), s ? new t2(e, n2, o.state, i) : (S2("SharedClientState", "Failed to parse mutation state for ID '" + n2 + "': " + r2), null);
  }, t2.prototype.Fs = function() {
    var t3 = {
      state: this.state,
      updateTimeMs: Date.now()
    };
    return this.error && (t3.error = {
      code: this.error.code,
      message: this.error.message
    }), JSON.stringify(t3);
  }, t2;
}();
var go = function() {
  function t2(t3, e, n2) {
    this.targetId = t3, this.state = e, this.error = n2;
  }
  __name(t2, "t");
  return t2.$s = function(e, n2) {
    var r2, i = JSON.parse(n2), o = typeof i == "object" && ["not-current", "current", "rejected"].indexOf(i.state) !== -1 && (i.error === void 0 || typeof i.error == "object");
    return o && i.error && ((o = typeof i.error.message == "string" && typeof i.error.code == "string") && (r2 = new G2(i.error.code, i.error.message))), o ? new t2(e, i.state, r2) : (S2("SharedClientState", "Failed to parse target state for ID '" + e + "': " + n2), null);
  }, t2.prototype.Fs = function() {
    var t3 = {
      state: this.state,
      updateTimeMs: Date.now()
    };
    return this.error && (t3.error = {
      code: this.error.code,
      message: this.error.message
    }), JSON.stringify(t3);
  }, t2;
}();
var wo = function() {
  function t2(t3, e) {
    this.clientId = t3, this.activeTargetIds = e;
  }
  __name(t2, "t");
  return t2.$s = function(e, n2) {
    for (var r2 = JSON.parse(n2), i = typeof r2 == "object" && r2.activeTargetIds instanceof Array, o = cn(), s = 0; i && s < r2.activeTargetIds.length; ++s)
      i = B(r2.activeTargetIds[s]), o = o.add(r2.activeTargetIds[s]);
    return i ? new t2(e, o) : (S2("SharedClientState", "Failed to parse client data for instance '" + e + "': " + n2), null);
  }, t2;
}();
var bo = function() {
  function t2(t3, e) {
    this.clientId = t3, this.onlineState = e;
  }
  __name(t2, "t");
  return t2.$s = function(e) {
    var n2 = JSON.parse(e);
    return typeof n2 == "object" && ["Unknown", "Online", "Offline"].indexOf(n2.onlineState) !== -1 && typeof n2.clientId == "string" ? new t2(n2.clientId, n2.onlineState) : (S2("SharedClientState", "Failed to parse online state: " + e), null);
  }, t2;
}();
var Io = function() {
  function t2() {
    this.activeTargetIds = cn();
  }
  __name(t2, "t");
  return t2.prototype.Os = function(t3) {
    this.activeTargetIds = this.activeTargetIds.add(t3);
  }, t2.prototype.ks = function(t3) {
    this.activeTargetIds = this.activeTargetIds.delete(t3);
  }, t2.prototype.Fs = function() {
    var t3 = {
      activeTargetIds: this.activeTargetIds.toArray(),
      updateTimeMs: Date.now()
    };
    return JSON.stringify(t3);
  }, t2;
}();
var Eo = function() {
  function t2(t3, e, n2, r2, i) {
    this.window = t3, this.Fe = e, this.persistenceKey = n2, this.Ms = r2, this.syncEngine = null, this.onlineStateHandler = null, this.sequenceNumberHandler = null, this.Ls = this.Bs.bind(this), this.qs = new We(R2), this.started = false, this.Us = [];
    var o = n2.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    this.storage = this.window.localStorage, this.currentUser = i, this.Qs = po(this.persistenceKey, this.Ms), this.Ks = function(t4) {
      return "firestore_sequence_number_" + t4;
    }(this.persistenceKey), this.qs = this.qs.insert(this.Ms, new Io()), this.Ws = new RegExp("^firestore_clients_" + o + "_([^_]*)$"), this.js = new RegExp("^firestore_mutations_" + o + "_(\\d+)(?:_(.*))?$"), this.Gs = new RegExp("^firestore_targets_" + o + "_(\\d+)$"), this.zs = function(t4) {
      return "firestore_online_state_" + t4;
    }(this.persistenceKey), this.Hs = function(t4) {
      return "firestore_bundle_loaded_" + t4;
    }(this.persistenceKey), this.window.addEventListener("storage", this.Ls);
  }
  __name(t2, "t");
  return t2.At = function(t3) {
    return !(!t3 || !t3.localStorage);
  }, t2.prototype.start = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i, o, s, u, a, c, h2, f = this;
      return __generator(this, function(l) {
        switch (l.label) {
          case 0:
            return [4, this.syncEngine.gn()];
          case 1:
            for (t3 = l.sent(), e = 0, n2 = t3; e < n2.length; e++)
              (r2 = n2[e]) !== this.Ms && (i = this.getItem(po(this.persistenceKey, r2))) && (o = wo.$s(r2, i)) && (this.qs = this.qs.insert(o.clientId, o));
            for (this.Js(), (s = this.storage.getItem(this.zs)) && (u = this.Ys(s)) && this.Xs(u), a = 0, c = this.Us; a < c.length; a++)
              h2 = c[a], this.Bs(h2);
            return this.Us = [], this.window.addEventListener("unload", function() {
              return f.shutdown();
            }), this.started = true, [2];
        }
      });
    });
  }, t2.prototype.writeSequenceNumber = function(t3) {
    this.setItem(this.Ks, JSON.stringify(t3));
  }, t2.prototype.getAllActiveQueryTargets = function() {
    return this.Zs(this.qs);
  }, t2.prototype.isActiveQueryTarget = function(t3) {
    var e = false;
    return this.qs.forEach(function(n2, r2) {
      r2.activeTargetIds.has(t3) && (e = true);
    }), e;
  }, t2.prototype.addPendingMutation = function(t3) {
    this.ti(t3, "pending");
  }, t2.prototype.updateMutationState = function(t3, e, n2) {
    this.ti(t3, e, n2), this.ei(t3);
  }, t2.prototype.addLocalQueryTarget = function(t3) {
    var e = "not-current";
    if (this.isActiveQueryTarget(t3)) {
      var n2 = this.storage.getItem(vo(this.persistenceKey, t3));
      if (n2) {
        var r2 = go.$s(t3, n2);
        r2 && (e = r2.state);
      }
    }
    return this.ni.Os(t3), this.Js(), e;
  }, t2.prototype.removeLocalQueryTarget = function(t3) {
    this.ni.ks(t3), this.Js();
  }, t2.prototype.isLocalQueryTarget = function(t3) {
    return this.ni.activeTargetIds.has(t3);
  }, t2.prototype.clearQueryState = function(t3) {
    this.removeItem(vo(this.persistenceKey, t3));
  }, t2.prototype.updateQueryState = function(t3, e, n2) {
    this.si(t3, e, n2);
  }, t2.prototype.handleUserChange = function(t3, e, n2) {
    var r2 = this;
    e.forEach(function(t4) {
      r2.ei(t4);
    }), this.currentUser = t3, n2.forEach(function(t4) {
      r2.addPendingMutation(t4);
    });
  }, t2.prototype.setOnlineState = function(t3) {
    this.ii(t3);
  }, t2.prototype.notifyBundleLoaded = function() {
    this.ri();
  }, t2.prototype.shutdown = function() {
    this.started && (this.window.removeEventListener("storage", this.Ls), this.removeItem(this.Qs), this.started = false);
  }, t2.prototype.getItem = function(t3) {
    var e = this.storage.getItem(t3);
    return _("SharedClientState", "READ", t3, e), e;
  }, t2.prototype.setItem = function(t3, e) {
    _("SharedClientState", "SET", t3, e), this.storage.setItem(t3, e);
  }, t2.prototype.removeItem = function(t3) {
    _("SharedClientState", "REMOVE", t3), this.storage.removeItem(t3);
  }, t2.prototype.Bs = function(t3) {
    var e = this, n2 = t3;
    if (n2.storageArea === this.storage) {
      if (_("SharedClientState", "EVENT", n2.key, n2.newValue), n2.key === this.Qs)
        return void S2("Received WebStorage notification for local change. Another client might have garbage-collected our state");
      this.Fe.enqueueRetryable(function() {
        return __awaiter(e, void 0, void 0, function() {
          var t4, e2, r2, i, o, s;
          return __generator(this, function(u) {
            if (this.started) {
              if (n2.key !== null) {
                if (this.Ws.test(n2.key)) {
                  if (n2.newValue == null)
                    return t4 = this.oi(n2.key), [2, this.ci(t4, null)];
                  if (e2 = this.ai(n2.key, n2.newValue))
                    return [2, this.ci(e2.clientId, e2)];
                } else if (this.js.test(n2.key)) {
                  if (n2.newValue !== null && (r2 = this.ui(n2.key, n2.newValue)))
                    return [2, this.hi(r2)];
                } else if (this.Gs.test(n2.key)) {
                  if (n2.newValue !== null && (i = this.li(n2.key, n2.newValue)))
                    return [2, this.fi(i)];
                } else if (n2.key === this.zs) {
                  if (n2.newValue !== null && (o = this.Ys(n2.newValue)))
                    return [2, this.Xs(o)];
                } else if (n2.key === this.Ks)
                  (s = function(t5) {
                    var e3 = I2.o;
                    if (t5 != null)
                      try {
                        var n3 = JSON.parse(t5);
                        k2(typeof n3 == "number"), e3 = n3;
                      } catch (t6) {
                        S2("SharedClientState", "Failed to read sequence number from WebStorage", t6);
                      }
                    return e3;
                  }(n2.newValue)) !== I2.o && this.sequenceNumberHandler(s);
                else if (n2.key === this.Hs)
                  return [2, this.syncEngine.di()];
              }
            } else
              this.Us.push(n2);
            return [2];
          });
        });
      });
    }
  }, Object.defineProperty(t2.prototype, "ni", {
    get: function() {
      return this.qs.get(this.Ms);
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Js = function() {
    this.setItem(this.Qs, this.ni.Fs());
  }, t2.prototype.ti = function(t3, e, n2) {
    var r2 = new mo(this.currentUser, t3, e, n2), i = yo(this.persistenceKey, this.currentUser, t3);
    this.setItem(i, r2.Fs());
  }, t2.prototype.ei = function(t3) {
    var e = yo(this.persistenceKey, this.currentUser, t3);
    this.removeItem(e);
  }, t2.prototype.ii = function(t3) {
    var e = {
      clientId: this.Ms,
      onlineState: t3
    };
    this.storage.setItem(this.zs, JSON.stringify(e));
  }, t2.prototype.si = function(t3, e, n2) {
    var r2 = vo(this.persistenceKey, t3), i = new go(t3, e, n2);
    this.setItem(r2, i.Fs());
  }, t2.prototype.ri = function() {
    this.setItem(this.Hs, "value-not-used");
  }, t2.prototype.oi = function(t3) {
    var e = this.Ws.exec(t3);
    return e ? e[1] : null;
  }, t2.prototype.ai = function(t3, e) {
    var n2 = this.oi(t3);
    return wo.$s(n2, e);
  }, t2.prototype.ui = function(t3, e) {
    var n2 = this.js.exec(t3), r2 = Number(n2[1]), i = n2[2] !== void 0 ? n2[2] : null;
    return mo.$s(new lo(i), r2, e);
  }, t2.prototype.li = function(t3, e) {
    var n2 = this.Gs.exec(t3), r2 = Number(n2[1]);
    return go.$s(r2, e);
  }, t2.prototype.Ys = function(t3) {
    return bo.$s(t3);
  }, t2.prototype.hi = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(e) {
        return t3.user.uid === this.currentUser.uid ? [2, this.syncEngine.wi(t3.batchId, t3.state, t3.error)] : (_("SharedClientState", "Ignoring mutation for non-active user " + t3.user.uid), [2]);
      });
    });
  }, t2.prototype.fi = function(t3) {
    return this.syncEngine._i(t3.targetId, t3.state, t3.error);
  }, t2.prototype.ci = function(t3, e) {
    var n2 = this, r2 = e ? this.qs.insert(t3, e) : this.qs.remove(t3), i = this.Zs(this.qs), o = this.Zs(r2), s = [], u = [];
    return o.forEach(function(t4) {
      i.has(t4) || s.push(t4);
    }), i.forEach(function(t4) {
      o.has(t4) || u.push(t4);
    }), this.syncEngine.mi(s, u).then(function() {
      n2.qs = r2;
    });
  }, t2.prototype.Xs = function(t3) {
    this.qs.get(t3.clientId) && this.onlineStateHandler(t3.onlineState);
  }, t2.prototype.Zs = function(t3) {
    var e = cn();
    return t3.forEach(function(t4, n2) {
      e = e.unionWith(n2.activeTargetIds);
    }), e;
  }, t2;
}();
var To = function() {
  function t2() {
    this.yi = new Io(), this.gi = {}, this.onlineStateHandler = null, this.sequenceNumberHandler = null;
  }
  __name(t2, "t");
  return t2.prototype.addPendingMutation = function(t3) {
  }, t2.prototype.updateMutationState = function(t3, e, n2) {
  }, t2.prototype.addLocalQueryTarget = function(t3) {
    return this.yi.Os(t3), this.gi[t3] || "not-current";
  }, t2.prototype.updateQueryState = function(t3, e, n2) {
    this.gi[t3] = e;
  }, t2.prototype.removeLocalQueryTarget = function(t3) {
    this.yi.ks(t3);
  }, t2.prototype.isLocalQueryTarget = function(t3) {
    return this.yi.activeTargetIds.has(t3);
  }, t2.prototype.clearQueryState = function(t3) {
    delete this.gi[t3];
  }, t2.prototype.getAllActiveQueryTargets = function() {
    return this.yi.activeTargetIds;
  }, t2.prototype.isActiveQueryTarget = function(t3) {
    return this.yi.activeTargetIds.has(t3);
  }, t2.prototype.start = function() {
    return this.yi = new Io(), Promise.resolve();
  }, t2.prototype.handleUserChange = function(t3, e, n2) {
  }, t2.prototype.setOnlineState = function(t3) {
  }, t2.prototype.shutdown = function() {
  }, t2.prototype.writeSequenceNumber = function(t3) {
  }, t2.prototype.notifyBundleLoaded = function() {
  }, t2;
}();
var _o = function() {
  function t2() {
  }
  __name(t2, "t");
  return t2.prototype.pi = function(t3) {
  }, t2.prototype.shutdown = function() {
  }, t2;
}();
var So = function() {
  function t2() {
    var t3 = this;
    this.Ei = function() {
      return t3.Ti();
    }, this.Ii = function() {
      return t3.Ai();
    }, this.Ri = [], this.bi();
  }
  __name(t2, "t");
  return t2.prototype.pi = function(t3) {
    this.Ri.push(t3);
  }, t2.prototype.shutdown = function() {
    window.removeEventListener("online", this.Ei), window.removeEventListener("offline", this.Ii);
  }, t2.prototype.bi = function() {
    window.addEventListener("online", this.Ei), window.addEventListener("offline", this.Ii);
  }, t2.prototype.Ti = function() {
    _("ConnectivityMonitor", "Network connectivity changed: AVAILABLE");
    for (var t3 = 0, e = this.Ri; t3 < e.length; t3++) {
      (0, e[t3])(0);
    }
  }, t2.prototype.Ai = function() {
    _("ConnectivityMonitor", "Network connectivity changed: UNAVAILABLE");
    for (var t3 = 0, e = this.Ri; t3 < e.length; t3++) {
      (0, e[t3])(1);
    }
  }, t2.At = function() {
    return typeof window != "undefined" && window.addEventListener !== void 0 && window.removeEventListener !== void 0;
  }, t2;
}();
var Do = {
  BatchGetDocuments: "batchGet",
  Commit: "commit",
  RunQuery: "runQuery"
};
var No = function() {
  function t2(t3) {
    this.vi = t3.vi, this.Pi = t3.Pi;
  }
  __name(t2, "t");
  return t2.prototype.Vi = function(t3) {
    this.Si = t3;
  }, t2.prototype.Di = function(t3) {
    this.Ci = t3;
  }, t2.prototype.onMessage = function(t3) {
    this.xi = t3;
  }, t2.prototype.close = function() {
    this.Pi();
  }, t2.prototype.send = function(t3) {
    this.vi(t3);
  }, t2.prototype.Ni = function() {
    this.Si();
  }, t2.prototype.$i = function(t3) {
    this.Ci(t3);
  }, t2.prototype.Fi = function(t3) {
    this.xi(t3);
  }, t2;
}();
var Ao = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this, e2) || this).forceLongPolling = e2.forceLongPolling, n2.autoDetectLongPolling = e2.autoDetectLongPolling, n2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.qi = function(t3, e2, n2, r2) {
    return new Promise(function(i, o) {
      var s = new XhrIo();
      s.listenOnce(EventType.COMPLETE, function() {
        try {
          switch (s.getLastErrorCode()) {
            case ErrorCode.NO_ERROR:
              var e3 = s.getResponseJson();
              _("Connection", "XHR received:", JSON.stringify(e3)), i(e3);
              break;
            case ErrorCode.TIMEOUT:
              _("Connection", 'RPC "' + t3 + '" timed out'), o(new G2(j.DEADLINE_EXCEEDED, "Request time out"));
              break;
            case ErrorCode.HTTP_ERROR:
              var n3 = s.getStatus();
              if (_("Connection", 'RPC "' + t3 + '" failed with status:', n3, "response text:", s.getResponseText()), n3 > 0) {
                var r3 = s.getResponseJson().error;
                if (r3 && r3.status && r3.message) {
                  var u2 = function(t4) {
                    var e4 = t4.toLowerCase().replace(/_/g, "-");
                    return Object.values(j).indexOf(e4) >= 0 ? e4 : j.UNKNOWN;
                  }(r3.status);
                  o(new G2(u2, r3.message));
                } else
                  o(new G2(j.UNKNOWN, "Server responded with status " + s.getStatus()));
              } else
                o(new G2(j.UNAVAILABLE, "Connection failed."));
              break;
            default:
              A2();
          }
        } finally {
          _("Connection", 'RPC "' + t3 + '" completed.');
        }
      });
      var u = JSON.stringify(r2);
      s.send(e2, "POST", u, n2, 15);
    });
  }, e.prototype.Qi = function(t3, e2) {
    var n2 = [this.Oi, "/", "google.firestore.v1.Firestore", "/", t3, "/channel"], c = createWebChannelTransport(), h2 = getStatEventTarget(), f = {
      httpSessionIdParam: "gsessionid",
      initMessageHeaders: {},
      messageUrlParams: {
        database: "projects/" + this.databaseId.projectId + "/databases/" + this.databaseId.database
      },
      sendRawJson: true,
      supportsCrossDomainXhr: true,
      internalChannelParams: {
        forwardChannelRequestTimeoutMs: 6e5
      },
      forceLongPolling: this.forceLongPolling,
      detectBufferingProxy: this.autoDetectLongPolling
    };
    this.Bi(f.initMessageHeaders, e2), isMobileCordova() || isReactNative() || isElectron() || isIE() || isUWP() || isBrowserExtension() || (f.httpHeadersOverwriteParam = "$httpHeaders");
    var m = n2.join("");
    _("Connection", "Creating WebChannel: " + m, f);
    var g = c.createWebChannel(m, f), w2 = false, b = false, I3 = new No({
      vi: function(t4) {
        b ? _("Connection", "Not sending because WebChannel is closed:", t4) : (w2 || (_("Connection", "Opening WebChannel transport."), g.open(), w2 = true), _("Connection", "WebChannel sending:", t4), g.send(t4));
      },
      Pi: function() {
        return g.close();
      }
    }), E3 = /* @__PURE__ */ __name(function(t4, e3, n3) {
      t4.listen(e3, function(t5) {
        try {
          n3(t5);
        } catch (t6) {
          setTimeout(function() {
            throw t6;
          }, 0);
        }
      });
    }, "E");
    return E3(g, WebChannel.EventType.OPEN, function() {
      b || _("Connection", "WebChannel transport opened.");
    }), E3(g, WebChannel.EventType.CLOSE, function() {
      b || (b = true, _("Connection", "WebChannel transport closed"), I3.$i());
    }), E3(g, WebChannel.EventType.ERROR, function(t4) {
      b || (b = true, D2("Connection", "WebChannel transport errored:", t4), I3.$i(new G2(j.UNAVAILABLE, "The operation could not be completed")));
    }), E3(g, WebChannel.EventType.MESSAGE, function(t4) {
      var e3;
      if (!b) {
        var n3 = t4.data[0];
        k2(!!n3);
        var r2 = n3, i = r2.error || ((e3 = r2[0]) === null || e3 === void 0 ? void 0 : e3.error);
        if (i) {
          _("Connection", "WebChannel received error:", i);
          var o = i.status, s = function(t5) {
            var e4 = Ue[t5];
            if (e4 !== void 0)
              return Qe(e4);
          }(o), u = i.message;
          s === void 0 && (s = j.INTERNAL, u = "Unknown error status: " + o + " with message " + i.message), b = true, I3.$i(new G2(s, u)), g.close();
        } else
          _("Connection", "WebChannel received:", n3), I3.Fi(n3);
      }
    }), E3(h2, Event.STAT_EVENT, function(t4) {
      t4.stat === Stat.PROXY ? _("Connection", "Detected buffering proxy") : t4.stat === Stat.NOPROXY && _("Connection", "Detected no buffering proxy");
    }), setTimeout(function() {
      I3.Ni();
    }, 0), I3;
  }, e;
}(function() {
  function t2(t3) {
    this.databaseInfo = t3, this.databaseId = t3.databaseId;
    var e = t3.ssl ? "https" : "http";
    this.Oi = e + "://" + t3.host, this.ki = "projects/" + this.databaseId.projectId + "/databases/" + this.databaseId.database + "/documents";
  }
  __name(t2, "t");
  return t2.prototype.Mi = function(t3, e, n2, r2) {
    var i = this.Li(t3, e);
    _("RestConnection", "Sending: ", i, n2);
    var o = {};
    return this.Bi(o, r2), this.qi(t3, i, o, n2).then(function(t4) {
      return _("RestConnection", "Received: ", t4), t4;
    }, function(e2) {
      throw D2("RestConnection", t3 + " failed with error: ", e2, "url: ", i, "request:", n2), e2;
    });
  }, t2.prototype.Ui = function(t3, e, n2, r2) {
    return this.Mi(t3, e, n2, r2);
  }, t2.prototype.Bi = function(t3, e) {
    if (t3["X-Goog-Api-Client"] = "gl-js/ fire/8.3.1", t3["Content-Type"] = "text/plain", e)
      for (var n2 in e.authHeaders)
        e.authHeaders.hasOwnProperty(n2) && (t3[n2] = e.authHeaders[n2]);
  }, t2.prototype.Li = function(t3, e) {
    var n2 = Do[t3];
    return this.Oi + "/v1/" + e + ":" + n2;
  }, t2;
}());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ko() {
  return typeof window != "undefined" ? window : null;
}
__name(ko, "ko");
function Co() {
  return typeof document != "undefined" ? document : null;
}
__name(Co, "Co");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function xo(t2) {
  return new In(t2, true);
}
__name(xo, "xo");
var Lo = function() {
  function t2(t3, e, n2, r2, i) {
    n2 === void 0 && (n2 = 1e3), r2 === void 0 && (r2 = 1.5), i === void 0 && (i = 6e4), this.Fe = t3, this.timerId = e, this.Ki = n2, this.Wi = r2, this.ji = i, this.Gi = 0, this.zi = null, this.Hi = Date.now(), this.reset();
  }
  __name(t2, "t");
  return t2.prototype.reset = function() {
    this.Gi = 0;
  }, t2.prototype.Ji = function() {
    this.Gi = this.ji;
  }, t2.prototype.Yi = function(t3) {
    var e = this;
    this.cancel();
    var n2 = Math.floor(this.Gi + this.Xi()), r2 = Math.max(0, Date.now() - this.Hi), i = Math.max(0, n2 - r2);
    i > 0 && _("ExponentialBackoff", "Backing off for " + i + " ms (base delay: " + this.Gi + " ms, delay with jitter: " + n2 + " ms, last attempt: " + r2 + " ms ago)"), this.zi = this.Fe.enqueueAfterDelay(this.timerId, i, function() {
      return e.Hi = Date.now(), t3();
    }), this.Gi *= this.Wi, this.Gi < this.Ki && (this.Gi = this.Ki), this.Gi > this.ji && (this.Gi = this.ji);
  }, t2.prototype.Zi = function() {
    this.zi !== null && (this.zi.skipDelay(), this.zi = null);
  }, t2.prototype.cancel = function() {
    this.zi !== null && (this.zi.cancel(), this.zi = null);
  }, t2.prototype.Xi = function() {
    return (Math.random() - 0.5) * this.Gi;
  }, t2;
}();
var Ro = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.Fe = t3, this.tr = n2, this.er = r2, this.nr = i, this.listener = o, this.state = 0, this.sr = 0, this.ir = null, this.stream = null, this.rr = new Lo(t3, e);
  }
  __name(t2, "t");
  return t2.prototype.cr = function() {
    return this.state === 1 || this.state === 2 || this.state === 4;
  }, t2.prototype.ar = function() {
    return this.state === 2;
  }, t2.prototype.start = function() {
    this.state !== 3 ? this.auth() : this.ur();
  }, t2.prototype.stop = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.cr() ? [4, this.close(0)] : [3, 2];
          case 1:
            t3.sent(), t3.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.hr = function() {
    this.state = 0, this.rr.reset();
  }, t2.prototype.lr = function() {
    var t3 = this;
    this.ar() && this.ir === null && (this.ir = this.Fe.enqueueAfterDelay(this.tr, 6e4, function() {
      return t3.dr();
    }));
  }, t2.prototype.wr = function(t3) {
    this._r(), this.stream.send(t3);
  }, t2.prototype.dr = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return this.ar() ? [2, this.close(0)] : [2];
      });
    });
  }, t2.prototype._r = function() {
    this.ir && (this.ir.cancel(), this.ir = null);
  }, t2.prototype.close = function(t3, e) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this._r(), this.rr.cancel(), this.sr++, t3 !== 3 ? this.rr.reset() : e && e.code === j.RESOURCE_EXHAUSTED ? (S2(e.toString()), S2("Using maximum backoff delay to prevent overloading the backend."), this.rr.Ji()) : e && e.code === j.UNAUTHENTICATED && this.nr.invalidateToken(), this.stream !== null && (this.mr(), this.stream.close(), this.stream = null), this.state = t3, [4, this.listener.Di(e)];
          case 1:
            return n2.sent(), [2];
        }
      });
    });
  }, t2.prototype.mr = function() {
  }, t2.prototype.auth = function() {
    var t3 = this;
    this.state = 1;
    var e = this.yr(this.sr), n2 = this.sr;
    this.nr.getToken().then(function(e2) {
      t3.sr === n2 && t3.gr(e2);
    }, function(n3) {
      e(function() {
        var e2 = new G2(j.UNKNOWN, "Fetching auth token failed: " + n3.message);
        return t3.pr(e2);
      });
    });
  }, t2.prototype.gr = function(t3) {
    var e = this, n2 = this.yr(this.sr);
    this.stream = this.Er(t3), this.stream.Vi(function() {
      n2(function() {
        return e.state = 2, e.listener.Vi();
      });
    }), this.stream.Di(function(t4) {
      n2(function() {
        return e.pr(t4);
      });
    }), this.stream.onMessage(function(t4) {
      n2(function() {
        return e.onMessage(t4);
      });
    });
  }, t2.prototype.ur = function() {
    var t3 = this;
    this.state = 4, this.rr.Yi(function() {
      return __awaiter(t3, void 0, void 0, function() {
        return __generator(this, function(t4) {
          return this.state = 0, this.start(), [2];
        });
      });
    });
  }, t2.prototype.pr = function(t3) {
    return _("PersistentStream", "close with error: " + t3), this.stream = null, this.close(3, t3);
  }, t2.prototype.yr = function(t3) {
    var e = this;
    return function(n2) {
      e.Fe.enqueueAndForget(function() {
        return e.sr === t3 ? n2() : (_("PersistentStream", "stream callback skipped by getCloseGuardedDispatcher."), Promise.resolve());
      });
    };
  }, t2;
}();
var Oo = function(t2) {
  function e(e2, n2, r2, i, o) {
    var s = this;
    return (s = t2.call(this, e2, "listen_stream_connection_backoff", "listen_stream_idle", n2, r2, o) || this).D = i, s;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.Er = function(t3) {
    return this.er.Qi("Listen", t3);
  }, e.prototype.onMessage = function(t3) {
    this.rr.reset();
    var e2 = function(t4, e3) {
      var n3;
      if ("targetChange" in e3) {
        e3.targetChange;
        var r2 = function(t5) {
          return t5 === "NO_CHANGE" ? 0 : t5 === "ADD" ? 1 : t5 === "REMOVE" ? 2 : t5 === "CURRENT" ? 3 : t5 === "RESET" ? 4 : A2();
        }(e3.targetChange.targetChangeType || "NO_CHANGE"), i = e3.targetChange.targetIds || [], o = function(t5, e4) {
          return t5.V ? (k2(e4 === void 0 || typeof e4 == "string"), Y2.fromBase64String(e4 || "")) : (k2(e4 === void 0 || e4 instanceof Uint8Array), Y2.fromUint8Array(e4 || new Uint8Array()));
        }(t4, e3.targetChange.resumeToken), s = (u = e3.targetChange.cause) && function(t5) {
          var e4 = t5.code === void 0 ? j.UNKNOWN : Qe(t5.code);
          return new G2(e4, t5.message || "");
        }(u);
        n3 = new pn(r2, i, o, s || null);
      } else if ("documentChange" in e3) {
        e3.documentChange, (r2 = e3.documentChange).document, r2.document.name, r2.document.updateTime, i = kn(t4, r2.document.name), o = Sn(r2.document.updateTime);
        var u = new se({
          mapValue: {
            fields: r2.document.fields
          }
        }), a = (s = new gt(i, o, u, {}), r2.targetIds || []), c = r2.removedTargetIds || [];
        n3 = new ln(a, c, s.key, s);
      } else if ("documentDelete" in e3)
        e3.documentDelete, (r2 = e3.documentDelete).document, i = kn(t4, r2.document), o = r2.readTime ? Sn(r2.readTime) : ie.min(), u = new wt(i, o), s = r2.removedTargetIds || [], n3 = new ln([], s, u.key, u);
      else if ("documentRemove" in e3)
        e3.documentRemove, (r2 = e3.documentRemove).document, i = kn(t4, r2.document), o = r2.removedTargetIds || [], n3 = new ln([], o, i, null);
      else {
        if (!("filter" in e3))
          return A2();
        e3.filter;
        var h2 = e3.filter;
        h2.targetId, r2 = h2.count || 0, i = new Ke(r2), o = h2.targetId, n3 = new dn(o, i);
      }
      return n3;
    }(this.D, t3), n2 = function(t4) {
      if (!("targetChange" in t4))
        return ie.min();
      var e3 = t4.targetChange;
      return e3.targetIds && e3.targetIds.length ? ie.min() : e3.readTime ? Sn(e3.readTime) : ie.min();
    }(t3);
    return this.listener.Tr(e2, n2);
  }, e.prototype.Ir = function(t3) {
    var e2 = {};
    e2.database = Ln(this.D), e2.addTarget = function(t4, e3) {
      var n3, r2 = e3.target;
      return (n3 = St(r2) ? {
        documents: qn(t4, r2)
      } : {
        query: Vn(t4, r2)
      }).targetId = e3.targetId, e3.resumeToken.approximateByteSize() > 0 ? n3.resumeToken = Tn(t4, e3.resumeToken) : e3.snapshotVersion.compareTo(ie.min()) > 0 && (n3.readTime = En(t4, e3.snapshotVersion.toTimestamp())), n3;
    }(this.D, t3);
    var n2 = function(t4, e3) {
      var n3 = function(t5, e4) {
        switch (e4) {
          case 0:
            return null;
          case 1:
            return "existence-filter-mismatch";
          case 2:
            return "limbo-document";
          default:
            return A2();
        }
      }(0, e3.purpose);
      return n3 == null ? null : {
        "goog-listen-tags": n3
      };
    }(this.D, t3);
    n2 && (e2.labels = n2), this.wr(e2);
  }, e.prototype.Ar = function(t3) {
    var e2 = {};
    e2.database = Ln(this.D), e2.removeTarget = t3, this.wr(e2);
  }, e;
}(Ro);
var Po = function(t2) {
  function e(e2, n2, r2, i, o) {
    var s = this;
    return (s = t2.call(this, e2, "write_stream_connection_backoff", "write_stream_idle", n2, r2, o) || this).D = i, s.Rr = false, s;
  }
  __name(e, "e");
  return __extends(e, t2), Object.defineProperty(e.prototype, "br", {
    get: function() {
      return this.Rr;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.start = function() {
    this.Rr = false, this.lastStreamToken = void 0, t2.prototype.start.call(this);
  }, e.prototype.mr = function() {
    this.Rr && this.vr([]);
  }, e.prototype.Er = function(t3) {
    return this.er.Qi("Write", t3);
  }, e.prototype.onMessage = function(t3) {
    if (k2(!!t3.streamToken), this.lastStreamToken = t3.streamToken, this.Rr) {
      this.rr.reset();
      var e2 = function(t4, e3) {
        return t4 && t4.length > 0 ? (k2(e3 !== void 0), t4.map(function(t5) {
          return function(t6, e4) {
            var n3 = t6.updateTime ? Sn(t6.updateTime) : Sn(e4);
            return n3.isEqual(ie.min()) && (n3 = Sn(e4)), new Se(n3, t6.transformResults || []);
          }(t5, e3);
        })) : [];
      }(t3.writeResults, t3.commitTime), n2 = Sn(t3.commitTime);
      return this.listener.Pr(n2, e2);
    }
    return k2(!t3.writeResults || t3.writeResults.length === 0), this.Rr = true, this.listener.Vr();
  }, e.prototype.Sr = function() {
    var t3 = {};
    t3.database = Ln(this.D), this.wr(t3);
  }, e.prototype.vr = function(t3) {
    var e2 = this, n2 = {
      streamToken: this.lastStreamToken,
      writes: t3.map(function(t4) {
        return Mn(e2.D, t4);
      })
    };
    this.wr(n2);
  }, e;
}(Ro);
var Mo = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).credentials = e2, i.er = n2, i.D = r2, i.Dr = false, i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.Cr = function() {
    if (this.Dr)
      throw new G2(j.FAILED_PRECONDITION, "The client has already been terminated.");
  }, e.prototype.Mi = function(t3, e2, n2) {
    var r2 = this;
    return this.Cr(), this.credentials.getToken().then(function(i) {
      return r2.er.Mi(t3, e2, n2, i);
    }).catch(function(t4) {
      throw t4.code === j.UNAUTHENTICATED && r2.credentials.invalidateToken(), t4;
    });
  }, e.prototype.Ui = function(t3, e2, n2) {
    var r2 = this;
    return this.Cr(), this.credentials.getToken().then(function(i) {
      return r2.er.Ui(t3, e2, n2, i);
    }).catch(function(t4) {
      throw t4.code === j.UNAUTHENTICATED && r2.credentials.invalidateToken(), t4;
    });
  }, e.prototype.terminate = function() {
    this.Dr = false;
  }, e;
}(function() {
});
var Fo = function() {
  function t2(t3, e) {
    this.asyncQueue = t3, this.onlineStateHandler = e, this.state = "Unknown", this.Nr = 0, this.$r = null, this.Fr = true;
  }
  __name(t2, "t");
  return t2.prototype.Or = function() {
    var t3 = this;
    this.Nr === 0 && (this.kr("Unknown"), this.$r = this.asyncQueue.enqueueAfterDelay("online_state_timeout", 1e4, function() {
      return t3.$r = null, t3.Mr("Backend didn't respond within 10 seconds."), t3.kr("Offline"), Promise.resolve();
    }));
  }, t2.prototype.Lr = function(t3) {
    this.state === "Online" ? this.kr("Unknown") : (this.Nr++, this.Nr >= 1 && (this.Br(), this.Mr("Connection failed 1 times. Most recent error: " + t3.toString()), this.kr("Offline")));
  }, t2.prototype.set = function(t3) {
    this.Br(), this.Nr = 0, t3 === "Online" && (this.Fr = false), this.kr(t3);
  }, t2.prototype.kr = function(t3) {
    t3 !== this.state && (this.state = t3, this.onlineStateHandler(t3));
  }, t2.prototype.Mr = function(t3) {
    var e = "Could not reach Cloud Firestore backend. " + t3 + "\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";
    this.Fr ? (S2(e), this.Fr = false) : _("OnlineStateTracker", e);
  }, t2.prototype.Br = function() {
    this.$r !== null && (this.$r.cancel(), this.$r = null);
  }, t2;
}();
var qo = /* @__PURE__ */ __name(function(t2, e, n2, r2, i) {
  var o = this;
  this.localStore = t2, this.datastore = e, this.asyncQueue = n2, this.remoteSyncer = {}, this.qr = [], this.Ur = new Map(), this.Qr = new Set(), this.Kr = [], this.Wr = i, this.Wr.pi(function(t3) {
    n2.enqueueAndForget(function() {
      return __awaiter(o, void 0, void 0, function() {
        return __generator(this, function(t4) {
          switch (t4.label) {
            case 0:
              return Wo(this) ? (_("RemoteStore", "Restarting streams for network reachability change."), [4, function(t5) {
                return __awaiter(this, void 0, void 0, function() {
                  var e2;
                  return __generator(this, function(n3) {
                    switch (n3.label) {
                      case 0:
                        return (e2 = C(t5)).Qr.add(4), [4, Uo(e2)];
                      case 1:
                        return n3.sent(), e2.jr.set("Unknown"), e2.Qr.delete(4), [4, Vo(e2)];
                      case 2:
                        return n3.sent(), [2];
                    }
                  });
                });
              }(this)]) : [3, 2];
            case 1:
              t4.sent(), t4.label = 2;
            case 2:
              return [2];
          }
        });
      });
    });
  }), this.jr = new Fo(n2, r2);
}, "qo");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Vo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          if (!Wo(t2))
            return [3, 4];
          e = 0, n2 = t2.Kr, r2.label = 1;
        case 1:
          return e < n2.length ? [4, (0, n2[e])(true)] : [3, 4];
        case 2:
          r2.sent(), r2.label = 3;
        case 3:
          return e++, [3, 1];
        case 4:
          return [2];
      }
    });
  });
}
__name(Vo, "Vo");
function Uo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          e = 0, n2 = t2.Kr, r2.label = 1;
        case 1:
          return e < n2.length ? [4, (0, n2[e])(false)] : [3, 4];
        case 2:
          r2.sent(), r2.label = 3;
        case 3:
          return e++, [3, 1];
        case 4:
          return [2];
      }
    });
  });
}
__name(Uo, "Uo");
function Bo(t2, e) {
  var n2 = C(t2);
  n2.Ur.has(e.targetId) || (n2.Ur.set(e.targetId, e), Qo(n2) ? zo(n2) : as(n2).ar() && Go(n2, e));
}
__name(Bo, "Bo");
function jo(t2, e) {
  var n2 = C(t2), r2 = as(n2);
  n2.Ur.delete(e), r2.ar() && Ko(n2, e), n2.Ur.size === 0 && (r2.ar() ? r2.lr() : Wo(n2) && n2.jr.set("Unknown"));
}
__name(jo, "jo");
function Go(t2, e) {
  t2.Gr.H(e.targetId), as(t2).Ir(e);
}
__name(Go, "Go");
function Ko(t2, e) {
  t2.Gr.H(e), as(t2).Ar(e);
}
__name(Ko, "Ko");
function zo(t2) {
  t2.Gr = new vn({
    getRemoteKeysForTarget: function(e) {
      return t2.remoteSyncer.getRemoteKeysForTarget(e);
    },
    yt: function(e) {
      return t2.Ur.get(e) || null;
    }
  }), as(t2).start(), t2.jr.Or();
}
__name(zo, "zo");
function Qo(t2) {
  return Wo(t2) && !as(t2).cr() && t2.Ur.size > 0;
}
__name(Qo, "Qo");
function Wo(t2) {
  return C(t2).Qr.size === 0;
}
__name(Wo, "Wo");
function Ho(t2) {
  t2.Gr = void 0;
}
__name(Ho, "Ho");
function Yo(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      return t2.Ur.forEach(function(e2, n2) {
        Go(t2, e2);
      }), [2];
    });
  });
}
__name(Yo, "Yo");
function Jo(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(n2) {
      return Ho(t2), Qo(t2) ? (t2.jr.Lr(e), zo(t2)) : t2.jr.set("Unknown"), [2];
    });
  });
}
__name(Jo, "Jo");
function Xo(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          if (t2.jr.set("Online"), !(e instanceof pn && e.state === 2 && e.cause))
            return [3, 6];
          s.label = 1;
        case 1:
          return s.trys.push([1, 3, , 5]), [
            4,
            function(t3, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r3, i2, o2;
                return __generator(this, function(s2) {
                  switch (s2.label) {
                    case 0:
                      n3 = e2.cause, r3 = 0, i2 = e2.targetIds, s2.label = 1;
                    case 1:
                      return r3 < i2.length ? (o2 = i2[r3], t3.Ur.has(o2) ? [4, t3.remoteSyncer.rejectListen(o2, n3)] : [3, 3]) : [3, 5];
                    case 2:
                      s2.sent(), t3.Ur.delete(o2), t3.Gr.removeTarget(o2), s2.label = 3;
                    case 3:
                      s2.label = 4;
                    case 4:
                      return r3++, [3, 1];
                    case 5:
                      return [2];
                  }
                });
              });
            }(t2, e)
          ];
        case 2:
          return s.sent(), [3, 5];
        case 3:
          return r2 = s.sent(), _("RemoteStore", "Failed to remove targets %s: %s ", e.targetIds.join(","), r2), [4, $o(t2, r2)];
        case 4:
          return s.sent(), [3, 5];
        case 5:
          return [3, 13];
        case 6:
          if (e instanceof ln ? t2.Gr.st(e) : e instanceof dn ? t2.Gr.ht(e) : t2.Gr.ot(e), n2.isEqual(ie.min()))
            return [3, 13];
          s.label = 7;
        case 7:
          return s.trys.push([7, 11, , 13]), [4, Ki(t2.localStore)];
        case 8:
          return i = s.sent(), n2.compareTo(i) >= 0 ? [
            4,
            function(t3, e2) {
              var n3 = t3.Gr.dt(e2);
              return n3.targetChanges.forEach(function(n4, r3) {
                if (n4.resumeToken.approximateByteSize() > 0) {
                  var i2 = t3.Ur.get(r3);
                  i2 && t3.Ur.set(r3, i2.withResumeToken(n4.resumeToken, e2));
                }
              }), n3.targetMismatches.forEach(function(e3) {
                var n4 = t3.Ur.get(e3);
                if (n4) {
                  t3.Ur.set(e3, n4.withResumeToken(Y2.EMPTY_BYTE_STRING, n4.snapshotVersion)), Ko(t3, e3);
                  var r3 = new Mr(n4.target, e3, 1, n4.sequenceNumber);
                  Go(t3, r3);
                }
              }), t3.remoteSyncer.applyRemoteEvent(n3);
            }(t2, n2)
          ] : [3, 10];
        case 9:
          s.sent(), s.label = 10;
        case 10:
          return [3, 13];
        case 11:
          return _("RemoteStore", "Failed to raise snapshot:", o = s.sent()), [4, $o(t2, o)];
        case 12:
          return s.sent(), [3, 13];
        case 13:
          return [2];
      }
    });
  });
}
__name(Xo, "Xo");
function $o(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2 = this;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          if (!Nr(e))
            throw e;
          return t2.Qr.add(1), [4, Uo(t2)];
        case 1:
          return i.sent(), t2.jr.set("Offline"), n2 || (n2 = /* @__PURE__ */ __name(function() {
            return Ki(t2.localStore);
          }, "n")), t2.asyncQueue.enqueueRetryable(function() {
            return __awaiter(r2, void 0, void 0, function() {
              return __generator(this, function(e2) {
                switch (e2.label) {
                  case 0:
                    return _("RemoteStore", "Retrying IndexedDB access"), [4, n2()];
                  case 1:
                    return e2.sent(), t2.Qr.delete(1), [4, Vo(t2)];
                  case 2:
                    return e2.sent(), [2];
                }
              });
            });
          }), [2];
      }
    });
  });
}
__name($o, "$o");
function Zo(t2, e) {
  return e().catch(function(n2) {
    return $o(t2, n2, e);
  });
}
__name(Zo, "Zo");
function ts(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2, r2, i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          e = C(t2), n2 = cs(e), r2 = e.qr.length > 0 ? e.qr[e.qr.length - 1].batchId : -1, s.label = 1;
        case 1:
          if (!function(t3) {
            return Wo(t3) && t3.qr.length < 10;
          }(e))
            return [3, 7];
          s.label = 2;
        case 2:
          return s.trys.push([2, 4, , 6]), [4, Wi(e.localStore, r2)];
        case 3:
          return (i = s.sent()) === null ? (e.qr.length === 0 && n2.lr(), [3, 7]) : (r2 = i.batchId, function(t3, e2) {
            t3.qr.push(e2);
            var n3 = cs(t3);
            n3.ar() && n3.br && n3.vr(e2.mutations);
          }(e, i), [3, 6]);
        case 4:
          return o = s.sent(), [4, $o(e, o)];
        case 5:
          return s.sent(), [3, 6];
        case 6:
          return [3, 1];
        case 7:
          return es(e) && ns(e), [2];
      }
    });
  });
}
__name(ts, "ts");
function es(t2) {
  return Wo(t2) && !cs(t2).cr() && t2.qr.length > 0;
}
__name(es, "es");
function ns(t2) {
  cs(t2).start();
}
__name(ns, "ns");
function rs(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      return cs(t2).Sr(), [2];
    });
  });
}
__name(rs, "rs");
function is(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2, r2, i;
    return __generator(this, function(o) {
      for (e = cs(t2), n2 = 0, r2 = t2.qr; n2 < r2.length; n2++)
        i = r2[n2], e.vr(i.mutations);
      return [2];
    });
  });
}
__name(is, "is");
function os(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return r2 = t2.qr.shift(), i = Pr.from(r2, e, n2), [4, Zo(t2, function() {
            return t2.remoteSyncer.applySuccessfulWrite(i);
          })];
        case 1:
          return o.sent(), [4, ts(t2)];
        case 2:
          return o.sent(), [2];
      }
    });
  });
}
__name(os, "os");
function ss(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(n2) {
      switch (n2.label) {
        case 0:
          return e && cs(t2).br ? [4, function(t3, e2) {
            return __awaiter(this, void 0, void 0, function() {
              var n3, r2;
              return __generator(this, function(i) {
                switch (i.label) {
                  case 0:
                    return ze(r2 = e2.code) && r2 !== j.ABORTED ? (n3 = t3.qr.shift(), cs(t3).hr(), [4, Zo(t3, function() {
                      return t3.remoteSyncer.rejectFailedWrite(n3.batchId, e2);
                    })]) : [3, 3];
                  case 1:
                    return i.sent(), [4, ts(t3)];
                  case 2:
                    i.sent(), i.label = 3;
                  case 3:
                    return [2];
                }
              });
            });
          }(t2, e)] : [3, 2];
        case 1:
          n2.sent(), n2.label = 2;
        case 2:
          return es(t2) && ns(t2), [2];
      }
    });
  });
}
__name(ss, "ss");
function us(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return n2 = C(t2), e ? (n2.Qr.delete(2), [4, Vo(n2)]) : [3, 2];
        case 1:
          return i.sent(), [3, 5];
        case 2:
          return (r2 = e) ? [3, 4] : (n2.Qr.add(2), [4, Uo(n2)]);
        case 3:
          i.sent(), r2 = n2.jr.set("Unknown"), i.label = 4;
        case 4:
          r2, i.label = 5;
        case 5:
          return [2];
      }
    });
  });
}
__name(us, "us");
function as(t2) {
  var e = this;
  return t2.zr || (t2.zr = function(t3, e2, n2) {
    var r2 = C(t3);
    return r2.Cr(), new Oo(e2, r2.er, r2.credentials, r2.D, n2);
  }(t2.datastore, t2.asyncQueue, {
    Vi: Yo.bind(null, t2),
    Di: Jo.bind(null, t2),
    Tr: Xo.bind(null, t2)
  }), t2.Kr.push(function(n2) {
    return __awaiter(e, void 0, void 0, function() {
      return __generator(this, function(e2) {
        switch (e2.label) {
          case 0:
            return n2 ? (t2.zr.hr(), Qo(t2) ? zo(t2) : t2.jr.set("Unknown"), [3, 3]) : [3, 1];
          case 1:
            return [4, t2.zr.stop()];
          case 2:
            e2.sent(), Ho(t2), e2.label = 3;
          case 3:
            return [2];
        }
      });
    });
  })), t2.zr;
}
__name(as, "as");
function cs(t2) {
  var e = this;
  return t2.Hr || (t2.Hr = function(t3, e2, n2) {
    var r2 = C(t3);
    return r2.Cr(), new Po(e2, r2.er, r2.credentials, r2.D, n2);
  }(t2.datastore, t2.asyncQueue, {
    Vi: rs.bind(null, t2),
    Di: ss.bind(null, t2),
    Vr: is.bind(null, t2),
    Pr: os.bind(null, t2)
  }), t2.Kr.push(function(n2) {
    return __awaiter(e, void 0, void 0, function() {
      return __generator(this, function(e2) {
        switch (e2.label) {
          case 0:
            return n2 ? (t2.Hr.hr(), [4, ts(t2)]) : [3, 2];
          case 1:
            return e2.sent(), [3, 4];
          case 2:
            return [4, t2.Hr.stop()];
          case 3:
            e2.sent(), t2.qr.length > 0 && (_("RemoteStore", "Stopping write stream with " + t2.qr.length + " pending writes"), t2.qr = []), e2.label = 4;
          case 4:
            return [2];
        }
      });
    });
  })), t2.Hr;
}
__name(cs, "cs");
var hs = function() {
  function t2(t3, e, n2, r2, i) {
    this.asyncQueue = t3, this.timerId = e, this.targetTimeMs = n2, this.op = r2, this.removalCallback = i, this.deferred = new Ir(), this.then = this.deferred.promise.then.bind(this.deferred.promise), this.deferred.promise.catch(function(t4) {
    });
  }
  __name(t2, "t");
  return t2.createAndSchedule = function(e, n2, r2, i, o) {
    var s = new t2(e, n2, Date.now() + r2, i, o);
    return s.start(r2), s;
  }, t2.prototype.start = function(t3) {
    var e = this;
    this.timerHandle = setTimeout(function() {
      return e.handleDelayElapsed();
    }, t3);
  }, t2.prototype.skipDelay = function() {
    return this.handleDelayElapsed();
  }, t2.prototype.cancel = function(t3) {
    this.timerHandle !== null && (this.clearTimeout(), this.deferred.reject(new G2(j.CANCELLED, "Operation cancelled" + (t3 ? ": " + t3 : ""))));
  }, t2.prototype.handleDelayElapsed = function() {
    var t3 = this;
    this.asyncQueue.enqueueAndForget(function() {
      return t3.timerHandle !== null ? (t3.clearTimeout(), t3.op().then(function(e) {
        return t3.deferred.resolve(e);
      })) : Promise.resolve();
    });
  }, t2.prototype.clearTimeout = function() {
    this.timerHandle !== null && (this.removalCallback(this), clearTimeout(this.timerHandle), this.timerHandle = null);
  }, t2;
}();
function fs(t2, e) {
  if (S2("AsyncQueue", e + ": " + t2), Nr(t2))
    return new G2(j.UNAVAILABLE, e + ": " + t2);
  throw t2;
}
__name(fs, "fs");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ls = function() {
  function t2(t3) {
    this.comparator = t3 ? function(e, n2) {
      return t3(e, n2) || H2.comparator(e.key, n2.key);
    } : function(t4, e) {
      return H2.comparator(t4.key, e.key);
    }, this.keyedMap = nn(), this.sortedSet = new We(this.comparator);
  }
  __name(t2, "t");
  return t2.emptySet = function(e) {
    return new t2(e.comparator);
  }, t2.prototype.has = function(t3) {
    return this.keyedMap.get(t3) != null;
  }, t2.prototype.get = function(t3) {
    return this.keyedMap.get(t3);
  }, t2.prototype.first = function() {
    return this.sortedSet.minKey();
  }, t2.prototype.last = function() {
    return this.sortedSet.maxKey();
  }, t2.prototype.isEmpty = function() {
    return this.sortedSet.isEmpty();
  }, t2.prototype.indexOf = function(t3) {
    var e = this.keyedMap.get(t3);
    return e ? this.sortedSet.indexOf(e) : -1;
  }, Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this.sortedSet.size;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.forEach = function(t3) {
    this.sortedSet.inorderTraversal(function(e, n2) {
      return t3(e), false;
    });
  }, t2.prototype.add = function(t3) {
    var e = this.delete(t3.key);
    return e.copy(e.keyedMap.insert(t3.key, t3), e.sortedSet.insert(t3, null));
  }, t2.prototype.delete = function(t3) {
    var e = this.get(t3);
    return e ? this.copy(this.keyedMap.remove(t3), this.sortedSet.remove(e)) : this;
  }, t2.prototype.isEqual = function(e) {
    if (!(e instanceof t2))
      return false;
    if (this.size !== e.size)
      return false;
    for (var n2 = this.sortedSet.getIterator(), r2 = e.sortedSet.getIterator(); n2.hasNext(); ) {
      var i = n2.getNext().key, o = r2.getNext().key;
      if (!i.isEqual(o))
        return false;
    }
    return true;
  }, t2.prototype.toString = function() {
    var t3 = [];
    return this.forEach(function(e) {
      t3.push(e.toString());
    }), t3.length === 0 ? "DocumentSet ()" : "DocumentSet (\n  " + t3.join("  \n") + "\n)";
  }, t2.prototype.copy = function(e, n2) {
    var r2 = new t2();
    return r2.comparator = this.comparator, r2.keyedMap = e, r2.sortedSet = n2, r2;
  }, t2;
}();
var ds = function() {
  function t2() {
    this.Jr = new We(H2.comparator);
  }
  __name(t2, "t");
  return t2.prototype.track = function(t3) {
    var e = t3.doc.key, n2 = this.Jr.get(e);
    n2 ? t3.type !== 0 && n2.type === 3 ? this.Jr = this.Jr.insert(e, t3) : t3.type === 3 && n2.type !== 1 ? this.Jr = this.Jr.insert(e, {
      type: n2.type,
      doc: t3.doc
    }) : t3.type === 2 && n2.type === 2 ? this.Jr = this.Jr.insert(e, {
      type: 2,
      doc: t3.doc
    }) : t3.type === 2 && n2.type === 0 ? this.Jr = this.Jr.insert(e, {
      type: 0,
      doc: t3.doc
    }) : t3.type === 1 && n2.type === 0 ? this.Jr = this.Jr.remove(e) : t3.type === 1 && n2.type === 2 ? this.Jr = this.Jr.insert(e, {
      type: 1,
      doc: n2.doc
    }) : t3.type === 0 && n2.type === 1 ? this.Jr = this.Jr.insert(e, {
      type: 2,
      doc: t3.doc
    }) : A2() : this.Jr = this.Jr.insert(e, t3);
  }, t2.prototype.Yr = function() {
    var t3 = [];
    return this.Jr.inorderTraversal(function(e, n2) {
      t3.push(n2);
    }), t3;
  }, t2;
}();
var ps = function() {
  function t2(t3, e, n2, r2, i, o, s, u) {
    this.query = t3, this.docs = e, this.oldDocs = n2, this.docChanges = r2, this.mutatedKeys = i, this.fromCache = o, this.syncStateChanged = s, this.excludesMetadataChanges = u;
  }
  __name(t2, "t");
  return t2.fromInitialDocuments = function(e, n2, r2, i) {
    var o = [];
    return n2.forEach(function(t3) {
      o.push({
        type: 0,
        doc: t3
      });
    }), new t2(e, n2, ls.emptySet(n2), o, r2, i, true, false);
  }, Object.defineProperty(t2.prototype, "hasPendingWrites", {
    get: function() {
      return !this.mutatedKeys.isEmpty();
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    if (!(this.fromCache === t3.fromCache && this.syncStateChanged === t3.syncStateChanged && this.mutatedKeys.isEqual(t3.mutatedKeys) && $t(this.query, t3.query) && this.docs.isEqual(t3.docs) && this.oldDocs.isEqual(t3.oldDocs)))
      return false;
    var e = this.docChanges, n2 = t3.docChanges;
    if (e.length !== n2.length)
      return false;
    for (var r2 = 0; r2 < e.length; r2++)
      if (e[r2].type !== n2[r2].type || !e[r2].doc.isEqual(n2[r2].doc))
        return false;
    return true;
  }, t2;
}();
var ys = /* @__PURE__ */ __name(function() {
  this.Xr = void 0, this.listeners = [];
}, "ys");
var vs = /* @__PURE__ */ __name(function() {
  this.queries = new Ei(function(t2) {
    return Zt(t2);
  }, $t), this.onlineState = "Unknown", this.Zr = new Set();
}, "vs");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ms(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s, u, a;
    return __generator(this, function(c) {
      switch (c.label) {
        case 0:
          if (n2 = C(t2), r2 = e.query, i = false, (o = n2.queries.get(r2)) || (i = true, o = new ys()), !i)
            return [3, 4];
          c.label = 1;
        case 1:
          return c.trys.push([1, 3, , 4]), s = o, [4, n2.onListen(r2)];
        case 2:
          return s.Xr = c.sent(), [3, 4];
        case 3:
          return u = c.sent(), a = fs(u, "Initialization of query '" + te(e.query) + "' failed"), [2, void e.onError(a)];
        case 4:
          return n2.queries.set(r2, o), o.listeners.push(e), e.eo(n2.onlineState), o.Xr && e.no(o.Xr) && Is(n2), [2];
      }
    });
  });
}
__name(ms, "ms");
function gs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s;
    return __generator(this, function(u) {
      return n2 = C(t2), r2 = e.query, i = false, (o = n2.queries.get(r2)) && (s = o.listeners.indexOf(e)) >= 0 && (o.listeners.splice(s, 1), i = o.listeners.length === 0), i ? [2, (n2.queries.delete(r2), n2.onUnlisten(r2))] : [2];
    });
  });
}
__name(gs, "gs");
function ws(t2, e) {
  for (var n2 = C(t2), r2 = false, i = 0, o = e; i < o.length; i++) {
    var s = o[i], u = s.query, a = n2.queries.get(u);
    if (a) {
      for (var c = 0, h2 = a.listeners; c < h2.length; c++) {
        h2[c].no(s) && (r2 = true);
      }
      a.Xr = s;
    }
  }
  r2 && Is(n2);
}
__name(ws, "ws");
function bs(t2, e, n2) {
  var r2 = C(t2), i = r2.queries.get(e);
  if (i)
    for (var o = 0, s = i.listeners; o < s.length; o++) {
      s[o].onError(n2);
    }
  r2.queries.delete(e);
}
__name(bs, "bs");
function Is(t2) {
  t2.Zr.forEach(function(t3) {
    t3.next();
  });
}
__name(Is, "Is");
var Es = function() {
  function t2(t3, e, n2) {
    this.query = t3, this.so = e, this.io = false, this.ro = null, this.onlineState = "Unknown", this.options = n2 || {};
  }
  __name(t2, "t");
  return t2.prototype.no = function(t3) {
    if (!this.options.includeMetadataChanges) {
      for (var e = [], n2 = 0, r2 = t3.docChanges; n2 < r2.length; n2++) {
        var i = r2[n2];
        i.type !== 3 && e.push(i);
      }
      t3 = new ps(t3.query, t3.docs, t3.oldDocs, e, t3.mutatedKeys, t3.fromCache, t3.syncStateChanged, true);
    }
    var o = false;
    return this.io ? this.oo(t3) && (this.so.next(t3), o = true) : this.co(t3, this.onlineState) && (this.ao(t3), o = true), this.ro = t3, o;
  }, t2.prototype.onError = function(t3) {
    this.so.error(t3);
  }, t2.prototype.eo = function(t3) {
    this.onlineState = t3;
    var e = false;
    return this.ro && !this.io && this.co(this.ro, t3) && (this.ao(this.ro), e = true), e;
  }, t2.prototype.co = function(t3, e) {
    if (!t3.fromCache)
      return true;
    var n2 = e !== "Offline";
    return !(this.options.uo && n2 || t3.docs.isEmpty() && e !== "Offline");
  }, t2.prototype.oo = function(t3) {
    if (t3.docChanges.length > 0)
      return true;
    var e = this.ro && this.ro.hasPendingWrites !== t3.hasPendingWrites;
    return !(!t3.syncStateChanged && !e) && this.options.includeMetadataChanges === true;
  }, t2.prototype.ao = function(t3) {
    t3 = ps.fromInitialDocuments(t3.query, t3.docs, t3.mutatedKeys, t3.fromCache), this.io = true, this.so.next(t3);
  }, t2;
}();
var Ts = function() {
  function t2(t3, e) {
    this.payload = t3, this.byteLength = e;
  }
  __name(t2, "t");
  return t2.prototype.ho = function() {
    return "metadata" in this.payload;
  }, t2;
}();
var _s = function() {
  function t2(t3) {
    this.D = t3;
  }
  __name(t2, "t");
  return t2.prototype.Gn = function(t3) {
    return kn(this.D, t3);
  }, t2.prototype.zn = function(t3) {
    return t3.metadata.exists ? Pn(this.D, t3.document, false) : new wt(this.Gn(t3.metadata.name), this.Hn(t3.metadata.readTime));
  }, t2.prototype.Hn = function(t3) {
    return Sn(t3);
  }, t2;
}();
var Ss = function() {
  function t2(t3, e, n2) {
    this.lo = t3, this.localStore = e, this.D = n2, this.queries = [], this.documents = [], this.progress = Ds(t3);
  }
  __name(t2, "t");
  return t2.prototype.fo = function(t3) {
    this.progress.bytesLoaded += t3.byteLength;
    var e = this.progress.documentsLoaded;
    return t3.payload.namedQuery ? this.queries.push(t3.payload.namedQuery) : t3.payload.documentMetadata ? (this.documents.push({
      metadata: t3.payload.documentMetadata
    }), t3.payload.documentMetadata.exists || ++e) : t3.payload.document && (this.documents[this.documents.length - 1].document = t3.payload.document, ++e), e !== this.progress.documentsLoaded ? (this.progress.documentsLoaded = e, Object.assign({}, this.progress)) : null;
  }, t2.prototype.wo = function(t3) {
    for (var e = new Map(), n2 = new _s(this.D), r2 = 0, i = t3; r2 < i.length; r2++) {
      var o = i[r2];
      if (o.metadata.queries)
        for (var s = n2.Gn(o.metadata.name), u = 0, a = o.metadata.queries; u < a.length; u++) {
          var c = a[u], h2 = (e.get(c) || un()).add(s);
          e.set(c, h2);
        }
    }
    return e;
  }, t2.prototype.complete = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2, i;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return [4, to(this.localStore, new _s(this.D), this.documents, this.lo.id)];
          case 1:
            t3 = o.sent(), e = this.wo(this.documents), n2 = 0, r2 = this.queries, o.label = 2;
          case 2:
            return n2 < r2.length ? (i = r2[n2], [4, eo(this.localStore, i, e.get(i.name))]) : [3, 5];
          case 3:
            o.sent(), o.label = 4;
          case 4:
            return n2++, [3, 2];
          case 5:
            return [2, (this.progress.taskState = "Success", new Mi(Object.assign({}, this.progress), t3))];
        }
      });
    });
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ds(t2) {
  return {
    taskState: "Running",
    documentsLoaded: 0,
    bytesLoaded: 0,
    totalDocuments: t2.totalDocuments,
    totalBytes: t2.totalBytes
  };
}
__name(Ds, "Ds");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ns = /* @__PURE__ */ __name(function(t2) {
  this.key = t2;
}, "Ns");
var As = /* @__PURE__ */ __name(function(t2) {
  this.key = t2;
}, "As");
var ks = function() {
  function t2(t3, e) {
    this.query = t3, this._o = e, this.mo = null, this.current = false, this.yo = un(), this.mutatedKeys = un(), this.po = ne(t3), this.Eo = new ls(this.po);
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "To", {
    get: function() {
      return this._o;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Io = function(t3, e) {
    var n2 = this, r2 = e ? e.Ao : new ds(), i = e ? e.Eo : this.Eo, o = e ? e.mutatedKeys : this.mutatedKeys, s = i, u = false, a = Kt(this.query) && i.size === this.query.limit ? i.last() : null, c = zt(this.query) && i.size === this.query.limit ? i.first() : null;
    if (t3.inorderTraversal(function(t4, e2) {
      var h3 = i.get(t4), f = e2 instanceof gt ? e2 : null;
      f && (f = ee(n2.query, f) ? f : null);
      var l = !!h3 && n2.mutatedKeys.has(h3.key), d = !!f && (f.hasLocalMutations || n2.mutatedKeys.has(f.key) && f.hasCommittedMutations), p2 = false;
      h3 && f ? h3.data().isEqual(f.data()) ? l !== d && (r2.track({
        type: 3,
        doc: f
      }), p2 = true) : n2.Ro(h3, f) || (r2.track({
        type: 2,
        doc: f
      }), p2 = true, (a && n2.po(f, a) > 0 || c && n2.po(f, c) < 0) && (u = true)) : !h3 && f ? (r2.track({
        type: 0,
        doc: f
      }), p2 = true) : h3 && !f && (r2.track({
        type: 1,
        doc: h3
      }), p2 = true, (a || c) && (u = true)), p2 && (f ? (s = s.add(f), o = d ? o.add(t4) : o.delete(t4)) : (s = s.delete(t4), o = o.delete(t4)));
    }), Kt(this.query) || zt(this.query))
      for (; s.size > this.query.limit; ) {
        var h2 = Kt(this.query) ? s.last() : s.first();
        s = s.delete(h2.key), o = o.delete(h2.key), r2.track({
          type: 1,
          doc: h2
        });
      }
    return {
      Eo: s,
      Ao: r2,
      Mn: u,
      mutatedKeys: o
    };
  }, t2.prototype.Ro = function(t3, e) {
    return t3.hasLocalMutations && e.hasCommittedMutations && !e.hasLocalMutations;
  }, t2.prototype.applyChanges = function(t3, e, n2) {
    var r2 = this, i = this.Eo;
    this.Eo = t3.Eo, this.mutatedKeys = t3.mutatedKeys;
    var o = t3.Ao.Yr();
    o.sort(function(t4, e2) {
      return function(t5, e3) {
        var n3 = /* @__PURE__ */ __name(function(t6) {
          switch (t6) {
            case 0:
              return 1;
            case 2:
            case 3:
              return 2;
            case 1:
              return 0;
            default:
              return A2();
          }
        }, "n");
        return n3(t5) - n3(e3);
      }(t4.type, e2.type) || r2.po(t4.doc, e2.doc);
    }), this.bo(n2);
    var s = e ? this.vo() : [], u = this.yo.size === 0 && this.current ? 1 : 0, a = u !== this.mo;
    return this.mo = u, o.length !== 0 || a ? {
      snapshot: new ps(this.query, t3.Eo, i, o, t3.mutatedKeys, u === 0, a, false),
      Po: s
    } : {
      Po: s
    };
  }, t2.prototype.eo = function(t3) {
    return this.current && t3 === "Offline" ? (this.current = false, this.applyChanges({
      Eo: this.Eo,
      Ao: new ds(),
      mutatedKeys: this.mutatedKeys,
      Mn: false
    }, false)) : {
      Po: []
    };
  }, t2.prototype.Vo = function(t3) {
    return !this._o.has(t3) && !!this.Eo.has(t3) && !this.Eo.get(t3).hasLocalMutations;
  }, t2.prototype.bo = function(t3) {
    var e = this;
    t3 && (t3.addedDocuments.forEach(function(t4) {
      return e._o = e._o.add(t4);
    }), t3.modifiedDocuments.forEach(function(t4) {
    }), t3.removedDocuments.forEach(function(t4) {
      return e._o = e._o.delete(t4);
    }), this.current = t3.current);
  }, t2.prototype.vo = function() {
    var t3 = this;
    if (!this.current)
      return [];
    var e = this.yo;
    this.yo = un(), this.Eo.forEach(function(e2) {
      t3.Vo(e2.key) && (t3.yo = t3.yo.add(e2.key));
    });
    var n2 = [];
    return e.forEach(function(e2) {
      t3.yo.has(e2) || n2.push(new As(e2));
    }), this.yo.forEach(function(t4) {
      e.has(t4) || n2.push(new Ns(t4));
    }), n2;
  }, t2.prototype.So = function(t3) {
    this._o = t3.jn, this.yo = un();
    var e = this.Io(t3.documents);
    return this.applyChanges(e, true);
  }, t2.prototype.Do = function() {
    return ps.fromInitialDocuments(this.query, this.Eo, this.mutatedKeys, this.mo === 0);
  }, t2;
}();
var Cs = /* @__PURE__ */ __name(function(t2, e, n2) {
  this.query = t2, this.targetId = e, this.view = n2;
}, "Cs");
var xs = /* @__PURE__ */ __name(function(t2) {
  this.key = t2, this.Co = false;
}, "xs");
var Ls = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.localStore = t3, this.remoteStore = e, this.eventManager = n2, this.sharedClientState = r2, this.currentUser = i, this.maxConcurrentLimboResolutions = o, this.xo = {}, this.No = new Ei(function(t4) {
      return Zt(t4);
    }, $t), this.$o = new Map(), this.Fo = new Set(), this.Oo = new We(H2.comparator), this.ko = new Map(), this.Mo = new ro(), this.Lo = {}, this.Bo = new Map(), this.qo = hi.ne(), this.onlineState = "Unknown", this.Uo = void 0;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "isPrimaryClient", {
    get: function() {
      return this.Uo === true;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
function Rs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s, u;
    return __generator(this, function(a) {
      switch (a.label) {
        case 0:
          return n2 = au(t2), (o = n2.No.get(e)) ? (r2 = o.targetId, n2.sharedClientState.addLocalQueryTarget(r2), i = o.view.Do(), [3, 4]) : [3, 1];
        case 1:
          return [4, Hi(n2.localStore, Jt(e))];
        case 2:
          return s = a.sent(), u = n2.sharedClientState.addLocalQueryTarget(s.targetId), r2 = s.targetId, [4, Os(n2, e, r2, u === "current")];
        case 3:
          i = a.sent(), n2.isPrimaryClient && Bo(n2.remoteStore, s), a.label = 4;
        case 4:
          return [2, i];
      }
    });
  });
}
__name(Rs, "Rs");
function Os(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, s, u, a, c;
    return __generator(this, function(h2) {
      switch (h2.label) {
        case 0:
          return t2.Qo = function(e2, n3, r3) {
            return function(t3, e3, n4, r4) {
              return __awaiter(this, void 0, void 0, function() {
                var i2, o2, s2;
                return __generator(this, function(u2) {
                  switch (u2.label) {
                    case 0:
                      return i2 = e3.view.Io(n4), i2.Mn ? [4, Ji(t3.localStore, e3.query, false).then(function(t4) {
                        var n5 = t4.documents;
                        return e3.view.Io(n5, i2);
                      })] : [3, 2];
                    case 1:
                      i2 = u2.sent(), u2.label = 2;
                    case 2:
                      return o2 = r4 && r4.targetChanges.get(e3.targetId), s2 = e3.view.applyChanges(i2, t3.isPrimaryClient, o2), [2, (Ws(t3, e3.targetId, s2.Po), s2.snapshot)];
                  }
                });
              });
            }(t2, e2, n3, r3);
          }, [4, Ji(t2.localStore, e, true)];
        case 1:
          return i = h2.sent(), o = new ks(e, i.jn), s = o.Io(i.documents), u = fn.createSynthesizedTargetChangeForCurrentChange(n2, r2 && t2.onlineState !== "Offline"), a = o.applyChanges(s, t2.isPrimaryClient, u), Ws(t2, n2, a.Po), c = new Cs(e, n2, o), [2, (t2.No.set(e, c), t2.$o.has(n2) ? t2.$o.get(n2).push(e) : t2.$o.set(n2, [e]), a.snapshot)];
      }
    });
  });
}
__name(Os, "Os");
function Ps(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return n2 = C(t2), r2 = n2.No.get(e), (i = n2.$o.get(r2.targetId)).length > 1 ? [2, (n2.$o.set(r2.targetId, i.filter(function(t3) {
            return !$t(t3, e);
          })), void n2.No.delete(e))] : n2.isPrimaryClient ? (n2.sharedClientState.removeLocalQueryTarget(r2.targetId), n2.sharedClientState.isActiveQueryTarget(r2.targetId) ? [3, 2] : [4, Yi(n2.localStore, r2.targetId, false).then(function() {
            n2.sharedClientState.clearQueryState(r2.targetId), jo(n2.remoteStore, r2.targetId), zs(n2, r2.targetId);
          }).catch(yi)]) : [3, 3];
        case 1:
          o.sent(), o.label = 2;
        case 2:
          return [3, 5];
        case 3:
          return zs(n2, r2.targetId), [4, Yi(n2.localStore, r2.targetId, true)];
        case 4:
          o.sent(), o.label = 5;
        case 5:
          return [2];
      }
    });
  });
}
__name(Ps, "Ps");
function Ms(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          r2 = cu(t2), u.label = 1;
        case 1:
          return u.trys.push([1, 5, , 6]), [4, function(t3, e2) {
            var n3, r3 = C(t3), i2 = tt.now(), o2 = e2.reduce(function(t4, e3) {
              return t4.add(e3.key);
            }, un());
            return r3.persistence.runTransaction("Locally write mutations", "readwrite", function(t4) {
              return r3.Kn.bn(t4, o2).next(function(o3) {
                n3 = o3;
                for (var s2 = [], u2 = 0, a = e2; u2 < a.length; u2++) {
                  var c = a[u2], h2 = xe(c, n3.get(c.key));
                  h2 != null && s2.push(new Pe(c.key, h2, ae(h2.proto.mapValue), De.exists(true)));
                }
                return r3.Tn.addMutationBatch(t4, i2, s2, e2);
              });
            }).then(function(t4) {
              var e3 = t4.applyToLocalDocumentSet(n3);
              return {
                batchId: t4.batchId,
                changes: e3
              };
            });
          }(r2.localStore, e)];
        case 2:
          return i = u.sent(), r2.sharedClientState.addPendingMutation(i.batchId), function(t3, e2, n3) {
            var r3 = t3.Lo[t3.currentUser.toKey()];
            r3 || (r3 = new We(R2)), r3 = r3.insert(e2, n3), t3.Lo[t3.currentUser.toKey()] = r3;
          }(r2, i.batchId, n2), [4, Js(r2, i.changes)];
        case 3:
          return u.sent(), [4, ts(r2.remoteStore)];
        case 4:
          return u.sent(), [3, 6];
        case 5:
          return o = u.sent(), s = fs(o, "Failed to persist write"), n2.reject(s), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
__name(Ms, "Ms");
function Fs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          n2 = C(t2), i.label = 1;
        case 1:
          return i.trys.push([1, 4, , 6]), [4, zi(n2.localStore, e)];
        case 2:
          return r2 = i.sent(), e.targetChanges.forEach(function(t3, e2) {
            var r3 = n2.ko.get(e2);
            r3 && (k2(t3.addedDocuments.size + t3.modifiedDocuments.size + t3.removedDocuments.size <= 1), t3.addedDocuments.size > 0 ? r3.Co = true : t3.modifiedDocuments.size > 0 ? k2(r3.Co) : t3.removedDocuments.size > 0 && (k2(r3.Co), r3.Co = false));
          }), [4, Js(n2, r2, e)];
        case 3:
          return i.sent(), [3, 6];
        case 4:
          return [4, yi(i.sent())];
        case 5:
          return i.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
__name(Fs, "Fs");
function qs(t2, e, n2) {
  var r2 = C(t2);
  if (r2.isPrimaryClient && n2 === 0 || !r2.isPrimaryClient && n2 === 1) {
    var i = [];
    r2.No.forEach(function(t3, n3) {
      var r3 = n3.view.eo(e);
      r3.snapshot && i.push(r3.snapshot);
    }), function(t3, e2) {
      var n3 = C(t3);
      n3.onlineState = e2;
      var r3 = false;
      n3.queries.forEach(function(t4, n4) {
        for (var i2 = 0, o = n4.listeners; i2 < o.length; i2++) {
          o[i2].eo(e2) && (r3 = true);
        }
      }), r3 && Is(n3);
    }(r2.eventManager, e), i.length && r2.xo.Tr(i), r2.onlineState = e, r2.isPrimaryClient && r2.sharedClientState.setOnlineState(e);
  }
}
__name(qs, "qs");
function Vs(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s, u, a;
    return __generator(this, function(c) {
      switch (c.label) {
        case 0:
          return (r2 = C(t2)).sharedClientState.updateQueryState(e, "rejected", n2), i = r2.ko.get(e), (o = i && i.key) ? (s = (s = new We(H2.comparator)).insert(o, new wt(o, ie.min())), u = un().add(o), a = new hn(ie.min(), new Map(), new Je(R2), s, u), [4, Fs(r2, a)]) : [3, 2];
        case 1:
          return c.sent(), r2.Oo = r2.Oo.remove(o), r2.ko.delete(e), Ys(r2), [3, 4];
        case 2:
          return [4, Yi(r2.localStore, e, false).then(function() {
            return zs(r2, e, n2);
          }).catch(yi)];
        case 3:
          c.sent(), c.label = 4;
        case 4:
          return [2];
      }
    });
  });
}
__name(Vs, "Vs");
function Us(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          n2 = C(t2), r2 = e.batch.batchId, o.label = 1;
        case 1:
          return o.trys.push([1, 4, , 6]), [4, Gi(n2.localStore, e)];
        case 2:
          return i = o.sent(), Ks(n2, r2, null), Gs(n2, r2), n2.sharedClientState.updateMutationState(r2, "acknowledged"), [4, Js(n2, i)];
        case 3:
          return o.sent(), [3, 6];
        case 4:
          return [4, yi(o.sent())];
        case 5:
          return o.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
__name(Us, "Us");
function Bs(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          r2 = C(t2), o.label = 1;
        case 1:
          return o.trys.push([1, 4, , 6]), [4, function(t3, e2) {
            var n3 = C(t3);
            return n3.persistence.runTransaction("Reject batch", "readwrite-primary", function(t4) {
              var r3;
              return n3.Tn.lookupMutationBatch(t4, e2).next(function(e3) {
                return k2(e3 !== null), r3 = e3.keys(), n3.Tn.removeMutationBatch(t4, e3);
              }).next(function() {
                return n3.Tn.performConsistencyCheck(t4);
              }).next(function() {
                return n3.Kn.bn(t4, r3);
              });
            });
          }(r2.localStore, e)];
        case 2:
          return i = o.sent(), Ks(r2, e, n2), Gs(r2, e), r2.sharedClientState.updateMutationState(e, "rejected", n2), [4, Js(r2, i)];
        case 3:
          return o.sent(), [3, 6];
        case 4:
          return [4, yi(o.sent())];
        case 5:
          return o.sent(), [3, 6];
        case 6:
          return [2];
      }
    });
  });
}
__name(Bs, "Bs");
function js(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          Wo((n2 = C(t2)).remoteStore) || _("SyncEngine", "The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."), u.label = 1;
        case 1:
          return u.trys.push([1, 3, , 4]), [4, function(t3) {
            var e2 = C(t3);
            return e2.persistence.runTransaction("Get highest unacknowledged batch id", "readonly", function(t4) {
              return e2.Tn.getHighestUnacknowledgedBatchId(t4);
            });
          }(n2.localStore)];
        case 2:
          return (r2 = u.sent()) === -1 ? [2, void e.resolve()] : ((i = n2.Bo.get(r2) || []).push(e), n2.Bo.set(r2, i), [3, 4]);
        case 3:
          return o = u.sent(), s = fs(o, "Initialization of waitForPendingWrites() operation failed"), e.reject(s), [3, 4];
        case 4:
          return [2];
      }
    });
  });
}
__name(js, "js");
function Gs(t2, e) {
  (t2.Bo.get(e) || []).forEach(function(t3) {
    t3.resolve();
  }), t2.Bo.delete(e);
}
__name(Gs, "Gs");
function Ks(t2, e, n2) {
  var r2 = C(t2), i = r2.Lo[r2.currentUser.toKey()];
  if (i) {
    var o = i.get(e);
    o && (n2 ? o.reject(n2) : o.resolve(), i = i.remove(e)), r2.Lo[r2.currentUser.toKey()] = i;
  }
}
__name(Ks, "Ks");
function zs(t2, e, n2) {
  n2 === void 0 && (n2 = null), t2.sharedClientState.removeLocalQueryTarget(e);
  for (var r2 = 0, i = t2.$o.get(e); r2 < i.length; r2++) {
    var o = i[r2];
    t2.No.delete(o), n2 && t2.xo.Ko(o, n2);
  }
  t2.$o.delete(e), t2.isPrimaryClient && t2.Mo.os(e).forEach(function(e2) {
    t2.Mo.containsKey(e2) || Qs(t2, e2);
  });
}
__name(zs, "zs");
function Qs(t2, e) {
  t2.Fo.delete(e.path.canonicalString());
  var n2 = t2.Oo.get(e);
  n2 !== null && (jo(t2.remoteStore, n2), t2.Oo = t2.Oo.remove(e), t2.ko.delete(n2), Ys(t2));
}
__name(Qs, "Qs");
function Ws(t2, e, n2) {
  for (var r2 = 0, i = n2; r2 < i.length; r2++) {
    var o = i[r2];
    o instanceof Ns ? (t2.Mo.addReference(o.key, e), Hs(t2, o)) : o instanceof As ? (_("SyncEngine", "Document no longer in limbo: " + o.key), t2.Mo.removeReference(o.key, e), t2.Mo.containsKey(o.key) || Qs(t2, o.key)) : A2();
  }
}
__name(Ws, "Ws");
function Hs(t2, e) {
  var n2 = e.key, r2 = n2.path.canonicalString();
  t2.Oo.get(n2) || t2.Fo.has(r2) || (_("SyncEngine", "New document in limbo: " + n2), t2.Fo.add(r2), Ys(t2));
}
__name(Hs, "Hs");
function Ys(t2) {
  for (; t2.Fo.size > 0 && t2.Oo.size < t2.maxConcurrentLimboResolutions; ) {
    var e = t2.Fo.values().next().value;
    t2.Fo.delete(e);
    var n2 = new H2(z2.fromString(e)), r2 = t2.qo.next();
    t2.ko.set(r2, new xs(n2)), t2.Oo = t2.Oo.insert(n2, r2), Bo(t2.remoteStore, new Mr(Jt(Gt(n2.path)), r2, 2, I2.o));
  }
}
__name(Ys, "Ys");
function Js(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          return r2 = C(t2), i = [], o = [], s = [], r2.No.isEmpty() ? [3, 3] : (r2.No.forEach(function(t3, u2) {
            s.push(r2.Qo(u2, e, n2).then(function(t4) {
              if (t4) {
                r2.isPrimaryClient && r2.sharedClientState.updateQueryState(u2.targetId, t4.fromCache ? "not-current" : "current"), i.push(t4);
                var e2 = qi.Nn(u2.targetId, t4);
                o.push(e2);
              }
            }));
          }), [4, Promise.all(s)]);
        case 1:
          return u.sent(), r2.xo.Tr(i), [4, function(t3, e2) {
            return __awaiter(this, void 0, void 0, function() {
              var n3, r3, i2, o2, s2, u2, a, c, h2;
              return __generator(this, function(f) {
                switch (f.label) {
                  case 0:
                    n3 = C(t3), f.label = 1;
                  case 1:
                    return f.trys.push([1, 3, , 4]), [4, n3.persistence.runTransaction("notifyLocalViewChanges", "readwrite", function(t4) {
                      return Er.forEach(e2, function(e3) {
                        return Er.forEach(e3.Cn, function(r4) {
                          return n3.persistence.referenceDelegate.addReference(t4, e3.targetId, r4);
                        }).next(function() {
                          return Er.forEach(e3.xn, function(r4) {
                            return n3.persistence.referenceDelegate.removeReference(t4, e3.targetId, r4);
                          });
                        });
                      });
                    })];
                  case 2:
                    return f.sent(), [3, 4];
                  case 3:
                    if (!Nr(r3 = f.sent()))
                      throw r3;
                    return _("LocalStore", "Failed to update sequence numbers: " + r3), [3, 4];
                  case 4:
                    for (i2 = 0, o2 = e2; i2 < o2.length; i2++)
                      s2 = o2[i2], u2 = s2.targetId, s2.fromCache || (a = n3.Bn.get(u2), c = a.snapshotVersion, h2 = a.withLastLimboFreeSnapshotVersion(c), n3.Bn = n3.Bn.insert(u2, h2));
                    return [2];
                }
              });
            });
          }(r2.localStore, o)];
        case 2:
          u.sent(), u.label = 3;
        case 3:
          return [2];
      }
    });
  });
}
__name(Js, "Js");
function Xs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return (n2 = C(t2)).currentUser.isEqual(e) ? [3, 3] : (_("SyncEngine", "User change. New user:", e.toKey()), [4, ji(n2.localStore, e)]);
        case 1:
          return r2 = i.sent(), n2.currentUser = e, function(t3, e2) {
            t3.Bo.forEach(function(t4) {
              t4.forEach(function(t5) {
                t5.reject(new G2(j.CANCELLED, "'waitForPendingWrites' promise is rejected due to a user change."));
              });
            }), t3.Bo.clear();
          }(n2), n2.sharedClientState.handleUserChange(e, r2.removedBatchIds, r2.addedBatchIds), [4, Js(n2, r2.Wn)];
        case 2:
          i.sent(), i.label = 3;
        case 3:
          return [2];
      }
    });
  });
}
__name(Xs, "Xs");
function $s(t2, e) {
  var n2 = C(t2), r2 = n2.ko.get(e);
  if (r2 && r2.Co)
    return un().add(r2.key);
  var i = un(), o = n2.$o.get(e);
  if (!o)
    return i;
  for (var s = 0, u = o; s < u.length; s++) {
    var a = u[s], c = n2.No.get(a);
    i = i.unionWith(c.view.To);
  }
  return i;
}
__name($s, "$s");
function Zs(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return [4, Ji((n2 = C(t2)).localStore, e.query, true)];
        case 1:
          return r2 = o.sent(), i = e.view.So(r2), [2, (n2.isPrimaryClient && Ws(n2, e.targetId, i.Po), i)];
      }
    });
  });
}
__name(Zs, "Zs");
function tu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e;
    return __generator(this, function(n2) {
      return [2, $i((e = C(t2)).localStore).then(function(t3) {
        return Js(e, t3);
      })];
    });
  });
}
__name(tu, "tu");
function eu(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o;
    return __generator(this, function(s) {
      switch (s.label) {
        case 0:
          return [4, function(t3, e2) {
            var n3 = C(t3), r3 = C(n3.Tn);
            return n3.persistence.runTransaction("Lookup mutation documents", "readonly", function(t4) {
              return r3.Jt(t4, e2).next(function(e3) {
                return e3 ? n3.Kn.bn(t4, e3) : Er.resolve(null);
              });
            });
          }((i = C(t2)).localStore, e)];
        case 1:
          return (o = s.sent()) === null ? [3, 6] : n2 !== "pending" ? [3, 3] : [4, ts(i.remoteStore)];
        case 2:
          return s.sent(), [3, 4];
        case 3:
          n2 === "acknowledged" || n2 === "rejected" ? (Ks(i, e, r2 || null), Gs(i, e), function(t3, e2) {
            C(C(t3).Tn).Xt(e2);
          }(i.localStore, e)) : A2(), s.label = 4;
        case 4:
          return [4, Js(i, o)];
        case 5:
          return s.sent(), [3, 7];
        case 6:
          _("SyncEngine", "Cannot apply mutation batch with id: " + e), s.label = 7;
        case 7:
          return [2];
      }
    });
  });
}
__name(eu, "eu");
function nu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i, o, s, u, a, c;
    return __generator(this, function(h2) {
      switch (h2.label) {
        case 0:
          return au(n2 = C(t2)), cu(n2), e !== true || n2.Uo === true ? [3, 3] : (r2 = n2.sharedClientState.getAllActiveQueryTargets(), [4, ru(n2, r2.toArray())]);
        case 1:
          return i = h2.sent(), n2.Uo = true, [4, us(n2.remoteStore, true)];
        case 2:
          for (h2.sent(), o = 0, s = i; o < s.length; o++)
            u = s[o], Bo(n2.remoteStore, u);
          return [3, 7];
        case 3:
          return e !== false || n2.Uo === false ? [3, 7] : (a = [], c = Promise.resolve(), n2.$o.forEach(function(t3, e2) {
            n2.sharedClientState.isLocalQueryTarget(e2) ? a.push(e2) : c = c.then(function() {
              return zs(n2, e2), Yi(n2.localStore, e2, true);
            }), jo(n2.remoteStore, e2);
          }), [4, c]);
        case 4:
          return h2.sent(), [4, ru(n2, a)];
        case 5:
          return h2.sent(), function(t3) {
            var e2 = C(t3);
            e2.ko.forEach(function(t4, n3) {
              jo(e2.remoteStore, n3);
            }), e2.Mo.cs(), e2.ko = new Map(), e2.Oo = new We(H2.comparator);
          }(n2), n2.Uo = false, [4, us(n2.remoteStore, false)];
        case 6:
          h2.sent(), h2.label = 7;
        case 7:
          return [2];
      }
    });
  });
}
__name(nu, "nu");
function ru(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var n3, r2, i, o, s, u, a, c, h2, f, l, d, p2, y2;
    return __generator(this, function(v2) {
      switch (v2.label) {
        case 0:
          n3 = C(t2), r2 = [], i = [], o = 0, s = e, v2.label = 1;
        case 1:
          return o < s.length ? (u = s[o], a = void 0, (c = n3.$o.get(u)) && c.length !== 0 ? [4, Hi(n3.localStore, Jt(c[0]))] : [3, 7]) : [3, 13];
        case 2:
          a = v2.sent(), h2 = 0, f = c, v2.label = 3;
        case 3:
          return h2 < f.length ? (l = f[h2], d = n3.No.get(l), [4, Zs(n3, d)]) : [3, 6];
        case 4:
          (p2 = v2.sent()).snapshot && i.push(p2.snapshot), v2.label = 5;
        case 5:
          return h2++, [3, 3];
        case 6:
          return [3, 11];
        case 7:
          return [4, Xi(n3.localStore, u)];
        case 8:
          return y2 = v2.sent(), [4, Hi(n3.localStore, y2)];
        case 9:
          return a = v2.sent(), [4, Os(n3, iu(y2), u, false)];
        case 10:
          v2.sent(), v2.label = 11;
        case 11:
          r2.push(a), v2.label = 12;
        case 12:
          return o++, [3, 1];
        case 13:
          return [2, (n3.xo.Tr(i), r2)];
      }
    });
  });
}
__name(ru, "ru");
function iu(t2) {
  return jt(t2.path, t2.collectionGroup, t2.orderBy, t2.filters, t2.limit, "F", t2.startAt, t2.endAt);
}
__name(iu, "iu");
function ou(t2) {
  var e = C(t2);
  return C(C(e.localStore).persistence).gn();
}
__name(ou, "ou");
function su(t2, e, n2, r2) {
  return __awaiter(this, void 0, void 0, function() {
    var i, o, s;
    return __generator(this, function(u) {
      switch (u.label) {
        case 0:
          return (i = C(t2)).Uo ? (_("SyncEngine", "Ignoring unexpected query state notification."), [3, 8]) : [3, 1];
        case 1:
          if (!i.$o.has(e))
            return [3, 8];
          switch (n2) {
            case "current":
            case "not-current":
              return [3, 2];
            case "rejected":
              return [3, 5];
          }
          return [3, 7];
        case 2:
          return [4, $i(i.localStore)];
        case 3:
          return o = u.sent(), s = hn.createSynthesizedRemoteEventForCurrentChange(e, n2 === "current"), [4, Js(i, o, s)];
        case 4:
          return u.sent(), [3, 8];
        case 5:
          return [4, Yi(i.localStore, e, true)];
        case 6:
          return u.sent(), zs(i, e, r2), [3, 8];
        case 7:
          A2(), u.label = 8;
        case 8:
          return [2];
      }
    });
  });
}
__name(su, "su");
function uu(t2, e, n2) {
  return __awaiter(this, void 0, void 0, function() {
    var r2, i, o, s, u, a, c, h2, f, l;
    return __generator(this, function(d) {
      switch (d.label) {
        case 0:
          if (!(r2 = au(t2)).Uo)
            return [3, 10];
          i = 0, o = e, d.label = 1;
        case 1:
          return i < o.length ? (s = o[i], r2.$o.has(s) ? (_("SyncEngine", "Adding an already active target " + s), [3, 5]) : [4, Xi(r2.localStore, s)]) : [3, 6];
        case 2:
          return u = d.sent(), [4, Hi(r2.localStore, u)];
        case 3:
          return a = d.sent(), [4, Os(r2, iu(u), a.targetId, false)];
        case 4:
          d.sent(), Bo(r2.remoteStore, a), d.label = 5;
        case 5:
          return i++, [3, 1];
        case 6:
          c = /* @__PURE__ */ __name(function(t3) {
            return __generator(this, function(e2) {
              switch (e2.label) {
                case 0:
                  return r2.$o.has(t3) ? [4, Yi(r2.localStore, t3, false).then(function() {
                    jo(r2.remoteStore, t3), zs(r2, t3);
                  }).catch(yi)] : [3, 2];
                case 1:
                  e2.sent(), e2.label = 2;
                case 2:
                  return [2];
              }
            });
          }, "c"), h2 = 0, f = n2, d.label = 7;
        case 7:
          return h2 < f.length ? (l = f[h2], [5, c(l)]) : [3, 10];
        case 8:
          d.sent(), d.label = 9;
        case 9:
          return h2++, [3, 7];
        case 10:
          return [2];
      }
    });
  });
}
__name(uu, "uu");
function au(t2) {
  var e = C(t2);
  return e.remoteStore.remoteSyncer.applyRemoteEvent = Fs.bind(null, e), e.remoteStore.remoteSyncer.getRemoteKeysForTarget = $s.bind(null, e), e.remoteStore.remoteSyncer.rejectListen = Vs.bind(null, e), e.xo.Tr = ws.bind(null, e.eventManager), e.xo.Ko = bs.bind(null, e.eventManager), e;
}
__name(au, "au");
function cu(t2) {
  var e = C(t2);
  return e.remoteStore.remoteSyncer.applySuccessfulWrite = Us.bind(null, e), e.remoteStore.remoteSyncer.rejectFailedWrite = Bs.bind(null, e), e;
}
__name(cu, "cu");
var fu = function() {
  function t2() {
    this.synchronizeTabs = false;
  }
  __name(t2, "t");
  return t2.prototype.initialize = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return this.D = xo(t3.databaseInfo.databaseId), this.sharedClientState = this.jo(t3), this.persistence = this.Go(t3), [4, this.persistence.start()];
          case 1:
            return e.sent(), this.gcScheduler = this.zo(t3), this.localStore = this.Ho(t3), [2];
        }
      });
    });
  }, t2.prototype.zo = function(t3) {
    return null;
  }, t2.prototype.Ho = function(t3) {
    return Bi(this.persistence, new Vi(), t3.initialUser, this.D);
  }, t2.prototype.Go = function(t3) {
    return new co(fo.Cs, this.D);
  }, t2.prototype.jo = function(t3) {
    return new To();
  }, t2.prototype.terminate = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.gcScheduler && this.gcScheduler.stop(), [4, this.sharedClientState.shutdown()];
          case 1:
            return t3.sent(), [4, this.persistence.shutdown()];
          case 2:
            return t3.sent(), [2];
        }
      });
    });
  }, t2;
}();
var lu = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).Jo = e2, i.cacheSizeBytes = n2, i.forceOwnership = r2, i.synchronizeTabs = false, i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.initialize = function(e2) {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, t2.prototype.initialize.call(this, e2)];
          case 1:
            return n2.sent(), [4, Zi(this.localStore)];
          case 2:
            return n2.sent(), [4, this.Jo.initialize(this, e2)];
          case 3:
            return n2.sent(), [4, cu(this.Jo.syncEngine)];
          case 4:
            return n2.sent(), [4, ts(this.Jo.remoteStore)];
          case 5:
            return n2.sent(), [2];
        }
      });
    });
  }, e.prototype.Ho = function(t3) {
    return Bi(this.persistence, new Vi(), t3.initialUser, this.D);
  }, e.prototype.zo = function(t3) {
    var e2 = this.persistence.referenceDelegate.garbageCollector;
    return new gi(e2, t3.asyncQueue);
  }, e.prototype.Go = function(t3) {
    var e2 = Pi(t3.databaseInfo.databaseId, t3.databaseInfo.persistenceKey), n2 = this.cacheSizeBytes !== void 0 ? ni.withCacheSize(this.cacheSizeBytes) : ni.DEFAULT;
    return new Li(this.synchronizeTabs, e2, t3.clientId, n2, t3.asyncQueue, ko(), Co(), this.D, this.sharedClientState, !!this.forceOwnership);
  }, e.prototype.jo = function(t3) {
    return new To();
  }, e;
}(fu);
var du = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2, false) || this).Jo = e2, r2.cacheSizeBytes = n2, r2.synchronizeTabs = true, r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.initialize = function(e2) {
    return __awaiter(this, void 0, void 0, function() {
      var n2, r2 = this;
      return __generator(this, function(i) {
        switch (i.label) {
          case 0:
            return [4, t2.prototype.initialize.call(this, e2)];
          case 1:
            return i.sent(), n2 = this.Jo.syncEngine, this.sharedClientState instanceof Eo ? (this.sharedClientState.syncEngine = {
              wi: eu.bind(null, n2),
              _i: su.bind(null, n2),
              mi: uu.bind(null, n2),
              gn: ou.bind(null, n2),
              di: tu.bind(null, n2)
            }, [4, this.sharedClientState.start()]) : [3, 3];
          case 2:
            i.sent(), i.label = 3;
          case 3:
            return [4, this.persistence.en(function(t3) {
              return __awaiter(r2, void 0, void 0, function() {
                return __generator(this, function(e3) {
                  switch (e3.label) {
                    case 0:
                      return [4, nu(this.Jo.syncEngine, t3)];
                    case 1:
                      return e3.sent(), this.gcScheduler && (t3 && !this.gcScheduler.started ? this.gcScheduler.start(this.localStore) : t3 || this.gcScheduler.stop()), [2];
                  }
                });
              });
            })];
          case 4:
            return i.sent(), [2];
        }
      });
    });
  }, e.prototype.jo = function(t3) {
    var e2 = ko();
    if (!Eo.At(e2))
      throw new G2(j.UNIMPLEMENTED, "IndexedDB persistence is only available on platforms that support LocalStorage.");
    var n2 = Pi(t3.databaseInfo.databaseId, t3.databaseInfo.persistenceKey);
    return new Eo(e2, t3.asyncQueue, n2, t3.clientId, t3.initialUser);
  }, e;
}(lu);
var pu = function() {
  function t2() {
  }
  __name(t2, "t");
  return t2.prototype.initialize = function(t3, e) {
    return __awaiter(this, void 0, void 0, function() {
      var n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.localStore ? [3, 2] : (this.localStore = t3.localStore, this.sharedClientState = t3.sharedClientState, this.datastore = this.createDatastore(e), this.remoteStore = this.createRemoteStore(e), this.eventManager = this.createEventManager(e), this.syncEngine = this.createSyncEngine(e, !t3.synchronizeTabs), this.sharedClientState.onlineStateHandler = function(t4) {
              return qs(n2.syncEngine, t4, 1);
            }, this.remoteStore.remoteSyncer.handleCredentialChange = Xs.bind(null, this.syncEngine), [4, us(this.remoteStore, this.syncEngine.isPrimaryClient)]);
          case 1:
            r2.sent(), r2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.createEventManager = function(t3) {
    return new vs();
  }, t2.prototype.createDatastore = function(t3) {
    var e, n2 = xo(t3.databaseInfo.databaseId), r2 = (e = t3.databaseInfo, new Ao(e));
    return function(t4, e2, n3) {
      return new Mo(t4, e2, n3);
    }(t3.credentials, r2, n2);
  }, t2.prototype.createRemoteStore = function(t3) {
    var e, n2, r2, i, o, s = this;
    return e = this.localStore, n2 = this.datastore, r2 = t3.asyncQueue, i = /* @__PURE__ */ __name(function(t4) {
      return qs(s.syncEngine, t4, 0);
    }, "i"), o = So.At() ? new So() : new _o(), new qo(e, n2, r2, i, o);
  }, t2.prototype.createSyncEngine = function(t3, e) {
    return function(t4, e2, n2, r2, i, o, s) {
      var u = new Ls(t4, e2, n2, r2, i, o);
      return s && (u.Uo = true), u;
    }(this.localStore, this.remoteStore, this.eventManager, this.sharedClientState, t3.initialUser, t3.maxConcurrentLimboResolutions, e);
  }, t2.prototype.terminate = function() {
    return function(t3) {
      return __awaiter(this, void 0, void 0, function() {
        var e;
        return __generator(this, function(n2) {
          switch (n2.label) {
            case 0:
              return e = C(t3), _("RemoteStore", "RemoteStore shutting down."), e.Qr.add(5), [4, Uo(e)];
            case 1:
              return n2.sent(), e.Wr.shutdown(), e.jr.set("Unknown"), [2];
          }
        });
      });
    }(this.remoteStore);
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var vu = function() {
  function t2(t3) {
    this.observer = t3, this.muted = false;
  }
  __name(t2, "t");
  return t2.prototype.next = function(t3) {
    this.observer.next && this.Yo(this.observer.next, t3);
  }, t2.prototype.error = function(t3) {
    this.observer.error ? this.Yo(this.observer.error, t3) : console.error("Uncaught Error in snapshot listener:", t3);
  }, t2.prototype.Xo = function() {
    this.muted = true;
  }, t2.prototype.Yo = function(t3, e) {
    var n2 = this;
    this.muted || setTimeout(function() {
      n2.muted || t3(e);
    }, 0);
  }, t2;
}();
var mu = function() {
  function t2(t3, e) {
    var n2 = this;
    this.Zo = t3, this.D = e, this.metadata = new Ir(), this.buffer = new Uint8Array(), this.tc = new TextDecoder("utf-8"), this.ec().then(function(t4) {
      t4 && t4.ho() ? n2.metadata.resolve(t4.payload.metadata) : n2.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             " + JSON.stringify(t4 == null ? void 0 : t4.payload)));
    }, function(t4) {
      return n2.metadata.reject(t4);
    });
  }
  __name(t2, "t");
  return t2.prototype.close = function() {
    return this.Zo.cancel();
  }, t2.prototype.getMetadata = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        return [2, this.metadata.promise];
      });
    });
  }, t2.prototype.Wo = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return [4, this.getMetadata()];
          case 1:
            return [2, (t3.sent(), this.ec())];
        }
      });
    });
  }, t2.prototype.ec = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e, n2, r2;
      return __generator(this, function(i) {
        switch (i.label) {
          case 0:
            return [4, this.nc()];
          case 1:
            return (t3 = i.sent()) === null ? [2, null] : (e = this.tc.decode(t3), n2 = Number(e), isNaN(n2) && this.sc("length string (" + e + ") is not valid number"), [4, this.ic(n2)]);
          case 2:
            return r2 = i.sent(), [2, new Ts(JSON.parse(r2), t3.length + n2)];
        }
      });
    });
  }, t2.prototype.rc = function() {
    return this.buffer.findIndex(function(t3) {
      return t3 === "{".charCodeAt(0);
    });
  }, t2.prototype.nc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.rc() < 0 ? [4, this.oc()] : [3, 3];
          case 1:
            if (n2.sent())
              return [3, 3];
            n2.label = 2;
          case 2:
            return [3, 0];
          case 3:
            return this.buffer.length === 0 ? [2, null] : ((t3 = this.rc()) < 0 && this.sc("Reached the end of bundle when a length string is expected."), e = this.buffer.slice(0, t3), [2, (this.buffer = this.buffer.slice(t3), e)]);
        }
      });
    });
  }, t2.prototype.ic = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.buffer.length < t3 ? [4, this.oc()] : [3, 3];
          case 1:
            n2.sent() && this.sc("Reached the end of bundle when more is expected."), n2.label = 2;
          case 2:
            return [3, 0];
          case 3:
            return e = this.tc.decode(this.buffer.slice(0, t3)), [2, (this.buffer = this.buffer.slice(t3), e)];
        }
      });
    });
  }, t2.prototype.sc = function(t3) {
    throw this.Zo.cancel(), new Error("Invalid bundle format: " + t3);
  }, t2.prototype.oc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.Zo.read()];
          case 1:
            return (t3 = n2.sent()).done || ((e = new Uint8Array(this.buffer.length + t3.value.length)).set(this.buffer), e.set(t3.value, this.buffer.length), this.buffer = e), [2, t3.done];
        }
      });
    });
  }, t2;
}();
var gu = function() {
  function t2(t3) {
    this.datastore = t3, this.readVersions = new Map(), this.mutations = [], this.committed = false, this.lastWriteError = null, this.writtenDocs = new Set();
  }
  __name(t2, "t");
  return t2.prototype.lookup = function(t3) {
    return __awaiter(this, void 0, void 0, function() {
      var e, n2 = this;
      return __generator(this, function(r2) {
        switch (r2.label) {
          case 0:
            if (this.ensureCommitNotCalled(), this.mutations.length > 0)
              throw new G2(j.INVALID_ARGUMENT, "Firestore transactions require all reads to be executed before all writes.");
            return [4, function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r3, i, o, s, u;
                return __generator(this, function(a) {
                  switch (a.label) {
                    case 0:
                      return n3 = C(t4), r3 = Ln(n3.D) + "/documents", i = {
                        documents: e2.map(function(t5) {
                          return An(n3.D, t5);
                        })
                      }, [4, n3.Ui("BatchGetDocuments", r3, i)];
                    case 1:
                      return o = a.sent(), s = new Map(), o.forEach(function(t5) {
                        var e3 = function(t6, e4) {
                          return "found" in e4 ? function(t7, e5) {
                            k2(!!e5.found), e5.found.name, e5.found.updateTime;
                            var n4 = kn(t7, e5.found.name), r4 = Sn(e5.found.updateTime), i2 = new se({
                              mapValue: {
                                fields: e5.found.fields
                              }
                            });
                            return new gt(n4, r4, i2, {});
                          }(t6, e4) : "missing" in e4 ? function(t7, e5) {
                            k2(!!e5.missing), k2(!!e5.readTime);
                            var n4 = kn(t7, e5.missing), r4 = Sn(e5.readTime);
                            return new wt(n4, r4);
                          }(t6, e4) : A2();
                        }(n3.D, t5);
                        s.set(e3.key.toString(), e3);
                      }), u = [], [2, (e2.forEach(function(t5) {
                        var e3 = s.get(t5.toString());
                        k2(!!e3), u.push(e3);
                      }), u)];
                  }
                });
              });
            }(this.datastore, t3)];
          case 1:
            return [2, ((e = r2.sent()).forEach(function(t4) {
              t4 instanceof wt || t4 instanceof gt ? n2.recordVersion(t4) : A2();
            }), e)];
        }
      });
    });
  }, t2.prototype.set = function(t3, e) {
    this.write(e.toMutation(t3, this.precondition(t3))), this.writtenDocs.add(t3.toString());
  }, t2.prototype.update = function(t3, e) {
    try {
      this.write(e.toMutation(t3, this.preconditionForUpdate(t3)));
    } catch (t4) {
      this.lastWriteError = t4;
    }
    this.writtenDocs.add(t3.toString());
  }, t2.prototype.delete = function(t3) {
    this.write(new je(t3, this.precondition(t3))), this.writtenDocs.add(t3.toString());
  }, t2.prototype.commit = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e = this;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            if (this.ensureCommitNotCalled(), this.lastWriteError)
              throw this.lastWriteError;
            return t3 = this.readVersions, this.mutations.forEach(function(e2) {
              t3.delete(e2.key.toString());
            }), t3.forEach(function(t4, n3) {
              var r2 = H2.fromPath(n3);
              e.mutations.push(new Ge(r2, e.precondition(r2)));
            }), [4, function(t4, e2) {
              return __awaiter(this, void 0, void 0, function() {
                var n3, r2, i;
                return __generator(this, function(o) {
                  switch (o.label) {
                    case 0:
                      return n3 = C(t4), r2 = Ln(n3.D) + "/documents", i = {
                        writes: e2.map(function(t5) {
                          return Mn(n3.D, t5);
                        })
                      }, [4, n3.Mi("Commit", r2, i)];
                    case 1:
                      return o.sent(), [2];
                  }
                });
              });
            }(this.datastore, this.mutations)];
          case 1:
            return n2.sent(), this.committed = true, [2];
        }
      });
    });
  }, t2.prototype.recordVersion = function(t3) {
    var e;
    if (t3 instanceof gt)
      e = t3.version;
    else {
      if (!(t3 instanceof wt))
        throw A2();
      e = ie.min();
    }
    var n2 = this.readVersions.get(t3.key.toString());
    if (n2) {
      if (!e.isEqual(n2))
        throw new G2(j.ABORTED, "Document version changed between two reads.");
    } else
      this.readVersions.set(t3.key.toString(), e);
  }, t2.prototype.precondition = function(t3) {
    var e = this.readVersions.get(t3.toString());
    return !this.writtenDocs.has(t3.toString()) && e ? De.updateTime(e) : De.none();
  }, t2.prototype.preconditionForUpdate = function(t3) {
    var e = this.readVersions.get(t3.toString());
    if (!this.writtenDocs.has(t3.toString()) && e) {
      if (e.isEqual(ie.min()))
        throw new G2(j.INVALID_ARGUMENT, "Can't update a document that doesn't exist.");
      return De.updateTime(e);
    }
    return De.exists(true);
  }, t2.prototype.write = function(t3) {
    this.ensureCommitNotCalled(), this.mutations.push(t3);
  }, t2.prototype.ensureCommitNotCalled = function() {
  }, t2;
}();
var wu = function() {
  function t2(t3, e, n2, r2) {
    this.asyncQueue = t3, this.datastore = e, this.updateFunction = n2, this.deferred = r2, this.cc = 5, this.rr = new Lo(this.asyncQueue, "transaction_retry");
  }
  __name(t2, "t");
  return t2.prototype.run = function() {
    this.ac();
  }, t2.prototype.ac = function() {
    var t3 = this;
    this.rr.Yi(function() {
      return __awaiter(t3, void 0, void 0, function() {
        var t4, e, n2 = this;
        return __generator(this, function(r2) {
          return t4 = new gu(this.datastore), (e = this.uc(t4)) && e.then(function(e2) {
            n2.asyncQueue.enqueueAndForget(function() {
              return t4.commit().then(function() {
                n2.deferred.resolve(e2);
              }).catch(function(t5) {
                n2.hc(t5);
              });
            });
          }).catch(function(t5) {
            n2.hc(t5);
          }), [2];
        });
      });
    });
  }, t2.prototype.uc = function(t3) {
    try {
      var e = this.updateFunction(t3);
      return !V2(e) && e.catch && e.then ? e : (this.deferred.reject(Error("Transaction callback must return a Promise")), null);
    } catch (t4) {
      return this.deferred.reject(t4), null;
    }
  }, t2.prototype.hc = function(t3) {
    var e = this;
    this.cc > 0 && this.lc(t3) ? (this.cc -= 1, this.asyncQueue.enqueueAndForget(function() {
      return e.ac(), Promise.resolve();
    })) : this.deferred.reject(t3);
  }, t2.prototype.lc = function(t3) {
    if (t3.name === "FirebaseError") {
      var e = t3.code;
      return e === "aborted" || e === "failed-precondition" || !ze(e);
    }
    return false;
  }, t2;
}();
var bu = function() {
  function t2(t3, e, n2) {
    var r2 = this;
    this.credentials = t3, this.asyncQueue = e, this.databaseInfo = n2, this.user = lo.UNAUTHENTICATED, this.clientId = L2.u(), this.credentialListener = function() {
    }, this.receivedInitialUser = new Ir(), this.credentials.setChangeListener(function(t4) {
      _("FirestoreClient", "Received user=", t4.uid), r2.user = t4, r2.credentialListener(t4), r2.receivedInitialUser.resolve();
    });
  }
  __name(t2, "t");
  return t2.prototype.getConfiguration = function() {
    return __awaiter(this, void 0, void 0, function() {
      return __generator(this, function(t3) {
        switch (t3.label) {
          case 0:
            return [4, this.receivedInitialUser.promise];
          case 1:
            return [2, (t3.sent(), {
              asyncQueue: this.asyncQueue,
              databaseInfo: this.databaseInfo,
              clientId: this.clientId,
              credentials: this.credentials,
              initialUser: this.user,
              maxConcurrentLimboResolutions: 100
            })];
        }
      });
    });
  }, t2.prototype.setCredentialChangeListener = function(t3) {
    var e = this;
    this.credentialListener = t3, this.receivedInitialUser.promise.then(function() {
      return e.credentialListener(e.user);
    });
  }, t2.prototype.verifyNotTerminated = function() {
    if (this.asyncQueue.isShuttingDown)
      throw new G2(j.FAILED_PRECONDITION, "The client has already been terminated.");
  }, t2.prototype.terminate = function() {
    var t3 = this;
    this.asyncQueue.enterRestrictedMode();
    var e = new Ir();
    return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function() {
      return __awaiter(t3, void 0, void 0, function() {
        var t4, n2;
        return __generator(this, function(r2) {
          switch (r2.label) {
            case 0:
              return r2.trys.push([0, 5, , 6]), this.onlineComponents ? [4, this.onlineComponents.terminate()] : [3, 2];
            case 1:
              r2.sent(), r2.label = 2;
            case 2:
              return this.offlineComponents ? [4, this.offlineComponents.terminate()] : [3, 4];
            case 3:
              r2.sent(), r2.label = 4;
            case 4:
              return this.credentials.removeChangeListener(), e.resolve(), [3, 6];
            case 5:
              return t4 = r2.sent(), n2 = fs(t4, "Failed to shutdown persistence"), e.reject(n2), [3, 6];
            case 6:
              return [2];
          }
        });
      });
    }), e.promise;
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Iu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2, i = this;
    return __generator(this, function(o) {
      switch (o.label) {
        case 0:
          return t2.asyncQueue.verifyOperationInProgress(), _("FirestoreClient", "Initializing OfflineComponentProvider"), [4, t2.getConfiguration()];
        case 1:
          return n2 = o.sent(), [4, e.initialize(n2)];
        case 2:
          return o.sent(), r2 = n2.initialUser, t2.setCredentialChangeListener(function(n3) {
            r2.isEqual(n3) || (r2 = n3, t2.asyncQueue.enqueueRetryable(function() {
              return __awaiter(i, void 0, void 0, function() {
                return __generator(this, function(t3) {
                  switch (t3.label) {
                    case 0:
                      return [4, ji(e.localStore, n3)];
                    case 1:
                      return t3.sent(), [2];
                  }
                });
              });
            }));
          }), e.persistence.setDatabaseDeletedListener(function() {
            return t2.terminate();
          }), t2.offlineComponents = e, [2];
      }
    });
  });
}
__name(Iu, "Iu");
function Eu(t2, e) {
  return __awaiter(this, void 0, void 0, function() {
    var n2, r2;
    return __generator(this, function(i) {
      switch (i.label) {
        case 0:
          return t2.asyncQueue.verifyOperationInProgress(), [4, Tu(t2)];
        case 1:
          return n2 = i.sent(), _("FirestoreClient", "Initializing OnlineComponentProvider"), [4, t2.getConfiguration()];
        case 2:
          return r2 = i.sent(), [4, e.initialize(n2, r2)];
        case 3:
          return i.sent(), t2.setCredentialChangeListener(function(n3) {
            return t2.asyncQueue.enqueueRetryable(function() {
              return function(t3, e2) {
                return __awaiter(this, void 0, void 0, function() {
                  var n4, r3;
                  return __generator(this, function(i2) {
                    switch (i2.label) {
                      case 0:
                        return (n4 = C(t3)).asyncQueue.verifyOperationInProgress(), _("RemoteStore", "RemoteStore received new credentials"), r3 = Wo(n4), n4.Qr.add(3), [4, Uo(n4)];
                      case 1:
                        return i2.sent(), r3 && n4.jr.set("Unknown"), [4, n4.remoteSyncer.handleCredentialChange(e2)];
                      case 2:
                        return i2.sent(), n4.Qr.delete(3), [4, Vo(n4)];
                      case 3:
                        return i2.sent(), [2];
                    }
                  });
                });
              }(e.remoteStore, n3);
            });
          }), t2.onlineComponents = e, [2];
      }
    });
  });
}
__name(Eu, "Eu");
function Tu(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      switch (e.label) {
        case 0:
          return t2.offlineComponents ? [3, 2] : (_("FirestoreClient", "Using default OfflineComponentProvider"), [4, Iu(t2, new fu())]);
        case 1:
          e.sent(), e.label = 2;
        case 2:
          return [2, t2.offlineComponents];
      }
    });
  });
}
__name(Tu, "Tu");
function _u(t2) {
  return __awaiter(this, void 0, void 0, function() {
    return __generator(this, function(e) {
      switch (e.label) {
        case 0:
          return t2.onlineComponents ? [3, 2] : (_("FirestoreClient", "Using default OnlineComponentProvider"), [4, Eu(t2, new pu())]);
        case 1:
          e.sent(), e.label = 2;
        case 2:
          return [2, t2.onlineComponents];
      }
    });
  });
}
__name(_u, "_u");
function Su(t2) {
  return Tu(t2).then(function(t3) {
    return t3.persistence;
  });
}
__name(Su, "Su");
function Du(t2) {
  return Tu(t2).then(function(t3) {
    return t3.localStore;
  });
}
__name(Du, "Du");
function Nu(t2) {
  return _u(t2).then(function(t3) {
    return t3.remoteStore;
  });
}
__name(Nu, "Nu");
function Au(t2) {
  return _u(t2).then(function(t3) {
    return t3.syncEngine;
  });
}
__name(Au, "Au");
function ku(t2) {
  return __awaiter(this, void 0, void 0, function() {
    var e, n2;
    return __generator(this, function(r2) {
      switch (r2.label) {
        case 0:
          return [4, _u(t2)];
        case 1:
          return e = r2.sent(), [2, ((n2 = e.eventManager).onListen = Rs.bind(null, e.syncEngine), n2.onUnlisten = Ps.bind(null, e.syncEngine), n2)];
      }
    });
  });
}
__name(ku, "ku");
function Cu(t2, e, n2) {
  var r2 = this;
  n2 === void 0 && (n2 = {});
  var i = new Ir();
  return t2.asyncQueue.enqueueAndForget(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return r3 = /* @__PURE__ */ __name(function(t3, e2, n3, r4, i2) {
              var o2 = new vu({
                next: function(o3) {
                  e2.enqueueAndForget(function() {
                    return gs(t3, s);
                  });
                  var u = o3.docs.has(n3);
                  !u && o3.fromCache ? i2.reject(new G2(j.UNAVAILABLE, "Failed to get document because the client is offline.")) : u && o3.fromCache && r4 && r4.source === "server" ? i2.reject(new G2(j.UNAVAILABLE, 'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')) : i2.resolve(o3);
                },
                error: function(t4) {
                  return i2.reject(t4);
                }
              }), s = new Es(Gt(n3.path), o2, {
                includeMetadataChanges: true,
                uo: true
              });
              return ms(t3, s);
            }, "r"), [4, ku(t2)];
          case 1:
            return [2, r3.apply(void 0, [o.sent(), t2.asyncQueue, e, n2, i])];
        }
      });
    });
  }), i.promise;
}
__name(Cu, "Cu");
function xu(t2, e, n2) {
  var r2 = this;
  n2 === void 0 && (n2 = {});
  var i = new Ir();
  return t2.asyncQueue.enqueueAndForget(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return r3 = /* @__PURE__ */ __name(function(t3, e2, n3, r4, i2) {
              var o2 = new vu({
                next: function(n4) {
                  e2.enqueueAndForget(function() {
                    return gs(t3, s);
                  }), n4.fromCache && r4.source === "server" ? i2.reject(new G2(j.UNAVAILABLE, 'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')) : i2.resolve(n4);
                },
                error: function(t4) {
                  return i2.reject(t4);
                }
              }), s = new Es(n3, o2, {
                includeMetadataChanges: true,
                uo: true
              });
              return ms(t3, s);
            }, "r"), [4, ku(t2)];
          case 1:
            return [2, r3.apply(void 0, [o.sent(), t2.asyncQueue, e, n2, i])];
        }
      });
    });
  }), i.promise;
}
__name(xu, "xu");
var Lu = /* @__PURE__ */ __name(function(t2, e, n2, r2, i, o) {
  this.databaseId = t2, this.persistenceKey = e, this.host = n2, this.ssl = r2, this.forceLongPolling = i, this.autoDetectLongPolling = o;
}, "Lu");
var Ru = function() {
  function t2(t3, e) {
    this.projectId = t3, this.database = e || "(default)";
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "isDefaultDatabase", {
    get: function() {
      return this.database === "(default)";
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(e) {
    return e instanceof t2 && e.projectId === this.projectId && e.database === this.database;
  }, t2;
}();
var Ou = new Map();
var Pu = /* @__PURE__ */ __name(function(t2, e) {
  this.user = e, this.type = "OAuth", this.authHeaders = {}, this.authHeaders.Authorization = "Bearer " + t2;
}, "Pu");
var Mu = function() {
  function t2() {
    this.changeListener = null;
  }
  __name(t2, "t");
  return t2.prototype.getToken = function() {
    return Promise.resolve(null);
  }, t2.prototype.invalidateToken = function() {
  }, t2.prototype.setChangeListener = function(t3) {
    this.changeListener = t3, t3(lo.UNAUTHENTICATED);
  }, t2.prototype.removeChangeListener = function() {
    this.changeListener = null;
  }, t2;
}();
var Fu = function() {
  function t2(t3) {
    var e = this;
    this.fc = null, this.currentUser = lo.UNAUTHENTICATED, this.receivedInitialUser = false, this.dc = 0, this.changeListener = null, this.forceRefresh = false, this.fc = function() {
      e.dc++, e.currentUser = e.wc(), e.receivedInitialUser = true, e.changeListener && e.changeListener(e.currentUser);
    }, this.dc = 0, this.auth = t3.getImmediate({
      optional: true
    }), this.auth ? this.auth.addAuthTokenListener(this.fc) : (this.fc(null), t3.get().then(function(t4) {
      e.auth = t4, e.fc && e.auth.addAuthTokenListener(e.fc);
    }, function() {
    }));
  }
  __name(t2, "t");
  return t2.prototype.getToken = function() {
    var t3 = this, e = this.dc, n2 = this.forceRefresh;
    return this.forceRefresh = false, this.auth ? this.auth.getToken(n2).then(function(n3) {
      return t3.dc !== e ? (_("FirebaseCredentialsProvider", "getToken aborted due to token change."), t3.getToken()) : n3 ? (k2(typeof n3.accessToken == "string"), new Pu(n3.accessToken, t3.currentUser)) : null;
    }) : Promise.resolve(null);
  }, t2.prototype.invalidateToken = function() {
    this.forceRefresh = true;
  }, t2.prototype.setChangeListener = function(t3) {
    this.changeListener = t3, this.receivedInitialUser && t3(this.currentUser);
  }, t2.prototype.removeChangeListener = function() {
    this.auth && this.auth.removeAuthTokenListener(this.fc), this.fc = null, this.changeListener = null;
  }, t2.prototype.wc = function() {
    var t3 = this.auth && this.auth.getUid();
    return k2(t3 === null || typeof t3 == "string"), new lo(t3);
  }, t2;
}();
var qu = function() {
  function t2(t3, e) {
    this._c = t3, this.mc = e, this.type = "FirstParty", this.user = lo.FIRST_PARTY;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "authHeaders", {
    get: function() {
      var t3 = {
        "X-Goog-AuthUser": this.mc
      }, e = this._c.auth.getAuthHeaderValueForFirstParty([]);
      return e && (t3.Authorization = e), t3;
    },
    enumerable: false,
    configurable: true
  }), t2;
}();
var Vu = function() {
  function t2(t3, e) {
    this._c = t3, this.mc = e;
  }
  __name(t2, "t");
  return t2.prototype.getToken = function() {
    return Promise.resolve(new qu(this._c, this.mc));
  }, t2.prototype.setChangeListener = function(t3) {
    t3(lo.FIRST_PARTY);
  }, t2.prototype.removeChangeListener = function() {
  }, t2.prototype.invalidateToken = function() {
  }, t2;
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Uu(t2, e, n2) {
  if (!n2)
    throw new G2(j.INVALID_ARGUMENT, "Function " + t2 + "() cannot be called with an empty " + e + ".");
}
__name(Uu, "Uu");
function Bu(t2, e) {
  if (e === void 0)
    return {
      merge: false
    };
  if (e.mergeFields !== void 0 && e.merge !== void 0)
    throw new G2(j.INVALID_ARGUMENT, "Invalid options passed to function " + t2 + '(): You cannot specify both "merge" and "mergeFields".');
  return e;
}
__name(Bu, "Bu");
function ju(t2, e, n2, r2) {
  if (e === true && r2 === true)
    throw new G2(j.INVALID_ARGUMENT, t2 + " and " + n2 + " cannot be used together.");
}
__name(ju, "ju");
function Gu(t2) {
  if (!H2.isDocumentKey(t2))
    throw new G2(j.INVALID_ARGUMENT, "Invalid document reference. Document references must have an even number of segments, but " + t2 + " has " + t2.length + ".");
}
__name(Gu, "Gu");
function Ku(t2) {
  if (H2.isDocumentKey(t2))
    throw new G2(j.INVALID_ARGUMENT, "Invalid collection reference. Collection references must have an odd number of segments, but " + t2 + " has " + t2.length + ".");
}
__name(Ku, "Ku");
function zu(t2) {
  if (t2 === void 0)
    return "undefined";
  if (t2 === null)
    return "null";
  if (typeof t2 == "string")
    return t2.length > 20 && (t2 = t2.substring(0, 20) + "..."), JSON.stringify(t2);
  if (typeof t2 == "number" || typeof t2 == "boolean")
    return "" + t2;
  if (typeof t2 == "object") {
    if (t2 instanceof Array)
      return "an array";
    var e = function(t3) {
      if (t3.constructor) {
        var e2 = /function\s+([^\s(]+)\s*\(/.exec(t3.constructor.toString());
        if (e2 && e2.length > 1)
          return e2[1];
      }
      return null;
    }(t2);
    return e ? "a custom " + e + " object" : "an object";
  }
  return typeof t2 == "function" ? "a function" : A2();
}
__name(zu, "zu");
function Qu(t2, e) {
  if ("_delegate" in t2 && (t2 = t2._delegate), !(t2 instanceof e)) {
    if (e.name === t2.constructor.name)
      throw new G2(j.INVALID_ARGUMENT, "Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");
    var n2 = zu(t2);
    throw new G2(j.INVALID_ARGUMENT, "Expected type '" + e.name + "', but it was: " + n2);
  }
  return t2;
}
__name(Qu, "Qu");
function Wu(t2, e) {
  if (e <= 0)
    throw new G2(j.INVALID_ARGUMENT, "Function " + t2 + "() requires a positive number, but it was: " + e + ".");
}
__name(Wu, "Wu");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Hu = function() {
  function t2(t3) {
    var e;
    if (t3.host === void 0) {
      if (t3.ssl !== void 0)
        throw new G2(j.INVALID_ARGUMENT, "Can't provide ssl option if host option is not set");
      this.host = "firestore.googleapis.com", this.ssl = true;
    } else
      this.host = t3.host, this.ssl = (e = t3.ssl) === null || e === void 0 || e;
    if (this.credentials = t3.credentials, this.ignoreUndefinedProperties = !!t3.ignoreUndefinedProperties, t3.cacheSizeBytes === void 0)
      this.cacheSizeBytes = 41943040;
    else {
      if (t3.cacheSizeBytes !== -1 && t3.cacheSizeBytes < 1048576)
        throw new G2(j.INVALID_ARGUMENT, "cacheSizeBytes must be at least 1048576");
      this.cacheSizeBytes = t3.cacheSizeBytes;
    }
    this.experimentalForceLongPolling = !!t3.experimentalForceLongPolling, this.experimentalAutoDetectLongPolling = !!t3.experimentalAutoDetectLongPolling, ju("experimentalForceLongPolling", t3.experimentalForceLongPolling, "experimentalAutoDetectLongPolling", t3.experimentalAutoDetectLongPolling);
  }
  __name(t2, "t");
  return t2.prototype.isEqual = function(t3) {
    return this.host === t3.host && this.ssl === t3.ssl && this.credentials === t3.credentials && this.cacheSizeBytes === t3.cacheSizeBytes && this.experimentalForceLongPolling === t3.experimentalForceLongPolling && this.experimentalAutoDetectLongPolling === t3.experimentalAutoDetectLongPolling && this.ignoreUndefinedProperties === t3.ignoreUndefinedProperties;
  }, t2;
}();
var Yu = function() {
  function t2(t3, e) {
    this._persistenceKey = "(lite)", this._settings = new Hu({}), this._settingsFrozen = false, t3 instanceof Ru ? (this._databaseId = t3, this._credentials = new Mu()) : (this._app = t3, this._databaseId = function(t4) {
      if (!Object.prototype.hasOwnProperty.apply(t4.options, ["projectId"]))
        throw new G2(j.INVALID_ARGUMENT, '"projectId" not provided in firebase.initializeApp.');
      return new Ru(t4.options.projectId);
    }(t3), this._credentials = new Fu(e));
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "app", {
    get: function() {
      if (!this._app)
        throw new G2(j.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this._app;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "_initialized", {
    get: function() {
      return this._settingsFrozen;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "_terminated", {
    get: function() {
      return this._terminateTask !== void 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype._setSettings = function(t3) {
    if (this._settingsFrozen)
      throw new G2(j.FAILED_PRECONDITION, "Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");
    this._settings = new Hu(t3), t3.credentials !== void 0 && (this._credentials = function(t4) {
      if (!t4)
        return new Mu();
      switch (t4.type) {
        case "gapi":
          var e = t4.client;
          return k2(!(typeof e != "object" || e === null || !e.auth || !e.auth.getAuthHeaderValueForFirstParty)), new Vu(e, t4.sessionIndex || "0");
        case "provider":
          return t4.client;
        default:
          throw new G2(j.INVALID_ARGUMENT, "makeCredentialsProvider failed due to invalid credential type");
      }
    }(t3.credentials));
  }, t2.prototype._getSettings = function() {
    return this._settings;
  }, t2.prototype._freezeSettings = function() {
    return this._settingsFrozen = true, this._settings;
  }, t2.prototype._delete = function() {
    return this._terminateTask || (this._terminateTask = this._terminate()), this._terminateTask;
  }, t2.prototype.toJSON = function() {
    return {
      app: this._app,
      databaseId: this._databaseId,
      settings: this._settings
    };
  }, t2.prototype._terminate = function() {
    return t3 = this, (e = Ou.get(t3)) && (_("ComponentProvider", "Removing Datastore"), Ou.delete(t3), e.terminate()), Promise.resolve();
    var t3, e;
  }, t2;
}();
var Ju = /* @__PURE__ */ __name(function(t2) {
  this._delegate = t2;
}, "Ju");
var Xu = function() {
  function t2(t3, e, n2) {
    this._converter = e, this._key = n2, this.type = "document", this.firestore = t3;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "_path", {
    get: function() {
      return this._key.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._key.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this._key.path.canonicalString();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "parent", {
    get: function() {
      return new Zu(this.firestore, this._converter, this._key.path.popLast());
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e, this._key);
  }, t2;
}();
var $u = function() {
  function t2(t3, e, n2) {
    this._converter = e, this._query = n2, this.type = "query", this.firestore = t3;
  }
  __name(t2, "t");
  return t2.prototype.withConverter = function(e) {
    return new t2(this.firestore, e, this._query);
  }, t2;
}();
var Zu = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, e2, n2, Gt(r2)) || this).firestore = e2, i._path = r2, i.type = "collection", i;
  }
  __name(e, "e");
  return __extends(e, t2), Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this._query.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "path", {
    get: function() {
      return this._query.path.canonicalString();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "parent", {
    get: function() {
      var t3 = this._path.popLast();
      return t3.isEmpty() ? null : new Xu(this.firestore, null, new H2(t3));
    },
    enumerable: false,
    configurable: true
  }), e.prototype.withConverter = function(t3) {
    return new e(this.firestore, t3, this._path);
  }, e;
}($u);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ta2(t2, e) {
  for (var n2, r2 = [], i = 2; i < arguments.length; i++)
    r2[i - 2] = arguments[i];
  if (t2 instanceof Ju && (t2 = t2._delegate), Uu("collection", "path", e), t2 instanceof Yu)
    return Ku(n2 = z2.fromString.apply(z2, __spreadArray([e], r2))), new Zu(t2, null, n2);
  if (!(t2 instanceof Xu || t2 instanceof Zu))
    throw new G2(j.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
  return Ku(n2 = z2.fromString.apply(z2, __spreadArray([t2.path], r2)).child(z2.fromString(e))), new Zu(t2.firestore, null, n2);
}
__name(ta2, "ta");
function ea2(t2, e) {
  for (var n2, r2 = [], i = 2; i < arguments.length; i++)
    r2[i - 2] = arguments[i];
  if (t2 instanceof Ju && (t2 = t2._delegate), arguments.length === 1 && (e = L2.u()), Uu("doc", "path", e), t2 instanceof Yu)
    return Gu(n2 = z2.fromString.apply(z2, __spreadArray([e], r2))), new Xu(t2, null, new H2(n2));
  if (!(t2 instanceof Xu || t2 instanceof Zu))
    throw new G2(j.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
  return Gu(n2 = t2._path.child(z2.fromString.apply(z2, __spreadArray([e], r2)))), new Xu(t2.firestore, t2 instanceof Zu ? t2._converter : null, new H2(n2));
}
__name(ea2, "ea");
function na2(t2, e) {
  return t2 instanceof Ju && (t2 = t2._delegate), e instanceof Ju && (e = e._delegate), (t2 instanceof Xu || t2 instanceof Zu) && (e instanceof Xu || e instanceof Zu) && t2.firestore === e.firestore && t2.path === e.path && t2._converter === e._converter;
}
__name(na2, "na");
function ra2(t2, e) {
  return t2 instanceof Ju && (t2 = t2._delegate), e instanceof Ju && (e = e._delegate), t2 instanceof $u && e instanceof $u && t2.firestore === e.firestore && $t(t2._query, e._query) && t2._converter === e._converter;
}
__name(ra2, "ra");
var ia = function() {
  function t2() {
    var t3 = this;
    this.yc = Promise.resolve(), this.gc = [], this.Ec = false, this.Tc = [], this.Ic = null, this.Ac = false, this.Rc = [], this.rr = new Lo(this, "async_queue_retry"), this.bc = function() {
      var e2 = Co();
      e2 && _("AsyncQueue", "Visibility state changed to " + e2.visibilityState), t3.rr.Zi();
    };
    var e = Co();
    e && typeof e.addEventListener == "function" && e.addEventListener("visibilitychange", this.bc);
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "isShuttingDown", {
    get: function() {
      return this.Ec;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.enqueueAndForget = function(t3) {
    this.enqueue(t3);
  }, t2.prototype.enqueueAndForgetEvenWhileRestricted = function(t3) {
    this.vc(), this.Pc(t3);
  }, t2.prototype.enterRestrictedMode = function() {
    if (!this.Ec) {
      this.Ec = true;
      var t3 = Co();
      t3 && typeof t3.removeEventListener == "function" && t3.removeEventListener("visibilitychange", this.bc);
    }
  }, t2.prototype.enqueue = function(t3) {
    return this.vc(), this.Ec ? new Promise(function(t4) {
    }) : this.Pc(t3);
  }, t2.prototype.enqueueRetryable = function(t3) {
    var e = this;
    this.enqueueAndForget(function() {
      return e.gc.push(t3), e.Vc();
    });
  }, t2.prototype.Vc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3, e = this;
      return __generator(this, function(n2) {
        switch (n2.label) {
          case 0:
            if (this.gc.length === 0)
              return [3, 5];
            n2.label = 1;
          case 1:
            return n2.trys.push([1, 3, , 4]), [4, this.gc[0]()];
          case 2:
            return n2.sent(), this.gc.shift(), this.rr.reset(), [3, 4];
          case 3:
            if (!Nr(t3 = n2.sent()))
              throw t3;
            return _("AsyncQueue", "Operation failed with retryable error: " + t3), [3, 4];
          case 4:
            this.gc.length > 0 && this.rr.Yi(function() {
              return e.Vc();
            }), n2.label = 5;
          case 5:
            return [2];
        }
      });
    });
  }, t2.prototype.Pc = function(t3) {
    var e = this, n2 = this.yc.then(function() {
      return e.Ac = true, t3().catch(function(t4) {
        throw e.Ic = t4, e.Ac = false, S2("INTERNAL UNHANDLED ERROR: ", function(t5) {
          var e2 = t5.message || "";
          return t5.stack && (e2 = t5.stack.includes(t5.message) ? t5.stack : t5.message + "\n" + t5.stack), e2;
        }(t4)), t4;
      }).then(function(t4) {
        return e.Ac = false, t4;
      });
    });
    return this.yc = n2, n2;
  }, t2.prototype.enqueueAfterDelay = function(t3, e, n2) {
    var r2 = this;
    this.vc(), this.Rc.indexOf(t3) > -1 && (e = 0);
    var i = hs.createAndSchedule(this, t3, e, n2, function(t4) {
      return r2.Sc(t4);
    });
    return this.Tc.push(i), i;
  }, t2.prototype.vc = function() {
    this.Ic && A2();
  }, t2.prototype.verifyOperationInProgress = function() {
  }, t2.prototype.Dc = function() {
    return __awaiter(this, void 0, void 0, function() {
      var t3;
      return __generator(this, function(e) {
        switch (e.label) {
          case 0:
            return [4, t3 = this.yc];
          case 1:
            e.sent(), e.label = 2;
          case 2:
            if (t3 !== this.yc)
              return [3, 0];
            e.label = 3;
          case 3:
            return [2];
        }
      });
    });
  }, t2.prototype.Cc = function(t3) {
    for (var e = 0, n2 = this.Tc; e < n2.length; e++) {
      if (n2[e].timerId === t3)
        return true;
    }
    return false;
  }, t2.prototype.xc = function(t3) {
    var e = this;
    return this.Dc().then(function() {
      e.Tc.sort(function(t4, e2) {
        return t4.targetTimeMs - e2.targetTimeMs;
      });
      for (var n2 = 0, r2 = e.Tc; n2 < r2.length; n2++) {
        var i = r2[n2];
        if (i.skipDelay(), t3 !== "all" && i.timerId === t3)
          break;
      }
      return e.Dc();
    });
  }, t2.prototype.Nc = function(t3) {
    this.Rc.push(t3);
  }, t2.prototype.Sc = function(t3) {
    var e = this.Tc.indexOf(t3);
    this.Tc.splice(e, 1);
  }, t2;
}();
function oa2(t2) {
  return function(t3, e) {
    if (typeof t3 != "object" || t3 === null)
      return false;
    for (var n2 = t3, r2 = 0, i = ["next", "error", "complete"]; r2 < i.length; r2++) {
      var o = i[r2];
      if (o in n2 && typeof n2[o] == "function")
        return true;
    }
    return false;
  }(t2);
}
__name(oa2, "oa");
var sa2 = function() {
  function t2() {
    this._progressObserver = {}, this._taskCompletionResolver = new Ir(), this._lastProgress = {
      taskState: "Running",
      totalBytes: 0,
      totalDocuments: 0,
      bytesLoaded: 0,
      documentsLoaded: 0
    };
  }
  __name(t2, "t");
  return t2.prototype.onProgress = function(t3, e, n2) {
    this._progressObserver = {
      next: t3,
      error: e,
      complete: n2
    };
  }, t2.prototype.catch = function(t3) {
    return this._taskCompletionResolver.promise.catch(t3);
  }, t2.prototype.then = function(t3, e) {
    return this._taskCompletionResolver.promise.then(t3, e);
  }, t2.prototype._completeWith = function(t3) {
    this._updateProgress(t3), this._progressObserver.complete && this._progressObserver.complete(), this._taskCompletionResolver.resolve(t3);
  }, t2.prototype._failWith = function(t3) {
    this._lastProgress.taskState = "Error", this._progressObserver.next && this._progressObserver.next(this._lastProgress), this._progressObserver.error && this._progressObserver.error(t3), this._taskCompletionResolver.reject(t3);
  }, t2.prototype._updateProgress = function(t3) {
    this._lastProgress = t3, this._progressObserver.next && this._progressObserver.next(t3);
  }, t2;
}();
var ua2 = -1;
var aa2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this)._queue = new ia(), r2._persistenceKey = "name" in e2 ? e2.name : "[DEFAULT]", r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._terminate = function() {
    return this._firestoreClient || ha2(this), this._firestoreClient.terminate();
  }, e;
}(Yu);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ca2(t2) {
  return t2._firestoreClient || ha2(t2), t2._firestoreClient.verifyNotTerminated(), t2._firestoreClient;
}
__name(ca2, "ca");
function ha2(t2) {
  var e = t2._freezeSettings(), n2 = function(t3, e2, n3) {
    return new Lu(t3, e2, n3.host, n3.ssl, n3.experimentalForceLongPolling, n3.experimentalAutoDetectLongPolling);
  }(t2._databaseId, t2._persistenceKey, e);
  t2._firestoreClient = new bu(t2._credentials, t2._queue, n2);
}
__name(ha2, "ha");
function fa2(t2, e, n2) {
  var r2 = this, i = new Ir();
  return t2.asyncQueue.enqueue(function() {
    return __awaiter(r2, void 0, void 0, function() {
      var r3;
      return __generator(this, function(o) {
        switch (o.label) {
          case 0:
            return o.trys.push([0, 3, , 4]), [4, Iu(t2, n2)];
          case 1:
            return o.sent(), [4, Eu(t2, e)];
          case 2:
            return o.sent(), i.resolve(), [3, 4];
          case 3:
            if (!function(t3) {
              return t3.name === "FirebaseError" ? t3.code === j.FAILED_PRECONDITION || t3.code === j.UNIMPLEMENTED : !(typeof DOMException != "undefined" && t3 instanceof DOMException) || (t3.code === 22 || t3.code === 20 || t3.code === 11);
            }(r3 = o.sent()))
              throw r3;
            return console.warn("Error enabling offline persistence. Falling back to persistence disabled: " + r3), i.reject(r3), [3, 4];
          case 4:
            return [2];
        }
      });
    });
  }).then(function() {
    return i.promise;
  });
}
__name(fa2, "fa");
function la(t2) {
  if (t2._initialized || t2._terminated)
    throw new G2(j.FAILED_PRECONDITION, "Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");
}
__name(la, "la");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var da2 = function() {
  function t2() {
    for (var t3 = [], e = 0; e < arguments.length; e++)
      t3[e] = arguments[e];
    for (var n2 = 0; n2 < t3.length; ++n2)
      if (t3[n2].length === 0)
        throw new G2(j.INVALID_ARGUMENT, "Invalid field name at argument $(i + 1). Field names must not be empty.");
    this._internalPath = new W2(t3);
  }
  __name(t2, "t");
  return t2.prototype.isEqual = function(t3) {
    return this._internalPath.isEqual(t3._internalPath);
  }, t2;
}();
var pa2 = function() {
  function t2(t3) {
    this._byteString = t3;
  }
  __name(t2, "t");
  return t2.fromBase64String = function(e) {
    try {
      return new t2(Y2.fromBase64String(e));
    } catch (e2) {
      throw new G2(j.INVALID_ARGUMENT, "Failed to construct data from Base64 string: " + e2);
    }
  }, t2.fromUint8Array = function(e) {
    return new t2(Y2.fromUint8Array(e));
  }, t2.prototype.toBase64 = function() {
    return this._byteString.toBase64();
  }, t2.prototype.toUint8Array = function() {
    return this._byteString.toUint8Array();
  }, t2.prototype.toString = function() {
    return "Bytes(base64: " + this.toBase64() + ")";
  }, t2.prototype.isEqual = function(t3) {
    return this._byteString.isEqual(t3._byteString);
  }, t2;
}();
var ya = /* @__PURE__ */ __name(function(t2) {
  this._methodName = t2;
}, "ya");
var va = function() {
  function t2(t3, e) {
    if (!isFinite(t3) || t3 < -90 || t3 > 90)
      throw new G2(j.INVALID_ARGUMENT, "Latitude must be a number between -90 and 90, but was: " + t3);
    if (!isFinite(e) || e < -180 || e > 180)
      throw new G2(j.INVALID_ARGUMENT, "Longitude must be a number between -180 and 180, but was: " + e);
    this._lat = t3, this._long = e;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "latitude", {
    get: function() {
      return this._lat;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "longitude", {
    get: function() {
      return this._long;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.isEqual = function(t3) {
    return this._lat === t3._lat && this._long === t3._long;
  }, t2.prototype.toJSON = function() {
    return {
      latitude: this._lat,
      longitude: this._long
    };
  }, t2.prototype._compareTo = function(t3) {
    return R2(this._lat, t3._lat) || R2(this._long, t3._long);
  }, t2;
}();
var ma2 = /^__.*__$/;
var ga = function() {
  function t2(t3, e, n2) {
    this.data = t3, this.fieldMask = e, this.fieldTransforms = n2;
  }
  __name(t2, "t");
  return t2.prototype.toMutation = function(t3, e) {
    return this.fieldMask !== null ? new Pe(t3, this.data, this.fieldMask, e, this.fieldTransforms) : new Oe(t3, this.data, e, this.fieldTransforms);
  }, t2;
}();
var wa = function() {
  function t2(t3, e, n2) {
    this.data = t3, this.fieldMask = e, this.fieldTransforms = n2;
  }
  __name(t2, "t");
  return t2.prototype.toMutation = function(t3, e) {
    return new Pe(t3, this.data, this.fieldMask, e, this.fieldTransforms);
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ba2(t2) {
  switch (t2) {
    case 0:
    case 2:
    case 1:
      return true;
    case 3:
    case 4:
      return false;
    default:
      throw A2();
  }
}
__name(ba2, "ba");
var Ia2 = function() {
  function t2(t3, e, n2, r2, i, o) {
    this.settings = t3, this.databaseId = e, this.D = n2, this.ignoreUndefinedProperties = r2, i === void 0 && this.$c(), this.fieldTransforms = i || [], this.fieldMask = o || [];
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "path", {
    get: function() {
      return this.settings.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "Fc", {
    get: function() {
      return this.settings.Fc;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.Oc = function(e) {
    return new t2(Object.assign(Object.assign({}, this.settings), e), this.databaseId, this.D, this.ignoreUndefinedProperties, this.fieldTransforms, this.fieldMask);
  }, t2.prototype.kc = function(t3) {
    var e, n2 = (e = this.path) === null || e === void 0 ? void 0 : e.child(t3), r2 = this.Oc({
      path: n2,
      Mc: false
    });
    return r2.Lc(t3), r2;
  }, t2.prototype.Bc = function(t3) {
    var e, n2 = (e = this.path) === null || e === void 0 ? void 0 : e.child(t3), r2 = this.Oc({
      path: n2,
      Mc: false
    });
    return r2.$c(), r2;
  }, t2.prototype.qc = function(t3) {
    return this.Oc({
      path: void 0,
      Mc: true
    });
  }, t2.prototype.Uc = function(t3) {
    return Ba2(t3, this.settings.methodName, this.settings.Qc || false, this.path, this.settings.Kc);
  }, t2.prototype.contains = function(t3) {
    return this.fieldMask.find(function(e) {
      return t3.isPrefixOf(e);
    }) !== void 0 || this.fieldTransforms.find(function(e) {
      return t3.isPrefixOf(e.field);
    }) !== void 0;
  }, t2.prototype.$c = function() {
    if (this.path)
      for (var t3 = 0; t3 < this.path.length; t3++)
        this.Lc(this.path.get(t3));
  }, t2.prototype.Lc = function(t3) {
    if (t3.length === 0)
      throw this.Uc("Document fields must not be empty");
    if (ba2(this.Fc) && ma2.test(t3))
      throw this.Uc('Document fields cannot begin and end with "__"');
  }, t2;
}();
var Ea2 = function() {
  function t2(t3, e, n2) {
    this.databaseId = t3, this.ignoreUndefinedProperties = e, this.D = n2 || xo(t3);
  }
  __name(t2, "t");
  return t2.prototype.Wc = function(t3, e, n2, r2) {
    return r2 === void 0 && (r2 = false), new Ia2({
      Fc: t3,
      methodName: e,
      Kc: n2,
      path: W2.emptyPath(),
      Mc: false,
      Qc: r2
    }, this.databaseId, this.D, this.ignoreUndefinedProperties);
  }, t2;
}();
function Ta2(t2) {
  var e = t2._freezeSettings(), n2 = xo(t2._databaseId);
  return new Ea2(t2._databaseId, !!e.ignoreUndefinedProperties, n2);
}
__name(Ta2, "Ta");
function _a(t2, e, n2, r2, i, o) {
  o === void 0 && (o = {});
  var s = t2.Wc(o.merge || o.mergeFields ? 2 : 0, e, n2, i);
  Fa2("Data must be an object, but it was:", s, r2);
  var u, a, c = Pa(r2, s);
  if (o.merge)
    u = new oe(s.fieldMask), a = s.fieldTransforms;
  else if (o.mergeFields) {
    for (var h2 = [], f = 0, l = o.mergeFields; f < l.length; f++) {
      var d = qa2(e, l[f], n2);
      if (!s.contains(d))
        throw new G2(j.INVALID_ARGUMENT, "Field '" + d + "' is specified in your field mask but missing from your input data.");
      ja2(h2, d) || h2.push(d);
    }
    u = new oe(h2), a = s.fieldTransforms.filter(function(t3) {
      return u.covers(t3.field);
    });
  } else
    u = null, a = s.fieldTransforms;
  return new ga(new se(c), u, a);
}
__name(_a, "_a");
var Sa = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    if (t3.Fc !== 2)
      throw t3.Fc === 1 ? t3.Uc(this._methodName + "() can only appear at the top level of your update data") : t3.Uc(this._methodName + "() cannot be used with set() unless you pass {merge:true}");
    return t3.fieldMask.push(t3.path), null;
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof e;
  }, e;
}(ya);
function Da2(t2, e, n2) {
  return new Ia2({
    Fc: 3,
    Kc: e.settings.Kc,
    methodName: t2._methodName,
    Mc: n2
  }, e.databaseId, e.D, e.ignoreUndefinedProperties);
}
__name(Da2, "Da");
var Na = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    return new _e(t3.path, new ve());
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof e;
  }, e;
}(ya);
var Aa2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).jc = n2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    var e2 = Da2(this, t3, true), n2 = this.jc.map(function(t4) {
      return Oa(t4, e2);
    }), r2 = new me(n2);
    return new _e(t3.path, r2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(ya);
var ka2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).jc = n2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    var e2 = Da2(this, t3, true), n2 = this.jc.map(function(t4) {
      return Oa(t4, e2);
    }), r2 = new we(n2);
    return new _e(t3.path, r2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(ya);
var Ca2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2) || this).Gc = n2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._toFieldTransform = function(t3) {
    var e2 = new Ie(t3.D, fe(t3.D, this.Gc));
    return new _e(t3.path, e2);
  }, e.prototype.isEqual = function(t3) {
    return this === t3;
  }, e;
}(ya);
function xa(t2, e, n2, r2) {
  var i = t2.Wc(1, e, n2);
  Fa2("Data must be an object, but it was:", i, r2);
  var o = [], s = new ue();
  F2(r2, function(t3, r3) {
    var u2 = Ua2(e, t3, n2);
    r3 instanceof Ju && (r3 = r3._delegate);
    var a = i.Bc(u2);
    if (r3 instanceof Sa)
      o.push(u2);
    else {
      var c = Oa(r3, a);
      c != null && (o.push(u2), s.set(u2, c));
    }
  });
  var u = new oe(o);
  return new wa(s.v(), u, i.fieldTransforms);
}
__name(xa, "xa");
function La2(t2, e, n2, r2, i, o) {
  var s = t2.Wc(1, e, n2), u = [qa2(e, r2, n2)], a = [i];
  if (o.length % 2 != 0)
    throw new G2(j.INVALID_ARGUMENT, "Function " + e + "() needs to be called with an even number of arguments that alternate between field names and values.");
  for (var c = 0; c < o.length; c += 2)
    u.push(qa2(e, o[c])), a.push(o[c + 1]);
  for (var h2 = [], f = new ue(), l = u.length - 1; l >= 0; --l)
    if (!ja2(h2, u[l])) {
      var d = u[l], p2 = a[l];
      p2 instanceof Ju && (p2 = p2._delegate);
      var y2 = s.Bc(d);
      if (p2 instanceof Sa)
        h2.push(d);
      else {
        var v2 = Oa(p2, y2);
        v2 != null && (h2.push(d), f.set(d, v2));
      }
    }
  var m = new oe(h2);
  return new wa(f.v(), m, s.fieldTransforms);
}
__name(La2, "La");
function Ra2(t2, e, n2, r2) {
  return r2 === void 0 && (r2 = false), Oa(n2, t2.Wc(r2 ? 4 : 3, e));
}
__name(Ra2, "Ra");
function Oa(t2, e) {
  if (t2 instanceof Ju && (t2 = t2._delegate), Ma2(t2))
    return Fa2("Unsupported field value:", e, t2), Pa(t2, e);
  if (t2 instanceof ya)
    return function(t3, e2) {
      if (!ba2(e2.Fc))
        throw e2.Uc(t3._methodName + "() can only be used with update() and set()");
      if (!e2.path)
        throw e2.Uc(t3._methodName + "() is not currently supported inside arrays");
      var n2 = t3._toFieldTransform(e2);
      n2 && e2.fieldTransforms.push(n2);
    }(t2, e), null;
  if (t2 === void 0 && e.ignoreUndefinedProperties)
    return null;
  if (e.path && e.fieldMask.push(e.path), t2 instanceof Array) {
    if (e.settings.Mc && e.Fc !== 4)
      throw e.Uc("Nested arrays are not supported");
    return function(t3, e2) {
      for (var n2 = [], r2 = 0, i = 0, o = t3; i < o.length; i++) {
        var s = Oa(o[i], e2.qc(r2));
        s == null && (s = {
          nullValue: "NULL_VALUE"
        }), n2.push(s), r2++;
      }
      return {
        arrayValue: {
          values: n2
        }
      };
    }(t2, e);
  }
  return function(t3, e2) {
    if (t3 instanceof Ju && (t3 = t3._delegate), t3 === null)
      return {
        nullValue: "NULL_VALUE"
      };
    if (typeof t3 == "number")
      return fe(e2.D, t3);
    if (typeof t3 == "boolean")
      return {
        booleanValue: t3
      };
    if (typeof t3 == "string")
      return {
        stringValue: t3
      };
    if (t3 instanceof Date) {
      var n2 = tt.fromDate(t3);
      return {
        timestampValue: En(e2.D, n2)
      };
    }
    if (t3 instanceof tt) {
      n2 = new tt(t3.seconds, 1e3 * Math.floor(t3.nanoseconds / 1e3));
      return {
        timestampValue: En(e2.D, n2)
      };
    }
    if (t3 instanceof va)
      return {
        geoPointValue: {
          latitude: t3.latitude,
          longitude: t3.longitude
        }
      };
    if (t3 instanceof pa2)
      return {
        bytesValue: Tn(e2.D, t3._byteString)
      };
    if (t3 instanceof Xu) {
      n2 = e2.databaseId;
      var r2 = t3.firestore._databaseId;
      if (!r2.isEqual(n2))
        throw e2.Uc("Document reference is for database " + r2.projectId + "/" + r2.database + " but should be for database " + n2.projectId + "/" + n2.database);
      return {
        referenceValue: Dn(t3.firestore._databaseId || e2.databaseId, t3._key.path)
      };
    }
    throw e2.Uc("Unsupported field value: " + zu(t3));
  }(t2, e);
}
__name(Oa, "Oa");
function Pa(t2, e) {
  var n2 = {};
  return q2(t2) ? e.path && e.path.length > 0 && e.fieldMask.push(e.path) : F2(t2, function(t3, r2) {
    var i = Oa(r2, e.kc(t3));
    i != null && (n2[t3] = i);
  }), {
    mapValue: {
      fields: n2
    }
  };
}
__name(Pa, "Pa");
function Ma2(t2) {
  return !(typeof t2 != "object" || t2 === null || t2 instanceof Array || t2 instanceof Date || t2 instanceof tt || t2 instanceof va || t2 instanceof pa2 || t2 instanceof Xu || t2 instanceof ya);
}
__name(Ma2, "Ma");
function Fa2(t2, e, n2) {
  if (!Ma2(n2) || !function(t3) {
    return typeof t3 == "object" && t3 !== null && (Object.getPrototypeOf(t3) === Object.prototype || Object.getPrototypeOf(t3) === null);
  }(n2)) {
    var r2 = zu(n2);
    throw r2 === "an object" ? e.Uc(t2 + " a custom object") : e.Uc(t2 + " " + r2);
  }
}
__name(Fa2, "Fa");
function qa2(t2, e, n2) {
  if (e instanceof Ju && (e = e._delegate), e instanceof da2)
    return e._internalPath;
  if (typeof e == "string")
    return Ua2(t2, e);
  throw Ba2("Field path arguments must be of type string or FieldPath.", t2, false, void 0, n2);
}
__name(qa2, "qa");
var Va2 = new RegExp("[~\\*/\\[\\]]");
function Ua2(t2, e, n2) {
  if (e.search(Va2) >= 0)
    throw Ba2("Invalid field path (" + e + "). Paths must not contain '~', '*', '/', '[', or ']'", t2, false, void 0, n2);
  try {
    return new (da2.bind.apply(da2, __spreadArray([void 0], e.split("."))))()._internalPath;
  } catch (r2) {
    throw Ba2("Invalid field path (" + e + "). Paths must not be empty, begin with '.', end with '.', or contain '..'", t2, false, void 0, n2);
  }
}
__name(Ua2, "Ua");
function Ba2(t2, e, n2, r2, i) {
  var o = r2 && !r2.isEmpty(), s = i !== void 0, u = "Function " + e + "() called with invalid data";
  n2 && (u += " (via `toFirestore()`)");
  var a = "";
  return (o || s) && (a += " (found", o && (a += " in field " + r2), s && (a += " in document " + i), a += ")"), new G2(j.INVALID_ARGUMENT, (u += ". ") + t2 + a);
}
__name(Ba2, "Ba");
function ja2(t2, e) {
  return t2.some(function(t3) {
    return t3.isEqual(e);
  });
}
__name(ja2, "ja");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ga2 = function() {
  function t2(t3, e, n2, r2, i) {
    this._firestore = t3, this._userDataWriter = e, this._key = n2, this._document = r2, this._converter = i;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "id", {
    get: function() {
      return this._key.path.lastSegment();
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "ref", {
    get: function() {
      return new Xu(this._firestore, this._converter, this._key);
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.exists = function() {
    return this._document !== null;
  }, t2.prototype.data = function() {
    if (this._document) {
      if (this._converter) {
        var t3 = new Ka2(this._firestore, this._userDataWriter, this._key, this._document, null);
        return this._converter.fromFirestore(t3);
      }
      return this._userDataWriter.convertValue(this._document.toProto());
    }
  }, t2.prototype.get = function(t3) {
    if (this._document) {
      var e = this._document.data().field(za2("DocumentSnapshot.get", t3));
      if (e !== null)
        return this._userDataWriter.convertValue(e);
    }
  }, t2;
}();
var Ka2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.data = function() {
    return t2.prototype.data.call(this);
  }, e;
}(Ga2);
function za2(t2, e) {
  return typeof e == "string" ? Ua2(t2, e) : e instanceof Ju ? e._delegate._internalPath : e._internalPath;
}
__name(za2, "za");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Qa2 = function() {
  function t2(t3, e) {
    this.hasPendingWrites = t3, this.fromCache = e;
  }
  __name(t2, "t");
  return t2.prototype.isEqual = function(t3) {
    return this.hasPendingWrites === t3.hasPendingWrites && this.fromCache === t3.fromCache;
  }, t2;
}();
var Wa2 = function(t2) {
  function e(e2, n2, r2, i, o, s) {
    var u = this;
    return (u = t2.call(this, e2, n2, r2, i, s) || this)._firestore = e2, u._firestoreImpl = e2, u.metadata = o, u;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.exists = function() {
    return t2.prototype.exists.call(this);
  }, e.prototype.data = function(t3) {
    if (t3 === void 0 && (t3 = {}), this._document) {
      if (this._converter) {
        var e2 = new Ha2(this._firestore, this._userDataWriter, this._key, this._document, this.metadata, null);
        return this._converter.fromFirestore(e2, t3);
      }
      return this._userDataWriter.convertValue(this._document.toProto(), t3.serverTimestamps);
    }
  }, e.prototype.get = function(t3, e2) {
    if (e2 === void 0 && (e2 = {}), this._document) {
      var n2 = this._document.data().field(za2("DocumentSnapshot.get", t3));
      if (n2 !== null)
        return this._userDataWriter.convertValue(n2, e2.serverTimestamps);
    }
  }, e;
}(Ga2);
var Ha2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.data = function(e2) {
    return e2 === void 0 && (e2 = {}), t2.prototype.data.call(this, e2);
  }, e;
}(Wa2);
var Ya2 = function() {
  function t2(t3, e, n2, r2) {
    this._firestore = t3, this._userDataWriter = e, this._snapshot = r2, this.metadata = new Qa2(r2.hasPendingWrites, r2.fromCache), this.query = n2;
  }
  __name(t2, "t");
  return Object.defineProperty(t2.prototype, "docs", {
    get: function() {
      var t3 = [];
      return this.forEach(function(e) {
        return t3.push(e);
      }), t3;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "size", {
    get: function() {
      return this._snapshot.docs.size;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(t2.prototype, "empty", {
    get: function() {
      return this.size === 0;
    },
    enumerable: false,
    configurable: true
  }), t2.prototype.forEach = function(t3, e) {
    var n2 = this;
    this._snapshot.docs.forEach(function(r2) {
      t3.call(e, new Ha2(n2._firestore, n2._userDataWriter, r2.key, r2, new Qa2(n2._snapshot.mutatedKeys.has(r2.key), n2._snapshot.fromCache), n2.query._converter));
    });
  }, t2.prototype.docChanges = function(t3) {
    t3 === void 0 && (t3 = {});
    var e = !!t3.includeMetadataChanges;
    if (e && this._snapshot.excludesMetadataChanges)
      throw new G2(j.INVALID_ARGUMENT, "To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");
    return this._cachedChanges && this._cachedChangesIncludeMetadataChanges === e || (this._cachedChanges = function(t4, e2) {
      if (t4._snapshot.oldDocs.isEmpty()) {
        var n2 = 0;
        return t4._snapshot.docChanges.map(function(e3) {
          var r3 = new Ha2(t4._firestore, t4._userDataWriter, e3.doc.key, e3.doc, new Qa2(t4._snapshot.mutatedKeys.has(e3.doc.key), t4._snapshot.fromCache), t4.query._converter);
          return e3.doc, {
            type: "added",
            doc: r3,
            oldIndex: -1,
            newIndex: n2++
          };
        });
      }
      var r2 = t4._snapshot.oldDocs;
      return t4._snapshot.docChanges.filter(function(t5) {
        return e2 || t5.type !== 3;
      }).map(function(e3) {
        var n3 = new Ha2(t4._firestore, t4._userDataWriter, e3.doc.key, e3.doc, new Qa2(t4._snapshot.mutatedKeys.has(e3.doc.key), t4._snapshot.fromCache), t4.query._converter), i = -1, o = -1;
        return e3.type !== 0 && (i = r2.indexOf(e3.doc.key), r2 = r2.delete(e3.doc.key)), e3.type !== 1 && (o = (r2 = r2.add(e3.doc)).indexOf(e3.doc.key)), {
          type: Ja2(e3.type),
          doc: n3,
          oldIndex: i,
          newIndex: o
        };
      });
    }(this, e), this._cachedChangesIncludeMetadataChanges = e), this._cachedChanges;
  }, t2;
}();
function Ja2(t2) {
  switch (t2) {
    case 0:
      return "added";
    case 2:
    case 3:
      return "modified";
    case 1:
      return "removed";
    default:
      return A2();
  }
}
__name(Ja2, "Ja");
function Xa2(t2, e) {
  return t2 instanceof Wa2 && e instanceof Wa2 ? t2._firestore === e._firestore && t2._key.isEqual(e._key) && (t2._document === null ? e._document === null : t2._document.isEqual(e._document)) && t2._converter === e._converter : t2 instanceof Ya2 && e instanceof Ya2 && t2._firestore === e._firestore && ra2(t2.query, e.query) && t2.metadata.isEqual(e.metadata) && t2._snapshot.isEqual(e._snapshot);
}
__name(Xa2, "Xa");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function $a2(t2) {
  if (zt(t2) && t2.explicitOrderBy.length === 0)
    throw new G2(j.UNIMPLEMENTED, "limitToLast() queries require specifying at least one orderBy() clause");
}
__name($a2, "$a");
var Za2 = /* @__PURE__ */ __name(function() {
}, "Za");
function tc(t2) {
  for (var e = [], n2 = 1; n2 < arguments.length; n2++)
    e[n2 - 1] = arguments[n2];
  for (var r2 = 0, i = e; r2 < i.length; r2++) {
    var o = i[r2];
    t2 = o._apply(t2);
  }
  return t2;
}
__name(tc, "tc");
var ec2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).zc = e2, i.Hc = n2, i.Jc = r2, i.type = "where", i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._apply = function(t3) {
    var e2 = Ta2(t3.firestore), n2 = function(t4, e3, n3, r2, i, o, s) {
      var u;
      if (i.isKeyField()) {
        if (o === "array-contains" || o === "array-contains-any")
          throw new G2(j.INVALID_ARGUMENT, "Invalid Query. You can't perform '" + o + "' queries on FieldPath.documentId().");
        if (o === "in" || o === "not-in") {
          ac2(s, o);
          for (var a = [], c = 0, h2 = s; c < h2.length; c++) {
            var f = h2[c];
            a.push(uc2(r2, t4, f));
          }
          u = {
            arrayValue: {
              values: a
            }
          };
        } else
          u = uc2(r2, t4, s);
      } else
        o !== "in" && o !== "not-in" && o !== "array-contains-any" || ac2(s, o), u = Ra2(n3, "where", s, o === "in" || o === "not-in");
      var l = Dt.create(i, o, u);
      return function(t5, e4) {
        if (e4.g()) {
          var n4 = Wt(t5);
          if (n4 !== null && !n4.isEqual(e4.field))
            throw new G2(j.INVALID_ARGUMENT, "Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '" + n4.toString() + "' and '" + e4.field.toString() + "'");
          var r3 = Qt(t5);
          r3 !== null && cc2(t5, e4.field, r3);
        }
        var i2 = function(t6, e5) {
          for (var n5 = 0, r4 = t6.filters; n5 < r4.length; n5++) {
            var i3 = r4[n5];
            if (e5.indexOf(i3.op) >= 0)
              return i3.op;
          }
          return null;
        }(t5, function(t6) {
          switch (t6) {
            case "!=":
              return ["!=", "not-in"];
            case "array-contains":
              return ["array-contains", "array-contains-any", "not-in"];
            case "in":
              return ["array-contains-any", "in", "not-in"];
            case "array-contains-any":
              return ["array-contains", "array-contains-any", "in", "not-in"];
            case "not-in":
              return ["array-contains", "array-contains-any", "in", "not-in", "!="];
            default:
              return [];
          }
        }(e4.op));
        if (i2 !== null)
          throw i2 === e4.op ? new G2(j.INVALID_ARGUMENT, "Invalid query. You cannot use more than one '" + e4.op.toString() + "' filter.") : new G2(j.INVALID_ARGUMENT, "Invalid query. You cannot use '" + e4.op.toString() + "' filters with '" + i2.toString() + "' filters.");
      }(t4, l), l;
    }(t3._query, 0, e2, t3.firestore._databaseId, this.zc, this.Hc, this.Jc);
    return new $u(t3.firestore, t3._converter, function(t4, e3) {
      var n3 = t4.filters.concat([e3]);
      return new Bt(t4.path, t4.collectionGroup, t4.explicitOrderBy.slice(), n3, t4.limit, t4.limitType, t4.startAt, t4.endAt);
    }(t3._query, n2));
  }, e;
}(Za2);
var nc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this) || this).zc = e2, r2.Yc = n2, r2.type = "orderBy", r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._apply = function(t3) {
    var e2 = function(t4, e3, n2) {
      if (t4.startAt !== null)
        throw new G2(j.INVALID_ARGUMENT, "Invalid query. You must not call startAt() or startAfter() before calling orderBy().");
      if (t4.endAt !== null)
        throw new G2(j.INVALID_ARGUMENT, "Invalid query. You must not call endAt() or endBefore() before calling orderBy().");
      var r2 = new Ft(e3, n2);
      return function(t5, e4) {
        if (Qt(t5) === null) {
          var n3 = Wt(t5);
          n3 !== null && cc2(t5, n3, e4.field);
        }
      }(t4, r2), r2;
    }(t3._query, this.zc, this.Yc);
    return new $u(t3.firestore, t3._converter, function(t4, e3) {
      var n2 = t4.explicitOrderBy.concat([e3]);
      return new Bt(t4.path, t4.collectionGroup, n2, t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, t4.endAt);
    }(t3._query, e2));
  }, e;
}(Za2);
var rc2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.Xc = n2, i.Zc = r2, i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._apply = function(t3) {
    return new $u(t3.firestore, t3._converter, Xt(t3._query, this.Xc, this.Zc));
  }, e;
}(Za2);
var ic2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.ta = n2, i.ea = r2, i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._apply = function(t3) {
    var e2 = sc2(t3, this.type, this.ta, this.ea);
    return new $u(t3.firestore, t3._converter, function(t4, e3) {
      return new Bt(t4.path, t4.collectionGroup, t4.explicitOrderBy.slice(), t4.filters.slice(), t4.limit, t4.limitType, e3, t4.endAt);
    }(t3._query, e2));
  }, e;
}(Za2);
var oc2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this) || this).type = e2, i.ta = n2, i.ea = r2, i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype._apply = function(t3) {
    var e2 = sc2(t3, this.type, this.ta, this.ea);
    return new $u(t3.firestore, t3._converter, function(t4, e3) {
      return new Bt(t4.path, t4.collectionGroup, t4.explicitOrderBy.slice(), t4.filters.slice(), t4.limit, t4.limitType, t4.startAt, e3);
    }(t3._query, e2));
  }, e;
}(Za2);
function sc2(t2, e, n2, r2) {
  if (n2[0] instanceof Ju && (n2[0] = n2[0]._delegate), n2[0] instanceof Ga2)
    return function(t3, e2, n3, r3, i2) {
      if (!r3)
        throw new G2(j.NOT_FOUND, "Can't use a DocumentSnapshot that doesn't exist for " + n3 + "().");
      for (var o = [], s = 0, u = Yt(t3); s < u.length; s++) {
        var a = u[s];
        if (a.field.isKeyField())
          o.push(ft(e2, r3.key));
        else {
          var c = r3.field(a.field);
          if (et(c))
            throw new G2(j.INVALID_ARGUMENT, 'Invalid query. You are trying to start or end a query using a document for which the field "' + a.field + '" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');
          if (c === null) {
            var h2 = a.field.canonicalString();
            throw new G2(j.INVALID_ARGUMENT, "Invalid query. You are trying to start or end a query using a document for which the field '" + h2 + "' (used as the orderBy) does not exist.");
          }
          o.push(c);
        }
      }
      return new Pt(o, i2);
    }(t2._query, t2.firestore._databaseId, e, n2[0]._document, r2);
  var i = Ta2(t2.firestore);
  return function(t3, e2, n3, r3, i2, o) {
    var s = t3.explicitOrderBy;
    if (i2.length > s.length)
      throw new G2(j.INVALID_ARGUMENT, "Too many arguments provided to " + r3 + "(). The number of arguments must be less than or equal to the number of orderBy() clauses");
    for (var u = [], a = 0; a < i2.length; a++) {
      var c = i2[a];
      if (s[a].field.isKeyField()) {
        if (typeof c != "string")
          throw new G2(j.INVALID_ARGUMENT, "Invalid query. Expected a string for document ID in " + r3 + "(), but got a " + typeof c);
        if (!Ht(t3) && c.indexOf("/") !== -1)
          throw new G2(j.INVALID_ARGUMENT, "Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to " + r3 + "() must be a plain document ID, but '" + c + "' contains a slash.");
        var h2 = t3.path.child(z2.fromString(c));
        if (!H2.isDocumentKey(h2))
          throw new G2(j.INVALID_ARGUMENT, "Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to " + r3 + "() must result in a valid document path, but '" + h2 + "' is not because it contains an odd number of segments.");
        var f = new H2(h2);
        u.push(ft(e2, f));
      } else {
        var l = Ra2(n3, r3, c);
        u.push(l);
      }
    }
    return new Pt(u, o);
  }(t2._query, t2.firestore._databaseId, i, e, n2, r2);
}
__name(sc2, "sc");
function uc2(t2, e, n2) {
  if (n2 instanceof Ju && (n2 = n2._delegate), typeof n2 == "string") {
    if (n2 === "")
      throw new G2(j.INVALID_ARGUMENT, "Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");
    if (!Ht(e) && n2.indexOf("/") !== -1)
      throw new G2(j.INVALID_ARGUMENT, "Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '" + n2 + "' contains a '/' character.");
    var r2 = e.path.child(z2.fromString(n2));
    if (!H2.isDocumentKey(r2))
      throw new G2(j.INVALID_ARGUMENT, "Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '" + r2 + "' is not because it has an odd number of segments (" + r2.length + ").");
    return ft(t2, new H2(r2));
  }
  if (n2 instanceof Xu)
    return ft(t2, n2._key);
  throw new G2(j.INVALID_ARGUMENT, "Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: " + zu(n2) + ".");
}
__name(uc2, "uc");
function ac2(t2, e) {
  if (!Array.isArray(t2) || t2.length === 0)
    throw new G2(j.INVALID_ARGUMENT, "Invalid Query. A non-empty array is required for '" + e.toString() + "' filters.");
  if (t2.length > 10)
    throw new G2(j.INVALID_ARGUMENT, "Invalid Query. '" + e.toString() + "' filters support a maximum of 10 elements in the value array.");
}
__name(ac2, "ac");
function cc2(t2, e, n2) {
  if (!n2.isEqual(e))
    throw new G2(j.INVALID_ARGUMENT, "Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '" + e.toString() + "' and so you must also use '" + e.toString() + "' as your first argument to orderBy(), but your first orderBy() is on field '" + n2.toString() + "' instead.");
}
__name(cc2, "cc");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var hc2 = function() {
  function t2() {
  }
  __name(t2, "t");
  return t2.prototype.convertValue = function(t3, e) {
    switch (e === void 0 && (e = "none"), it(t3)) {
      case 0:
        return null;
      case 1:
        return t3.booleanValue;
      case 2:
        return $(t3.integerValue || t3.doubleValue);
      case 3:
        return this.convertTimestamp(t3.timestampValue);
      case 4:
        return this.convertServerTimestamp(t3, e);
      case 5:
        return t3.stringValue;
      case 6:
        return this.convertBytes(Z2(t3.bytesValue));
      case 7:
        return this.convertReference(t3.referenceValue);
      case 8:
        return this.convertGeoPoint(t3.geoPointValue);
      case 9:
        return this.convertArray(t3.arrayValue, e);
      case 10:
        return this.convertObject(t3.mapValue, e);
      default:
        throw A2();
    }
  }, t2.prototype.convertObject = function(t3, e) {
    var n2 = this, r2 = {};
    return F2(t3.fields || {}, function(t4, i) {
      r2[t4] = n2.convertValue(i, e);
    }), r2;
  }, t2.prototype.convertGeoPoint = function(t3) {
    return new va($(t3.latitude), $(t3.longitude));
  }, t2.prototype.convertArray = function(t3, e) {
    var n2 = this;
    return (t3.values || []).map(function(t4) {
      return n2.convertValue(t4, e);
    });
  }, t2.prototype.convertServerTimestamp = function(t3, e) {
    switch (e) {
      case "previous":
        var n2 = nt(t3);
        return n2 == null ? null : this.convertValue(n2, e);
      case "estimate":
        return this.convertTimestamp(rt(t3));
      default:
        return null;
    }
  }, t2.prototype.convertTimestamp = function(t3) {
    var e = X2(t3);
    return new tt(e.seconds, e.nanos);
  }, t2.prototype.convertDocumentKey = function(t3, e) {
    var n2 = z2.fromString(t3);
    k2(Xn(n2));
    var r2 = new Ru(n2.get(1), n2.get(3)), i = new H2(n2.popFirst(5));
    return r2.isEqual(e) || S2("Document " + i + " contains a document reference within a different database (" + r2.projectId + "/" + r2.database + ") which is not supported. It will be treated as a reference in the current database (" + e.projectId + "/" + e.database + ") instead."), i;
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function fc2(t2, e, n2) {
  return t2 ? n2 && (n2.merge || n2.mergeFields) ? t2.toFirestore(e, n2) : t2.toFirestore(e) : e;
}
__name(fc2, "fc");
var lc2 = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.convertBytes = function(t3) {
    return new pa2(t3);
  }, e.prototype.convertReference = function(t3) {
    var e2 = this.convertDocumentKey(t3, this.firestore._databaseId);
    return new Xu(this.firestore, null, e2);
  }, e;
}(hc2);
var dc2 = function() {
  function t2(t3, e) {
    this._firestore = t3, this._commitHandler = e, this._mutations = [], this._committed = false, this._dataReader = Ta2(t3);
  }
  __name(t2, "t");
  return t2.prototype.set = function(t3, e, n2) {
    this._verifyNotCommitted();
    var r2 = pc2(t3, this._firestore), i = fc2(r2._converter, e, n2), o = _a(this._dataReader, "WriteBatch.set", r2._key, i, r2._converter !== null, n2);
    return this._mutations.push(o.toMutation(r2._key, De.none())), this;
  }, t2.prototype.update = function(t3, e, n2) {
    for (var r2 = [], i = 3; i < arguments.length; i++)
      r2[i - 3] = arguments[i];
    this._verifyNotCommitted();
    var o, s = pc2(t3, this._firestore);
    return e instanceof Ju && (e = e._delegate), o = typeof e == "string" || e instanceof da2 ? La2(this._dataReader, "WriteBatch.update", s._key, e, n2, r2) : xa(this._dataReader, "WriteBatch.update", s._key, e), this._mutations.push(o.toMutation(s._key, De.exists(true))), this;
  }, t2.prototype.delete = function(t3) {
    this._verifyNotCommitted();
    var e = pc2(t3, this._firestore);
    return this._mutations = this._mutations.concat(new je(e._key, De.none())), this;
  }, t2.prototype.commit = function() {
    return this._verifyNotCommitted(), this._committed = true, this._mutations.length > 0 ? this._commitHandler(this._mutations) : Promise.resolve();
  }, t2.prototype._verifyNotCommitted = function() {
    if (this._committed)
      throw new G2(j.FAILED_PRECONDITION, "A write batch can no longer be used after commit() has been called.");
  }, t2;
}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function pc2(t2, e) {
  if (t2 instanceof Ju && (t2 = t2._delegate), t2.firestore !== e)
    throw new G2(j.INVALID_ARGUMENT, "Provided document reference is from a different Firestore instance.");
  return t2;
}
__name(pc2, "pc");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var yc2 = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.convertBytes = function(t3) {
    return new pa2(t3);
  }, e.prototype.convertReference = function(t3) {
    var e2 = this.convertDocumentKey(t3, this.firestore._databaseId);
    return new Xu(this.firestore, null, e2);
  }, e;
}(hc2);
function vc2(t2, e, n2) {
  for (var r2 = [], i = 3; i < arguments.length; i++)
    r2[i - 3] = arguments[i];
  t2 = Qu(t2, Xu);
  var o = Qu(t2.firestore, aa2), s = Ta2(o);
  return e instanceof Ju && (e = e._delegate), gc2(o, [(typeof e == "string" || e instanceof da2 ? La2(s, "updateDoc", t2._key, e, n2, r2) : xa(s, "updateDoc", t2._key, e)).toMutation(t2._key, De.exists(true))]);
}
__name(vc2, "vc");
function mc2(t2) {
  for (var e, n2, r2, i = [], o = 1; o < arguments.length; o++)
    i[o - 1] = arguments[o];
  t2 instanceof Ju && (t2 = t2._delegate);
  var s = {
    includeMetadataChanges: false
  }, u = 0;
  typeof i[u] != "object" || oa2(i[u]) || (s = i[u], u++);
  var a, c, h2, f = {
    includeMetadataChanges: s.includeMetadataChanges
  };
  if (oa2(i[u])) {
    var l = i[u];
    i[u] = (e = l.next) === null || e === void 0 ? void 0 : e.bind(l), i[u + 1] = (n2 = l.error) === null || n2 === void 0 ? void 0 : n2.bind(l), i[u + 2] = (r2 = l.complete) === null || r2 === void 0 ? void 0 : r2.bind(l);
  }
  if (t2 instanceof Xu)
    c = Qu(t2.firestore, aa2), h2 = Gt(t2._key.path), a = {
      next: function(e2) {
        i[u] && i[u](wc2(c, t2, e2));
      },
      error: i[u + 1],
      complete: i[u + 2]
    };
  else {
    var d = Qu(t2, $u);
    c = Qu(d.firestore, aa2), h2 = d._query;
    var p2 = new yc2(c);
    a = {
      next: function(t3) {
        i[u] && i[u](new Ya2(c, p2, d, t3));
      },
      error: i[u + 1],
      complete: i[u + 2]
    }, $a2(t2._query);
  }
  return function(t3, e2, n3, r3) {
    var i2 = this, o2 = new vu(r3), s2 = new Es(e2, o2, n3);
    return t3.asyncQueue.enqueueAndForget(function() {
      return __awaiter(i2, void 0, void 0, function() {
        var e3;
        return __generator(this, function(n4) {
          switch (n4.label) {
            case 0:
              return e3 = ms, [4, ku(t3)];
            case 1:
              return [2, e3.apply(void 0, [n4.sent(), s2])];
          }
        });
      });
    }), function() {
      o2.Xo(), t3.asyncQueue.enqueueAndForget(function() {
        return __awaiter(i2, void 0, void 0, function() {
          var e3;
          return __generator(this, function(n4) {
            switch (n4.label) {
              case 0:
                return e3 = gs, [4, ku(t3)];
              case 1:
                return [2, e3.apply(void 0, [n4.sent(), s2])];
            }
          });
        });
      });
    };
  }(ca2(c), h2, f, a);
}
__name(mc2, "mc");
function gc2(t2, e) {
  return function(t3, e2) {
    var n2 = this, r2 = new Ir();
    return t3.asyncQueue.enqueueAndForget(function() {
      return __awaiter(n2, void 0, void 0, function() {
        var n3;
        return __generator(this, function(i) {
          switch (i.label) {
            case 0:
              return n3 = Ms, [4, Au(t3)];
            case 1:
              return [2, n3.apply(void 0, [i.sent(), e2, r2])];
          }
        });
      });
    }), r2.promise;
  }(ca2(t2), e);
}
__name(gc2, "gc");
function wc2(t2, e, n2) {
  var r2 = n2.docs.get(e._key), i = new yc2(t2);
  return new Wa2(t2, i, e._key, r2, new Qa2(n2.hasPendingWrites, n2.fromCache), e._converter);
}
__name(wc2, "wc");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var bc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this)._firestore = e2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.get = function(e2) {
    var n2 = this, r2 = pc2(e2, this._firestore), i = new yc2(this._firestore);
    return t2.prototype.get.call(this, e2).then(function(t3) {
      return new Wa2(n2._firestore, i, r2._key, t3._document, new Qa2(false, false), r2._converter);
    });
  }, e;
}(function() {
  function t2(t3, e) {
    this._firestore = t3, this._transaction = e, this._dataReader = Ta2(t3);
  }
  __name(t2, "t");
  return t2.prototype.get = function(t3) {
    var e = this, n2 = pc2(t3, this._firestore), r2 = new lc2(this._firestore);
    return this._transaction.lookup([n2._key]).then(function(t4) {
      if (!t4 || t4.length !== 1)
        return A2();
      var i = t4[0];
      if (i instanceof wt)
        return new Ga2(e._firestore, r2, n2._key, null, n2._converter);
      if (i instanceof gt)
        return new Ga2(e._firestore, r2, i.key, i, n2._converter);
      throw A2();
    });
  }, t2.prototype.set = function(t3, e, n2) {
    var r2 = pc2(t3, this._firestore), i = fc2(r2._converter, e, n2), o = _a(this._dataReader, "Transaction.set", r2._key, i, r2._converter !== null, n2);
    return this._transaction.set(r2._key, o), this;
  }, t2.prototype.update = function(t3, e, n2) {
    for (var r2 = [], i = 3; i < arguments.length; i++)
      r2[i - 3] = arguments[i];
    var o, s = pc2(t3, this._firestore);
    return e instanceof Ju && (e = e._delegate), o = typeof e == "string" || e instanceof da2 ? La2(this._dataReader, "Transaction.update", s._key, e, n2, r2) : xa(this._dataReader, "Transaction.update", s._key, e), this._transaction.update(s._key, o), this;
  }, t2.prototype.delete = function(t3) {
    var e = pc2(t3, this._firestore);
    return this._transaction.delete(e._key), this;
  }, t2;
}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ic2() {
  if (typeof Uint8Array == "undefined")
    throw new G2(j.UNIMPLEMENTED, "Uint8Arrays are not available in this environment.");
}
__name(Ic2, "Ic");
function Ec2() {
  if (typeof atob == "undefined")
    throw new G2(j.UNIMPLEMENTED, "Blobs are unavailable in Firestore in this environment.");
}
__name(Ec2, "Ec");
var Tc2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.fromBase64String = function(t3) {
    return Ec2(), new e(pa2.fromBase64String(t3));
  }, e.fromUint8Array = function(t3) {
    return Ic2(), new e(pa2.fromUint8Array(t3));
  }, e.prototype.toBase64 = function() {
    return Ec2(), this._delegate.toBase64();
  }, e.prototype.toUint8Array = function() {
    return Ic2(), this._delegate.toUint8Array();
  }, e.prototype.isEqual = function(t3) {
    return this._delegate.isEqual(t3._delegate);
  }, e.prototype.toString = function() {
    return "Blob(base64: " + this.toBase64() + ")";
  }, e;
}(Ju);
var _c = function() {
  function t2() {
  }
  __name(t2, "t");
  return t2.prototype.enableIndexedDbPersistence = function(t3, e) {
    return function(t4, e2) {
      la(t4 = Qu(t4, aa2));
      var n2 = ca2(t4), r2 = t4._freezeSettings(), i = new pu();
      return fa2(n2, i, new lu(i, r2.cacheSizeBytes, e2 == null ? void 0 : e2.forceOwnership));
    }(t3._delegate, {
      forceOwnership: e
    });
  }, t2.prototype.enableMultiTabIndexedDbPersistence = function(t3) {
    return function(t4) {
      la(t4 = Qu(t4, aa2));
      var e = ca2(t4), n2 = t4._freezeSettings(), r2 = new pu();
      return fa2(e, r2, new du(r2, n2.cacheSizeBytes));
    }(t3._delegate);
  }, t2.prototype.clearIndexedDbPersistence = function(t3) {
    return function(t4) {
      var e = this;
      if (t4._initialized && !t4._terminated)
        throw new G2(j.FAILED_PRECONDITION, "Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");
      var n2 = new Ir();
      return t4._queue.enqueueAndForgetEvenWhileRestricted(function() {
        return __awaiter(e, void 0, void 0, function() {
          var e2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return r2.trys.push([0, 2, , 3]), [4, function(t5) {
                  return __awaiter(this, void 0, void 0, function() {
                    var e3;
                    return __generator(this, function(n3) {
                      switch (n3.label) {
                        case 0:
                          return _r.At() ? (e3 = t5 + "main", [4, _r.delete(e3)]) : [2, Promise.resolve()];
                        case 1:
                          return n3.sent(), [2];
                      }
                    });
                  });
                }(Pi(t4._databaseId, t4._persistenceKey))];
              case 1:
                return r2.sent(), n2.resolve(), [3, 3];
              case 2:
                return e2 = r2.sent(), n2.reject(e2), [3, 3];
              case 3:
                return [2];
            }
          });
        });
      }), n2.promise;
    }(t3._delegate);
  }, t2;
}();
var Sc2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, n2) || this).na = r2, i.INTERNAL = {
      delete: function() {
        return i.terminate();
      }
    }, e2 instanceof Ru || (i.sa = e2), i;
  }
  __name(e, "e");
  return __extends(e, t2), Object.defineProperty(e.prototype, "_databaseId", {
    get: function() {
      return this._delegate._databaseId;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.settings = function(t3) {
    t3.merge && delete (t3 = Object.assign(Object.assign({}, this._delegate._getSettings()), t3)).merge, this._delegate._setSettings(t3);
  }, e.prototype.useEmulator = function(t3, e2) {
    !function(t4, e3, n2) {
      var r2 = (t4 = Qu(t4, Yu))._getSettings();
      r2.host !== "firestore.googleapis.com" && r2.host !== e3 && D2("Host has been set in both settings() and useEmulator(), emulator host will be used"), t4._setSettings(Object.assign(Object.assign({}, r2), {
        host: e3 + ":" + n2,
        ssl: false
      }));
    }(this._delegate, t3, e2);
  }, e.prototype.enableNetwork = function() {
    return function(t3) {
      var e2 = this;
      return t3.asyncQueue.enqueue(function() {
        return __awaiter(e2, void 0, void 0, function() {
          var e3, n2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return [4, Su(t3)];
              case 1:
                return e3 = r2.sent(), [4, Nu(t3)];
              case 2:
                return n2 = r2.sent(), [2, (e3.setNetworkEnabled(true), function(t4) {
                  var e4 = C(t4);
                  return e4.Qr.delete(0), Vo(e4);
                }(n2))];
            }
          });
        });
      });
    }(ca2(Qu(this._delegate, aa2)));
  }, e.prototype.disableNetwork = function() {
    return function(t3) {
      var e2 = this;
      return t3.asyncQueue.enqueue(function() {
        return __awaiter(e2, void 0, void 0, function() {
          var e3, n2;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return [4, Su(t3)];
              case 1:
                return e3 = r2.sent(), [4, Nu(t3)];
              case 2:
                return n2 = r2.sent(), [2, (e3.setNetworkEnabled(false), function(t4) {
                  return __awaiter(this, void 0, void 0, function() {
                    var e4;
                    return __generator(this, function(n3) {
                      switch (n3.label) {
                        case 0:
                          return (e4 = C(t4)).Qr.add(0), [4, Uo(e4)];
                        case 1:
                          return n3.sent(), e4.jr.set("Offline"), [2];
                      }
                    });
                  });
                }(n2))];
            }
          });
        });
      });
    }(ca2(Qu(this._delegate, aa2)));
  }, e.prototype.enablePersistence = function(t3) {
    var e2 = false, n2 = false;
    return t3 && ju("synchronizeTabs", e2 = !!t3.synchronizeTabs, "experimentalForceOwningTab", n2 = !!t3.experimentalForceOwningTab), e2 ? this.na.enableMultiTabIndexedDbPersistence(this) : this.na.enableIndexedDbPersistence(this, n2);
  }, e.prototype.clearPersistence = function() {
    return this.na.clearIndexedDbPersistence(this);
  }, e.prototype.terminate = function() {
    return this.sa && (this.sa._removeServiceInstance("firestore"), this.sa._removeServiceInstance("firestore-exp")), this._delegate._delete();
  }, e.prototype.waitForPendingWrites = function() {
    return function(t3) {
      var e2 = this, n2 = new Ir();
      return t3.asyncQueue.enqueueAndForget(function() {
        return __awaiter(e2, void 0, void 0, function() {
          var e3;
          return __generator(this, function(r2) {
            switch (r2.label) {
              case 0:
                return e3 = js, [4, Au(t3)];
              case 1:
                return [2, e3.apply(void 0, [r2.sent(), n2])];
            }
          });
        });
      }), n2.promise;
    }(ca2(Qu(this._delegate, aa2)));
  }, e.prototype.onSnapshotsInSync = function(t3) {
    return function(t4, e2) {
      return function(t5, e3) {
        var n2 = this, r2 = new vu(e3);
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(n2, void 0, void 0, function() {
            var e4;
            return __generator(this, function(n3) {
              switch (n3.label) {
                case 0:
                  return e4 = /* @__PURE__ */ __name(function(t6, e5) {
                    C(t6).Zr.add(e5), e5.next();
                  }, "e"), [4, ku(t5)];
                case 1:
                  return [2, e4.apply(void 0, [n3.sent(), r2])];
              }
            });
          });
        }), function() {
          r2.Xo(), t5.asyncQueue.enqueueAndForget(function() {
            return __awaiter(n2, void 0, void 0, function() {
              var e4;
              return __generator(this, function(n3) {
                switch (n3.label) {
                  case 0:
                    return e4 = /* @__PURE__ */ __name(function(t6, e5) {
                      C(t6).Zr.delete(e5);
                    }, "e"), [4, ku(t5)];
                  case 1:
                    return [2, e4.apply(void 0, [n3.sent(), r2])];
                }
              });
            });
          });
        };
      }(ca2(t4 = Qu(t4, aa2)), oa2(e2) ? e2 : {
        next: e2
      });
    }(this._delegate, t3);
  }, Object.defineProperty(e.prototype, "app", {
    get: function() {
      if (!this.sa)
        throw new G2(j.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this.sa;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.collection = function(t3) {
    try {
      return new Uc2(this, ta2(this._delegate, t3));
    } catch (t4) {
      throw Lc2(t4, "collection()", "Firestore.collection()");
    }
  }, e.prototype.doc = function(t3) {
    try {
      return new xc(this, ea2(this._delegate, t3));
    } catch (t4) {
      throw Lc2(t4, "doc()", "Firestore.doc()");
    }
  }, e.prototype.collectionGroup = function(t3) {
    try {
      return new Fc2(this, function(t4, e2) {
        if (t4 = Qu(t4, Yu), Uu("collectionGroup", "collection id", e2), e2.indexOf("/") >= 0)
          throw new G2(j.INVALID_ARGUMENT, "Invalid collection ID '" + e2 + "' passed to function collectionGroup(). Collection IDs must not contain '/'.");
        return new $u(t4, null, function(t5) {
          return new Bt(z2.emptyPath(), t5);
        }(e2));
      }(this._delegate, t3));
    } catch (t4) {
      throw Lc2(t4, "collectionGroup()", "Firestore.collectionGroup()");
    }
  }, e.prototype.runTransaction = function(t3) {
    var e2 = this;
    return function(t4, e3) {
      return function(t5, e4) {
        var n2 = this, r2 = new Ir();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(n2, void 0, void 0, function() {
            var n3;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return [4, function(t6) {
                    return _u(t6).then(function(t7) {
                      return t7.datastore;
                    });
                  }(t5)];
                case 1:
                  return n3 = i.sent(), new wu(t5.asyncQueue, n3, e4, r2).run(), [2];
              }
            });
          });
        }), r2.promise;
      }(ca2(t4), function(n2) {
        return e3(new bc2(t4, n2));
      });
    }(this._delegate, function(n2) {
      return t3(new Ac2(e2, n2));
    });
  }, e.prototype.batch = function() {
    var t3 = this;
    return ca2(this._delegate), new kc2(new dc2(this._delegate, function(e2) {
      return gc2(t3._delegate, e2);
    }));
  }, e.prototype.loadBundle = function(t3) {
    throw new G2(j.FAILED_PRECONDITION, '"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?');
  }, e.prototype.namedQuery = function(t3) {
    throw new G2(j.FAILED_PRECONDITION, '"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?');
  }, e;
}(Ju);
var Dc2 = function(t2) {
  function e(e2) {
    var n2 = this;
    return (n2 = t2.call(this) || this).firestore = e2, n2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.convertBytes = function(t3) {
    return new Tc2(new pa2(t3));
  }, e.prototype.convertReference = function(t3) {
    var e2 = this.convertDocumentKey(t3, this.firestore._databaseId);
    return xc.ia(e2, this.firestore, null);
  }, e;
}(hc2);
function Nc2(t2) {
  var e;
  e = t2, E2.setLogLevel(e);
}
__name(Nc2, "Nc");
var Ac2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this)._firestore = e2, r2._userDataWriter = new Dc2(e2), r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.get = function(t3) {
    var e2 = this, n2 = Bc2(t3);
    return this._delegate.get(n2).then(function(t4) {
      return new Pc2(e2._firestore, new Wa2(e2._firestore._delegate, e2._userDataWriter, t4._key, t4._document, t4.metadata, n2._converter));
    });
  }, e.prototype.set = function(t3, e2, n2) {
    var r2 = Bc2(t3);
    return n2 ? (Bu("Transaction.set", n2), this._delegate.set(r2, e2, n2)) : this._delegate.set(r2, e2), this;
  }, e.prototype.update = function(t3, e2, n2) {
    for (var r2, i = [], o = 3; o < arguments.length; o++)
      i[o - 3] = arguments[o];
    var s = Bc2(t3);
    return arguments.length === 2 ? this._delegate.update(s, e2) : (r2 = this._delegate).update.apply(r2, __spreadArray([s, e2, n2], i)), this;
  }, e.prototype.delete = function(t3) {
    var e2 = Bc2(t3);
    return this._delegate.delete(e2), this;
  }, e;
}(Ju);
var kc2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.set = function(t3, e2, n2) {
    var r2 = Bc2(t3);
    return n2 ? (Bu("WriteBatch.set", n2), this._delegate.set(r2, e2, n2)) : this._delegate.set(r2, e2), this;
  }, e.prototype.update = function(t3, e2, n2) {
    for (var r2, i = [], o = 3; o < arguments.length; o++)
      i[o - 3] = arguments[o];
    var s = Bc2(t3);
    return arguments.length === 2 ? this._delegate.update(s, e2) : (r2 = this._delegate).update.apply(r2, __spreadArray([s, e2, n2], i)), this;
  }, e.prototype.delete = function(t3) {
    var e2 = Bc2(t3);
    return this._delegate.delete(e2), this;
  }, e.prototype.commit = function() {
    return this._delegate.commit();
  }, e;
}(Ju);
var Cc2 = function(t2) {
  function e(e2, n2, r2) {
    var i = this;
    return (i = t2.call(this, r2) || this)._firestore = e2, i._userDataWriter = n2, i;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.fromFirestore = function(t3, e2) {
    var n2 = new Ha2(this._firestore._delegate, this._userDataWriter, t3._key, t3._document, t3.metadata, null);
    return this._delegate.fromFirestore(new Mc2(this._firestore, n2), e2 != null ? e2 : {});
  }, e.prototype.toFirestore = function(t3, e2) {
    return e2 ? this._delegate.toFirestore(t3, e2) : this._delegate.toFirestore(t3);
  }, e.ra = function(t3, n2) {
    var r2 = e.oa, i = r2.get(t3);
    i || (i = new WeakMap(), r2.set(t3, i));
    var o = i.get(n2);
    return o || (o = new e(t3, new Dc2(t3), n2), i.set(n2, o)), o;
  }, e;
}(Ju);
Cc2.oa = new WeakMap();
var xc = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).firestore = e2, r2._userDataWriter = new Dc2(e2), r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.ca = function(t3, n2, r2) {
    if (t3.length % 2 != 0)
      throw new G2(j.INVALID_ARGUMENT, "Invalid document reference. Document references must have an even number of segments, but " + t3.canonicalString() + " has " + t3.length);
    return new e(n2, new Xu(n2._delegate, r2, new H2(t3)));
  }, e.ia = function(t3, n2, r2) {
    return new e(n2, new Xu(n2._delegate, r2, t3));
  }, Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "parent", {
    get: function() {
      return new Uc2(this.firestore, this._delegate.parent);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "path", {
    get: function() {
      return this._delegate.path;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.collection = function(t3) {
    try {
      return new Uc2(this.firestore, ta2(this._delegate, t3));
    } catch (t4) {
      throw Lc2(t4, "collection()", "DocumentReference.collection()");
    }
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof Ju && (t3 = t3._delegate), t3 instanceof Xu && na2(this._delegate, t3);
  }, e.prototype.set = function(t3, e2) {
    e2 = Bu("DocumentReference.set", e2);
    try {
      return function(t4, e3, n2) {
        t4 = Qu(t4, Xu);
        var r2 = Qu(t4.firestore, aa2), i = fc2(t4._converter, e3, n2);
        return gc2(r2, [_a(Ta2(r2), "setDoc", t4._key, i, t4._converter !== null, n2).toMutation(t4._key, De.none())]);
      }(this._delegate, t3, e2);
    } catch (t4) {
      throw Lc2(t4, "setDoc()", "DocumentReference.set()");
    }
  }, e.prototype.update = function(t3, e2) {
    for (var n2 = [], r2 = 2; r2 < arguments.length; r2++)
      n2[r2 - 2] = arguments[r2];
    try {
      return arguments.length === 1 ? vc2(this._delegate, t3) : vc2.apply(void 0, __spreadArray([this._delegate, t3, e2], n2));
    } catch (t4) {
      throw Lc2(t4, "updateDoc()", "DocumentReference.update()");
    }
  }, e.prototype.delete = function() {
    return gc2(Qu((t3 = this._delegate).firestore, aa2), [new je(t3._key, De.none())]);
    var t3;
  }, e.prototype.onSnapshot = function() {
    for (var t3 = this, e2 = [], n2 = 0; n2 < arguments.length; n2++)
      e2[n2] = arguments[n2];
    var r2 = Rc2(e2), i = Oc2(e2, function(e3) {
      return new Pc2(t3.firestore, new Wa2(t3.firestore._delegate, t3._userDataWriter, e3._key, e3._document, e3.metadata, t3._delegate._converter));
    });
    return mc2(this._delegate, r2, i);
  }, e.prototype.get = function(t3) {
    var e2 = this;
    return ((t3 == null ? void 0 : t3.source) === "cache" ? function(t4) {
      t4 = Qu(t4, Xu);
      var e3 = Qu(t4.firestore, aa2), n2 = ca2(e3), r2 = new yc2(e3);
      return function(t5, e4) {
        var n3 = this, r3 = new Ir();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(n3, void 0, void 0, function() {
            var n4;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return n4 = /* @__PURE__ */ __name(function(t6, e5, n5) {
                    return __awaiter(this, void 0, void 0, function() {
                      var r4, i2;
                      return __generator(this, function(o) {
                        switch (o.label) {
                          case 0:
                            return o.trys.push([0, 2, , 3]), [4, function(t7, e6) {
                              var n6 = C(t7);
                              return n6.persistence.runTransaction("read document", "readonly", function(t8) {
                                return n6.Kn.In(t8, e6);
                              });
                            }(t6, e5)];
                          case 1:
                            return (i2 = o.sent()) instanceof gt ? n5.resolve(i2) : i2 instanceof wt ? n5.resolve(null) : n5.reject(new G2(j.UNAVAILABLE, "Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")), [3, 3];
                          case 2:
                            return r4 = o.sent(), i2 = fs(r4, "Failed to get document '" + e5 + " from cache"), n5.reject(i2), [3, 3];
                          case 3:
                            return [2];
                        }
                      });
                    });
                  }, "n"), [4, Du(t5)];
                case 1:
                  return [2, n4.apply(void 0, [i.sent(), e4, r3])];
              }
            });
          });
        }), r3.promise;
      }(n2, t4._key).then(function(n3) {
        return new Wa2(e3, r2, t4._key, n3, new Qa2(n3 instanceof gt && n3.hasLocalMutations, true), t4._converter);
      });
    }(this._delegate) : (t3 == null ? void 0 : t3.source) === "server" ? function(t4) {
      t4 = Qu(t4, Xu);
      var e3 = Qu(t4.firestore, aa2);
      return Cu(ca2(e3), t4._key, {
        source: "server"
      }).then(function(n2) {
        return wc2(e3, t4, n2);
      });
    }(this._delegate) : function(t4) {
      t4 = Qu(t4, Xu);
      var e3 = Qu(t4.firestore, aa2);
      return Cu(ca2(e3), t4._key).then(function(n2) {
        return wc2(e3, t4, n2);
      });
    }(this._delegate)).then(function(t4) {
      return new Pc2(e2.firestore, new Wa2(e2.firestore._delegate, e2._userDataWriter, t4._key, t4._document, t4.metadata, e2._delegate._converter));
    });
  }, e.prototype.withConverter = function(t3) {
    return new e(this.firestore, t3 ? this._delegate.withConverter(Cc2.ra(this.firestore, t3)) : this._delegate.withConverter(null));
  }, e;
}(Ju);
function Lc2(t2, e, n2) {
  return t2.message = t2.message.replace(e, n2), t2;
}
__name(Lc2, "Lc");
function Rc2(t2) {
  for (var e = 0, n2 = t2; e < n2.length; e++) {
    var r2 = n2[e];
    if (typeof r2 == "object" && !oa2(r2))
      return r2;
  }
  return {};
}
__name(Rc2, "Rc");
function Oc2(t2, e) {
  var n2, r2, i;
  return {
    next: function(t3) {
      i.next && i.next(e(t3));
    },
    error: (n2 = (i = oa2(t2[0]) ? t2[0] : oa2(t2[1]) ? t2[1] : typeof t2[0] == "function" ? {
      next: t2[0],
      error: t2[1],
      complete: t2[2]
    } : {
      next: t2[1],
      error: t2[2],
      complete: t2[3]
    }).error) === null || n2 === void 0 ? void 0 : n2.bind(i),
    complete: (r2 = i.complete) === null || r2 === void 0 ? void 0 : r2.bind(i)
  };
}
__name(Oc2, "Oc");
var Pc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this)._firestore = e2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), Object.defineProperty(e.prototype, "ref", {
    get: function() {
      return new xc(this._firestore, this._delegate.ref);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "metadata", {
    get: function() {
      return this._delegate.metadata;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "exists", {
    get: function() {
      return this._delegate.exists();
    },
    enumerable: false,
    configurable: true
  }), e.prototype.data = function(t3) {
    return this._delegate.data(t3);
  }, e.prototype.get = function(t3, e2) {
    return this._delegate.get(t3, e2);
  }, e.prototype.isEqual = function(t3) {
    return Xa2(this._delegate, t3._delegate);
  }, e;
}(Ju);
var Mc2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.data = function(t3) {
    return this._delegate.data(t3);
  }, e;
}(Pc2);
var Fc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this).firestore = e2, r2._userDataWriter = new Dc2(e2), r2;
  }
  __name(e, "e");
  return __extends(e, t2), e.prototype.where = function(t3, n2, r2) {
    try {
      return new e(this.firestore, tc(this._delegate, function(t4, e2, n3) {
        var r3 = e2, i = za2("where", t4);
        return new ec2(i, r3, n3);
      }(t3, n2, r2)));
    } catch (t4) {
      throw Lc2(t4, /(orderBy|where)\(\)/, "Query.$1()");
    }
  }, e.prototype.orderBy = function(t3, n2) {
    try {
      return new e(this.firestore, tc(this._delegate, function(t4, e2) {
        e2 === void 0 && (e2 = "asc");
        var n3 = e2, r2 = za2("orderBy", t4);
        return new nc2(r2, n3);
      }(t3, n2)));
    } catch (t4) {
      throw Lc2(t4, /(orderBy|where)\(\)/, "Query.$1()");
    }
  }, e.prototype.limit = function(t3) {
    try {
      return new e(this.firestore, tc(this._delegate, function(t4) {
        return Wu("limit", t4), new rc2("limit", t4, "F");
      }(t3)));
    } catch (t4) {
      throw Lc2(t4, "limit()", "Query.limit()");
    }
  }, e.prototype.limitToLast = function(t3) {
    try {
      return new e(this.firestore, tc(this._delegate, function(t4) {
        return Wu("limitToLast", t4), new rc2("limitToLast", t4, "L");
      }(t3)));
    } catch (t4) {
      throw Lc2(t4, "limitToLast()", "Query.limitToLast()");
    }
  }, e.prototype.startAt = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    try {
      return new e(this.firestore, tc(this._delegate, function() {
        for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
          t4[e2] = arguments[e2];
        return new ic2("startAt", t4, true);
      }.apply(void 0, t3)));
    } catch (t4) {
      throw Lc2(t4, "startAt()", "Query.startAt()");
    }
  }, e.prototype.startAfter = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    try {
      return new e(this.firestore, tc(this._delegate, function() {
        for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
          t4[e2] = arguments[e2];
        return new ic2("startAfter", t4, false);
      }.apply(void 0, t3)));
    } catch (t4) {
      throw Lc2(t4, "startAfter()", "Query.startAfter()");
    }
  }, e.prototype.endBefore = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    try {
      return new e(this.firestore, tc(this._delegate, function() {
        for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
          t4[e2] = arguments[e2];
        return new oc2("endBefore", t4, true);
      }.apply(void 0, t3)));
    } catch (t4) {
      throw Lc2(t4, "endBefore()", "Query.endBefore()");
    }
  }, e.prototype.endAt = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    try {
      return new e(this.firestore, tc(this._delegate, function() {
        for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
          t4[e2] = arguments[e2];
        return new oc2("endAt", t4, false);
      }.apply(void 0, t3)));
    } catch (t4) {
      throw Lc2(t4, "endAt()", "Query.endAt()");
    }
  }, e.prototype.isEqual = function(t3) {
    return ra2(this._delegate, t3._delegate);
  }, e.prototype.get = function(t3) {
    var e2 = this;
    return ((t3 == null ? void 0 : t3.source) === "cache" ? function(t4) {
      t4 = Qu(t4, $u);
      var e3 = Qu(t4.firestore, aa2), n2 = ca2(e3), r2 = new yc2(e3);
      return function(t5, e4) {
        var n3 = this, r3 = new Ir();
        return t5.asyncQueue.enqueueAndForget(function() {
          return __awaiter(n3, void 0, void 0, function() {
            var n4;
            return __generator(this, function(i) {
              switch (i.label) {
                case 0:
                  return n4 = /* @__PURE__ */ __name(function(t6, e5, n5) {
                    return __awaiter(this, void 0, void 0, function() {
                      var r4, i2, o, s, u;
                      return __generator(this, function(a) {
                        switch (a.label) {
                          case 0:
                            return a.trys.push([0, 2, , 3]), [4, Ji(t6, e5, true)];
                          case 1:
                            return u = a.sent(), r4 = new ks(e5, u.jn), i2 = r4.Io(u.documents), o = r4.applyChanges(i2, false), n5.resolve(o.snapshot), [3, 3];
                          case 2:
                            return s = a.sent(), u = fs(s, "Failed to execute query '" + e5 + " against cache"), n5.reject(u), [3, 3];
                          case 3:
                            return [2];
                        }
                      });
                    });
                  }, "n"), [4, Du(t5)];
                case 1:
                  return [2, n4.apply(void 0, [i.sent(), e4, r3])];
              }
            });
          });
        }), r3.promise;
      }(n2, t4._query).then(function(n3) {
        return new Ya2(e3, r2, t4, n3);
      });
    }(this._delegate) : (t3 == null ? void 0 : t3.source) === "server" ? function(t4) {
      t4 = Qu(t4, $u);
      var e3 = Qu(t4.firestore, aa2), n2 = ca2(e3), r2 = new yc2(e3);
      return xu(n2, t4._query, {
        source: "server"
      }).then(function(n3) {
        return new Ya2(e3, r2, t4, n3);
      });
    }(this._delegate) : function(t4) {
      t4 = Qu(t4, $u);
      var e3 = Qu(t4.firestore, aa2), n2 = ca2(e3), r2 = new yc2(e3);
      return $a2(t4._query), xu(n2, t4._query).then(function(n3) {
        return new Ya2(e3, r2, t4, n3);
      });
    }(this._delegate)).then(function(t4) {
      return new Vc2(e2.firestore, new Ya2(e2.firestore._delegate, e2._userDataWriter, e2._delegate, t4._snapshot));
    });
  }, e.prototype.onSnapshot = function() {
    for (var t3 = this, e2 = [], n2 = 0; n2 < arguments.length; n2++)
      e2[n2] = arguments[n2];
    var r2 = Rc2(e2), i = Oc2(e2, function(e3) {
      return new Vc2(t3.firestore, new Ya2(t3.firestore._delegate, t3._userDataWriter, t3._delegate, e3._snapshot));
    });
    return mc2(this._delegate, r2, i);
  }, e.prototype.withConverter = function(t3) {
    return new e(this.firestore, t3 ? this._delegate.withConverter(Cc2.ra(this.firestore, t3)) : this._delegate.withConverter(null));
  }, e;
}(Ju);
var qc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this)._firestore = e2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), Object.defineProperty(e.prototype, "type", {
    get: function() {
      return this._delegate.type;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "doc", {
    get: function() {
      return new Mc2(this._firestore, this._delegate.doc);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "oldIndex", {
    get: function() {
      return this._delegate.oldIndex;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "newIndex", {
    get: function() {
      return this._delegate.newIndex;
    },
    enumerable: false,
    configurable: true
  }), e;
}(Ju);
var Vc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, n2) || this)._firestore = e2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), Object.defineProperty(e.prototype, "query", {
    get: function() {
      return new Fc2(this._firestore, this._delegate.query);
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "metadata", {
    get: function() {
      return this._delegate.metadata;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "size", {
    get: function() {
      return this._delegate.size;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "empty", {
    get: function() {
      return this._delegate.empty;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "docs", {
    get: function() {
      var t3 = this;
      return this._delegate.docs.map(function(e2) {
        return new Mc2(t3._firestore, e2);
      });
    },
    enumerable: false,
    configurable: true
  }), e.prototype.docChanges = function(t3) {
    var e2 = this;
    return this._delegate.docChanges(t3).map(function(t4) {
      return new qc2(e2._firestore, t4);
    });
  }, e.prototype.forEach = function(t3, e2) {
    var n2 = this;
    this._delegate.forEach(function(r2) {
      t3.call(e2, new Mc2(n2._firestore, r2));
    });
  }, e.prototype.isEqual = function(t3) {
    return Xa2(this._delegate, t3._delegate);
  }, e;
}(Ju);
var Uc2 = function(t2) {
  function e(e2, n2) {
    var r2 = this;
    return (r2 = t2.call(this, e2, n2) || this).firestore = e2, r2._delegate = n2, r2;
  }
  __name(e, "e");
  return __extends(e, t2), Object.defineProperty(e.prototype, "id", {
    get: function() {
      return this._delegate.id;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "path", {
    get: function() {
      return this._delegate.path;
    },
    enumerable: false,
    configurable: true
  }), Object.defineProperty(e.prototype, "parent", {
    get: function() {
      var t3 = this._delegate.parent;
      return t3 ? new xc(this.firestore, t3) : null;
    },
    enumerable: false,
    configurable: true
  }), e.prototype.doc = function(t3) {
    try {
      return new xc(this.firestore, t3 === void 0 ? ea2(this._delegate) : ea2(this._delegate, t3));
    } catch (t4) {
      throw Lc2(t4, "doc()", "CollectionReference.doc()");
    }
  }, e.prototype.add = function(t3) {
    var e2 = this;
    return function(t4, e3) {
      var n2 = Qu(t4.firestore, aa2), r2 = ea2(t4), i = fc2(t4._converter, e3);
      return gc2(n2, [_a(Ta2(t4.firestore), "addDoc", r2._key, i, t4._converter !== null, {}).toMutation(r2._key, De.exists(false))]).then(function() {
        return r2;
      });
    }(this._delegate, t3).then(function(t4) {
      return new xc(e2.firestore, t4);
    });
  }, e.prototype.isEqual = function(t3) {
    return na2(this._delegate, t3._delegate);
  }, e.prototype.withConverter = function(t3) {
    return new e(this.firestore, t3 ? this._delegate.withConverter(Cc2.ra(this.firestore, t3)) : this._delegate.withConverter(null));
  }, e;
}(Fc2);
function Bc2(t2) {
  return t2 instanceof Ju && (t2 = t2._delegate), Qu(t2, Xu);
}
__name(Bc2, "Bc");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var jc2 = function(t2) {
  function e() {
    for (var e2 = [], n2 = 0; n2 < arguments.length; n2++)
      e2[n2] = arguments[n2];
    return t2.call(this, new (da2.bind.apply(da2, __spreadArray([void 0], e2)))()) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.documentId = function() {
    return new e(W2.keyField().canonicalString());
  }, e.prototype.isEqual = function(t3) {
    return t3 instanceof Ju && (t3 = t3._delegate), t3 instanceof da2 && this._delegate._internalPath.isEqual(t3._internalPath);
  }, e;
}(Ju);
var Gc2 = function(t2) {
  function e() {
    return t2 !== null && t2.apply(this, arguments) || this;
  }
  __name(e, "e");
  return __extends(e, t2), e.serverTimestamp = function() {
    var t3 = new Na("serverTimestamp");
    return t3._methodName = "FieldValue.serverTimestamp", new e(t3);
  }, e.delete = function() {
    var t3 = new Sa("deleteField");
    return t3._methodName = "FieldValue.delete", new e(t3);
  }, e.arrayUnion = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    var r2 = function() {
      for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
        t4[e2] = arguments[e2];
      return new Aa2("arrayUnion", t4);
    }.apply(void 0, t3);
    return r2._methodName = "FieldValue.arrayUnion", new e(r2);
  }, e.arrayRemove = function() {
    for (var t3 = [], n2 = 0; n2 < arguments.length; n2++)
      t3[n2] = arguments[n2];
    var r2 = function() {
      for (var t4 = [], e2 = 0; e2 < arguments.length; e2++)
        t4[e2] = arguments[e2];
      return new ka2("arrayRemove", t4);
    }.apply(void 0, t3);
    return r2._methodName = "FieldValue.arrayRemove", new e(r2);
  }, e.increment = function(t3) {
    var n2 = function(t4) {
      return new Ca2("increment", t4);
    }(t3);
    return n2._methodName = "FieldValue.increment", new e(n2);
  }, e.prototype.isEqual = function(t3) {
    return this._delegate.isEqual(t3._delegate);
  }, e;
}(Ju);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// ../../../node_modules/@firebase/firestore/dist/esm5/index.js
var L3 = {
  Firestore: Sc2,
  GeoPoint: va,
  Timestamp: tt,
  Blob: Tc2,
  Transaction: Ac2,
  WriteBatch: kc2,
  DocumentReference: xc,
  DocumentSnapshot: Pc2,
  Query: Fc2,
  QueryDocumentSnapshot: Mc2,
  QuerySnapshot: Vc2,
  CollectionReference: Uc2,
  FieldPath: jc2,
  FieldValue: Gc2,
  setLogLevel: Nc2,
  CACHE_SIZE_UNLIMITED: ua2
};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function P3(e) {
  !function(e2, r2) {
    e2.INTERNAL.registerComponent(new Component("firestore", function(e3) {
      var t2 = e3.getProvider("app").getImmediate();
      return r2(t2, e3.getProvider("auth-internal"));
    }, "PUBLIC").setServiceProps(Object.assign({}, L3)));
  }(e, function(e2, s) {
    return new Sc2(e2, new aa2(e2, s), new _c());
  }), e.registerVersion("@firebase/firestore", "2.2.1");
}
__name(P3, "P");
P3(index_esm_default);
//# sourceMappingURL=firebase_firestore.js.map
